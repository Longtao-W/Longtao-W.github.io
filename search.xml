<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>longtaoLM的使用</title>
      <link href="metaverse/longtaollm/"/>
      <url>metaverse/longtaollm/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>longtaoLM是一个精简的中文语言模型</p><h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><p>在下面的input中输入文字，等待一段时间将会在右侧给出生成的结果；</p><p>注意，如果提问，必须带上问号<code>?</code></p><iframe    src="https://eustance-eustance-longtao-v1.hf.space"    frameborder="0"    width="850"    height="450"></iframe>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CodeGeeXr多语言代码生成模型</title>
      <link href="metaverse/codegeex/"/>
      <url>metaverse/codegeex/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>去年copilot微软发布的基于AI的辅助工具因为利用Github开源代码，造成了不小的冲击，不过copilot的功能还是让人印象深刻</p><p><strong>代码补全</strong>：很多ide都支持，单copilot 增强了 IDE 的补全功能。</p><p><strong>注释即代码</strong>：通过编写注释然后一路根据 copilot 的提示编写出完整的程序</p><p>copilot虽好，但是随着收费，热度也在下降，而最近清华大学和华为推出的开源工具CodeGeeX，不仅仅兼容copilot功能，还支持了代码翻译等功能，根据宣传，主要有一下几个特点：</p><p><strong>高精度代码生成</strong>：支持生成Python、C++、Java、JavaScript和Go等多种主流编程语言的代码，在HumanEval-X代码生成任务上取得47%~60%求解率，较其他开源基线模型有更佳的平均性能。</p><p><strong>跨语言代码翻译</strong>：支持代码片段在不同编程语言间进行自动翻译转换，翻译结果正确率高，在HumanEval-X代码翻译任务上超越了其它基线模型。</p><p><strong>自动编程插件</strong>：CodeGeeX插件现已上架VSCode插件市场（完全免费），用户可以通过其强大的少样本生成能力，自定义代码生成风格和能力，更好辅助代码编写</p><h2 id="相关地址"><a href="#相关地址" class="headerlink" title="相关地址"></a>相关地址</h2><h2 id="demo试用地址"><a href="#demo试用地址" class="headerlink" title="demo试用地址"></a>demo试用地址</h2><h3 id="在线生成与翻译DEMO"><a href="#在线生成与翻译DEMO" class="headerlink" title="在线生成与翻译DEMO"></a>在线生成与翻译DEMO</h3><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/22/100811112691208133214153230147421061462154_gopic_.png" alt="img"></p><p>DEMO地址：<a href="https://models.aminer.cn/codegeex/zh-CN/playground">代码生成</a>和<a href="https://models.aminer.cn/codegeex/zh-CN/codeTranslator">代码翻译</a></p><h2 id="自动编程VS-Code插件"><a href="#自动编程VS-Code插件" class="headerlink" title="自动编程VS Code插件"></a>自动编程VS Code插件</h2><p>插件下载地址：<a href="https://marketplace.visualstudio.com/items?itemName=aminer.codegeex">https://marketplace.visualstudio.com/items?itemName=aminer.codegeex</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>grub介绍及使用</title>
      <link href="metaverse/grub/"/>
      <url>metaverse/grub/</url>
      
        <content type="html"><![CDATA[<h2 id="多重操作系统引导管理器"><a href="#多重操作系统引导管理器" class="headerlink" title="多重操作系统引导管理器"></a>多重操作系统引导管理器</h2><h3 id="什么是多重引导"><a href="#什么是多重引导" class="headerlink" title="什么是多重引导"></a>什么是多重引导</h3><p>多重引导指一台计算机上安装多个操作系统,同时可以选择启动哪一个,例如常见的双系统也被叫做双引导</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>grub是GNU项目的启动引导程序，可以用于选择操作系统分区中的不同内核也可以向内核传递启动参数</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ol><li><p>修改/etc/default/grub中的参数</p></li><li><p>1.当为legacyBIOS时</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>2.当为UEFIBIOS时</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/efi/EFI/操作系统名称/grub.cfg </span><br></pre></td></tr></table></figure></li><li><p>重启机器</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu使用指北</title>
      <link href="metaverse/ubuntu/"/>
      <url>metaverse/ubuntu/</url>
      
        <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>[toc]</p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211124/1637718777Ubuntu-Pink.png"></p><h2 id="方便使用"><a href="#方便使用" class="headerlink" title="方便使用"></a>方便使用</h2><h3 id="ubuntu的sudo不用每次都输入密码解决办法"><a href="#ubuntu的sudo不用每次都输入密码解决办法" class="headerlink" title="ubuntu的sudo不用每次都输入密码解决办法"></a>ubuntu的sudo不用每次都输入密码解决办法</h3><p><strong>方法</strong>:修改<code>/etc/sudoers</code>文件中的<code>%sudo   ALL=(ALL:ALL) ALL   修改为  %sudo   ALL=(ALL:ALL) NOPASSWD:ALL</code><br><strong>原因</strong>：<code>/etc/sudoers</code>为<code>sudo</code>配置文件，当用户执行<code>sudo</code>时，系统会主动寻找<code>/etc/sudoers</code>文件，判断该用户是否有执行<code>sudo</code>的权限，确认用户具有可执行sudo的权限后，让用户输入用户自己的密码确认，若密码输入成功，则开始执行sudo后续的命令</p><h3 id="py2-py3-设置-pip"><a href="#py2-py3-设置-pip" class="headerlink" title="py2 py3 设置 pip"></a>py2 py3 设置 pip</h3><p>下载<a href="https://bootstrap.pypa.io/pip/2.7/get-pip.py">https://bootstrap.pypa.io/pip/2.7/get-pip.py</a></p><p>sudo python2 get-pip.py安装 就可使用pip2了</p><h2 id="Linux-通用"><a href="#Linux-通用" class="headerlink" title="Linux 通用"></a>Linux 通用</h2><h3 id="linux如何制作U盘系统镜像"><a href="#linux如何制作U盘系统镜像" class="headerlink" title="linux如何制作U盘系统镜像"></a>linux如何制作U盘系统镜像</h3><p>方法挺多的，这里用<code>dd</code>命令实现</p><h4 id="获取U盘路径"><a href="#获取U盘路径" class="headerlink" title="获取U盘路径"></a>获取U盘路径</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l <span class="comment">#diskmode 是 USB的那个就是</span></span><br></pre></td></tr></table></figure><h4 id="卸载U盘"><a href="#卸载U盘" class="headerlink" title="卸载U盘"></a>卸载U盘</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /dev/sda* <span class="comment">#我这里的U盘路径是/dev/sda</span></span><br></pre></td></tr></table></figure><h4 id="格式化U盘"><a href="#格式化U盘" class="headerlink" title="格式化U盘"></a>格式化U盘</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs.vfat /dev/sda -I <span class="comment"># mkfs.vfat 与mkfs.fat以及mkdosfs效果一样的都是创建vfat文件系统</span></span><br></pre></td></tr></table></figure><h4 id="制作系统盘"><a href="#制作系统盘" class="headerlink" title="制作系统盘"></a>制作系统盘</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd <span class="keyword">if</span>=~/yourImage.iso of=/dev/sda <span class="comment"># ~/yourImage.iso是你的iso文件</span></span><br></pre></td></tr></table></figure><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ol><li>dd命令直接将Linux的iso写入U盘就能开机引导的原因是，这些Linux的iso自带了引导文件，所以用dd将Windows的iso写入U盘将不能开机引导，Windows的U盘启动盘制作方法，请参考本文第三小节</li></ol><h3 id="配置免密"><a href="#配置免密" class="headerlink" title="配置免密"></a>配置免密</h3><p>如果没有设置root密码，先设置一下root账户密码：<br>sudo passwd root<br>为了避免每次sudo都要输入密码，这里配置一下visudo：<br>sudo visudo<br>在文件最后加上一句（改为自己的用户名）：<br>longtao ALL=(ALL) NOPASSWD: ALL</p><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了"><a href="#IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了" class="headerlink" title="IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了"></a>IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了</h2><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/22/17622374100240188772124472144517832259_image-20220721114611372.png" alt="image-20220721114611372"></p><h2 id="IBUS输入法与jetbrain全家桶有冲突，谨慎使用"><a href="#IBUS输入法与jetbrain全家桶有冲突，谨慎使用" class="headerlink" title="IBUS输入法与jetbrain全家桶有冲突，谨慎使用"></a>IBUS输入法与jetbrain全家桶有冲突，谨慎使用</h2>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>collectd后台监控程序</title>
      <link href="metaverse/collectd/"/>
      <url>metaverse/collectd/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>collectd 是一个后台监控程序，用来采集其所运行系统上的系统信息，并提供各种存储方式来存储为不同值的格式，例如 RRD 文件形式、文本格式、MongoDB 等等</p><p><strong>连接</strong>：<a href="https://collectd.org/index.shtml">官网文档</a>、<a href="https://collectd.org/download.shtml">下载地址</a>、<a href="https://github.com/collectd/collectd">源码地址</a></p><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ol><li>C语言编写，性能好，跨平台能力强</li><li>插件丰富，方便扩充</li></ol><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ol><li>监控简单</li><li>不能直接生成图形</li></ol><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>修改<code>sudo vim /opt/collectd/etc/collectd.conf</code>选择自己需要的插件</p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p><code>systemctl start collectd</code> 启动服务</p><h3 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h3><p>若开启了<code>rrdtool</code>插件就可在<code>/var/lib/collectd/rrd/</code>目录下看到相应的统计数据</p><p>日志存储在<code>/var/log/syslog</code></p><h2 id="主要插件"><a href="#主要插件" class="headerlink" title="主要插件"></a>主要插件</h2><h3 id="virt"><a href="#virt" class="headerlink" title="virt"></a>virt</h3><h4 id="vcpu"><a href="#vcpu" class="headerlink" title="vcpu"></a>vcpu</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get_vcpu_stats</span><span class="params">(virDomainPtr domain, <span class="keyword">unsigned</span> <span class="keyword">short</span> nr_virt_cpu)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> max_cpus = VIR_NODEINFO_MAXCPUS(nodeinfo);</span><br><span class="line"></span><br><span class="line">  virVcpuInfoPtr vinfo = <span class="built_in">calloc</span>(nr_virt_cpu, <span class="keyword">sizeof</span>(*vinfo));</span><br><span class="line">  <span class="keyword">if</span> (vinfo == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    ERROR(PLUGIN_NAME <span class="string">&quot; plugin: calloc failed.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> cpu_map_len = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> *cpumaps = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (extra_stats &amp; ex_stats_vcpupin) &#123;</span><br><span class="line">    cpu_map_len = VIR_CPU_MAPLEN(max_cpus);</span><br><span class="line">    cpumaps = <span class="built_in">calloc</span>(nr_virt_cpu, cpu_map_len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cpumaps == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      ERROR(PLUGIN_NAME <span class="string">&quot; plugin: calloc failed.&quot;</span>);</span><br><span class="line">      sfree(vinfo);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> status =</span><br><span class="line">      virDomainGetVcpus(domain, vinfo, nr_virt_cpu, cpumaps, cpu_map_len);</span><br><span class="line">  <span class="keyword">if</span> (status &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    ERROR(PLUGIN_NAME <span class="string">&quot; plugin: virDomainGetVcpus failed with status %i.&quot;</span>,</span><br><span class="line">          status);</span><br><span class="line"></span><br><span class="line">    virErrorPtr err = virGetLastError();</span><br><span class="line">    <span class="keyword">if</span> (err-&gt;code == VIR_ERR_NO_SUPPORT) &#123;</span><br><span class="line">      <span class="keyword">if</span> (extra_stats &amp; ex_stats_vcpu)</span><br><span class="line">        ERROR(PLUGIN_NAME</span><br><span class="line">              <span class="string">&quot; plugin: Disabled unsupported ExtraStats selector: vcpu&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (extra_stats &amp; ex_stats_vcpupin)</span><br><span class="line">        ERROR(PLUGIN_NAME</span><br><span class="line">              <span class="string">&quot; plugin: Disabled unsupported ExtraStats selector: vcpupin&quot;</span>);</span><br><span class="line">      extra_stats &amp;= ~(ex_stats_vcpu | ex_stats_vcpupin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sfree(cpumaps);</span><br><span class="line">    sfree(vinfo);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nr_virt_cpu; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (extra_stats &amp; ex_stats_vcpu)</span><br><span class="line">      vcpu_submit(vinfo[i].cpuTime, domain, vinfo[i].number, <span class="string">&quot;virt_vcpu&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (extra_stats &amp; ex_stats_vcpupin)</span><br><span class="line">      vcpu_pin_submit(domain, max_cpus, i, cpumaps, cpu_map_len);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  sfree(cpumaps);</span><br><span class="line">  sfree(vinfo);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">vcpu_submit</span><span class="params">(<span class="keyword">derive_t</span> value, virDomainPtr dom, <span class="keyword">int</span> vcpu_nr,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="keyword">const</span> <span class="keyword">char</span> *type)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> type_instance[DATA_MAX_NAME_LEN];</span><br><span class="line"></span><br><span class="line">  ssnprintf(type_instance, <span class="keyword">sizeof</span>(type_instance), <span class="string">&quot;%d&quot;</span>, vcpu_nr);</span><br><span class="line">  submit(dom, type, type_instance, &amp;(<span class="keyword">value_t</span>)&#123;.derive = value&#125;, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(virDomainPtr dom, <span class="keyword">char</span> <span class="keyword">const</span> *type,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">char</span> <span class="keyword">const</span> *type_instance, <span class="keyword">value_t</span> *values,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">size_t</span> values_len)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">value_list_t</span> vl = VALUE_LIST_INIT;</span><br><span class="line">  init_value_list(&amp;vl, dom);</span><br><span class="line"></span><br><span class="line">  vl.values = values;</span><br><span class="line">  vl.values_len = values_len;</span><br><span class="line"></span><br><span class="line">  sstrncpy(vl.type, type, <span class="keyword">sizeof</span>(vl.type));</span><br><span class="line">  <span class="keyword">if</span> (type_instance != <span class="literal">NULL</span>)</span><br><span class="line">    sstrncpy(vl.type_instance, type_instance, <span class="keyword">sizeof</span>(vl.type_instance));</span><br><span class="line"></span><br><span class="line">  plugin_dispatch_values(&amp;vl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CPU时间是指中央处理器（CPU）用于执行特定进程或线程的时间量</p><p>虚拟机使用的CPU时间除以宿主机的总CPU时间</p><p>总CPU时间分为用户空间时间、内核空间时间、空闲时间等</p><h3 id="cpu"><a href="#cpu" class="headerlink" title="cpu"></a>cpu</h3><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>idle的时候cpu在做什么？</p><ol><li>节能：一些现代操作系统和处理器支持节能功能，当 CPU 处于空闲状态时，可以降低 CPU 的频率或进入低功耗模式，以节省能源和降低发热。</li><li>调度决策：操作系统可以使用空闲时间来评估当前的任务队列，并决定下一个要执行的任务，以优化系统的性能和响应能力。</li><li>维护任务：操作系统可以利用空闲时间来执行一些后台维护任务，如内存回收、文件系统清理等。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>prometheus的使用</title>
      <link href="metaverse/prometheus/"/>
      <url>metaverse/prometheus/</url>
      
        <content type="html"><![CDATA[<p>普罗米修斯(Prometheus)是一个SoundCloud公司开源的基于GO的监控系统，作者 Matt T.Proud 在2012年加入SoundCloud开发，2015年正式发布。</p><p>prometheus架构如下</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211122/1637544429v2-0ff3a54dfa1284f61e124405dd25c9aa_1440w.jpg" alt="img"></p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211122/16375453951.svg" alt="1"></p><p>其中</p><h3 id="Prometheus-Server"><a href="#Prometheus-Server" class="headerlink" title="Prometheus Server"></a>Prometheus Server</h3><p>用数据的采集和存储，PromQL查询，报警配置</p><ol><li>Retrieval</li><li>TSDB</li><li>HTTP server</li></ol><h4 id="Push-gateway"><a href="#Push-gateway" class="headerlink" title="Push gateway"></a>Push gateway</h4><p>用于批量，短期的监控数据的汇报总节点。</p><h4 id="Exporters"><a href="#Exporters" class="headerlink" title="Exporters"></a>Exporters</h4><p>各种汇报数据的exporter，例如汇报机器数据的node_exporter，汇报MondogDB</p><h4 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h4><p>用于高级通知管理</p><h3 id="采集数据"><a href="#采集数据" class="headerlink" title="采集数据"></a>采集数据</h3><p>若要采集目标的监控数据(主机或服务)，需要在目标上安装采集组件(Exporter)，Exporter能采集目标监控数据，然后传输给Prometheus，Exporter会暴露一个http接口，Prometheus通过Pull周期性拉去数据，Prometheus 也提供push传输数据，可以将数据push到Push gateway, Prometheus 再通过Pull从Push Gateway拿数据</p><h4 id="采集流程"><a href="#采集流程" class="headerlink" title="采集流程"></a>采集流程</h4><ol><li>Prometheus server</li></ol>]]></content>
      
      
      <categories>
          
          <category> tool </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cobra Tutorial</title>
      <link href="metaverse/cobra/"/>
      <url>metaverse/cobra/</url>
      
        <content type="html"><![CDATA[<h2 id="cobra"><a href="#cobra" class="headerlink" title="cobra"></a>cobra</h2><p>cobra 是go的cli框架，包含cli库和生成基于cobra cli应用的命令行工具</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>子命令，如<code>app server</code>、<code>app sub</code>等</li><li>完整兼容POSIX的flag，包括长命名和短命名</li><li>子命令的嵌套（子命令）</li><li>全局、本地、级联三种flag</li><li>好用的工具命令，如<code>cobra init appname</code>初始化cli程序,<code>cobra add cmdname</code>为cli程序增加子命令</li><li>智能提示</li><li>生成命令help，以及为每个flag、cmd生成<code>-h</code>，<code>--help</code>帮助</li><li>生成自动补全功能</li><li>生成man帮助文档</li><li>命令别名</li><li>自定义帮助、用法</li><li>为达到saas的12-factor 可选择viper</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>go get -u github.com/spf13/cobra/cobra</code>会自动安装最新版本库和命令行工具，国内下不下来可以手动下载放到对应的文件夹中，然后就可以在你的code里应用它<code>import &quot;github.com/spf13/cobra&quot;</code></p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>cobra主要管理commands、args、flags，commands代表一个命令或动作，一般用动词命名，args代表输入的参数，一般用名词命名，flags是对commands的修饰，一般用形容词命名；好的cli应用应该学习成本低，用户容易理解 cli的含义，git的例子能很好的说明这一点: <code>git clone URL --bare</code> ，clone是commands是动词，URL是args是你的输入，bare是flag是形容词</p><h3 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h3><p>commands是cli应用的核心，每次交互都包含在一个command中，command可以拥有可选的子命令（sub commands）</p><h3 id="flags"><a href="#flags" class="headerlink" title="flags"></a>flags</h3><p>flag 是修饰command的一种方式，cobra支持完全兼容的POSIX flag以及go的 flag包，一个flag可以被定义成仅对当前命令生效或对当前及子孙命令生效（对于写代码时增加flag来说），flag功能由<a href="https://github.com/ogier/pflag">pflag library</a>提供</p><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>虽然你可以自定义你自己的应用工程结构，但推荐你使用以下cobra-cli应用的典型结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">▾ appName&#x2F;</span><br><span class="line">  ▾ cmd&#x2F;</span><br><span class="line">      add.go</span><br><span class="line">      your.go</span><br><span class="line">      commands.go</span><br><span class="line">      here.go</span><br><span class="line">    main.go</span><br></pre></td></tr></table></figure><p>在cobra应用中，main.go通常只提供初始化cobra的功能，like that</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;&#123;pathToYourApp&#125;/cmd&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用cobra生成工具"><a href="#使用cobra生成工具" class="headerlink" title="使用cobra生成工具"></a>使用cobra生成工具</h2><p>cobra提供了帮你生成模板的cli工具，有如下命令:</p><h3 id="初始化应用init"><a href="#初始化应用init" class="headerlink" title="初始化应用init"></a>初始化应用init</h3><p><code>cobra init [name] [flags]</code>,name是你cobra应用的名字，<code>--pkg-name</code>pkg 的名字 flag可以选择<code>-a</code> 作者名，<code>-l</code>添加license,默认Apache2.0，<code>--viper</code>添加viper等功能，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--pkg-name string   fully qualified pkg name</span><br><span class="line">-a, --author string    author name for copyright attribution (default &quot;YOUR NAME&quot;)</span><br><span class="line">    --config string    config file (default is $HOME&#x2F;.cobra.yaml)</span><br><span class="line">-l, --license string   name of license for the project</span><br><span class="line">    --viper            use Viper for configuration (default true)</span><br></pre></td></tr></table></figure><p>初始化应用后一般<code>go mod init</code>初始化应用，golang基础，在此不赘述</p><h3 id="添加commands"><a href="#添加commands" class="headerlink" title="添加commands"></a>添加commands</h3><p><code>cobra add [name] -p &#39;parentComand&#39;</code> <code>-p</code>可以为特定命令添加子命令，缺省为根命令</p><h2 id="使用Cobra库"><a href="#使用Cobra库" class="headerlink" title="使用Cobra库"></a>使用Cobra库</h2><p>手动创建需要新建一个rootCmd文件,然后添加若干command</p><h3 id="创建rootCmd"><a href="#创建rootCmd" class="headerlink" title="创建rootCmd"></a>创建rootCmd</h3><p>cobra不需要创建一个特定的实例，可以直接使用<code>&amp;cobra.Commaand</code>，如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;hugo&quot;</span>, <span class="comment">//command,代表命令</span></span><br><span class="line">  Short: <span class="string">&quot;Hugo is a very fast static site generator&quot;</span>, <span class="comment">//对command的简短介绍</span></span><br><span class="line">  Long: <span class="string">`A Fast and Flexible Static Site Generator built with </span></span><br><span class="line"><span class="string">                love by spf13 and friends in Go.</span></span><br><span class="line"><span class="string">                Complete documentation is available at http://hugo.spf13.com`</span>, <span class="comment">//对command的详细介绍</span></span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 命令实际要做的事情</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123; <span class="comment">//启动</span></span><br><span class="line">  <span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你可以在init中定义flatgs以及处理配置，示例如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">  homedir <span class="string">&quot;github.com/mitchellh/go-homedir&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cobra.OnInitialize(initConfig) <span class="comment">//初始化配置</span></span><br><span class="line">  rootCmd.PersistentFlags().StringVar(&amp;cfgFile, <span class="string">&quot;config&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;config file (default is $HOME/.cobra.yaml)&quot;</span>)<span class="comment">//配置</span></span><br><span class="line">  rootCmd.PersistentFlags().StringVarP(&amp;projectBase, <span class="string">&quot;projectbase&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;base project directory eg. github.com/spf13/&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringP(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;Author name for copyright attribution&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringVarP(&amp;userLicense, <span class="string">&quot;license&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Name of license for the project (can provide `licensetext` in config)&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().Bool(<span class="string">&quot;viper&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;Use Viper for configuration&quot;</span>)</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))<span class="comment">//绑定viper的标致到cobra</span></span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;projectbase&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;projectbase&quot;</span>))</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;useViper&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;viper&quot;</span>))</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;</span>)</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;license&quot;</span>, <span class="string">&quot;apache&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// viper读取配置文件</span></span><br><span class="line">  <span class="keyword">if</span> cfgFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="comment">// 从flag读取文件</span></span><br><span class="line">    viper.SetConfigFile(cfgFile)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 获取主目录</span></span><br><span class="line">    home, err := homedir.Dir()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查找文件.cobra</span></span><br><span class="line">    viper.AddConfigPath(home)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;.cobra&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Can&#x27;t read config:&quot;</span>, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加命令"><a href="#添加命令" class="headerlink" title="添加命令"></a>添加命令</h3><p>添加的命令可以创建在cmd目录下单独的go文件，比如创建一个version命令：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.AddCommand(versionCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;version&quot;</span>,</span><br><span class="line">  Short: <span class="string">&quot;Print the version number of Hugo&quot;</span>,</span><br><span class="line">  Long:  <span class="string">`All software has versions. This is Hugo&#x27;s`</span>,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hugo Static Site Generator v0.9 -- HEAD&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用flag"><a href="#使用flag" class="headerlink" title="使用flag"></a>使用flag</h3><p>我们有两种</p><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ol><li><code>go mod init yourpackage</code> 创建你自己的模块</li><li><code>go get -u github.com/spf13/cobra/cobra</code> 加载依赖</li></ol><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><ol><li><code>cobra init ./ -a longtao -l GPL --viper</code> 初始化包(在当前目录初始化cobra，作者是longtao,许可是gpl，并使用viper配置)</li><li><code>go build  -o ./ .</code> 编译测试一下是否正常使用</li></ol>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
            <tag> golang </tag>
            
            <tag> cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>viper Tutorial</title>
      <link href="metaverse/viper/"/>
      <url>metaverse/viper/</url>
      
        <content type="html"><![CDATA[<h2 id="cobra"><a href="#cobra" class="headerlink" title="cobra"></a>cobra</h2><p>cobra 是go的cli框架，包含cli库和生成基于cobra cli应用的命令行工具</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>子命令，如<code>app server</code>、<code>app sub</code>等</li><li>完整兼容POSIX的flag，包括长命名和短命名</li><li>子命令的嵌套（子命令）</li><li>全局、本地、级联三种flag</li><li>好用的工具命令，如<code>cobra init appname</code>初始化cli程序,<code>cobra add cmdname</code>为cli程序增加子命令</li><li>智能提示</li><li>生成命令help，以及为每个flag、cmd生成<code>-h</code>，<code>--help</code>帮助</li><li>生成自动补全功能</li><li>生成man帮助文档</li><li>命令别名</li><li>自定义帮助、用法</li><li>为达到saas的12-factor 可选择viper</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>go get -u github.com/spf13/cobra/cobra</code>会自动安装最新版本库和命令行工具，国内下不下来可以手动下载放到对应的文件夹中，然后就可以在你的code里应用它<code>import &quot;github.com/spf13/cobra&quot;</code></p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>cobra主要管理commands、args、flags，commands代表一个命令或动作，一般用动词命名，args代表输入的参数，一般用名词命名，flags是对commands的修饰，一般用形容词命名；好的cli应用应该学习成本低，用户容易理解 cli的含义，git的例子能很好的说明这一点: <code>git clone URL --bare</code> ，clone是commands是动词，URL是args是你的输入，bare是flag是形容词</p><h3 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h3><p>commands是cli应用的核心，每次交互都包含在一个command中，command可以拥有可选的子命令（sub commands）</p><h3 id="flags"><a href="#flags" class="headerlink" title="flags"></a>flags</h3><p>flag 是修饰command的一种方式，cobra支持完全兼容的POSIX flag以及go的 flag包，一个flag可以被定义成仅对当前命令生效或对当前及子孙命令生效（对于写代码时增加flag来说），flag功能由<a href="https://github.com/ogier/pflag">pflag library</a>提供</p><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>虽然你可以自定义你自己的应用工程结构，但推荐你使用以下cobra-cli应用的典型结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">▾ appName&#x2F;</span><br><span class="line">  ▾ cmd&#x2F;</span><br><span class="line">      add.go</span><br><span class="line">      your.go</span><br><span class="line">      commands.go</span><br><span class="line">      here.go</span><br><span class="line">    main.go</span><br></pre></td></tr></table></figure><p>在cobra应用中，main.go通常只提供初始化cobra的功能，like that</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;&#123;pathToYourApp&#125;/cmd&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用cobra生成工具"><a href="#使用cobra生成工具" class="headerlink" title="使用cobra生成工具"></a>使用cobra生成工具</h2><p>cobra提供了帮你生成模板的cli工具，有如下命令:</p><h3 id="初始化应用init"><a href="#初始化应用init" class="headerlink" title="初始化应用init"></a>初始化应用init</h3><p><code>cobra init [name] [flags]</code>,name是你cobra应用的名字，<code>--pkg-name</code>pkg 的名字 flag可以选择<code>-a</code> 作者名，<code>-l</code>添加license,默认Apache2.0，<code>--viper</code>添加viper等功能，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--pkg-name string   fully qualified pkg name</span><br><span class="line">-a, --author string    author name for copyright attribution (default &quot;YOUR NAME&quot;)</span><br><span class="line">    --config string    config file (default is $HOME&#x2F;.cobra.yaml)</span><br><span class="line">-l, --license string   name of license for the project</span><br><span class="line">    --viper            use Viper for configuration (default true)</span><br></pre></td></tr></table></figure><p>初始化应用后一般<code>go mod init</code>初始化应用，golang基础，在此不赘述</p><h3 id="添加commands"><a href="#添加commands" class="headerlink" title="添加commands"></a>添加commands</h3><p><code>cobra add [name] -p &#39;parentComand&#39;</code> <code>-p</code>可以为特定命令添加子命令，缺省为根命令</p><h2 id="使用Cobra库"><a href="#使用Cobra库" class="headerlink" title="使用Cobra库"></a>使用Cobra库</h2><p>手动创建需要新建一个rootCmd文件,然后添加若干command</p><h3 id="创建rootCmd"><a href="#创建rootCmd" class="headerlink" title="创建rootCmd"></a>创建rootCmd</h3><p>cobra不需要创建一个特定的实例，可以直接使用<code>&amp;cobra.Commaand</code>，如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;hugo&quot;</span>, <span class="comment">//command,代表命令</span></span><br><span class="line">  Short: <span class="string">&quot;Hugo is a very fast static site generator&quot;</span>, <span class="comment">//对command的简短介绍</span></span><br><span class="line">  Long: <span class="string">`A Fast and Flexible Static Site Generator built with </span></span><br><span class="line"><span class="string">                love by spf13 and friends in Go.</span></span><br><span class="line"><span class="string">                Complete documentation is available at http://hugo.spf13.com`</span>, <span class="comment">//对command的详细介绍</span></span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 命令实际要做的事情</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123; <span class="comment">//启动</span></span><br><span class="line">  <span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你可以在init中定义flatgs以及处理配置，示例如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">  homedir <span class="string">&quot;github.com/mitchellh/go-homedir&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cobra.OnInitialize(initConfig) <span class="comment">//初始化配置</span></span><br><span class="line">  rootCmd.PersistentFlags().StringVar(&amp;cfgFile, <span class="string">&quot;config&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;config file (default is $HOME/.cobra.yaml)&quot;</span>)<span class="comment">//配置</span></span><br><span class="line">  rootCmd.PersistentFlags().StringVarP(&amp;projectBase, <span class="string">&quot;projectbase&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;base project directory eg. github.com/spf13/&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringP(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;Author name for copyright attribution&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringVarP(&amp;userLicense, <span class="string">&quot;license&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Name of license for the project (can provide `licensetext` in config)&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().Bool(<span class="string">&quot;viper&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;Use Viper for configuration&quot;</span>)</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))<span class="comment">//绑定viper的标致到cobra</span></span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;projectbase&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;projectbase&quot;</span>))</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;useViper&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;viper&quot;</span>))</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;</span>)</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;license&quot;</span>, <span class="string">&quot;apache&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// viper读取配置文件</span></span><br><span class="line">  <span class="keyword">if</span> cfgFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="comment">// 从flag读取文件</span></span><br><span class="line">    viper.SetConfigFile(cfgFile)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 获取主目录</span></span><br><span class="line">    home, err := homedir.Dir()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查找文件.cobra</span></span><br><span class="line">    viper.AddConfigPath(home)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;.cobra&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Can&#x27;t read config:&quot;</span>, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加命令"><a href="#添加命令" class="headerlink" title="添加命令"></a>添加命令</h3><p>添加的命令可以创建在cmd目录下单独的go文件，比如创建一个version命令：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.AddCommand(versionCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;version&quot;</span>,</span><br><span class="line">  Short: <span class="string">&quot;Print the version number of Hugo&quot;</span>,</span><br><span class="line">  Long:  <span class="string">`All software has versions. This is Hugo&#x27;s`</span>,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hugo Static Site Generator v0.9 -- HEAD&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用flag"><a href="#使用flag" class="headerlink" title="使用flag"></a>使用flag</h3><p>我们有两种</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
            <tag> golang </tag>
            
            <tag> cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GarbledCircuit</title>
      <link href="metaverse/garbledcircuit/"/>
      <url>metaverse/garbledcircuit/</url>
      
        <content type="html"><![CDATA[<h1 id="Garbled-Circuit"><a href="#Garbled-Circuit" class="headerlink" title="Garbled Circuit"></a>Garbled Circuit</h1><h2 id="零碎知识"><a href="#零碎知识" class="headerlink" title="零碎知识"></a>零碎知识</h2><p><strong>定律</strong>:是由实验得出的基本结论，由定律进行数学推导可以得到一些物理上的结论或者定理</p><p><strong>定理</strong>: 由公理，原理，定律经过数学推导得出的结论</p><p><strong>公理</strong>: 是没有经过证明，但被当作不证自明的一个命题</p><p><strong>信息守恒定律</strong>: 物理学的绝对性定律,量子力学基石(幺正性:波函数归一化,全空间粒子总概率为1),指孤立物理系统中信息守恒(定律,不一定正确,如黑洞佯谬的挑战)</p><p><strong>黑洞无毛</strong>: 黑洞只有质量、角动量以及电荷三个不能变为电磁辐射的守恒量，其他的信息全都丧失</p><p><strong>黑洞佯谬</strong>: 广义相对论中对黑洞的计算得出黑洞无毛,黑洞层面信息不再守恒,这也是广义相对论和量子理论矛盾之处</p><p><strong>同态</strong>：抽象代数中，同态是两个代数结构（例如群、环、或者向量空间）之间的保持结构不变的映射</p><p><strong>同态加密</strong>: 对经过同态加密的数据进行处理得到一个输出，将这一输出进行解密，其结果与用同一方法处理未加密的原始数据得到的输出结果是一样的</p><p><strong>可信计算(Trusted Computing，TC)</strong>: 可信目的是保证系统和应用的完整性等，从而确定系统或软件运行在期望的可信状态。可信是安全的必要不充分条件,可信计算分为外包计算和多方计算,外包计算是甲方拥有数据和计算方法,使用乙方的算力获取结果,安全常用同态加密</p><p><strong>差分隐私(differential privacy)</strong>: 一种数据共享手段,为了应对差分攻击而生,原理就是给查询结果加噪声</p><p><strong>多方安全计算（Secure Multi-Party Computation）</strong>：主要是针对无可信第三方的情况下，如何安全地计算一个约定函数的问题；安全多方计算（  Secure  Multi-Party  Computation，MPC）于1986  年由姚期智院士提出。安全多方计算协议允许多个数据所有者在互不信任的情况下进行协同计算，输出计算结果，并保证任何一方均无法得到除应得的计算结果之外的其他任何信息。换句话说，MPC技术可以获取数据使用价值，却不泄露原始数据内容</p><p><strong>信息论安全</strong>：一个安全多方计算协议，如果对于拥有无限计算能力攻击者而言是安全的，则称作是信息论安全的或无条件安全的</p><p><strong>密码学安全</strong>: 如果对于拥有多项式计算能力的攻击者是安全的，则称为是密码学安全的或条件安全的。在条件安全模型下，当且仅当恶意参与者的人数少于总人数的一半时，安全的方案才存在</p><p><strong>敌手模型</strong>：</p><p>半诚实（Semi-Honest）模型：假设参与计算的各方都是半诚实的，即参与方可以保留交互时得到的信息。对于想要协作完成计算并得到正确结果的参与方来说，这样的模型符合实际情况。恶意（Malicious）模型、诚实模型不符合实际情况</p><p><strong>多项式时间</strong>：在计算复杂度理论中，指的是一个问题的计算时间不大于问题大小的多项式倍数，可以在机器上以多项式时间求解的问题被称为P问题，可以在多项式时间验证答案的问题被称为NP，数学家有时把“如多项式时间长的算法”视为快速计算，相对应的是超多项式时间</p><p>密钥共享：密钥分享的基本思路是将每个数字拆散成多个数，并将这些数分发到多个参与方，如算工资，设置一个最大数值范围，每个人给别人一个数字，可以提前超支出，但是经过n次分发后进行相加</p><p>随机预言机Random OracleL：如果x和H(x)已经在表里记录过，就输出H(x)如果没有关于x的记录，则RO完全随机地在值域中选取一个0,1字符串（或者从其他希望映射到的元素集合中完全随机的选取）当作H(x)，把这个和x一起记录在表里，然后输出这个H(x)。</p><h2 id="OT协议"><a href="#OT协议" class="headerlink" title="OT协议"></a>OT协议</h2><p><strong>1-out-of-2 OT</strong></p><p>消息提供方Alice有两个消息M0和M1，只想提供给Bob其中一个，并且不会泄露另一个</p><p>消息接收方Bob想要获取其中一个消息(假设为M1),但不想让Alice知道自己想获取的是哪一个</p><h4 id="流程演示"><a href="#流程演示" class="headerlink" title="流程演示"></a>流程演示</h4><p>1-2OT假设Alice有两个消息M0、M1,Bob想获取M1</p><p>假设M1、M0长度相同，要求随机数r长度和两者相同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line"> participant A as Alice(数据提供方，拥有消息M0和M1) </span><br><span class="line"> participant B as Bob(数据请求方，想要获取M1)</span><br><span class="line"> A -&gt;&gt; A: Alice分别产生两个密钥对rsa0,rsa1</span><br><span class="line"> A -&gt;&gt; B : 发送给Bob rsa0-pub,rsa1-pub公钥</span><br><span class="line"> B -&gt;&gt; B : 生成一个随机数r</span><br><span class="line"> B -&gt;&gt; B : Bob想要获取M1,使用rsa1-pub加密r成rsa1-context</span><br><span class="line"> B -&gt;&gt; A : Bob将rsa1-context发送给Alice</span><br><span class="line"> A-&gt;&gt;A : Alice用rsa0-pri,rsa1-pri分别解密rsa1-context得到r&#39;和r</span><br><span class="line"> A-&gt;&gt;A: Alice用r&#39;与M0做xor得到xor(r&#39;,M0)、xor(r&#39;,M0),r与M1得到xor(r,M1)</span><br><span class="line"> A -&gt;&gt;B : Alice把xor(r&#39;,M0)、xor(r,M1)发送给Bob</span><br><span class="line"> B -&gt;&gt;B: xor(xor(r,M1),r)得到消息M1</span><br></pre></td></tr></table></figure><div class="mermaid">sequenceDiagram    participant A as Alice(数据提供方，拥有消息M0和M1)     participant B as Bob(数据请求方，想要获取M1)    A -&gt;&gt; A: Alice分别产生两个密钥对rsa0,rsa1    A -&gt;&gt; B : 发送给Bob rsa0-pub,rsa1-pub公钥    B -&gt;&gt; B : 生成一个随机数r    B -&gt;&gt; B : Bob想要获取M1,使用rsa1-pub加密r成rsa1-context    B -&gt;&gt; A : Bob将rsa1-context发送给Alice    A-&gt;&gt;A : Alice用rsa0-pri,rsa1-pri分别解密rsa1-context得到r&#39;和r    A-&gt;&gt;A: Alice用r&#39;与M0做xor得到xor(r&#39;,M0)、xor(r&#39;,M0),r与M1得到xor(r,M1)    A -&gt;&gt;B : Alice把xor(r&#39;,M0)、xor(r,M1)发送给Bob    B -&gt;&gt;B: xor(xor(r,M1),r)得到消息M1</div><h2 id="混淆电路"><a href="#混淆电路" class="headerlink" title="混淆电路"></a>混淆电路</h2><p>所有可计算的函数问题都可转换为不同的电路，加法电路、乘法电路、移位电路、选择电路等。而电路本质上由门（gate）组成，逻辑门包括与门、非门、或门、与非门等。混淆电路把这些门的真值表进行加密和打乱来掩盖原本的逻辑信息信息。</p><p>基本步骤</p><ol><li>生成：Alice生成混淆电路</li><li>传输：Bob获取Alice的输入和混淆电路，基于OT协议</li><li>计算：Bob计算电路的到混淆结果，发送给Alice，Alice根据混淆结果得到最终结果发送给Bob</li></ol><p>下面我们单看XOR门的混淆电路过程（可逆运算不能达到隐私计算效果）</p><p>XOR的真值表为</p><table><thead><tr><th>Alice</th><th>Bob</th><th>out</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>1</td></tr><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>0</td><td>0</td><td>0</td></tr></tbody></table><p>Alice首先使用字符串替换真值表，然后使用输入作为对称加密密钥加密输出</p><table><thead><tr><th>Alice</th><th>Bob</th><th>out</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>ENCa1b1(r0)</td></tr><tr><td>a1</td><td>b0</td><td>ENCa1b0(r1)</td></tr><tr><td>a0</td><td>b1</td><td>ENCa0b1(r1)</td></tr><tr><td>a0</td><td>b0</td><td>ENCa0b0(r0)</td></tr></tbody></table><p><strong>数据传递</strong></p><ol><li>Alice把自己的输入(假设为a1)和输出(ENCa1b1(r0)、ENCa1b0(r1)、  ENCa0b1(r1)、ENCa0b0(r0))发送给发送给Bob</li><li>Bob通过不经意传输获取自己的输出对应的字符串（假设是b0）</li></ol><p>评估：对于单个逻辑门，显然没有达到隐私计算的目的，混淆电路一般用于不可逆的计算！</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211018/16345319921634531766163453174816345291911634526937v2-b70574979c325cdaa52eef57c68eb610_b.png" alt="img"></p> <iframe   height=850  width=90%  src="https://longtao.fun/ppt/yaoGC.html"   frameborder=0   allowfullscreen> </iframe>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Garbled Circuit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux的boot目录</title>
      <link href="metaverse/boot/"/>
      <url>metaverse/boot/</url>
      
        <content type="html"><![CDATA[<p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/16351392001-642-png_6_0_0_0_0_0_0_1258.74_1781.819-1259-0-755-1259.jpg" alt="See the source image"></p><p>1.查看当前运行的linux内核编译参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">两个方法，proc要求在内核编译时增减相应的选项才会生成，很多系统没有/proc/config.gz，第二种方法，一般</span></span><br><span class="line">zcat /proc/config.gz</span><br><span class="line"><span class="meta">#</span><span class="bash">或</span></span><br><span class="line">cat /boot/config-$(uname -r)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简洁明了的systemd的使用</title>
      <link href="metaverse/systemd/"/>
      <url>metaverse/systemd/</url>
      
        <content type="html"><![CDATA[<h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><h3 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h3><p>在systemd之前使用initd 管理服务（把启动脚本放在在<code>/etc/init.d/</code>下），但是有两个主要缺点：</p><ol><li>线性(串行)启动导致启动时间过长</li><li>initd只负责在系统启动时启动启动脚本，若要处理脚本状态需要自己实现，导致脚本复杂</li></ol><h3 id="systemd设计目标"><a href="#systemd设计目标" class="headerlink" title="systemd设计目标"></a>systemd设计目标</h3><ol><li>为服务启动和管理提供全套解决方案</li><li>可完全取代init.d ，性能更强，功能更多</li></ol><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><h3 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h3><h4 id="综合-systemctl"><a href="#综合-systemctl" class="headerlink" title="综合(systemctl))"></a>综合(systemctl))</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">常用命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line">systemctl reboot</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭电源</span></span><br><span class="line">systemctl poweroff</span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU暂停</span></span><br><span class="line">systemctl halt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂起</span></span><br><span class="line">systemctl suspend</span><br></pre></td></tr></table></figure><h4 id="用户-loginctl"><a href="#用户-loginctl" class="headerlink" title="用户(loginctl)"></a>用户(loginctl)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">list-sessions            List sessions</span><br><span class="line">session-status [ID...]   Show session status</span><br><span class="line">show-session [ID...]     Show properties of sessions or the manager</span><br><span class="line">activate [ID]            Activate a session</span><br><span class="line">lock-session [ID...]     Screen lock one or more sessions</span><br><span class="line">unlock-session [ID...]   Screen unlock one or more sessions</span><br><span class="line">lock-sessions            Screen lock all current sessions</span><br><span class="line">unlock-sessions          Screen unlock all current sessions</span><br><span class="line">terminate-session ID...  Terminate one or more sessions</span><br><span class="line">kill-session ID...       Send signal to processes of a session</span><br></pre></td></tr></table></figure><h4 id="时间-timedatectl"><a href="#时间-timedatectl" class="headerlink" title="时间(timedatectl)"></a>时间(timedatectl)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">status                   Show current time settings</span><br><span class="line">show                     Show properties of systemd-timedated</span><br><span class="line">set-time TIME            Set system time</span><br><span class="line">set-timezone ZONE        Set system time zone</span><br><span class="line">list-timezones           Show known time zones</span><br><span class="line">set-local-rtc BOOL       Control whether RTC is in local time</span><br><span class="line">set-ntp BOOL             Enable or disable network time synchronization</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="本地化设置-localectl"><a href="#本地化设置-localectl" class="headerlink" title="本地化设置(localectl)"></a>本地化设置(localectl)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">status                   Show current locale settings</span><br><span class="line">set-locale LOCALE...     Set system locale</span><br><span class="line">list-locales             Show known locales</span><br><span class="line">set-keymap MAP [MAP]     Set console and X11 keyboard mappings</span><br><span class="line">list-keymaps             Show known virtual console keyboard mappings</span><br><span class="line">set-x11-keymap LAYOUT [MODEL [VARIANT [OPTIONS]]]</span><br><span class="line">                         Set X11 and console keyboard mappings</span><br><span class="line">list-x11-keymap-models   Show known X11 keyboard mapping models</span><br><span class="line">list-x11-keymap-layouts  Show known X11 keyboard mapping layouts</span><br><span class="line">list-x11-keymap-variants [LAYOUT]</span><br><span class="line">                         Show known X11 keyboard mapping variants</span><br><span class="line">list-x11-keymap-options  Show known X11 keyboard mapping options</span><br></pre></td></tr></table></figure><h4 id="启动信息-systemd-analyze"><a href="#启动信息-systemd-analyze" class="headerlink" title="启动信息(systemd-analyze)"></a>启动信息(systemd-analyze)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">time                    Print time spent in the kernel</span><br><span class="line">blame                   Print list of running units ordered by time to init</span><br><span class="line">critical-chain          Print a tree of the time critical chain of units</span><br><span class="line">plot                    Output SVG graphic showing service initialization</span><br><span class="line">dot                     Output dependency graph in dot(1) format</span><br><span class="line">set-log-level LEVEL     Set logging threshold for systemd</span><br><span class="line">dump                    Output state serialization of service manager</span><br><span class="line">verify FILE...          Check unit files for correctness</span><br></pre></td></tr></table></figure><h4 id="主机信息-hostnamectl"><a href="#主机信息-hostnamectl" class="headerlink" title="主机信息(hostnamectl)"></a>主机信息(hostnamectl)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">status                 Show current hostname settings</span><br><span class="line">set-hostname NAME      Set system hostname</span><br><span class="line">set-icon-name NAME     Set icon name for host</span><br><span class="line">set-chassis NAME       Set chassis type for host</span><br><span class="line">set-deployment NAME    Set deployment environment for host</span><br><span class="line">set-location NAME      Set location for host</span><br></pre></td></tr></table></figure><h3 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h3><h4 id="支持的资源"><a href="#支持的资源" class="headerlink" title="支持的资源"></a>支持的资源</h4><p>文件后缀就是资源名，例如service的后缀为.service</p><table><thead><tr><th>资源</th><th>功能</th></tr></thead><tbody><tr><td>service</td><td>定义系统服务</td></tr><tr><td>socket</td><td>标识进程间通信使用的socket文件</td></tr><tr><td>target</td><td>模拟实现“运行级别”，多个 Unit 构成的一个组</td></tr><tr><td>device</td><td>定义内核识别的设备</td></tr><tr><td>snapshot</td><td>管理systemd快照</td></tr><tr><td>scope</td><td>非systemd启动的进程</td></tr><tr><td>timer</td><td>管理计划任务</td></tr><tr><td>slice</td><td>进程组</td></tr><tr><td>path</td><td>文件</td></tr><tr><td>swap</td><td>交换设备</td></tr><tr><td>mount</td><td>文件系统挂载点</td></tr><tr><td>automount</td><td>自动挂载点</td></tr></tbody></table><h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">基础命令</span></span><br><span class="line">systemctl status # 状态</span><br><span class="line">systemctl start # 开启</span><br><span class="line">syttemctl stop # 关闭</span><br><span class="line">systemctl restart # 重启</span><br><span class="line">systemctl reload # 重载</span><br><span class="line">systemctl kill # 杀死</span><br><span class="line">systemctl enable # 开机启动</span><br><span class="line">systemctl disable # 开机不启动</span><br><span class="line">systemctl mask # 屏蔽</span><br><span class="line">systemctl unmask # 不屏蔽</span><br><span class="line">systemctl show # 查看配置</span><br><span class="line">systemctl cat # 查看配置文件内容</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询命令</span></span><br><span class="line">systemctl  is-active </span><br><span class="line">systemctl is-failed</span><br><span class="line">systemctl is-enabled</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出依赖</span></span><br><span class="line">systemctl list-dependencies</span><br><span class="line"><span class="meta">#</span><span class="bash">查询列表</span></span><br><span class="line">list-sockets</span><br><span class="line">list-unit-files    </span><br><span class="line">list-jobs </span><br><span class="line">list-timers </span><br><span class="line">list-units </span><br></pre></td></tr></table></figure><h4 id="启动状态"><a href="#启动状态" class="headerlink" title="启动状态"></a>启动状态</h4><p>static：不可以自己启动，可以被被其它的 enabled 的服务来唤醒。<br>mask：屏蔽掉了，除非unmask否则无论如何无法启动<br>enable：开机启动<br>disable：开机不启动</p><h4 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-F --field=FIELD         List all values that a specified field takes</span><br><span class="line">   --new-id128           Generate a new 128-bit ID</span><br><span class="line">   --disk-usage          Show total disk usage of all journal files</span><br><span class="line">   --vacuum-size=BYTES   Reduce disk usage below specified size</span><br><span class="line">   --vacuum-time=TIME    Remove journal files older than specified date</span><br><span class="line">   --flush               Flush all journal data from /run into /var</span><br><span class="line">   --header              Show journal header information</span><br><span class="line">   --list-catalog        Show all message IDs in the catalog</span><br><span class="line">   --dump-catalog        Show entries in the message catalog</span><br><span class="line">   --update-catalog      Update the message catalog database</span><br><span class="line">   --setup-keys          Generate a new FSS key pair</span><br><span class="line">   --verify              Verify journal file consistency</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="怎么写一个Unit"><a href="#怎么写一个Unit" class="headerlink" title="怎么写一个Unit"></a>怎么写一个Unit</h4><p>最好的说明往往都是官网说明<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">https://www.freedesktop.org/software/systemd/man/systemd.unit.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">属性=值</span><br><span class="line">[Service]</span><br><span class="line">属性=值</span><br><span class="line">[Install]</span><br><span class="line">属性=值</span><br></pre></td></tr></table></figure><p>一般有 Unit(unit元数据)、Install(定义启动)、Service(配置)三个模块，很多情况下Install模块可省略</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description：简短描述</span><br><span class="line">Documentation：文档地址</span><br><span class="line">Requires：当前 Unit 依赖的其他 Unit，如果它们没有运行，当前 Unit 会启动失败</span><br><span class="line">Wants：与当前 Unit 配合的其他 Unit，如果它们没有运行，当前 Unit 不会启动失败</span><br><span class="line">BindsTo：与Requires类似，它指定的 Unit 如果退出，会导致当前 Unit 停止运行</span><br><span class="line">Before：如果该字段指定的 Unit 也要启动，那么必须在当前 Unit 之后启动</span><br><span class="line">After：如果该字段指定的 Unit 也要启动，那么必须在当前 Unit 之前启动</span><br><span class="line">Conflicts：这里指定的 Unit 不能与当前 Unit 同时运行</span><br><span class="line">Condition...：当前 Unit 运行必须满足的条件，否则不会运行</span><br><span class="line">Assert...：当前 Unit 运行必须满足的条件，否则会报启动失败</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type：定义启动时的进程行为。它有以下几种值。</span><br><span class="line">Type=simple：默认值，执行ExecStart指定的命令，启动主进程</span><br><span class="line">Type=forking：以 fork 方式从父进程创建子进程，创建后父进程会立即退出</span><br><span class="line">Type=oneshot：一次性进程，Systemd 会等当前服务退出，再继续往下执行</span><br><span class="line">Type=dbus：当前服务通过D-Bus启动</span><br><span class="line">Type=notify：当前服务启动完毕，会通知Systemd，再继续往下执行</span><br><span class="line">Type=idle：若有其他任务执行完毕，当前服务才会运行</span><br><span class="line">Workingdirectory: 工作目录</span><br><span class="line">ExecStart：启动当前服务的命令</span><br><span class="line">ExecStartPre：启动当前服务之前执行的命令</span><br><span class="line">ExecStartPost：启动当前服务之后执行的命令</span><br><span class="line">ExecReload：重启当前服务时执行的命令</span><br><span class="line">ExecStop：停止当前服务时执行的命令</span><br><span class="line">ExecStopPost：停止当其服务之后执行的命令</span><br><span class="line">RestartSec：自动重启当前服务间隔的秒数</span><br><span class="line">Restart：定义何种情况 Systemd 会自动重启当前服务，可能的值包括always（总是重启）、on-success、on-failure、on-abnormal、on-abort、on-watchdog</span><br><span class="line">TimeoutSec：定义 Systemd 停止当前服务之前等待的秒数</span><br><span class="line">Environment：指定环境变量</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy：它的值是一个或多个 Target，当前 Unit 激活时（enable）符号链接会放入/etc/systemd/system目录下面以 Target 名 + .wants后缀构成的子目录中</span><br><span class="line">RequiredBy：它的值是一个或多个 Target，当前 Unit 激活时，符号链接会放入/etc/systemd/system目录下面以 Target 名 + .required后缀构成的子目录中</span><br><span class="line">Alias：当前 Unit 可用于启动的别名</span><br><span class="line">Also：当前 Unit 激活（enable）时，会被同时激活的其他 Unit</span><br></pre></td></tr></table></figure><h4 id="一个简单的例子"><a href="#一个简单的例子" class="headerlink" title="一个简单的例子"></a>一个简单的例子</h4><ol><li><p>首先我们用c实现一个简单的http helloworld </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT 2333</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_SIZE 2048</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RESPONSE_HEADER <span class="meta-string">&quot;HTTP/1.1 200 OK\r\nConnection: close\r\nAccept-Ranges: bytes\r\nContent-Type: text/html\r\n\r\n&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RESPONSE_BODY <span class="meta-string">&quot;Hello longtaoTechLife!&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> conn)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buffer[BUFFER_SIZE];</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    bzero(buffer, BUFFER_SIZE);</span><br><span class="line">    len = recv(conn, buffer, BUFFER_SIZE, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">0</span> ) &#123;</span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;recv len not right&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">    send(conn, RESPONSE_HEADER RESPONSE_BODY, <span class="keyword">sizeof</span>(RESPONSE_HEADER RESPONSE_BODY), <span class="number">0</span>);</span><br><span class="line">    close(conn);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> port = PORT;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clientSockAddr</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serverSockAddr</span>;</span></span><br><span class="line">    <span class="keyword">int</span> listener = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> conn;</span><br><span class="line">    <span class="keyword">int</span> optval = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">socklen_t</span> len = <span class="keyword">sizeof</span>(struct sockaddr_in);</span><br><span class="line">    setsockopt(listener, SOL_SOCKET, SO_REUSEADDR, &amp;optval, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    serverSockAddr.sin_family = AF_INET;</span><br><span class="line">    serverSockAddr.sin_port = htons(port);</span><br><span class="line">    serverSockAddr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(bind(listener,(struct sockaddr *)&amp;serverSockAddr,<span class="keyword">sizeof</span>(serverSockAddr))==<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;bind error!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(listen(listener, <span class="number">10</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;listen failed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    conn = accept(listener, (struct sockaddr*)&amp;clientSockAddr, &amp;len);</span><br><span class="line">    <span class="keyword">if</span>(conn &lt; <span class="number">0</span> || handle(conn) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        close(conn);</span><br><span class="line">        <span class="keyword">continue</span>;&#125;&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></li><li><p>我们试一下正常运行,打印了我们期望的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-59-110 ~]# ./hello.server&amp;</span><br><span class="line">[1] 1460</span><br><span class="line">[root@172-20-59-110 ~]# curl -X GET localhost:2333</span><br><span class="line">Hello longtaoTechLife![root@172-20-59-110 ~]# </span><br></pre></td></tr></table></figure></li><li><p>接下来我们写一个简单的systemd service 写入/etc/systemd/system/hello.service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=this is longtao&#x27;s hello test</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/root/hello.server #注意一定要写成绝对地址</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target # 缺少此项无法使用systemctl enable/disable 功能</span><br></pre></td></tr></table></figure></li><li><p>我们用systemctl status hello看一下状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-59-110 ~]# systemctl status hello</span><br><span class="line">● hello.service - this is longtao&#x27;s hello test</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/hello.service; static; vendor preset: disabled) #配置文件路径，是否enable等</span><br><span class="line">   Active: inactive (dead) since 四 2021-07-15 18:14:23 CST; 18s ago # 运行状态，我们能看到未运行</span><br><span class="line">  Process: 708 ExecStart=/root/hello.server </span><br><span class="line"> Main PID: 708 (code=killed, signal=TERM) # 显示进程ID</span><br></pre></td></tr></table></figure></li><li><p>我们启动服务systemctl status hello并打开开机启动 systemctl status hello，再看一下状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">● hello.service - this is longtao&#x27;s hello test</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/hello.service; enabled; vendor preset: disabled) # 我们看到状态enbale开机启动设置成功了</span><br><span class="line">   Active: active (running) since 四 2021-07-15 18:18:25 CST; 26s ago #运行状态为正在运行</span><br><span class="line"> Main PID: 1328 (hello.server)</span><br><span class="line">   CGroup: /system.slice/hello.service   #CGroup下显示所有孜进程，CGroup常用于隔离资源，容器中常用，我们以后再说</span><br><span class="line">           └─1328 /root/hello.server </span><br></pre></td></tr></table></figure></li><li><p>这样我们就实现了一个简单的service，可以快乐的使用systemctl restart\stop\等管理我们的服务了。</p></li></ol><h2 id="优点-好的特性"><a href="#优点-好的特性" class="headerlink" title="优点(好的特性)"></a>优点(好的特性)</h2><ol><li>功能强大，使用便捷</li><li>启动速度快</li></ol><h2 id="特点-中性特性"><a href="#特点-中性特性" class="headerlink" title="特点(中性特性)"></a>特点(中性特性)</h2><ol><li>systemd 取代了initd，成为了系统第一个进程(PID为1)</li></ol><h2 id="缺点-不好的特性"><a href="#缺点-不好的特性" class="headerlink" title="缺点(不好的特性)"></a>缺点(不好的特性)</h2><ol><li>体系庞大，使用起来非常复杂</li><li>与操作系统的其他模块耦合性过强，不符合Unix的KISS原则，下面是systemd架构图，可以看出需要很多模块支持<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/1635309214webp" alt="img"></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPU简介</title>
      <link href="metaverse/cpu/"/>
      <url>metaverse/cpu/</url>
      
        <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>CPU:( <code>CentralProcessingUnit</code>): 中央处理单元，CPU不等于物理核，更不等于逻辑核,一个逻辑核包含多个物理核，一个物理核可以分成n个逻辑核</p><p>物理核(<code>physical core</code>): 可以看的到的，真实的cpu核，有独立的电路元件以及L1,L2缓存，可以独立地执行指令。</p><p>逻辑核( <code>logical core，LCPU</code>): 在同一个物理核内，逻辑层面的核。1LCPU=1THREAD</p><p>超线程( <code>Hyper-threading， HT</code>)：时间管理大师，超线程可以在一个逻辑核等待指令执行的间隔把时间片分配到另一个逻辑核。同一物理核超出的逻辑核之间为兄弟线程；</p><p>虚拟核：使用虚拟化技术，超分出的核心，位于虚拟机中；</p><p>CPU Die(裸晶): 生产中引入概念，从晶圆上切下来的裸晶，通过片外总线互联，可以封装在一个Package中,die之间通过HT(HyperTransport)总线通信</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211222/1640103678R-C.4ac803e989bb4f90f212532d90337994?rik=easxlVWcYVTbiQ&riu=http://www.quantgrav.com/wordpress/wp-content/uploads/2020/02/10-1582802010-1.jpeg&ehk=sywkHVPXnt5dsrGybbhzM075BW1qO6GPaaplhltTfTw=&risl=&pid=ImgRaw&r=0&sres=1&sresct=1" alt="See the source image"></p><p>CPU Package(封装)：对应一个cpu socket的一个CPU；</p><p>双路服务器:主板上有两个cpu插槽(socket),多个处理器通过 QPI 链路相连;</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211222/16401033685c295e257dc738d5.jpg" alt="超微（SUPERMICRO）X11DPH-T双路服务器主板【图片价格品牌报价】-京东"></p><p>对称多处理机(Symmetric multiprocessing,SMP)：每个处理器的地位都是平等的，对资源的使用权限相同。拥有超过一个以上的处理器，这些处理器都连接到同一个共享的主存上，并由单一操作系统来控制。在多核心处理器的例子中，对称多处理架构，将每一个核心都当成是独立的处理器。</p><p>下图为双路服务器的两个CPU，每个CPU 封装了4个die</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211221/16400752521640075186v2-ce7b6f2b4dfbceef66fa8a97866cf3b1_1440w.jpg" alt="img"></p><h2 id="cpu缓存"><a href="#cpu缓存" class="headerlink" title="cpu缓存"></a>cpu缓存</h2><p><strong>CPU高速缓存</strong>(cpu cache)目的是减少处理器访问内存的延时，在存储体系中仅次于cpu寄存器，速度快，接近处理器频率；</p><p>缓存是SRAM(<strong>S</strong>tatic <strong>R</strong>andom <strong>A</strong>ccess <strong>M</strong>emory),使用CMOS(<strong>C</strong>omplementary <strong>M</strong>etal-<strong>O</strong>xide-<strong>S</strong>emiconductor)工艺；</p><h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><ol><li>处理器访问内存时先检查cache中是否存在，命中则返回，未命中，存入cache再返回；</li><li>处理器写入内存时命中直接改写，未命中按照策略，写入或不写入cache；</li></ol><h3 id="缓存级别-常见"><a href="#缓存级别-常见" class="headerlink" title="缓存级别(常见)"></a>缓存级别(常见)</h3><p>缓存一般有三层，L1距离cpu最近，运行速率最高，容量最小;一般L1、L2为每个物理核独占</p><p>曾经有过L4 Cache 是个eDRAM,(Haswell/Broadwell:在Iris系列中)</p><h4 id="缓存的设计"><a href="#缓存的设计" class="headerlink" title="缓存的设计"></a>缓存的设计</h4><ul><li>exclusive：L1 cahce中的内容不能包含在L2中</li><li>strictly inclusive：L1cache的内容一定严格包含在L2中。</li><li>Third one（没有正式名字）:不要求L1的一定包含在L2中</li></ul><h2 id="背景事件"><a href="#背景事件" class="headerlink" title="背景事件"></a>背景事件</h2><h3 id="晶体管的诞生"><a href="#晶体管的诞生" class="headerlink" title="晶体管的诞生"></a>晶体管的诞生</h3><p>1947年贝尔实验室的肖克莱、布拉顿、巴丁共同发明晶体管(包括二极管、三极管、晶闸管、场效应管等)，晶体管相比电子管功耗低、效率高。</p><h3 id="八叛逆与仙童半导体"><a href="#八叛逆与仙童半导体" class="headerlink" title="八叛逆与仙童半导体"></a>八叛逆与仙童半导体</h3><p>1955年，肖克利回到老家硅谷创建“肖克利半导体实验室”，两年招募8位年轻的科学家；后八人退出并找到Fairchild摄影器材公司的投资成立Fairchild仙童半导体。</p><h3 id="Intel的成立"><a href="#Intel的成立" class="headerlink" title="Intel的成立"></a>Intel的成立</h3><p>因仙童半导体与母公司矛盾，1968年7月，诺依斯和摩尔、格鲁夫脱离仙童成立Intel</p><h3 id="AMD的成立"><a href="#AMD的成立" class="headerlink" title="AMD的成立"></a>AMD的成立</h3><p>1969年5月，桑德斯带着7位仙童员工创办AMD</p><h3 id="Intel-4004"><a href="#Intel-4004" class="headerlink" title="Intel 4004"></a>Intel 4004</h3><p>1971年11月，英特尔公司推出了世界上第一款CPU Inter 4004，这是第一个可用于微型计算机的四位微处理器。此时MOS LSI(大规模集成)技术的可用性，刚刚开始在计算器业务从机电到电子的根本变化，4004的出现宣布了电子一体化的新时代，开始为PC机的出现铺路。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">740kHz</td><td align="left">4bit 单核</td><td align="left">2300</td><td align="left">10微米</td></tr></tbody></table><p>但当时的Inter作为一个小厂难以达到IBM 1620在1960的算力水平。</p><p>Inter在1972年生产了Inter 8008，打算用作终端控制器，与Inter 4040类似，是第一个8bit处理器</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">200-800KHz</td><td align="left">8bit单核</td><td align="left">3500</td><td align="left">10微米</td></tr></tbody></table><h3 id="TMS-1000"><a href="#TMS-1000" class="headerlink" title="TMS 1000"></a>TMS 1000</h3><p>德州仪器（TI）生产，这是第一个包含足够RAM和足够用于程序ROM的空间以及在单个芯片上具有I / O支持的微处理器。从而使其无需多个芯片即可运行外部支持芯片，使其成为第一个微控制器。它还具有一项创新功能，可以向CPU添加<strong>自定义指令</strong>。</p><p>不足：内存不是连续的，内存都是内部的。所有硬连线都是单周期的，不允许中断。</p><h3 id="Intel-8080"><a href="#Intel-8080" class="headerlink" title="Intel 8080"></a>Intel 8080</h3><p>974年4月，8008的后续产品8080发布，是第一个成功的PC机Altair的处理器。</p><p>14位的PC和寻址功能，16位地址总线和8位数据总线，七个8位寄存器。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">2MHz</td><td align="left">8bit单核</td><td align="left">4500</td><td align="left">6微米</td></tr></tbody></table><p>有IO端口，可以连接256个IO设备。因此可以连接I / O设备而不会占用或干扰寻址空间，还有一个信号引脚，该信号引脚可使堆栈占用单独的内存</p><h3 id="x86架构出现-Intel-8086"><a href="#x86架构出现-Intel-8086" class="headerlink" title="x86架构出现 Intel 8086"></a>x86架构出现 Intel 8086</h3><p>1978年6月Intel 8086发布，x86架构诞生</p><p>总线接口单元通过一个6字节的预取队列将指令流馈送到执行单元，因此，获取和执行是并发的-流水线的一种原始形式。</p><p>数据寄存器通常被指令隐式使用，使临时值的寄存器分配变得复杂。它具有64K 8位I / O（或32K 16位）端口和固定向量中断。还可以通过索引寄存器设置四个段寄存器</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">5MHz</td><td align="left">16bit单核</td><td align="left">29000</td><td align="left">3微米</td></tr></tbody></table><p>不足：与大多数分段处理器一样，8086不仅提供缺失的字节，还将分段寄存器（X 16或左移4位）添加到地址中。由于不增加地址位的情况下扩展地址空间而进行尝试的奇怪结果，有可能使两个具有相同值的指针指向两个不同的存储位置，或者使两个具有不同值的指针指向同一位置，并且受到限制典型的数据结构小于64K。但在高级语言中却引起了持续的混乱（例如近/远指针）。更糟糕的是，这使得将地址空间扩展到1 MB以上变得困难。</p><h3 id="Intel-80286（1982）"><a href="#Intel-80286（1982）" class="headerlink" title="Intel 80286（1982）"></a>Intel 80286（1982）</h3><p>80286芯片，该芯片比8006和8088都有了飞跃的发展，时钟频率由最初的6MHz逐渐提高到20MHz。其内部和外部数据总线皆为16位，地址总线24位，可寻址16MB内存。采用PGA的正方形包装</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">6MHz</td><td align="left">16bit 单核</td><td align="left">134000</td><td align="left">1.5微米</td></tr></tbody></table><p>从80286开始，CPU的工作方式也演变成两种：实模式和保护模式。</p><p>实模式：微处理器可以访问内存限制在1MB</p><p>保护模式：保护操作系统，遇到异常使用时系统不会停机</p><p>不足：仅通过添加新模式将设计扩展到32位。进行切换返回时需要使用原始80286中被保留了下来的bug进行切换。所有内存访问都仍然限于64K段。</p><h3 id="Intel-80386（1985）"><a href="#Intel-80386（1985）" class="headerlink" title="Intel 80386（1985）"></a>Intel 80386（1985）</h3><p>具有几种处理器模式（包括单独的分页和分段模式），添加了MMU，安全模式</p><p>英特尔为80386设计了高速缓存（Cache），采取预读内存的方法来缓解这个速度瓶颈，从此以后，Cache就和CPU成为了如影随形的东西。</p><p>英特尔借此机会修复了以前设计中剩余的一些最受欢迎的功能。转向x86-64，AMD决定进一步改进设计，增加了更简洁的64位模式</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">16MHz</td><td align="left">32bit 单核</td><td align="left">275000</td><td align="left">1.5微米</td></tr></tbody></table><p>不足： 64位功能被设计为32位附加组件，并且在低端版本中被禁用。启用后，扩展的32位流水线将比主流水线晚1/2个时钟周期。</p><h3 id="Intel-80486（1989）"><a href="#Intel-80486（1989）" class="headerlink" title="Intel 80486（1989）"></a>Intel 80486（1989）</h3><p>将80386和数学协微处理器80387以及一个8KB的高速缓存集成在一个芯片内。</p><p>添加了完整的流水线，单片8K缓存，片上FPU和时钟加倍版本（例如Z-280）。</p><p>内部缓存缩短了微处理器与慢速DRAM的等待时间。</p><p>在80×86系列中首次采用了RISC（精简指令集）技术，可以在一个时钟周期内执行一条指令。它还采用了突发总线方式，大大提高了与内存的数据交换速度。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">25MHz</td><td align="left">32bit 单核</td><td align="left">1.2M</td><td align="left">1微米</td></tr></tbody></table><p>不足：CPU的频率越来越快，而PC机外部设备受工艺限制，能够承受的工作频率有限，这就阻碍了CPU主频的进一步提高。</p><p>在486的基础上，发展出了Intel 80486 DX/SX/DX2/DX4/SL CPU；Inter486 OverDrive，TI 486Dx，Cyrix 486DLC，Cyrix5x86，AMD 5×86</p><h3 id="微-micro-架构的出现"><a href="#微-micro-架构的出现" class="headerlink" title="微(micro)架构的出现"></a>微(micro)架构的出现</h3><p>intel推出奔腾系列，P5微架构;</p><p>amd推出K5微架构竞争，性能较差;</p><h3 id="Intel-Pentium（1993）"><a href="#Intel-Pentium（1993）" class="headerlink" title="Intel Pentium（1993）"></a>Intel Pentium（1993）</h3><p>它也是第一个超标量Intel x86处理器（Intel公司把这种同时执行两条指令的能力称为超标量技术）。它具有双Integer流水线和单个浮点单元，允许它每个时钟发出并完成多个指令。</p><p>从PENTIUM开始，我们大家有了超频这样一个用尝试少的钱换取尝试多的性能的好方法</p><p>从Pentium开始，CPU封装开始出现扇热盖的设计，CPU的发热问题已经突显。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">60, 66MHz</td><td align="left">32bit 单核</td><td align="left">3.1M</td><td align="left">0.8微米</td></tr></tbody></table><p>不足：i586程序(这个程序还有一些其他的名字，比如Linux用户就把它称为f00f程序)是一种越界攻击手段，处理器芯片会因为无法执行这个程序发来的非法指令而出现死机现象。</p><p>这个程序似乎并没有利用奔腾CPU里浮点运算的弱点，它直接向CPU送去错误的指令。这种死机现象除了手动重置计算机外没有其他好的解决办法</p><h3 id="Intel-Pentium-Pro（1995）"><a href="#Intel-Pentium-Pro（1995）" class="headerlink" title="Intel Pentium Pro（1995）"></a>Intel Pentium Pro（1995）</h3><p>为工作站和服务器设计，超算ASCI Red（第一台达到每秒万亿次浮点运算的计算机）。</p><p>Pentium临的是在Pentium Pro的一个封装中除Pentium Pro芯片外还包括一个256KB的二级缓存芯片，两个芯片之间用高频宽的奔腾Pro200MHZ CPU的L2 CACHE即正在运行在200MHZ上，内部通讯总线互连，处理器与高速缓存的连接线路也被安置在该封装中，这样就使高速缓存能更容易地运行在更高的频率上。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">200MHz</td><td align="left">32bit 单核</td><td align="left">5.5M</td><td align="left">0.35微米</td></tr></tbody></table><p>不足：但是肇因于0.35微米制程发热功率甚大，故其时脉不曾高于233 MHz（正式版不能超频）。此外，由于指令队列的问题，Pentium Pro的16bit指令执行能力低于Pentium，造成Windows3.X和Windows9X与DOS系统下Pentium Pro性能低下。</p><h3 id="64位处理器的诞生"><a href="#64位处理器的诞生" class="headerlink" title="64位处理器的诞生"></a>64位处理器的诞生</h3><ul><li>1961年：IBM发表IBM 7030 Stretch 超级电脑。它使用64位资料字组，以及32或64位的指令字组。</li><li>1999年：Intel发布IA-64架构的指令集。AMD首次公开64位集以扩展给IA-32，称为x86-64（后来改名为AMD64）。</li></ul><h3 id="Intel-Xeon（2001）"><a href="#Intel-Xeon（2001）" class="headerlink" title="Intel Xeon（2001）"></a>Intel Xeon（2001）</h3><p>主要供非消费级服务站，服务器和嵌入式系统使用。</p><p>基于英特尔的NetBurst架构，有更高级的网络功能，及更复杂更的3D图形性能，另一方面，支持至强的芯片组也在并行运算、支持高性能I/O子系统（如SCSI磁盘阵列、千兆网络接口）、支持PCI总线分段等方面更好地支持服务器端的运算。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">1.7GHz</td><td align="left">32bit 单核</td><td align="left">42M</td><td align="left">180nm</td></tr></tbody></table><h3 id="多核处理器的出现"><a href="#多核处理器的出现" class="headerlink" title="多核处理器的出现"></a>多核处理器的出现</h3><p>2000年IBM发布POWER4,双核心处理器；</p><p>2005年4月，AMD发布皓龙(Opteron)双核处理器</p><h3 id="Core-2（2009）"><a href="#Core-2（2009）" class="headerlink" title="Core 2（2009）"></a>Core 2（2009）</h3><p>第一款微架构处理器，取代由2000年起大多数英特尔处理器采用的NetBurst架构。</p><p>提升缓冲存储器效率、核心数量等作出优化。这些新处理器的功耗比以往的Pentium 4/D处理器低很多。</p><table><thead><tr><th align="left">时钟频率</th><th align="left">类型</th><th align="left">晶体管</th><th align="left">工艺</th></tr></thead><tbody><tr><td align="left">1.06GHz~3.33GHz</td><td align="left">64bit，1,2,4核</td><td align="left">291M</td><td align="left">65nm</td></tr></tbody></table><p>不足：Core 2处理器的主板售价较高，导致组装成本大幅增加所致</p><h3 id="Alder-Lake-大小核"><a href="#Alder-Lake-大小核" class="headerlink" title="Alder Lake 大小核"></a>Alder Lake 大小核</h3><p>待补充。。。</p>]]></content>
      
      
      <categories>
          
          <category> 基础架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 编程基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>极简的极客法则</title>
      <link href="metaverse/hacklaw/"/>
      <url>metaverse/hacklaw/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>原文是<a href="https://github.com/dwmkerr/hacker-laws">hacker-laws</a> ，作者做了翻译、归纳、整理、夹带私货；<br>阅读hacker laws 有助于coder 更好的开发； here we go!</p><h2 id="定律"><a href="#定律" class="headerlink" title="定律"></a>定律</h2><h3 id="90-9-1-法则-90–9–1-Principle-or-1-Rule"><a href="#90-9-1-法则-90–9–1-Principle-or-1-Rule" class="headerlink" title="90-9-1 法则 (90–9–1 Principle or 1% Rule)"></a>90-9-1 法则 (90–9–1 Principle or 1% Rule)</h3><p>在诸如维基这样的互联网社区中，90% 的用户只看内容并不参与互动，9% 的用户会参与讨论，而只有 1% 的用户会创造内容。</p><h3 id="阿姆达尔定律-Amdahl’s-Law"><a href="#阿姆达尔定律-Amdahl’s-Law" class="headerlink" title="阿姆达尔定律 (Amdahl’s Law)"></a>阿姆达尔定律 (Amdahl’s Law)</h3><p>并行计算中，有些部分可以被多核心并行处理，有些部分只能串行处理，增加核心对速度的提升的收益会边际递减</p><h3 id="破窗效应-The-Broken-Windows-Theory"><a href="#破窗效应-The-Broken-Windows-Theory" class="headerlink" title="破窗效应 (The Broken Windows Theory)"></a>破窗效应 (The Broken Windows Theory)</h3><p>在破窗理论中认为，恶化若不修复，会导致进一步更严重的恶化参见：</p><h3 id="布鲁克斯法则-Brooks’s-Law"><a href="#布鲁克斯法则-Brooks’s-Law" class="headerlink" title="布鲁克斯法则 (Brooks’s Law)"></a>布鲁克斯法则 (Brooks’s Law)</h3><p>软件开发后期，添加人力只会使项目开发得更慢。因为有些事情无法分割，切增加沟通成本（和阿姆达尔有点像）<br>《人月神话》大篇幅在讲这个</p><h3 id="CAP-定理-CAP-Theorem-or-Brewer’s-Theorem"><a href="#CAP-定理-CAP-Theorem-or-Brewer’s-Theorem" class="headerlink" title="CAP 定理 (CAP Theorem or Brewer’s Theorem)"></a>CAP 定理 (CAP Theorem or Brewer’s Theorem)</h3><p>CAP 定理由 Eric Brewer 所定义，它指出对于分布式数据存储来说，不可能同时满足以下三点，可以有侧重，例如金融交易系统的强一致性，淘宝的可用性等：</p><ul><li>一致性 (Consistency)：每个终端都会接收到 最新的数据，或者返回错误。</li><li>可用性 (Availability): 每个终端都会接收到一个 非错误的响应，但不能保证该数据是 最新的数据。</li><li>分区容错性 (Partition Tolerance)：当节点之间任意数量的网络请求失败时，系统能按预期继续运行（脑裂后还可以保证使用）。</li></ul><h3 id="康威定律-Conway’s-Law"><a href="#康威定律-Conway’s-Law" class="headerlink" title="康威定律 (Conway’s Law)"></a>康威定律 (Conway’s Law)</h3><p>如果一个组织被分散成许多小而无联系的单元，那么它开发的软件也是小而分散的。组织架构会体现在软件架构上（分形）</p><h3 id="坎宁汉姆定律-Cunningham’s-Law"><a href="#坎宁汉姆定律-Cunningham’s-Law" class="headerlink" title="坎宁汉姆定律 (Cunningham’s Law)"></a>坎宁汉姆定律 (Cunningham’s Law)</h3><p>在网络上想得到正确答案的最好方法不是提问题，而是发布一个错误的答案，引起辩论（不建议这么做，现在网上已经一堆的错误回答）</p><h3 id="邓巴数字-Dunbar’s-Number"><a href="#邓巴数字-Dunbar’s-Number" class="headerlink" title="邓巴数字 (Dunbar’s Number)"></a>邓巴数字 (Dunbar’s Number)</h3><p>邓巴数字是对一个人能够保持稳定社会关系的人数的认知极限——在这种关系中，邓巴数字的估计值一般在 100 至 250 之间。所以有些以扁平化为珍宝的公司在扩张时管理会有问题，对我们个人的启发是，可以交一两个社交牛的朋友，可以交换新事物。</p><h3 id="邓宁-克鲁格效应-The-Dunning-Kruger-Effect"><a href="#邓宁-克鲁格效应-The-Dunning-Kruger-Effect" class="headerlink" title="邓宁-克鲁格效应 (The Dunning-Kruger Effect)"></a>邓宁-克鲁格效应 (The Dunning-Kruger Effect)</h3><p>无能的人往往不会意识到自己的无能。而得出正确答案所需要的技能，正是你认识到何为正确答案所需要的技能。虚幻的优越性产自无知</p><h3 id="费茨法则-Fitts’s-Law"><a href="#费茨法则-Fitts’s-Law" class="headerlink" title="费茨法则 (Fitts’s Law)"></a>费茨法则 (Fitts’s Law)</h3><p>该法则指出，移动到目标区域所需的时间是到目标的距离除以目标宽度的函数。<br>费茨法则决定了在设计 UX 或 UI 时，交互元素应该尽可能大，而用户注意力区域和交互元素之间的距离应该尽可能小。这会对设计产生影响，例如将相近的任务进行归类分组等。</p><h3 id="盖尔定律-Gall’s-Law"><a href="#盖尔定律-Gall’s-Law" class="headerlink" title="盖尔定律 (Gall’s Law)"></a>盖尔定律 (Gall’s Law)</h3><p>完整的复杂系统不是设计成的，而是一步步的修补和更改变成现在的样子。</p><h3 id="古德哈特定律-Goodhart’s-Law"><a href="#古德哈特定律-Goodhart’s-Law" class="headerlink" title="古德哈特定律 (Goodhart’s Law)"></a>古德哈特定律 (Goodhart’s Law)</h3><p>当一个措施本身成为目标时，它就不再是一个好的措施，像为了kpi而kpi，在方法中迷失目的</p><h3 id="汉隆的剃刀-Hanlon’s-Razor"><a href="#汉隆的剃刀-Hanlon’s-Razor" class="headerlink" title="汉隆的剃刀 (Hanlon’s Razor)"></a>汉隆的剃刀 (Hanlon’s Razor)</h3><p>能解释为愚蠢的，就不要解释为恶意的</p><h3 id="席克定律-Hick’s-Law-or-Hick-Hyman-Law"><a href="#席克定律-Hick’s-Law-or-Hick-Hyman-Law" class="headerlink" title="席克定律 (Hick’s Law or Hick-Hyman Law)"></a>席克定律 (Hick’s Law or Hick-Hyman Law)</h3><p>决策时间和可供选择的选项数量呈对数增长关系。</p><h3 id="侯世达定律-Hofstadter’s-Law"><a href="#侯世达定律-Hofstadter’s-Law" class="headerlink" title="侯世达定律 (Hofstadter’s Law)"></a>侯世达定律 (Hofstadter’s Law)</h3><p>结果往往低于目标，即使考虑到了这个点。</p><h3 id="哈特伯定律-Hutber’s-Law"><a href="#哈特伯定律-Hutber’s-Law" class="headerlink" title="哈特伯定律 (Hutber’s Law)"></a>哈特伯定律 (Hutber’s Law)</h3><p>对一个系统的改进会导致其他部分的恶化；或者它会将其他的恶化隐藏起来，并导致系统整体状态的退化。</p><h3 id="技术成熟度曲线-The-Hype-Cycle-or-Amara’s-Law"><a href="#技术成熟度曲线-The-Hype-Cycle-or-Amara’s-Law" class="headerlink" title="技术成熟度曲线 (The Hype Cycle or Amara’s Law)"></a>技术成熟度曲线 (The Hype Cycle or Amara’s Law)</h3><p>人有动物性-短时。我们倾向于过高估计技术在短期内的影响，并低估长期效应。</p><h3 id="隐式接口定律-Hyrum’s-Law-or-The-Law-of-Implicit-Interfaces"><a href="#隐式接口定律-Hyrum’s-Law-or-The-Law-of-Implicit-Interfaces" class="headerlink" title="隐式接口定律 (Hyrum’s Law or The Law of Implicit Interfaces)"></a>隐式接口定律 (Hyrum’s Law or The Law of Implicit Interfaces)</h3><p>当你的 API 有足够多的用户时，API 的所有行为最终都会被其他人所依赖，大家不会一直看文档，很多公司都在取消文档工程师，转而提升用户使用体验。</p><h3 id="柯林汉定律-Kernighan’s-Law"><a href="#柯林汉定律-Kernighan’s-Law" class="headerlink" title="柯林汉定律 (Kernighan’s Law)"></a>柯林汉定律 (Kernighan’s Law)</h3><p>调试在一开始就比编写程序困难一倍。因此，按照定义，如果你的代码写得非常巧妙，那么你就没有足够的能力来调试它。</p><h3 id="林纳斯定律-Linus’s-Law"><a href="#林纳斯定律-Linus’s-Law" class="headerlink" title="林纳斯定律 (Linus’s Law)"></a>林纳斯定律 (Linus’s Law)</h3><p>简单地说，能够看到问题的人越多，有人解决过相关的问题或事情的可能性就越高。</p><h3 id="梅特卡夫定律-Metcalfe’s-Law"><a href="#梅特卡夫定律-Metcalfe’s-Law" class="headerlink" title="梅特卡夫定律 (Metcalfe’s Law)"></a>梅特卡夫定律 (Metcalfe’s Law)</h3><p>在网络理论中，系统的价值约等于系统用户数的平方，人的作用很大。</p><h3 id="摩尔定律-Moore’s-Law"><a href="#摩尔定律-Moore’s-Law" class="headerlink" title="摩尔定律 (Moore’s Law)"></a>摩尔定律 (Moore’s Law)</h3><p>集成电路中的晶体管数量大约每两年翻一番。价格不变，芯片性能两年一番。</p><h3 id="墨菲定律-Murphy’s-Law-Sod’s-Law"><a href="#墨菲定律-Murphy’s-Law-Sod’s-Law" class="headerlink" title="墨菲定律 (Murphy’s Law / Sod’s Law)"></a>墨菲定律 (Murphy’s Law / Sod’s Law)</h3><p>凡是可能出错的事就一定会出错。</p><h3 id="奥卡姆剃刀-Occam’s-Razor"><a href="#奥卡姆剃刀-Occam’s-Razor" class="headerlink" title="奥卡姆剃刀 (Occam’s Razor)"></a>奥卡姆剃刀 (Occam’s Razor)</h3><p>如无必要，勿增实体。</p><h3 id="帕金森定理-Parkinson’s-Law"><a href="#帕金森定理-Parkinson’s-Law" class="headerlink" title="帕金森定理 (Parkinson’s Law)"></a>帕金森定理 (Parkinson’s Law)</h3><p>在工作能够完成的时限内，工作量会一直增加，直到所有可用时间都被填满为止，所以别卷了，工作是做不完的。</p><h3 id="过早优化效应-Premature-Optimization-Effect"><a href="#过早优化效应-Premature-Optimization-Effect" class="headerlink" title="过早优化效应 (Premature Optimization Effect)"></a>过早优化效应 (Premature Optimization Effect)</h3><p>过早优化是万恶之源。</p><h3 id="普特定律-Putt’s-Law"><a href="#普特定律-Putt’s-Law" class="headerlink" title="普特定律 (Putt’s Law)"></a>普特定律 (Putt’s Law)</h3><p>技术由两类人主导，一类是纯粹的管理人员， 一类是纯粹的技术人员。</p><h3 id="里德定律-Reed’s-Law"><a href="#里德定律-Reed’s-Law" class="headerlink" title="里德定律 (Reed’s Law)"></a>里德定律 (Reed’s Law)</h3><p>大型网络，尤其是社交网络的效用会随着网络的大小呈指数级扩增，规模效应</p><h3 id="复杂性守恒定律-The-Law-of-Conservation-of-Complexity-or-Tesler’s-Law"><a href="#复杂性守恒定律-The-Law-of-Conservation-of-Complexity-or-Tesler’s-Law" class="headerlink" title="复杂性守恒定律 (The Law of Conservation of Complexity or Tesler’s Law)"></a>复杂性守恒定律 (The Law of Conservation of Complexity or Tesler’s Law)</h3><p>系统中存在着一定程度的复杂性，并且不能减少。</p><h3 id="得墨忒耳定律-The-Law-of-Demeter"><a href="#得墨忒耳定律-The-Law-of-Demeter" class="headerlink" title="得墨忒耳定律 (The Law of Demeter)"></a>得墨忒耳定律 (The Law of Demeter)</h3><p>得墨忒耳定律又称最少知识原则，是一条与面向对象语言有关的软件设计原则，只和已知的打交道。</p><h3 id="抽象泄漏定律-The-Law-of-Leaky-Abstractions"><a href="#抽象泄漏定律-The-Law-of-Leaky-Abstractions" class="headerlink" title="抽象泄漏定律 (The Law of Leaky Abstractions)"></a>抽象泄漏定律 (The Law of Leaky Abstractions)</h3><p>在某种程度上，所有非平凡的抽象都是有泄漏的。<br>过度依赖抽象，加上对底层过程的理解不足，实际上使得问题在某些情况下更加复杂。</p><h3 id="帕金森琐碎定理-The-Law-of-Triviality"><a href="#帕金森琐碎定理-The-Law-of-Triviality" class="headerlink" title="帕金森琐碎定理 (The Law of Triviality)"></a>帕金森琐碎定理 (The Law of Triviality)</h3><p>群体将给予更多的时间和注意力来处理琐碎的问题，而不是用来处理严肃而实质性的问题。</p><h3 id="Unix-哲学-The-Unix-Philosophy"><a href="#Unix-哲学-The-Unix-Philosophy" class="headerlink" title="Unix 哲学 (The Unix Philosophy)"></a>Unix 哲学 (The Unix Philosophy)</h3><p>软件组件应该很小，并专注于做一件特定的事情。将小而简单以及定义良好的单元组合在一起，而不是使用大而复杂的多用途程序，可以更轻松地构建系统。</p><h3 id="Spotify-模型-The-Spotify-Model"><a href="#Spotify-模型-The-Spotify-Model" class="headerlink" title="Spotify 模型 (The Spotify Model)"></a>Spotify 模型 (The Spotify Model)</h3><p>团队围绕功能而非技术进行组织。</p><h3 id="沃德勒定律-Wadler’s-Law"><a href="#沃德勒定律-Wadler’s-Law" class="headerlink" title="沃德勒定律 (Wadler’s Law)"></a>沃德勒定律 (Wadler’s Law)</h3><p>任何语言设计中，讨论下面列表中某个要素所花费的总时间与其位置成正比。</p><ol><li>语义 (Semantics)</li><li>语法 (Syntax)</li><li>词法 (Lexical syntax)</li><li>注释语法 (Lexical syntax of comments)<br>简而言之，在语义上花费一个小时，就要在注释语法上花费八个小时</li></ol><h3 id="惠顿定律-Wheaton’s-Law"><a href="#惠顿定律-Wheaton’s-Law" class="headerlink" title="惠顿定律 (Wheaton’s Law)"></a>惠顿定律 (Wheaton’s Law)</h3><p>不要像个傻子一样。</p><h2 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h2><p>原则通常是与设计相关的准则。</p><h3 id="乔治·伯克斯定律-All-Models-Are-Wrong-or-George-Box’s-Law"><a href="#乔治·伯克斯定律-All-Models-Are-Wrong-or-George-Box’s-Law" class="headerlink" title="乔治·伯克斯定律 (All Models Are Wrong or George Box’s Law)"></a>乔治·伯克斯定律 (All Models Are Wrong or George Box’s Law)</h3><p>这一原则表明，所有的系统模型都是有缺陷的，但只要它们没有太多缺陷，那便有可能是有用的。这一原则源于统计学，同时也适用于科学和计算模型。</p><h3 id="切斯特森围栏-Chesterson’s-Fence"><a href="#切斯特森围栏-Chesterson’s-Fence" class="headerlink" title="切斯特森围栏 (Chesterson’s Fence)"></a>切斯特森围栏 (Chesterson’s Fence)</h3><p>在了解现有情况背后的原因之前，不应该进行改进。</p><h3 id="死海效应-The-Dead-Sea-Effect"><a href="#死海效应-The-Dead-Sea-Effect" class="headerlink" title="死海效应 (The Dead Sea Effect)"></a>死海效应 (The Dead Sea Effect)</h3><p>死海效应表明，在任何一个组织中，工程师的技能、才华和效能往往与他们在公司的时间呈反比。</p><h3 id="呆伯特法则-The-Dilbert-Principle"><a href="#呆伯特法则-The-Dilbert-Principle" class="headerlink" title="呆伯特法则 (The Dilbert Principle)"></a>呆伯特法则 (The Dilbert Principle)</h3><p>公司会倾向于系统地将工作能力差的员工提升到管理层，以使他们脱离工作流程（在国内目前没有）。</p><h3 id="帕累托法则-The-Pareto-Principle-or-The-80-20-Rule"><a href="#帕累托法则-The-Pareto-Principle-or-The-80-20-Rule" class="headerlink" title="帕累托法则 (The Pareto Principle or The 80/20 Rule)"></a>帕累托法则 (The Pareto Principle or The 80/20 Rule)</h3><p>生活中大多数事情不是均匀分布的。<br>这个原则也被称为<strong>二八法则</strong>，<strong>重要的少数法则</strong>和<strong>因素稀疏原则</strong>。</p><h3 id="舍基原理-The-Shirky-Principle"><a href="#舍基原理-The-Shirky-Principle" class="headerlink" title="舍基原理 (The Shirky Principle)"></a>舍基原理 (The Shirky Principle)</h3><p>各机构会努力保留他们能够解决的问题。<br>当一个人不理解自己的工作就能够获得酬劳时，那么他就很难再去了解这份工作了！</p><h3 id="彼得原理-The-Peter-Principle"><a href="#彼得原理-The-Peter-Principle" class="headerlink" title="彼得原理 (The Peter Principle)"></a>彼得原理 (The Peter Principle)</h3><p>在等级制度中，人往往会被提升到他们的“无法胜任的水平。</p><h3 id="鲁棒性原则-The-Robustness-Principle-or-Postel’s-Law"><a href="#鲁棒性原则-The-Robustness-Principle-or-Postel’s-Law" class="headerlink" title="鲁棒性原则 (The Robustness Principle or Postel’s Law)"></a>鲁棒性原则 (The Robustness Principle or Postel’s Law)</h3><p>在自己所做的事情上要保守, 在接受别人的事情上要自由。</p><h3 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h3><ul><li>S：单一功能原则：有且有一个单一的功能，并且该功能应该由这个类完全封装起来</li><li>O：开闭原则：对于扩展是开放的，但是对于修改是封闭的</li><li>L：里氏替换原则：子类可以扩展父类的功能，但不能改变父类原有的功能</li><li>I：接口隔离原则：建立单一接口，不要建立庞大臃肿的接口</li><li>D：依赖反转原则 ：不要太多耦合<br>这些是 <a href="https://github.com/nusr/hacker-laws-zh#todo">Object-Oriented Programming</a> 的关键原则。诸如此类的设计原则能够帮助开发人员构建更易于维护的系统。</li></ul><h3 id="不要重复你自己原则-The-DRY-Principle"><a href="#不要重复你自己原则-The-DRY-Principle" class="headerlink" title="不要重复你自己原则 (The DRY Principle)"></a>不要重复你自己原则 (The DRY Principle)</h3><p>系统中，每一块知识都必须是单一、明确而权威的。</p><h3 id="KISS-原则-The-KISS-Principle"><a href="#KISS-原则-The-KISS-Principle" class="headerlink" title="KISS 原则 (The KISS Principle)"></a>KISS 原则 (The KISS Principle)</h3><p>保持简单和直白。</p><h3 id="你不需要它原则-YAGNI"><a href="#你不需要它原则-YAGNI" class="headerlink" title="你不需要它原则 (YAGNI)"></a>你不需要它原则 (YAGNI)</h3><p>只有当你需要某些东西的时候，才去实现它们，而不是在你预见的时候。如无必要，勿增实体</p><h3 id="分布式计算的谬论-The-Fallacies-of-Distributed-Computing"><a href="#分布式计算的谬论-The-Fallacies-of-Distributed-Computing" class="headerlink" title="分布式计算的谬论 (The Fallacies of Distributed Computing)"></a>分布式计算的谬论 (The Fallacies of Distributed Computing)</h3><p>不要做以下假设</p><ul><li>网络可靠</li><li>延迟为零</li><li>带宽无限</li><li>网络安全</li><li>拓扑恒定</li><li>单一管理员</li><li>运输成本为零</li><li>网络为同构的</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程思想 </tag>
            
            <tag> 编程哲学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从Typhoon台风到控制反转-依赖注入</title>
      <link href="metaverse/dependencyinjection/"/>
      <url>metaverse/dependencyinjection/</url>
      
        <content type="html"><![CDATA[<p>最近这两天台风“烟花“ 肆虐长三角，偶然间看到ios开发中的Typhoon，那今天就聊聊依赖注入吧。</p><h2 id="什么是Typhoon台风"><a href="#什么是Typhoon台风" class="headerlink" title="什么是Typhoon台风"></a>什么是Typhoon台风</h2><p>Typhoon 是Objective-C和Swift语言的轻量级依赖注入工具，功能较全，容易上手。</p><h2 id="什么是依赖注入-Dependency-Injection-DI"><a href="#什么是依赖注入-Dependency-Injection-DI" class="headerlink" title="什么是依赖注入(Dependency Injection,DI)"></a>什么是依赖注入(Dependency Injection,DI)</h2><p>依赖注入是减少代码耦合度的一种常见方式。</p><p>在解释依赖注入之前我们要解释一下控制反转，因为依赖注入是实现控制反转的一种方式(另一种方式是依赖查找)。</p><h3 id="什么是控制反转-Inversion-of-Control-IoC"><a href="#什么是控制反转-Inversion-of-Control-IoC" class="headerlink" title="什么是控制反转(Inversion of Control,IoC)"></a>什么是控制反转(Inversion of Control,IoC)</h3><p>控制反转是面向对象编程(OOP)的一种设计原则(SOLID原则的D依赖倒置原则)，用来降低代码耦合度。</p><p>描述：类A需要用到类B中的对象o,必使得要在类A要获取类B的引用，类B实例创建过程如果在类A代码中实现会使得代码耦合度增大，更改类B中的代码，可能也要去更改引用了类B的代码，很不好用；而控制反转则是将创建类B实例的控制权从类A中剥离到IOC容器控制。</p><h4 id="依赖注入与控制反转辨析"><a href="#依赖注入与控制反转辨析" class="headerlink" title="依赖注入与控制反转辨析"></a>依赖注入与控制反转辨析</h4><p>控制反转是思想，依赖注入是技术，依赖注入是控制反转的一种实现方式。</p><p>依赖注入是从类A的角度描述的：类A需要依赖IOC容器创建并注入类A需要的外部资源；</p><p>控制反转是从IOC容器的角度描述的：IOC容器控制类A，由IOC容器反向向类A中注入类A需要的外部资源。</p><h3 id="依赖注入与依赖查找-Dependency-Lookup-的区别"><a href="#依赖注入与依赖查找-Dependency-Lookup-的区别" class="headerlink" title="依赖注入与依赖查找(Dependency Lookup)的区别"></a>依赖注入与依赖查找(Dependency Lookup)的区别</h3><p>依赖查找使用容器的API来查找依赖的资源，虽然降低了对象间的依赖，却让对象依赖容器，无法在容器外使用依赖对象。</p><h3 id="依赖注入的方式"><a href="#依赖注入的方式" class="headerlink" title="依赖注入的方式"></a>依赖注入的方式</h3><p>依赖注入有5种实现方式，主要使用Setter注入和构造方法注入。</p><h4 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h4><p>IOC调用带参数的构造方法来注入依赖的实例，每个参数代表一个依赖。</p><h4 id="Set方法注入"><a href="#Set方法注入" class="headerlink" title="Set方法注入"></a>Set方法注入</h4><p>set是更新变量值的一种方法，在接受注入的类中(上文类A)中定义Set方法，在参数中定义药注入的元素，IOC调用类A的Set方法实现注入；</p><h4 id="接口注入"><a href="#接口注入" class="headerlink" title="接口注入"></a>接口注入</h4><p>在接口中定义要注入的信息，IOC通过接口注入。</p><h4 id="基于注解、反射注入"><a href="#基于注解、反射注入" class="headerlink" title="基于注解、反射注入"></a>基于注解、反射注入</h4><p>指的是java那种注解(而非py3那种注解)，java中@Resource、@Autowired、@Qualifier都可用于注解注入</p><h4 id="编译时注入"><a href="#编译时注入" class="headerlink" title="编译时注入"></a>编译时注入</h4><p>在编译时自动生成代码完成注入，例如golang中的wire</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程思想 </tag>
            
            <tag> 依赖反转 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang实现rsa加解密</title>
      <link href="metaverse/implementrsa/"/>
      <url>metaverse/implementrsa/</url>
      
        <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ol><li><p>数字签名</p></li><li><p>加解密</p></li><li><p>对称</p></li><li><p>非对称</p></li><li><p>RSA算法</p></li></ol><p>大整数的因数分解，是一件非常困难的事情（对目前的计算机算力和数学方法来说）。我们可以以此为数据加解密</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//publicKey, privateKey := generateKey(999773, 999959)</span></span><br><span class="line">publicKey, privateKey := generateKey(<span class="number">7001</span>, <span class="number">7079</span>)</span><br><span class="line">txt := <span class="string">&quot;password&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;publicKey&quot;</span>,publicKey)</span><br><span class="line">fmt.Println(<span class="string">&quot;privateKey&quot;</span>, privateKey)</span><br><span class="line">encode := rsaEnCode(publicKey, txt)</span><br><span class="line">fmt.Println(encode)</span><br><span class="line">decode := rsaDeCode(privateKey, encode)</span><br><span class="line">fmt.Println(decode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//gcd 最大公约数greatest common divisor,辗转相除法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gcd</span><span class="params">(x, y <span class="keyword">uint64</span>)</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">tmp := x % y</span><br><span class="line"><span class="keyword">if</span> tmp &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> gcd(y, tmp)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//lcm 最小公倍数least common multiple，公式法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lcm</span><span class="params">(x, y <span class="keyword">uint64</span>)</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x * y / gcd(x, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//generateKey 生成密钥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateKey</span><span class="params">(a, b <span class="keyword">uint64</span>)</span> <span class="params">([2]<span class="keyword">uint64</span>, [2]<span class="keyword">uint64</span>)</span></span> &#123;</span><br><span class="line">publicKey := [<span class="number">2</span>]<span class="keyword">uint64</span>&#123;&#125;</span><br><span class="line">privateKey := [<span class="number">2</span>]<span class="keyword">uint64</span>&#123;&#125;</span><br><span class="line">n := a * b</span><br><span class="line">publicKey[<span class="number">0</span>] = n</span><br><span class="line">privateKey[<span class="number">0</span>] = n</span><br><span class="line"></span><br><span class="line">l := lcm(a<span class="number">-1</span>, b<span class="number">-1</span>)</span><br><span class="line">e, err := getE(l)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">d, err := getD(e, l)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">publicKey[<span class="number">1</span>] = e</span><br><span class="line">privateKey[<span class="number">1</span>] = d</span><br><span class="line">fmt.Println(e)</span><br><span class="line">fmt.Println(d)</span><br><span class="line"><span class="keyword">return</span> publicKey, privateKey</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取公钥参数e</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getE</span><span class="params">(l <span class="keyword">uint64</span>)</span> <span class="params">(<span class="keyword">uint64</span>, error)</span></span> &#123;</span><br><span class="line">e := l - <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> e &lt;= <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;no e founded&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> gcd(e, l) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> e, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">e--</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取私钥参数d</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getD</span><span class="params">(e, l <span class="keyword">uint64</span>)</span> <span class="params">(<span class="keyword">uint64</span>, error)</span></span> &#123;</span><br><span class="line">d := l - <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> d &lt;= <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;no d founded&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> e*d%l == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> e, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">d--</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无符号64位整形求幂</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pow</span><span class="params">(a, b <span class="keyword">uint64</span>)</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">out := a</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> b == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br><span class="line">out *= a</span><br><span class="line">b--</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//rsa加密</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rsaEnCode</span><span class="params">(publicKey [2]<span class="keyword">uint64</span>, string2 <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">pp := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">0</span>,<span class="built_in">len</span>(string2))</span><br><span class="line"><span class="keyword">for</span> _,v :=<span class="keyword">range</span> string2 &#123;</span><br><span class="line">uint64String := <span class="keyword">uint64</span>(v)</span><br><span class="line">encodeUint := pow(uint64String, publicKey[<span class="number">1</span>]) % publicKey[<span class="number">0</span>]</span><br><span class="line">encodeString := strconv.FormatUint(encodeUint, <span class="number">10</span>)</span><br><span class="line">pp = <span class="built_in">append</span>(pp, encodeString)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;rsaEncode&quot;</span>,fmt.Sprintf(strings.Join(pp,<span class="string">&quot;,&quot;</span>)))</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(strings.Join(pp,<span class="string">&quot;,&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//rsa解密</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rsaDeCode</span><span class="params">(publicKey [2]<span class="keyword">uint64</span>, string2 <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">txtSlice := strings.Split(string2,<span class="string">&quot;,&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;txt&quot;</span>,txtSlice,reflect.TypeOf(txtSlice))</span><br><span class="line">pp := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">0</span>,<span class="built_in">len</span>(txtSlice))</span><br><span class="line"><span class="keyword">for</span> _,v :=<span class="keyword">range</span> txtSlice &#123;</span><br><span class="line">uint64String,_ := strconv.ParseUint(v,<span class="number">10</span>,<span class="number">64</span>)</span><br><span class="line">encodeUint := pow(uint64String, publicKey[<span class="number">1</span>]) % publicKey[<span class="number">0</span>]</span><br><span class="line">encodeString := <span class="keyword">string</span>(encodeUint)</span><br><span class="line">fmt.Println(encodeUint,encodeString)</span><br><span class="line">pp = <span class="built_in">append</span>(pp, encodeString)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;rsaDecode&quot;</span>,pp,fmt.Sprintf(strings.Join(pp,<span class="string">&quot;&quot;</span>)))</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(strings.Join(pp,<span class="string">&quot;&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="PKCS1与PKCS8"><a href="#PKCS1与PKCS8" class="headerlink" title="PKCS1与PKCS8"></a>PKCS1与PKCS8</h2><p><strong>PKCS1：</strong>全名《Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications》最新版本2.2  <em>(rfc8017, 有兴趣的同学可以读一下)</em> ，从名称上可以看出它是针对RSA算法的一个规范。里面包含了RSA加密、解密、签名验签等所有的内容，当然也包含了私钥的格式。PKCS1的1.1版本是1991年发布的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">...</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p> <strong>PKCS8：</strong>全名《Public-Key Cryptography Standards (PKCS) #8: Private-Key Information Syntax Specification》最新版本1.2，从名称上可以看出它是一个专门用来存储私钥的文件格式规范。PKCS1的1.2版本是2008年发布的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">...</span><br><span class="line">-----END PRIVATE KEY-----</span><br></pre></td></tr></table></figure><h4 id="将私钥PEM格式的文件转换为DER格式"><a href="#将私钥PEM格式的文件转换为DER格式" class="headerlink" title="将私钥PEM格式的文件转换为DER格式"></a>将私钥PEM格式的文件转换为DER格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash# openssl rsa -in pkcs1.pem -out pkcs1.der -outform DER</span><br><span class="line">bash# openssl pkcs8 -topk8 -inform PEM -in pkcs1.pem -outform DER -nocrypt -out pkcs8.der</span><br><span class="line">bash# ls </span><br><span class="line">pkcs1.der pkcs1.pem pkcs8.der pkcs8.pem</span><br></pre></td></tr></table></figure><h3 id="对比两个der格式内容"><a href="#对比两个der格式内容" class="headerlink" title="对比两个der格式内容"></a>对比两个der格式内容</h3><p>使用hexdump查看内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat pkcs1.der | hexdump</span><br></pre></td></tr></table></figure><h4 id="PEM-和DER区别"><a href="#PEM-和DER区别" class="headerlink" title="PEM 和DER区别"></a>PEM 和DER区别</h4><p>PEM与DER有什么区别呢？其实PEM就是对DER的内容做了base64的编码并做了一下格式化的输出而已。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 密码学 </tag>
            
            <tag> golang </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>奥卡姆剃刀和他的剃刀兄弟们</title>
      <link href="metaverse/razor/"/>
      <url>metaverse/razor/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><p>在开发和生活中常听人说起奥卡姆剃刀以及<code>若无必要，勿增实体</code>，其实除了奥卡姆剃刀这个工具外还有很多其他有用的剃刀。</p><h4 id="剃刀是什么"><a href="#剃刀是什么" class="headerlink" title="剃刀是什么"></a>剃刀是什么</h4><p>剃刀又称哲学剃刀，英文名Philosophical razor，是帮人做决定一些经验法则，是一种粗略的不稳定的简化思决策工具，只能做出粗略的判断(经验上的)，做出的决定<strong>更可能让你满意</strong>也有可能<strong>让你不满意</strong>(慎用)。</p><p><img src= "/img/loading.gif" data-lazy-src="data:image/jpeg;base64,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" alt="剃刀图片-剃刀素材-剃刀插画-摄图新视界"></p><h4 id="奥卡姆剃刀"><a href="#奥卡姆剃刀" class="headerlink" title="奥卡姆剃刀"></a>奥卡姆剃刀</h4><h5 id="奥卡姆剃刀是什么"><a href="#奥卡姆剃刀是什么" class="headerlink" title="奥卡姆剃刀是什么"></a>奥卡姆剃刀是什么</h5><p>奥卡姆剃刀英文名Ockham’s Razor，又称简约法则，14世纪提出，原教旨为‘entities should not be multiplied beyond necessity’，奥卡姆剃刀更像是从500/1000简化到1/2，而不是从汤汤(封面就是汤汤)是一只猫简化到汤汤是一种生物，更不是简化成汤汤是一种植物，当然奥卡姆剃刀也可以做一些微小的删除，但是请不要滥用！</p><h5 id="通俗解释"><a href="#通俗解释" class="headerlink" title="通俗解释"></a>通俗解释</h5><ol><li>更简单的解释<strong>更可能</strong>是正确的</li><li>假设越少越好</li></ol><h5 id="有哪些影响"><a href="#有哪些影响" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>地心说对天体运行的描述是及其复杂的，日心说对天体的描述的简单的，虽然两者都可以同等相对正确的描述天体运行轨迹（都很粗糙，太阳系统中每个星体运行轨迹是很复杂的，老三体人了），除此之外还有简约美，经验论，贝叶斯推断、主成分分析法等</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211011/1633947952v2-af4cb514073ed0e75f8830646b3ae5e5_1440w.jpg?source=172ae18b" alt="[天文地理常识] 地心说和日心说哪个对？"></p><h5 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h5><p>维特根斯坦说过： 推理过程的实质，是将能够符合我们经验的最简单法则接受为真理。</p><h4 id="汉隆剃刀"><a href="#汉隆剃刀" class="headerlink" title="汉隆剃刀"></a>汉隆剃刀</h4><h5 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h5><p>英文名Hanlon’s razor，来源不确切1940年后，原教旨为‘never attribute to malice that which is adequately explained by stupidity’，能解释为愚蠢的，就不要解释为恶意。</p><h5 id="通俗解释-1"><a href="#通俗解释-1" class="headerlink" title="通俗解释"></a>通俗解释</h5><p>出现不好的结果，不要总觉得别人坏，更可能是傻</p><p>不要以小人之心度君之之腹</p><h5 id="有哪些影响-1"><a href="#有哪些影响-1" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>太多因为误会导致的矛盾了，国家实体间战略误判导致世界大战，夫妻鸡同鸭讲导致婚姻破裂</p><h5 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h5><p>如果觉得全世界都对你有恶意，我想你应该要反省一下自己了</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211011/1633947960v2-870c054ee67f3ff9d9567f93f2c0d86b_1440w.jpg" alt="img"></p><h4 id="希金斯剃刀"><a href="#希金斯剃刀" class="headerlink" title="希金斯剃刀"></a>希金斯剃刀</h4><h5 id="是什么-1"><a href="#是什么-1" class="headerlink" title="是什么"></a>是什么</h5><p>英文名Hitchens’s razor，出自2007年《神并不伟大》起源于19世纪，原教旨为What can be asserted without evidence can also be dismissed without evidence，没有证据的断言也可以没有证据的驳斥。</p><h5 id="通俗解释-2"><a href="#通俗解释-2" class="headerlink" title="通俗解释"></a>通俗解释</h5><p>谁提出，谁举证；谁改变状态，谁负责改变状态的责任</p><h5 id="有哪些影响-2"><a href="#有哪些影响-2" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>认识论中影响很深，全世界很多人都认同</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211011/16339479631434.jpg_wh300.jpg" alt="法庭图片_法庭素材_法庭高清图片_摄图网图片下载"></p><h5 id="应用-2"><a href="#应用-2" class="headerlink" title="应用"></a>应用</h5><p>talk is cheap，show me your code，少说多做，证据说话</p><h4 id="修模剃刀"><a href="#修模剃刀" class="headerlink" title="修模剃刀"></a>修模剃刀</h4><h5 id="是什么-2"><a href="#是什么-2" class="headerlink" title="是什么"></a>是什么</h5><p>英文名Hume’s guillotine，起源于18世纪，原教旨为If the cause, any effect, be not sufficient to produce it, we must either reject that cause, or add to it such qualities as will give it a just proportion to the effect，如果为某一结果所指定的原因不足以产生该结果，我们就必须要么拒绝该原因，要么在其上加上一些使其与结果成正比的性质。</p><h5 id="通俗解释-3"><a href="#通俗解释-3" class="headerlink" title="通俗解释"></a>通俗解释</h5><p>如果某个原因不能直接导致结果，那这个原因要么和结果无关，要么只是结果的要素之一</p><h5 id="有哪些影响-3"><a href="#有哪些影响-3" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>知乎直呼内行</p><h5 id="应用-3"><a href="#应用-3" class="headerlink" title="应用"></a>应用</h5><p>抛开剂量谈毒性都是耍流氓</p><p><img src= "/img/loading.gif" data-lazy-src="data:image/png;base64,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" alt="卡通手绘辩论的人免抠素材免费下载_觅元素51yuansu.com"></p><h4 id="阿尔德剃刀"><a href="#阿尔德剃刀" class="headerlink" title="阿尔德剃刀"></a>阿尔德剃刀</h4><h5 id="是什么-3"><a href="#是什么-3" class="headerlink" title="是什么"></a>是什么</h5><p>英文名Alder’s razor，又称牛顿的火焰激光剑，起源于 2004 ，原教旨是If something cannot be settled by experiment or observation, then it is not worthy of debate.如果一件事不能通过实验或观察来证明伪，那就不值得辩论</p><p><img src= "/img/loading.gif" data-lazy-src="data:image/jpeg;base64,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" alt="牛顿的烈焰激光剑_万图壁纸网"></p><h5 id="通俗解释-4"><a href="#通俗解释-4" class="headerlink" title="通俗解释"></a>通俗解释</h5><p>如果无法证伪，那就没有讨论的价值</p><h5 id="有哪些影响-4"><a href="#有哪些影响-4" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>对科学的判断，可证伪性，伪科学和部分宗教人士不可证伪</p><h5 id="应用-4"><a href="#应用-4" class="headerlink" title="应用"></a>应用</h5><p>先问是不是个问题，再问是不是，最后再问为什么。</p><p>波普尔的可证伪性原则：科学的理论必须是可证伪的。</p><h4 id="格里斯剃刀"><a href="#格里斯剃刀" class="headerlink" title="格里斯剃刀"></a>格里斯剃刀</h4><h5 id="是什么-4"><a href="#是什么-4" class="headerlink" title="是什么"></a>是什么</h5><p>英文名Grice’s razor，起源于20世纪，原教旨是Conversational implications are to be preferred over semantic context for linguistic explanations；在语言解释中，会话含义优先于语义语境</p><h5 id="通俗解释-5"><a href="#通俗解释-5" class="headerlink" title="通俗解释"></a>通俗解释</h5><p>要理解说话人说的真实意思，而不是理解说话的字面意思</p><p><img src= "/img/loading.gif" data-lazy-src="data:image/jpeg;base64,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" alt="甄嬛传"></p><h5 id="有哪些影响-5"><a href="#有哪些影响-5" class="headerlink" title="有哪些影响"></a>有哪些影响</h5><p>每个人所想，所做，所说，潜意识都不一定一样</p><h5 id="应用-5"><a href="#应用-5" class="headerlink" title="应用"></a>应用</h5><p>听话要听背后的意思，有的是因为需要壁垒，有的是因为人之间的思考方式和语言输入方式不同，本质是数据存储在人脑的存储时、数据组织方式、输入时的差异导致的，当然，也有人善于利用这一点。</p><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="萨根标准"><a href="#萨根标准" class="headerlink" title="萨根标准"></a>萨根标准</h5><p>极端的论断要求需要极端的证据。</p><h5 id="波普尔的可证伪性原则"><a href="#波普尔的可证伪性原则" class="headerlink" title="波普尔的可证伪性原则"></a>波普尔的可证伪性原则</h5><p>科学的理论必须是可证伪的。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程思想 </tag>
            
            <tag> 编程哲学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三分钟入门分布式系统</title>
      <link href="metaverse/distributedbasics/"/>
      <url>metaverse/distributedbasics/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="什么是分布式系统"><a href="#什么是分布式系统" class="headerlink" title="什么是分布式系统"></a>什么是分布式系统</h2><p>为了完成共同的任务，通过某种通信方式(一般是网络)使用多个计算机节点。这个由多个计算节点组成的系统就是分布式系统。通俗来说就是使用更多机器来处理问题，其实我们的互联网就是一个分布式系统。</p><h2 id="为什么要使用分布式系统"><a href="#为什么要使用分布式系统" class="headerlink" title="为什么要使用分布式系统"></a>为什么要使用分布式系统</h2><p>单节点计算、存储能力弱，硬件提升性价比低，应用消耗资源过于高时；要实现高可用、高并发时；可以无限的横向扩展</p><h2 id="如何实现分布式"><a href="#如何实现分布式" class="headerlink" title="如何实现分布式"></a>如何实现分布式</h2><p>简单来说就是对任务分而治之(贯穿整个计算机上下的底层思想，而且来源于生活)，即是分片(partition),把不同分片交给不同节点处理即可，在未来保证可用性与并发性时，我们将分片冗余处理(一个分片交给多个节点处理)</p><h2 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h2><p>定理指的是一个经过逻辑证明的猜想；2000年布鲁尔提出此猜想2002年MIT的大佬给出证明</p><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>CAP定理指出一个分布式系统不能同时满足一下三点</p><ul><li>一致性(Consistency)所有节点访问同一份最新的数据副本</li><li>可用性(Availability)每次请求都能获取到非错的响应</li><li>分区容错性(Partition tolerance)一个分布式系统中出现故障导致分裂成多个计算节点（区）；这些区应能使系统正常运行，一般来说P应该一定要满足的，弱不满足那么就违背了分布式系统初衷</li></ul><h3 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h3><p>CAP只能三选二，那么我们就有三种策略，我们看一下有哪些情况会用到</p><p>CA：放弃P，会导致分布式节点无法进行扩展，传统的关系型数据库就是如此，一般P是必选项</p><p>CP：牺牲用户体验，常见分布式数据库以及银行系统就是</p><p>AP：牺牲一致性，淘宝、12306等就是</p><h2 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h2><p>为平衡CAP提出，包含</p><p>基本可用(Basically Available): 在出现故障时，允许部分可用性（基础可用）</p><p>软状态(Soft State):允许出现中间状态，不同节点之间数据不一致</p><p>最终一致性(Eventual Consistency):软状态不可持续，在有限期限后应能保证数据的最终一致</p><h2 id="一致性算法"><a href="#一致性算法" class="headerlink" title="一致性算法"></a>一致性算法</h2><p>后续文章会详细介绍这些算法</p><h3 id="强一致性算法"><a href="#强一致性算法" class="headerlink" title="强一致性算法"></a>强一致性算法</h3><p>Paxos：我最喜欢的图灵奖获得者Leslie Lamport于90年提出，几乎所有强一致性算法鼻祖，后续文章会详细介绍</p><p>Raft(Paxos变种)：etcd使用</p><p>ZAB(Paxos变种)：ZooKeeper使用</p><h3 id="最终一致性算法"><a href="#最终一致性算法" class="headerlink" title="最终一致性算法"></a>最终一致性算法</h3><p>DNS系统：域名解析，超过TTL逐步向上询问</p><p>Gossip算法：逆熵算法，Cassandra中使用</p><h2 id="不要做那些假设"><a href="#不要做那些假设" class="headerlink" title="不要做那些假设"></a>不要做那些假设</h2><p>还记得我们前几天发的极客法则吗，不要做以下假设，在实际生产上会遇到不同问题需要实际处理</p><ul><li>网络可靠</li><li>延迟为零</li><li>带宽无限</li><li>网络安全</li><li>拓扑恒定</li><li>单一管理员</li><li>运输成本为零</li><li>网络为同构的</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 分布式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go逃逸分析</title>
      <link href="metaverse/escapeanalysis/"/>
      <url>metaverse/escapeanalysis/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="go逃逸分析"><a href="#go逃逸分析" class="headerlink" title="go逃逸分析"></a>go逃逸分析</h2><h3 id="什么是逃逸"><a href="#什么是逃逸" class="headerlink" title="什么是逃逸"></a>什么是逃逸</h3><p>内存从栈逃逸到堆中，会增大GC的压力</p><h3 id="为什么要做逃逸分析"><a href="#为什么要做逃逸分析" class="headerlink" title="为什么要做逃逸分析"></a>为什么要做逃逸分析</h3><p>申请到栈内存性能好，不会引起GC，函数返回直接释放</p><p>申请到堆内存会导致gc，引起性能问题</p><p>如何分配：</p><ol><li>如果函数外部没有引用，则优先放到栈中；</li><li>如果函数外部存在引用，则必定放到堆中；</li></ol><p>常见的三种逃逸</p><h3 id="指针逃逸"><a href="#指针逃逸" class="headerlink" title="指针逃逸"></a>指针逃逸</h3><p>函数返回局部变量的指针导致指针逃逸</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointerEscapeFunc</span><span class="params">()</span> *<span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> v <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">return</span> &amp;v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    pointerEscapeFunc()<span class="comment">//v会被分配到堆上</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">host$</span><span class="bash"> go build -gcflags <span class="string">&#x27;-m -l&#x27;</span> tem.go <span class="comment">#-m打印信息，-l忽略inline信息</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> command-line-arguments</span></span><br><span class="line">./tem.go:3:6: moved to heap: v #可见v被分配到了堆上</span><br></pre></td></tr></table></figure><h3 id="栈空间不足"><a href="#栈空间不足" class="headerlink" title="栈空间不足"></a>栈空间不足</h3><p>go的goroutine初始栈大小为2KB，go可以增大栈大小，但不可超过系统栈限制(使用<code>ulimit -s</code>查看)，超过一定大小的变量将会逃逸到堆上，不同go版本大小限制不同</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stackSpaceExhausted</span><span class="params">()</span></span>&#123;</span><br><span class="line">    v := <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">0</span>,<span class="number">10000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    stackSpaceExhausted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">host$</span><span class="bash"> go build -gcflags <span class="string">&#x27;-m -l&#x27;</span> tem.go</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> command-line-arguments</span></span><br><span class="line">./tem.go:3:11: make([]int, 0, 10000) escapes to heap # 可见逃逸到了堆上，go1.15</span><br></pre></td></tr></table></figure><h3 id="闭包引用"><a href="#闭包引用" class="headerlink" title="闭包引用"></a>闭包引用</h3><p>函数类型也分两种，一种是函数字面量类型（未命名类型,func literal），另一种是函数命名类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">outer</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">        a++</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    inner := outer()</span><br><span class="line">    <span class="built_in">print</span>(inner())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">host$</span><span class="bash"> go build -gcflags <span class="string">&#x27;-m -l&#x27;</span> tem.go</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> command-line-arguments</span></span><br><span class="line">./tem.go:3:6: moved to heap: a</span><br><span class="line">./tem.go:4:9: func literal escapes to heap</span><br></pre></td></tr></table></figure><h3 id="动态类型"><a href="#动态类型" class="headerlink" title="动态类型"></a>动态类型</h3><p>对象大小不确定或作为不确定大小的参数时发生逃逸</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line">    fmt.Println(a)<span class="comment">//fmt.Println的入参是...interface&#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">host$</span><span class="bash"> go build -gcflags <span class="string">&#x27;-m -l&#x27;</span> tem.go</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> command-line-arguments</span></span><br><span class="line">./tem.go:7:13: main ... argument does not escape</span><br><span class="line">./tem.go:7:13: a escapes to heap</span><br></pre></td></tr></table></figure><h3 id="逃逸分析使用"><a href="#逃逸分析使用" class="headerlink" title="逃逸分析使用"></a>逃逸分析使用</h3><p>传值会拷贝对象，增加对象拷贝开销(听君一席话，胜似一席话)，只读切内存小的结构体使用可以提高性能</p><p>传指针会导致内存逃逸到堆中，增加垃圾回收(GC)负担,对象需要频繁创建删除时，GC开销会特别大，影响性能，但在需要修改对象值、内存占用大的结构体中，传指针性能更好</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux瓶颈分析</title>
      <link href="metaverse/linuxperformanceanalysis/"/>
      <url>metaverse/linuxperformanceanalysis/</url>
      
        <content type="html"><![CDATA[<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><p>性能优化一项最重要的步骤就是寻找到系统的瓶颈</p><h5 id="粗略分析"><a href="#粗略分析" class="headerlink" title="粗略分析"></a>粗略分析</h5><p>系统响应慢，一般的瓶颈在IO、CPU、内存还有应用。</p><p>使用top查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@172-20-59-60 apt_ui]# top</span><br><span class="line">top - 15:59:31 up 6 days,  1:10,  3 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">Tasks: 144 total,   1 running, 142 sleeping,   0 stopped,   1 zombie</span><br><span class="line"><span class="meta">%</span><span class="bash">Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class="line">KiB Mem :  8009636 total,  5126364 free,  2307032 used,   576240 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  5396772 avail Mem</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line"> 9307 root      20   0  620968  28320   6064 S   0.0  0.4   3:39.37 python3</span><br><span class="line">  861 root      20   0  567404  16752   5992 S   0.0  0.2   0:57.56 tuned</span><br><span class="line">  651 root      20   0   21684   1324    988 S   0.0  0.0   0:47.08 irqbalance</span><br><span class="line">  662 avahi     20   0   55952   2392   1920 S   0.0  0.0   0:35.02 avahi-daemon</span><br><span class="line">  809 root      20   0  113440  12796    308 S   0.0  0.2   0:24.29 dhclient</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li> 输入M，进程列表按内存使用大小降序排序，便于我们观察最大内存使用者使用有问题</li><li> 输入P，进程列表按CPU使用大小降序排序，便于我们观察最耗CPU资源</li><li> 100.0 id 空闲CPU时间百分比，如果这个值过低，表明系统CPU存在瓶颈</li><li> 0.0 wa 等待I/O的CPU时间百分比，如果这个值过高，表明IO存在瓶颈</li></ol><h5 id="内存瓶颈"><a href="#内存瓶颈" class="headerlink" title="内存瓶颈"></a>内存瓶颈</h5><p>一般使用free工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@172-20-59-60 apt_ui]# free</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:        8009636     2306408     5126984       25144      576244     5397396</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure><p>缺省时free的单位为KB</p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>total</td><td>总物理内存大小</td></tr><tr><td>used</td><td>已使用物理内存大小</td></tr><tr><td>free</td><td>未分配物理内存大小</td></tr><tr><td>shared</td><td>共享的物理内存大小</td></tr><tr><td>buff/cache</td><td>为了提高系统的读写速度（包含磁盘块的读写，文件的读写等），操作系统将部分内存作为缓存使用，该数值为缓存占用的物理内存大小</td></tr><tr><td>available</td><td>可用的物理内存大小</td></tr></tbody></table><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>total</td><td>Swap 分区的总大小</td></tr><tr><td>used</td><td>已使用的 Swap 分区大小</td></tr><tr><td>free</td><td>未使用的 Swap 分区大小</td></tr></tbody></table><p>根据上表，在不考虑 Swap 分区的情况下，内存计算如下：<br>总内存大小：Mem.total = Mem.used + Mem.free + Mem.shared + Mem.buff/cache<br>理论上实际可用内存大小：Mem.actual = Mem.total - Mem.used - Mem.shared = Mem.free + Mem.buff/cache</p><p>在考虑 Swap 分区的情况下，内存计算如下：<br>总内存大小：Mem.total = Mem.used + Mem.free + Mem.shared + Mem.buff/cache<br>理论上实际可用内存大小：Mem.actual = Mem.total - Mem.used - Mem.shared + Swap.free = Mem.free + Mem.buff/cache + Swap.free</p><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>PageCache.size</td><td>可以回收的 PageCache 大小，计算公式见上图</td></tr><tr><td>SlabCache.size</td><td>可以回收的 SlabCache 大小 ，计算公式见上图</td></tr><tr><td>WaterMark.low</td><td>支持系统使用的最低水位线，计算公式见上图</td></tr></tbody></table><p>Mem.available = Mem.free + PageCache.size + SlabCache.size - WaterMark.low</p><p>进一步的监视内存使用情况，可使用vmstat工具，可实时动态监视操作系统的内存和虚拟内存的动态变化使用情况</p><p>vmstat [delay] [count] </p><ul><li>  delay是两次输出之间的延迟时间；</li><li>  count是指按照这个时间间隔统计的次数。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@172-20-59-60 apt_ui]# vmstat 1 3</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 1  0      0 5126380   2068 574208    0    0     0    22    4    8  0  0 100  0  0</span><br><span class="line"> 0  0      0 5126488   2068 574208    0    0     0     0  422   53  0  0 100  0  0</span><br><span class="line"> 0  0      0 5126488   2068 574208    0    0     0     0  392   49  0  0 100  0  0</span><br></pre></td></tr></table></figure><p>Procs（进程）:</p><ul><li>  r: 运行队列中进程数量</li><li>  b: 等待IO的进程数量</li></ul><p>Memory（内存）:</p><ul><li>  swpd: 使用虚拟内存大小</li><li>  free: 可用内存大小</li><li>  buff: 用作缓冲的内存大小</li><li>  cache: 用作缓存的内存大小</li></ul><p>Swap:</p><ul><li>  si: 每秒从交换区写到内存的大小</li><li>  so: 每秒写入交换区的内存大小</li></ul><p>IO：（现在的Linux版本块的大小为1024bytes）</p><ul><li>  bi: 每秒读取的块数</li><li>  bo: 每秒写入的块数</li></ul><p>system：</p><ul><li>  in: 每秒中断数，包括时钟中断</li><li>  cs: 每秒上下文切换数</li></ul><p>CPU（以百分比表示）</p><ul><li>  us: 用户进程执行时间(user time)</li><li>  sy: 系统进程执行时间(system time)</li><li>  id: 空闲时间(包括IO等待时间)</li><li>  wa: 等待IO时间</li></ul><p>内存测试工具我们使用Stream，基准测试，注意数据仅在相同软件相同版本有比较价值</p><h5 id="IO瓶颈"><a href="#IO瓶颈" class="headerlink" title="IO瓶颈"></a>IO瓶颈</h5><p>如果IO存在性能瓶颈，top工具中的%wa会偏高</p><p>可使用iostat 进一步分析</p><p>iostat　[paras] [delay] [count] </p><ul><li>  -c显示CPU使用情况</li><li>  -d 显示磁盘使用情况</li><li>  -k 以 KB 为单位显示</li><li>  -m 以 M 为单位显示</li><li>  -N 显示磁盘阵列(LVM) 信息</li><li>  -p[磁盘] 显示磁盘和分区的情况</li><li>  -t 显示终端和CPU的信息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-59-60 apt_ui]# iostat 3 3</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (172-20-59-60)      12/31/2020      _x86_64_        (8 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.03    0.00    0.02    0.02    0.00   99.93</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">vda               0.08         0.59         0.88     308042     462261</span><br><span class="line">vdb               0.52         0.01       176.61       6256   92643328</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.04    0.00    0.00    0.00    0.00   99.96</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">vda               0.00         0.00         0.00          0          0</span><br><span class="line">vdb               0.00         0.00         0.00          0          0</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.00    0.00    0.00    0.00    0.00  100.00</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">vda               0.00         0.00         0.00          0          0</span><br><span class="line">vdb               0.00         0.00         0.00          0          0</span><br></pre></td></tr></table></figure><ul><li>  %user：CPU处在用户模式下的时间百分比。</li><li>  %nice：CPU处在带NICE值的用户模式下的时间百分比。</li><li>  %system：CPU处在系统模式下的时间百分比。</li><li>  %iowait：CPU等待输入输出完成时间的百分比。</li><li>  %steal：管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。</li><li>  %idle：CPU空闲时间百分比。</li><li>  rrqm/s: 每秒进行 merge 的读操作数目。即 rmerge/s</li><li>  wrqm/s: 每秒进行 merge 的写操作数目。即 wmerge/s</li><li>  r/s: 每秒完成的读 I/O 设备次数。即 rio/s</li><li>  w/s: 每秒完成的写 I/O 设备次数。即 wio/s</li><li>  rsec/s: 每秒读扇区数。即 rsect/s</li><li>  wsec/s: 每秒写扇区数。即 wsect/s</li><li>  rkB/s: 每秒读K字节数。是 rsect/s 的一半，因为每扇区大小为512字节。</li><li>  wkB/s: 每秒写K字节数。是 wsect/s 的一半。</li><li>  avgrq-sz: 平均每次设备I/O操作的数据大小 (扇区)。</li><li>  avgqu-sz: 平均I/O队列长度。</li><li>  await: 平均每次设备I/O操作的等待时间 (毫秒)。</li><li>  svctm: 平均每次设备I/O操作的服务时间 (毫秒)。</li><li>  %util: 一秒中有百分之多少的时间用于 I/O 操作，即被io消耗的cpu百分比</li></ul><p>磁盘测试工具我们一般使用iperf3，注意数据仅在相同软件相同版本有比较价值</p><h3 id="性能测试工具"><a href="#性能测试工具" class="headerlink" title="性能测试工具"></a>性能测试工具</h3><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139608R-C.d63f9367c74e1dca73ffbcae473118fa?rik=c734OLrGXr8BPg&riu=http://www.brendangregg.com/Perf/linux_observability_tools.png&ehk=nHWnEkal2z+T0vbSwBOdhejyU03bFpVvmJxFTX6A9tA=&risl=&pid=ImgRaw&r=0" alt="See the source image"></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>硬盘IO性能估算(IOPS,吞吐量，延时)</title>
      <link href="metaverse/diskperformanceestimation/"/>
      <url>metaverse/diskperformanceestimation/</url>
      
        <content type="html"><![CDATA[<h1 id="硬盘IO性能估算-IOPS-吞吐量，延时"><a href="#硬盘IO性能估算-IOPS-吞吐量，延时" class="headerlink" title="硬盘IO性能估算(IOPS,吞吐量，延时)"></a>硬盘IO性能估算(IOPS,吞吐量，延时)</h1><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p><strong>磁盘种类</strong></p><p>硬盘有<strong>固态硬盘</strong>(SSD 盘，新式硬盘)、<strong>机械硬盘</strong>(HDD 传统硬盘)、<strong>混合硬盘</strong>(HHD 一块基于传统机械硬盘诞生出来的新硬盘)。SSD采用闪存颗粒来储存，HDD采用磁性碟片来储存，混合硬盘(HHD: Hybrid Hard Disk)是把磁性硬盘和闪存集成到一起的一种硬盘。</p><p><strong>容量</strong></p><p>硬盘的容量以兆字节(MB/MiB)、千兆字节(GB/GiB)或百万兆字节(TB/TiB)为单位，而常见的换算式为：1TB=1024GB,1GB=1024MB而1MB=1024KB。但硬盘厂商通常运用的是GB，也就是1G=1000MB，而Win系统，就依旧以“GB”字样来表示“GiB”单位(1024换算的)，因此我们在BIOS中或在格式化硬盘时看到的容量会比厂家的标称值要小。</p><p><strong>转速</strong>（Rotational Speed 或Spindle speed）</p><p>RPM是Revolutions Per minute的缩写，是转/每分钟。RPM值越大，内部传输率就越快，访问时间就越短，硬盘的整体性能也就越好。</p><p><strong>寻道时间</strong> Tseek是指将读写磁头移动至正确的磁道上所需要的时间。寻道时间越短，I/O操作越快，目前磁盘的平均寻道时间一般在3－15ms。</p><p><strong>旋转延迟</strong> Trotation是指盘片旋转将请求数据所在扇区移至读写磁头下方所需要的时间。旋转延迟取决于磁盘转速，通常使用磁盘旋转一周所需时间的1/2表示。</p><p><strong>数据传输时间</strong> Ttransfer是指完成传输所请求的数据所需要的时间，它取决于数据传输率，其值等于数据大小除以数据传输率。目前IDE/ATA能达到133MB/s，SATA II可达到300MB/s的接口数据传输率，数据传输时间通常远小于前两部分消耗时间。简单计算时可忽略。</p><p><strong>IOPS</strong></p><p>每秒处理的IO次数</p><p><strong>RPM</strong></p><p>转速</p><h3 id="性能估算"><a href="#性能估算" class="headerlink" title="性能估算"></a>性能估算</h3><p><strong>寻道时间估算</strong></p><p>磁头移动到对应磁道上的耗时。</p><p> SATA 7200RPM，平均寻道时间是9ms。</p><p> SAS 10000RPM，平均寻道时间是6ms。 </p><p>SAS 15000RPM，平均寻道时间是4ms。</p><p>具体查看磁盘供应商提供数据。</p><p><strong>旋转延时估算</strong></p><p>平均为磁盘旋转一周所需时间的一半<br>$$<br>旋转延时=60*1000/RPM/2<br>$$<br><strong>传输时间</strong></p><p> 平均数据大小除以接口传输率，耗时很小粗略计算可以忽略。 SATA，300<del>600MB/s。 SAS，3Gbit/s。 FC，2</del>4Gbit/s。 NVME，32Gbit/s。</p><p><strong>吞吐量估算</strong><br>$$<br>I/O 吞吐量(一秒内)＝ IOPS* 平均 I/O SIZE<br>$$<br><strong>IOPS估算</strong><br>$$<br>IOPS = 1000 ms/ (寻道时间 + 旋转延迟)\<br>物理磁盘总的IOPS = 物理磁盘的IOPS × 磁盘数目\<br>可用的IOPS = （物理磁盘总的IOPS × 写百分比 ÷ RAID写惩罚） + （物理磁盘总的IOPS × 读百分比）<br>$$<br>其中</p><p><strong>RAID-0：</strong>直接的条带，数据每次写入对应物理磁盘上的一次写入，写惩罚值是1。</p><p><strong>RAID-1和10</strong>：RAID-1 和RAID-10的写惩罚很简单理解，因为数据的镜像存在的，所以一次写入会有两次，写惩罚值是2。</p><p><strong>RAID-5：</strong>RAID-5由于要计算校验位的机制存在，需要读数据、读校验位、写数据、写校验位四个步骤，所以RAID-5的写惩罚值是4。</p><p><strong>RAID-6：</strong>RAID-6由于有两个校验位的存在，与RAID-5相比，需要读取两次校验位和写入两次校验位，所以RAID-6的写惩罚值是6。</p><p><strong>iops估算raid盘数</strong></p><ol><li><p>如果单盘不能满足性能需求，需要通过Raid实现，计算所需硬盘数公式如下。 Raid1、10，Drive IOPS = Read IOPS + 2<em>Write IOPS Raid3、5，Drive IOPS = Read IOPS + 4</em>Write IOPS Raid6，Drive IOPS = Read IOPS + 6*Write IOPS；</p></li><li><p>设需要IOPS 5000，读写比例2:1，则RAID10后IOPS需求为。 RAID10，(2/3) * 5000 + 2 * (1/3) * 5000 = 6666 IOPS；</p></li><li><p>已知SAS 15000RPM机械硬盘IOPS165。 5000IOPS所需硬盘个数, 6666 / 165 = 40。</p></li></ol><p><strong>SSD硬盘IO估算</strong></p><p>固态硬盘没有寻道时间和旋转时间。IO耗时是通过地址查找数据耗时，根据芯片颗粒SLC、MLC，中控芯片、队列深度32~64、接口SATA、PCIE的不同，一般负载非太高时是相对固定值（控制在60%利用率）。 IOPS = 1000 / IO耗时。因为SSD比较固定，比如Intel 320 SSD对8K avgrq-sz耗时0.1ms，1000/0.1ms=10000 IOPS。具体参考后续文章。</p><p><strong>常见存储设备参考性能</strong></p><p>5400 RPM SATA，60 IOPS </p><p>7200 RPM SATA，70 IOPS </p><p>10000 RPM SAS，110 IOPS </p><p>15000 RPM SAS，150 IOPS，Sequential RW 180MB/s、Radom RW 15MB/s。 </p><p>10000 RPM FC，125 IOPS </p><p>15000 RPM FC，150 IOPS</p><p> SSD SATA，3000~40000 IOPS，R 400MB/s、W 250MB/s。 </p><p>SSD PCIE，20000~40000 IOPS，R 500MB/s、W 300MB/s。 </p><p>内存，1000000+ IOPS，30~60 GB/s。</p><h3 id="性能调优"><a href="#性能调优" class="headerlink" title="性能调优"></a>性能调优</h3><p>对于随机负载，当遇到余下情况时，我们那通常认为存在 I/O 性能问题：</p><ol><li><p>平均读时间大于 15ms</p></li><li><p>在具有写 cache 的条件下，平均写时间大于 2.5ms</p></li></ol><p>对于顺序负载，当遇到余下情况时，我们那通常认为存在 I/O 性能问题：</p><ol start="3"><li><p>在一个磁盘上有两个连续的 I/O 流</p></li><li><p>吞吐量不足（即远远小于磁盘 I/O 带宽）</p></li></ol><p>对于一块磁盘来讲，随着 IOPS 数量的增加，I/O service 也会增加，并且会有一个饱和点，即 IOPS 达到某个点以后，IOPS 再增加将会引起 I/O service time 的显著增加。</p><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p><strong>判断是ssd还是hdd</strong></p><ol><li>```shell<br>cat /sys/block/*/queue/rotational<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. &#96;&#96;&#96;shell</span><br><span class="line">   lsblk -d -o name,rota</span><br></pre></td></tr></table></figure></li></ol><p>0为ssd，1为hdd</p><p><strong>查看磁盘转速</strong></p><ol><li><pre><code>sginfo -g /dev/*</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shc与upx加密混淆压缩</title>
      <link href="metaverse/shcandupx/"/>
      <url>metaverse/shcandupx/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="shc混淆"><a href="#shc混淆" class="headerlink" title="shc混淆"></a>shc混淆</h2><h3 id="shc安装"><a href="#shc安装" class="headerlink" title="shc安装"></a>shc安装</h3><p>从官网下载<a href="http://www.datsi.fi.upm.es/~frosal/sources/">http://www.datsi.fi.upm.es/~frosal/sources/</a> (最新2015年的shc-3.8.9b.tgz)，或者源码下载<a href="https://github.com/neurobin/shc">https://github.com/neurobin/shc</a> (有最新的)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.datsi.fi.upm.es/~frosal/sources/shc-3.8.9b.tgz</span><br><span class="line">tar zxvf shc-3.8.9b.tgz</span><br><span class="line">cd shc-3.8.9b</span><br><span class="line">make clean</span><br><span class="line">make test # 等待paused 然后回车</span><br><span class="line">make strings&amp;install # 等待继续输入yes</span><br></pre></td></tr></table></figure><p>shc命令说明</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-e %s  Expiration date in dd/mm/yyyy format [none]</span><br><span class="line">-m %s  Message to display upon expiration [&quot;Please contact your provider&quot;]</span><br><span class="line">-f %s  File name of the script to compile</span><br><span class="line">-i %s  Inline option for the shell interpreter i.e: -e</span><br><span class="line">-x %s  eXec command, as a printf format i.e: exec(&#x27;%s&#x27;,@ARGV);</span><br><span class="line">-l %s  Last shell option i.e: --</span><br><span class="line">-r     Relax security. Make a redistributable binary</span><br><span class="line">-v     Verbose compilation</span><br><span class="line">-D     Switch ON debug exec calls [OFF]</span><br><span class="line">-T     Allow binary to be traceable [no]</span><br><span class="line">-C     Display license and exit</span><br><span class="line">-A     Display abstract and exit</span><br></pre></td></tr></table></figure><h3 id="使用shc给hello-world脚本加密"><a href="#使用shc给hello-world脚本加密" class="headerlink" title="使用shc给hello world脚本加密"></a>使用shc给hello world脚本加密</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们先创建一个sh</span></span><br><span class="line">[root@localhost ~]# echo &#x27;#!/bin/bash&#x27; &gt; hello.sh;echo &quot;echo hello world&quot; &gt;&gt; hello.sh</span><br><span class="line">[root@localhost ~]# chmod +x hello.sh;./hello.sh</span><br><span class="line">hello world</span><br><span class="line">[root@localhost ~]# shc -f hello.sh</span><br><span class="line">[root@localhost ~]# ./hello.sh.x</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>我们使用readelf查看发现是elf文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-65-67 ~]# readelf -h hello.sh.x </span><br><span class="line">ELF 头：</span><br><span class="line">  Magic：  7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 </span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2&#x27;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              EXEC (可执行文件)</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  入口点地址：              0x400d00</span><br><span class="line">  程序头起点：              64 (bytes into file)</span><br><span class="line">  Start of section headers:          9376 (bytes into file)</span><br><span class="line">  标志：             0x0</span><br><span class="line">  本头的大小：       64 (字节)</span><br><span class="line">  程序头大小：       56 (字节)</span><br><span class="line">  Number of program headers:         9</span><br><span class="line">  节头大小：         64 (字节)</span><br><span class="line">  节头数量：         28</span><br><span class="line">  字符串表索引节头： 27</span><br></pre></td></tr></table></figure><h3 id="shc简单的原理介绍"><a href="#shc简单的原理介绍" class="headerlink" title="shc简单的原理介绍"></a>shc简单的原理介绍</h3><p>我们在使用<code>shc -f hello.sh</code>时会发现还生成了一个hello.sh.x.c的文件，阅读c我们知道shc是将脚本用rc4进行加密，然后将加密后的脚本、密钥、解密程序再用c编译成elf文件，在执行elf时再将加密的脚本解密运行。  看了shc的混淆方式，我们也可以用其他编译行语言(例如go、rust、c++)等自己实现，更换加解密算法，甚至不用加解密算法。</p><h3 id="从shc-可执行文件获取源码-逆向"><a href="#从shc-可执行文件获取源码-逆向" class="headerlink" title="从shc 可执行文件获取源码(逆向)"></a>从shc 可执行文件获取源码(逆向)</h3><ol><li>使用IDA等反编译工具动态调试，找解密后的函数</li><li>使用coredump 从内存读取。</li><li>使用一些现有的工具，例如<a href="https://github.com/yanncam/UnSHc%EF%BC%8C%E6%96%B0%E7%9A%84shc%E5%8A%A0%E5%85%A5%E4%BA%86linux%E5%86%85%E6%A0%B8%E6%9C%AC%E8%BA%AB%E7%9A%84%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%A5%BD%E5%83%8F%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BA%86">https://github.com/yanncam/UnSHc，新的shc加入了linux内核本身的安全机制，好像不能用了</a></li></ol><h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><ol><li>使用gzexe混淆</li><li> shc -e 过期时间挺好用的</li></ol><h2 id="使用upx加壳"><a href="#使用upx加壳" class="headerlink" title="使用upx加壳"></a>使用upx加壳</h2><h3 id="upx安装"><a href="#upx安装" class="headerlink" title="upx安装"></a>upx安装</h3><p>从<a href="https://github.com/upx/upx">https://github.com/upx/upx</a> 下载源码安装或其他包管理器安装</p><h3 id="upx-演示"><a href="#upx-演示" class="headerlink" title="upx 演示"></a>upx 演示</h3><p>在我们刚刚使用shc对helloworld脚本编译生成elf后，我们可以使用upx对此elf进行加壳压缩，也算是一种混淆方式</p><p>upx压缩前 11k</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-65-67 ~]# ls -lh ./hello.sh.x</span><br><span class="line">-rwx--x--x. 1 root root 11K 7月  23 10:19 ./hello.sh.x</span><br></pre></td></tr></table></figure><p>upx 压缩后 6.9k, -9代表压缩等级（1-9,9个等级）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-65-67 ~]# upx -9 ./hello.sh.x;ls -lh ./hello.sh.x</span><br><span class="line">                       Ultimate Packer for eXecutables</span><br><span class="line">                          Copyright (C) 1996 - 2013</span><br><span class="line">UPX 3.91        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Sep 30th 2013</span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">     11168 -&gt;      7004   62.71%  linux/ElfAMD   hello.sh.x                    </span><br><span class="line"></span><br><span class="line">Packed 1 file.</span><br><span class="line">-rwx--x--x. 1 root root 6.9K 7月  23 10:19 ./hello.sh.x</span><br></pre></td></tr></table></figure><p>我们压缩后的helloworld依然正常运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-65-67 ~]# ./hello.sh.x </span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><h3 id="upx原理"><a href="#upx原理" class="headerlink" title="upx原理"></a>upx原理</h3><p>对elf文件进行压缩并插入解压代码，在运行时（加载到内存时）解压代码</p><h3 id="脱壳工具"><a href="#脱壳工具" class="headerlink" title="脱壳工具"></a>脱壳工具</h3><p>略</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zeroconf与mDNS</title>
      <link href="metaverse/zeroconf/"/>
      <url>metaverse/zeroconf/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>路由中有以下几种形式</p><p>单播：在网络地址和网络节点之间存在一一对应的关系。</p><p>任播：根据路由拓扑自动决定送到“最近”或“最好”的目的地</p><p>多播：是一种群组通信，它把信息同时传递给一组目的计算机。常指IP多播，组播地址224.0.0.0～224.0.0.255</p><p>广播:向指定网络范围内所以设备发送信息，主机标识段host ID 为全1 的IP 地址为广播地址，ARP、DHCP都使用了广播</p><p>地域性广播：一种“特殊”的多播</p><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>Domain Name System,域名服务，将域名和ip地址互相影射的分布式数据库，使用TCP和UDP的53端口</p><p>TCP：面向连接的协议，提供可靠的数据传输，一般服务质量要求比较高的情况，使用这个协议。</p><p>UDP：用户数据报协议，是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。</p><h2 id="zeroConf"><a href="#zeroConf" class="headerlink" title="zeroConf"></a>zeroConf</h2><p>Zero configuration networking,零配置网络服务规范是一种让用户武穴使用DHCP、DNS等设置就能自动连接设备的一种规范，主要包含以下协议</p><ul><li>Link-Local Address： 无需利用DHCP Server 取得设备地址和IP的相关资料 【RFC3927】</li><li>Multicast Dns： 不需要DNS Server 就可以解决domain 和ip的绑定关系 【RFC6762】</li><li>DNS-SD（dns-based service discovery）： 不需要目录服务器，就可以自动发现设备服务 【RFC6763】</li></ul><h2 id="mDNS"><a href="#mDNS" class="headerlink" title="mDNS"></a>mDNS</h2><h4 id="原理和特点"><a href="#原理和特点" class="headerlink" title="原理和特点"></a>原理和特点</h4><p>Multicast DNS (mDNS)，多播DNS，使用5353端口，组播地址为 <code>224.0.0.251</code> 或 <code>[FF02::FB]</code> 。在一个没有常规DNS服务器的小型网络内可以使用mDNS来实现类似DNS的编程接口、包格式和操作语义,mdns协议使用DNS协议一样的数据包</p><p>若主机开启了mDNS，在进入局域网内时会向224.0.0.251地址发送信息，信息内容包含，ip地址端口号，服务名等；</p><p>同时其mDNS服务会向其它mDNS询问获取局域网内的服务。</p><p>mDNS的顶级域名用 <code>.local</code> 和普通域名区分开的.</p><h2 id="DNS-SD"><a href="#DNS-SD" class="headerlink" title="DNS-SD"></a>DNS-SD</h2><p>DNS Service Discovery是一种基于 DNS 协议的服务发现协议，设备之间可以通过该协议自动发现服务</p><p>使用如下格式</p><p><code>&lt;instance&gt;.&lt;service&gt;.&lt;transport&gt;.&lt;domain&gt;</code></p><h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p>启动DNS-SD的主机在进入局域网后或启动DNS-SD后会向组播地址发送组播消息，包括主机名、IP信息等，其他拥有相应服务的主机会响应</p><p>关闭DNS-SD的主机在关闭DNS-SD后会向组播地址刷新组播消息，清除信息</p><h2 id="技术应用"><a href="#技术应用" class="headerlink" title="技术应用"></a>技术应用</h2><p>avahi、bonjour、WiSe-Zeroconf是zeroconf协议的常用实现</p><p>在苹果家族中常使用Bonjour、linux中常用avahi、在嵌入式领域常用WiSe-Zeroconf</p><h3 id="小玩具"><a href="#小玩具" class="headerlink" title="小玩具"></a>小玩具</h3><h4 id="安装-amp-下载-rocket"><a href="#安装-amp-下载-rocket" class="headerlink" title="安装&amp;下载:rocket:"></a>安装&amp;下载:rocket:</h4><p>使用golang的<code>zeroconf</code>包进行简单封装的玩具</p><p>server端：<a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-linux-amd64">amd64-linux</a> <a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-mac-amd64">amd64-mac</a> <a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-win-amd64.exe">amd64-win</a></p><p>client端：<a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-linux-amd64">amd64-linux</a> <a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-mac-amd64">amd64-mac</a> <a href="http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-win-amd64.exe">amd64-win</a></p><h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><h3 id="AVAHI"><a href="#AVAHI" class="headerlink" title="AVAHI"></a>AVAHI</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nss-mDNS avahi avahi-tools -y</span><br></pre></td></tr></table></figure><p>avahi-tools是avahi的工具包，包含avahi-browse、avahi-publish-address 、 avahi-resolve-host-nameavahi-browse-domains、avahi-publish-service、avahi-set-host-name、avahi-daemon、avahi-resolve、avahi-publish、avahi-resolve-address</p><p>常用的avahi-browse的功能如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-D --browse-domains  浏览域而不是服务</span><br><span class="line">-a --all             显示所有服务，忽略类型</span><br><span class="line">-d --domain=DOMAIN   要浏览的域</span><br><span class="line">-v --verbose         启用详述模式</span><br><span class="line">-t --terminate       导出一个完整列表后终止</span><br><span class="line">-c --cache           导出缓存中的所有条目后终止</span><br><span class="line">-l --ignore-local    忽略本地服务</span><br><span class="line">-r --resolve         解析找到的服务</span><br><span class="line">-f --no-fail         如果 daemon 不可用也不中断</span><br><span class="line">-p --parsable        输出可解析格式</span><br><span class="line">-k --no-db-lookup    不查询服务类型</span><br><span class="line">-b --dump-db         导出服务类型数据库</span><br></pre></td></tr></table></figure><h4 id="添加服务"><a href="#添加服务" class="headerlink" title="添加服务"></a>添加服务</h4><p>创建文件 /etc/avahi/services/wltHello.service</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; standalone&#x3D;&#39;no&#39;?&gt;</span><br><span class="line">&lt;!DOCTYPE service-group SYSTEM &quot;avahi-service.dtd&quot;&gt;</span><br><span class="line">&lt;service-group&gt;</span><br><span class="line">    &lt;name&gt;wlt@*Hello&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;service&gt;</span><br><span class="line">        &lt;type&gt;_wlt@*Hello._tcp&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;port&gt;5678&lt;&#x2F;port&gt;</span><br><span class="line">    &lt;&#x2F;service&gt;</span><br><span class="line">&lt;&#x2F;service-group&gt;</span><br></pre></td></tr></table></figure><h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dbus</span><br><span class="line">systemctl restart avahi-daemon</span><br></pre></td></tr></table></figure><h4 id="查询服务"><a href="#查询服务" class="headerlink" title="查询服务"></a>查询服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# avahi-browse -vrtp _wlt@*Hello._tcp</span><br><span class="line">+;eth0;IPv4;wlt\064\042Hello;_wlt\064\042Hello._tcp;local</span><br><span class="line">=;eth0;IPv4;wlt\064\042Hello;_wlt\064\042Hello._tcp;local;linux.local;172.20.65.36;5678;</span><br></pre></td></tr></table></figure><p>通过avahi-browse即可在局域网内通过avahi-browse发现服务</p><p>在实际生产中，我们可以在开启服务时同时添加mDNS服务，消费者机器通过avahi-browse查询服务得到开启服务的ip地址，再进一步与服务建立链接。除此之外avahi还暴露了一些api：<a href="https://www.avahi.org/doxygen/v0.7/html/index.html">https://www.avahi.org/doxygen/v0.7/html/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中间人攻击与HTTPS</title>
      <link href="metaverse/maninthemiddleattackandhttps/"/>
      <url>metaverse/maninthemiddleattackandhttps/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><p>HTTP(hypertext transfer protocol )协议是一种七层协议，是万维网通信的基石，通常使用tcp协议(HTTP3使用quic(udp))，默认端口80</p><h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><p>GET、HEAD：获取资源</p><p>POST：上传资源</p><p>PUT：修改资源</p><p>DELETE：删除资源</p><p>TRACE：回显请求</p><p>OPTIONS：回复资源所有可用方法</p><p>CONNECT：留给SSL加密使用</p><h3 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h3><p>在函数式编程中，幂等函数是对任何值x具有f（f（x））= f（x）属性的函数，在编程领域，则意为同一个系统，使用同样的条件，一次请求和重复的多次请求对系统资源的影响是一致的</p><p>GET、HEAD、PUT、DELETE、OPTIONS、TRACE都是幂等的，而GET、HEAD、OPTIONS、TRACE一般来说没有副作用。</p><h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><ul><li>1xx消息：请求已被服务器接收，继续处理</li><li>2xx成功：请求成功</li><li>3xx重定向：重定向</li><li>4xx请求错误：客户端错误</li><li>5xx服务器错误：服务器错误</li></ul><h3 id="HTTP-keeep-alive"><a href="#HTTP-keeep-alive" class="headerlink" title="HTTP keeep-alive"></a>HTTP keeep-alive</h3><p>HTTP1.1加入</p><p>优点：同时打开的TCP链接少了、降低延时</p><p>缺点：请求后保持链接，可能会影响性能</p><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS(hypertext transfer protocol secure)是使用HTTP通信，使用SSL/TLS加密数据包，默认端口443</p><h3 id="传输过程"><a href="#传输过程" class="headerlink" title="传输过程"></a>传输过程</h3><p>证书验证阶段：</p><ol><li>浏览器发起HTTPS请求</li><li>服务端返回HTTPS证书和SSL非对称加密公钥</li><li>浏览器，验证HTTPS证书合法性，合法就生成随机数</li></ol><p>传输阶段：</p><ol><li>浏览器通过SSL公钥加密随机数，传输到服务端</li><li>服务端通过SSL私钥解密，通过随机数构造对称加密(TLS)，通过TLS传输</li></ol><h4 id="如何验证证书合法性"><a href="#如何验证证书合法性" class="headerlink" title="如何验证证书合法性"></a>如何验证证书合法性</h4><p>证书包含：公钥、持有者信息、证书机构信息(CA)、数字签名和算法、有效期等</p><p>证书签发：</p><ol><li>CA把各种信息打包通过计算得到hash值</li><li>CA使用私钥对hash值加密生成证书签名</li><li>将证书签名加到文件证书上，形成数字证书</li></ol><p>证书校验：</p><ol><li>浏览器通过同样hash算法得到hash值</li><li>浏览器用公钥对CA数字签名解密与自己算的hash值比较，若相同就是可信的</li></ol><p>证书信任链：通过当前证书-中间证书-根证书逐级担保信任</p><h2 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h2><p>A与C进行通信时，需要经过B进行传输，B获取了A和C的通话信息，B分别伪装成A和C通信，伪装成C和A通信</p><h3 id="非对称加密场景"><a href="#非对称加密场景" class="headerlink" title="非对称加密场景"></a>非对称加密场景</h3><p>A发送公钥给C时，B作为中间人攻击，B也生成公私钥，B将自己的公钥发给C和C通信，B通过A发送的公钥和A通信</p><h3 id="HTTPS中的中间人攻击"><a href="#HTTPS中的中间人攻击" class="headerlink" title="HTTPS中的中间人攻击"></a>HTTPS中的中间人攻击</h3><p>在缺少证书验证环节时，可以进行HTTPS中间人攻击，具体流程如下</p><ol><li>A与C进行通信时，本地请求劫持，B成为中间人</li><li>B返回自己伪造的证书给A，B与C通信</li><li>A不会验证证书，直接创建随机数，与B进行通信</li><li>B与C按照正常流程进行通信</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>udp offload</title>
      <link href="metaverse/offload/"/>
      <url>metaverse/offload/</url>
      
        <content type="html"><![CDATA[<h2 id="tx-udp-tnl-segmentation"><a href="#tx-udp-tnl-segmentation" class="headerlink" title="tx-udp_tnl-segmentation"></a><strong>tx-udp_tnl-segmentation</strong></h2><p>Overlay网络，例如VxLAN，现在应用的越来越多。Overlay网络可以使得用户不受物理网络的限制，进而创建，配置并管理所需要的虚拟网络连接。同时Overlay可以让多个租户共用一个物理网络，提高网络的利用率。Overlay网络有很多种，但是最具有代表性的是VxLAN。VxLAN是一个MAC in UDP的设计，具体格式如下所示。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455587v2-f6d9dcd0ad97394b4c4585ee161245f0_1440w.jpg" alt="img"></p><p>从VxLAN的格式可以看出，以VxLAN为代表的Overlay网络在性能上存在两个问题。一个是Overhead的增加，VxLAN在原始的Ethernet Frame上再包了一层Ethernet+IP+UDP+VXLAN，这样每个Ethernet Frame比原来要多传输50个字节。所以可以预见的是，Overlay网络的效率必然要低于Underlay网络。另一个问题比传50个字节更为严重，那就是需要处理这额外的50个字节。这50个字节包括了4个Header，每个Header都涉及到拷贝，计算，都需要消耗CPU。而我们现在迫切的问题在于CPU可以用来处理每个网络数据包的时间更少了。</p><p>首先，VxLAN的这50个字节是没法避免的。其次，那就只能降低它的影响。这里仍然可以采用Jumbo Frames的思想，因为50个字节是固定的，那网络数据包越大，50字节带来的影响就相对越小。</p><p>先来看一下虚拟机的网络连接图。虚拟机通过QEMU连接到位于宿主机的TAP设备，之后再通过虚机交换机转到VTEP（VxLAN Tunnel EndPoint），封装VxLAN格式，发给宿主机网卡。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455592v2-a4653d5451d3cf9737399d07be171d6e_1440w.jpg" alt="img"></p><p>理想情况就是，一大段VxLAN数据直接传给网卡，由网卡去完成剩下的分片，分段，并对分成的小的网络包分别封装VxLAN，计算校验和等工作。这样VxLAN对虚机网络带来影响就可以降到最低。实际中，这是可能的，但是需要一系列的前提条件。</p><p>首先，虚拟机要把大的网络包发到宿主机。因为虚拟机里面也运行了一个操作系统，也有自己的TCP/IP协议栈，所以虚拟机完全有能力自己就把大的网络包分成多个小的网络包。从前面介绍的内容看，只有TSO才能真正将一个大的网络包发到网卡。GSO在发到网卡的时候，已经在进入驱动的前一刻将大的网络包分成了若干个小的网络数据包。所以这里要求：虚机的网卡支持TSO（Virtio默认支持），并且打开TSO（默认打开），同时虚机发出的是TCP数据。</p><p>之后，经过QEMU，虚拟交换机的转发，VTEP的封装，这个大的TCP数据被封装成了VxLAN格式。50个字节的VxLAN数据被加到了这个大的TCP数据上。接下来问题来了，这本来是个TCP数据，但是因为做了VxLAN的封装，现在看起来像是个UDP的数据。如果操作系统不做任何处理，按照前面的介绍，那就应该走GSO做IP Fragmentation，并在发送给网卡的前一刻分成多个小包。这样，如果网卡本来支持TSO现在就用不上了。并且更加严重的是，现在还没做TCP Segmentation。我们在上一篇花了很大的篇幅介绍其必要性的TCP Segmentation在这里也丢失了。</p><p>对于现代的网卡，除了TSO，GSO等offload选项外，还多了一个选项tx-udp_tnl-segmentation。如果这个选项打开，操作系统自己会识别封装成VxLAN的UDP数据是一个tunnel数据，并且操作系统会直接把这一大段VxLAN数据丢给网卡去处理。在网卡里面，网卡会针对内层的TCP数据，完成TCP Segmentation。之后再为每个TCP Segment加上VxLAN封装（50字节），如下图右所示。这样，VxLAN封装对于虚拟机网络来说，影响降到了最低。</p><p>从前面描述看，要达成上述的效果，需要宿主机网卡同时支持TSO和tx-udp_tnl-segmentation。如果这两者任意一个不支持或者都不支持。那么系统内核会调用GSO，将封装成VxLAN格式的大段TCP数据，在发给网卡驱动前完成TCP Segmentation，并且为每个TCP Segment加上VxLAN封装。如下图左所示。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455599v2-539c4c2923a10f9c331325ef604b1864_1440w.jpg" alt="img"></p><p>如果关闭虚拟机内的TSO，或者虚拟机内发送的是UDP数据。那么在虚拟机的TCP/IP协议栈会调用GSO，发给虚拟机网卡驱动的前一刻，完成了分段、分片。虚拟机最终发到QEMU的网络数据包就是多个小的网络数据包。这个时候，无论宿主机怎么配置，都需要处理多个小的网络包，并对他们做VxLAN封装。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635171342R-C.3fd39d32acf22e924676ae13410bc7f8?rik=CpqSRGJGylO/Bw&riu=http://wiki.networksecuritytoolkit.org/images/thumb/No_segmentation_offloading.png/964px-No_segmentation_offloading.png&ehk=pAE0DfOX5Ii0DGj2zezPKbufNwQEX0uE62lUjaW09OA=&risl=&pid=ImgRaw&r=0" alt="See the source image"></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux IO模式</title>
      <link href="metaverse/linuxio/"/>
      <url>metaverse/linuxio/</url>
      
        <content type="html"><![CDATA[<p>同步IO和异步IO，阻塞IO和非阻塞IO分别是什么，到底有什么区别？不同的人在不同的上下文下给出的答案是不同的。所以先限定一下本文的上下文。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本文讨论的背景是Linux环境下的network IO。</span><br></pre></td></tr></table></figure><h3 id="概念说明"><a href="#概念说明" class="headerlink" title="概念说明"></a>概念说明</h3><p>在进行解释之前，首先要说明几个概念：<br>- 用户空间和内核空间<br>- 进程切换<br>- 进程的阻塞<br>- 文件描述符<br>- 缓存 I/O</p><h4 id="用户空间与内核空间"><a href="#用户空间与内核空间" class="headerlink" title="用户空间与内核空间"></a>用户空间与内核空间</h4><p>现在操作系统都是采用虚拟存储器，那么对32位操作系统而言，它的寻址空间（虚拟存储空间）为4G（2的32次方）。操作系统的核心是内核，独立于普通的应用程序，可以访问受保护的内存空间，也有访问底层硬件设备的所有权限。为了保证用户进程不能直接操作内核（kernel），保证内核的安全，操心系统将虚拟空间划分为两部分，一部分为内核空间，一部分为用户空间。针对linux操作系统而言，将最高的1G字节（从虚拟地址0xC0000000到0xFFFFFFFF），供内核使用，称为内核空间，而将较低的3G字节（从虚拟地址0x00000000到0xBFFFFFFF），供各个进程使用，称为用户空间。</p><h4 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h4><p>为了控制进程的执行，内核必须有能力挂起正在CPU上运行的进程，并恢复以前挂起的某个进程的执行。这种行为被称为进程切换。因此可以说，任何进程都是在操作系统内核的支持下运行的，是与内核紧密相关的。</p><p>从一个进程的运行转到另一个进程上运行，这个过程中经过下面这些变化：<br>\1. 保存处理机上下文，包括程序计数器和其他寄存器。<br>\2. 更新PCB信息。<br>\3. 把进程的PCB移入相应的队列，如就绪、在某事件阻塞等队列。<br>\4. 选择另一个进程执行，并更新其PCB。<br>\5. 更新内存管理的数据结构。<br>\6. 恢复处理机上下文。</p><p>注：<strong>总而言之就是很耗资源</strong>，具体的可以参考这篇文章：<a href="http://guojing.me/linux-kernel-architecture/posts/process-switch/">进程切换</a></p><h4 id="进程的阻塞"><a href="#进程的阻塞" class="headerlink" title="进程的阻塞"></a>进程的阻塞</h4><p>正在执行的进程，由于期待的某些事件未发生，如请求系统资源失败、等待某种操作的完成、新数据尚未到达或无新工作做等，则由系统自动执行阻塞原语(Block)，使自己由运行状态变为阻塞状态。可见，进程的阻塞是进程自身的一种主动行为，也因此只有处于运行态的进程（获得CPU），才可能将其转为阻塞状态。<code>当进程进入阻塞状态，是不占用CPU资源的</code>。</p><h4 id="文件描述符fd"><a href="#文件描述符fd" class="headerlink" title="文件描述符fd"></a>文件描述符fd</h4><p>文件描述符（File descriptor）是计算机科学中的一个术语，是一个用于表述指向文件的引用的抽象化概念。</p><p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。</p><h4 id="缓存-I-O"><a href="#缓存-I-O" class="headerlink" title="缓存 I/O"></a>缓存 I/O</h4><p>缓存 I/O 又被称作标准 I/O，大多数文件系统的默认 I/O 操作都是缓存 I/O。在 Linux 的缓存 I/O 机制中，操作系统会将 I/O 的数据缓存在文件系统的页缓存（ page cache ）中，也就是说，数据会先被拷贝到操作系统内核的缓冲区中，然后才会从操作系统内核的缓冲区拷贝到应用程序的地址空间。</p><p><strong>缓存 I/O 的缺点：</strong><br>数据在传输过程中需要在应用程序地址空间和内核进行多次数据拷贝操作，这些数据拷贝操作所带来的 CPU 以及内存开销是非常大的。</p><h3 id="IO模式"><a href="#IO模式" class="headerlink" title="IO模式"></a>IO模式</h3><p>刚才说了，对于一次IO访问（以read举例），数据会先被拷贝到操作系统内核的缓冲区中，然后才会从操作系统内核的缓冲区拷贝到应用程序的地址空间。所以说，当一个read操作发生时，它会经历两个阶段：<br>\1. 等待数据准备 (Waiting for the data to be ready)<br>\2. 将数据从内核拷贝到进程中 (Copying the data from the kernel to the process)</p><p>正式因为这两个阶段，linux系统产生了下面五种网络模式的方案。<br>- 阻塞 I/O（blocking IO）<br>- 非阻塞 I/O（nonblocking IO）<br>- I/O 多路复用（ IO multiplexing）<br>- 信号驱动 I/O（ signal driven IO）<br>- 异步 I/O（asynchronous IO）</p><p>注：由于signal driven IO在实际中并不常用，所以我这只提及剩下的四种IO Model。</p><h4 id="阻塞-I-O（blocking-IO）"><a href="#阻塞-I-O（blocking-IO）" class="headerlink" title="阻塞 I/O（blocking IO）"></a>阻塞 I/O（blocking IO）</h4><p>在linux中，默认情况下所有的socket都是blocking，一个典型的读操作流程大概是这样：<br><img src= "/img/loading.gif" data-lazy-src="https://segmentfault.com/img/bVm1c3" alt="clipboard.png"></p><p>当用户进程调用了recvfrom这个系统调用，kernel就开始了IO的第一个阶段：准备数据（对于网络IO来说，很多时候数据在一开始还没有到达。比如，还没有收到一个完整的UDP包。这个时候kernel就要等待足够的数据到来）。这个过程需要等待，也就是说数据被拷贝到操作系统内核的缓冲区中是需要一个过程的。而在用户进程这边，整个进程会被阻塞（当然，是进程自己选择的阻塞）。当kernel一直等到数据准备好了，它就会将数据从kernel中拷贝到用户内存，然后kernel返回结果，用户进程才解除block的状态，重新运行起来。</p><blockquote><p>  所以，blocking IO的特点就是在IO执行的两个阶段都被block了。</p></blockquote><h4 id="非阻塞-I-O（nonblocking-IO）"><a href="#非阻塞-I-O（nonblocking-IO）" class="headerlink" title="非阻塞 I/O（nonblocking IO）"></a>非阻塞 I/O（nonblocking IO）</h4><p>linux下，可以通过设置socket使其变为non-blocking。当对一个non-blocking socket执行读操作时，流程是这个样子：<br><img src= "/img/loading.gif" data-lazy-src="https://segmentfault.com/img/bVm1c4" alt="clipboard.png"></p><p>当用户进程发出read操作时，如果kernel中的数据还没有准备好，那么它并不会block用户进程，而是立刻返回一个error。从用户进程角度讲 ，它发起一个read操作后，并不需要等待，而是马上就得到了一个结果。用户进程判断结果是一个error时，它就知道数据还没有准备好，于是它可以再次发送read操作。一旦kernel中的数据准备好了，并且又再次收到了用户进程的system call，那么它马上就将数据拷贝到了用户内存，然后返回。</p><blockquote><p>  所以，nonblocking IO的特点是用户进程需要<strong>不断的主动询问</strong>kernel数据好了没有。</p></blockquote><h4 id="I-O-多路复用（-IO-multiplexing）"><a href="#I-O-多路复用（-IO-multiplexing）" class="headerlink" title="I/O 多路复用（ IO multiplexing）"></a>I/O 多路复用（ IO multiplexing）</h4><p>IO multiplexing就是我们说的select，poll，epoll，有些地方也称这种IO方式为event driven IO。select/epoll的好处就在于单个process就可以同时处理多个网络连接的IO。它的基本原理就是select，poll，epoll这个function会不断的轮询所负责的所有socket，当某个socket有数据到达了，就通知用户进程。</p><p><img src= "/img/loading.gif" data-lazy-src="https://segmentfault.com/img/bVm1c5" alt="clipboard.png"></p><p><code>当用户进程调用了select，那么整个进程会被block</code>，而同时，kernel会“监视”所有select负责的socket，当任何一个socket中的数据准备好了，select就会返回。这个时候用户进程再调用read操作，将数据从kernel拷贝到用户进程。</p><blockquote><p>  所以，I/O 多路复用的特点是通过一种机制一个进程能同时等待多个文件描述符，而这些文件描述符（套接字描述符）其中的任意一个进入读就绪状态，select()函数就可以返回。</p></blockquote><p>这个图和blocking IO的图其实并没有太大的不同，事实上，还更差一些。因为这里需要使用两个system call (select 和 recvfrom)，而blocking IO只调用了一个system call (recvfrom)。但是，用select的优势在于它可以同时处理多个connection。</p><p>所以，如果处理的连接数不是很高的话，使用select/epoll的web server不一定比使用multi-threading + blocking IO的web server性能更好，可能延迟还更大。select/epoll的优势并不是对于单个连接能处理得更快，而是在于能处理更多的连接。）</p><p>在IO multiplexing Model中，实际中，对于每一个socket，一般都设置成为non-blocking，但是，如上图所示，整个用户的process其实是一直被block的。只不过process是被select这个函数block，而不是被socket IO给block。</p><h4 id="异步-I-O（asynchronous-IO）"><a href="#异步-I-O（asynchronous-IO）" class="headerlink" title="异步 I/O（asynchronous IO）"></a>异步 I/O（asynchronous IO）</h4><p>inux下的asynchronous IO其实用得很少。先看一下它的流程：<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139536bVm1c8" alt="clipboard.png"></p><p>用户进程发起read操作之后，立刻就可以开始去做其它的事。而另一方面，从kernel的角度，当它受到一个asynchronous read之后，首先它会立刻返回，所以不会对用户进程产生任何block。然后，kernel会等待数据准备完成，然后将数据拷贝到用户内存，当这一切都完成之后，kernel会给用户进程发送一个signal，告诉它read操作完成了。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><h5 id="blocking和non-blocking的区别"><a href="#blocking和non-blocking的区别" class="headerlink" title="blocking和non-blocking的区别"></a>blocking和non-blocking的区别</h5><p>调用blocking IO会一直block住对应的进程直到操作完成，而non-blocking IO在kernel还准备数据的情况下会立刻返回。</p><h5 id="synchronous-IO和asynchronous-IO的区别"><a href="#synchronous-IO和asynchronous-IO的区别" class="headerlink" title="synchronous IO和asynchronous IO的区别"></a>synchronous IO和asynchronous IO的区别</h5><p>在说明synchronous IO和asynchronous IO的区别之前，需要先给出两者的定义。POSIX的定义是这样子的：<br>- A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;<br>- An asynchronous I/O operation does not cause the requesting process to be blocked;</p><p>两者的区别就在于synchronous IO做”IO operation”的时候会将process阻塞。按照这个定义，之前所述的blocking IO，non-blocking IO，IO multiplexing都属于synchronous IO。</p><p>有人会说，non-blocking IO并没有被block啊。这里有个非常“狡猾”的地方，定义中所指的”IO operation”是指真实的IO操作，就是例子中的recvfrom这个system call。non-blocking IO在执行recvfrom这个system call的时候，如果kernel的数据没有准备好，这时候不会block进程。但是，当kernel中数据准备好的时候，recvfrom会将数据从kernel拷贝到用户内存中，这个时候进程是被block了，在这段时间内，进程是被block的。</p><p>而asynchronous IO则不一样，当进程发起IO 操作之后，就直接返回再也不理睬了，直到kernel发送一个信号，告诉进程说IO完成。在这整个过程中，进程完全没有被block。</p><p><strong>各个IO Model的比较如图所示：</strong><br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139539bVm1c9" alt="clipboard.png"></p><p>通过上面的图片，可以发现non-blocking IO和asynchronous IO的区别还是很明显的。在non-blocking IO中，虽然进程大部分时间都不会被block，但是它仍然要求进程去主动的check，并且当数据准备完成以后，也需要进程主动的再次调用recvfrom来将数据拷贝到用户内存。而asynchronous IO则完全不同。它就像是用户进程将整个IO操作交给了他人（kernel）完成，然后他人做完后发信号通知。在此期间，用户进程不需要去检查IO操作的状态，也不需要主动的去拷贝数据。</p><h3 id="I-O-多路复用之select、poll、epoll详解"><a href="#I-O-多路复用之select、poll、epoll详解" class="headerlink" title="I/O 多路复用之select、poll、epoll详解"></a>I/O 多路复用之select、poll、epoll详解</h3><p>select，poll，epoll都是IO多路复用的机制。I/O多路复用就是通过一种机制，一个进程可以监视多个描述符，一旦某个描述符就绪（一般是读就绪或者写就绪），能够通知程序进行相应的读写操作。但select，poll，epoll本质上都是同步I/O，因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，而异步I/O则无需自己负责进行读写，异步I/O的实现会负责把数据从内核拷贝到用户空间。（这里啰嗦下）</p><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int select (int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);</span><br></pre></td></tr></table></figure><p>select 函数监视的文件描述符分3类，分别是writefds、readfds、和exceptfds。调用后select函数会阻塞，直到有描述副就绪（有数据 可读、可写、或者有except），或者超时（timeout指定等待时间，如果立即返回设为null即可），函数返回。当select函数返回后，可以 通过遍历fdset，来找到就绪的描述符。</p><p>select目前几乎在所有的平台上支持，其良好跨平台支持也是它的一个优点。select的一 个缺点在于单个进程能够监视的文件描述符的数量存在最大限制，在Linux上一般为1024，可以通过修改宏定义甚至重新编译内核的方式提升这一限制，但 是这样也会造成效率的降低。</p><h4 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int poll (struct pollfd *fds, unsigned int nfds, int timeout);</span><br></pre></td></tr></table></figure><p>不同与select使用三个位图来表示三个fdset的方式，poll使用一个 pollfd的指针实现。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct pollfd &#123;</span><br><span class="line">    int fd; &#x2F;* file descriptor *&#x2F;</span><br><span class="line">    short events; &#x2F;* requested events to watch *&#x2F;</span><br><span class="line">    short revents; &#x2F;* returned events witnessed *&#x2F;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>pollfd结构包含了要监视的event和发生的event，不再使用select“参数-值”传递的方式。同时，pollfd并没有最大数量限制（但是数量过大后性能也是会下降）。 和select函数一样，poll返回后，需要轮询pollfd来获取就绪的描述符。</p><blockquote><p>  从上面看，select和poll都需要在返回后，<code>通过遍历文件描述符来获取已经就绪的socket</code>。事实上，同时连接的大量客户端在一时刻可能只有很少的处于就绪状态，因此随着监视的描述符数量的增长，其效率也会线性下降。</p></blockquote><h4 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h4><p>epoll是在2.6内核中提出的，是之前的select和poll的增强版本。相对于select和poll来说，epoll更加灵活，没有描述符限制。epoll使用一个文件描述符管理多个描述符，将用户关系的文件描述符的事件存放到内核的一个事件表中，这样在用户空间和内核空间的copy只需一次。</p><h5 id="epoll操作过程"><a href="#epoll操作过程" class="headerlink" title="epoll操作过程"></a>epoll操作过程</h5><p>epoll操作过程需要三个接口，分别如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int epoll_create(int size)；&#x2F;&#x2F;创建一个epoll的句柄，size用来告诉内核这个监听的数目一共有多大</span><br><span class="line">int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)；</span><br><span class="line">int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);</span><br></pre></td></tr></table></figure><p><strong>1. int epoll_create(int size);</strong><br>创建一个epoll的句柄，size用来告诉内核这个监听的数目一共有多大，这个参数不同于select()中的第一个参数，给出最大监听的fd+1的值，<code>参数size并不是限制了epoll所能监听的描述符最大个数，只是对内核初始分配内部数据结构的一个建议</code>。<br>当创建好epoll句柄后，它就会占用一个fd值，在linux下如果查看/proc/进程id/fd/，是能够看到这个fd的，所以在使用完epoll后，必须调用close()关闭，否则可能导致fd被耗尽。</p><p><strong>2. int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)；</strong><br>函数是对指定描述符fd执行op操作。<br>- epfd：是epoll_create()的返回值。<br>- op：表示op操作，用三个宏来表示：添加EPOLL_CTL_ADD，删除EPOLL_CTL_DEL，修改EPOLL_CTL_MOD。分别添加、删除和修改对fd的监听事件。<br>- fd：是需要监听的fd（文件描述符）<br>- epoll_event：是告诉内核需要监听什么事，struct epoll_event结构如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct epoll_event &#123;</span><br><span class="line">  __uint32_t events;  &#x2F;* Epoll events *&#x2F;</span><br><span class="line">  epoll_data_t data;  &#x2F;* User data variable *&#x2F;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;events可以是以下几个宏的集合：</span><br><span class="line">EPOLLIN ：表示对应的文件描述符可以读（包括对端SOCKET正常关闭）；</span><br><span class="line">EPOLLOUT：表示对应的文件描述符可以写；</span><br><span class="line">EPOLLPRI：表示对应的文件描述符有紧急的数据可读（这里应该表示有带外数据到来）；</span><br><span class="line">EPOLLERR：表示对应的文件描述符发生错误；</span><br><span class="line">EPOLLHUP：表示对应的文件描述符被挂断；</span><br><span class="line">EPOLLET： 将EPOLL设为边缘触发(Edge Triggered)模式，这是相对于水平触发(Level Triggered)来说的。</span><br><span class="line">EPOLLONESHOT：只监听一次事件，当监听完这次事件之后，如果还需要继续监听这个socket的话，需要再次把这个socket加入到EPOLL队列里</span><br></pre></td></tr></table></figure><p><strong>3. int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);</strong><br>等待epfd上的io事件，最多返回maxevents个事件。<br>参数events用来从内核得到事件的集合，maxevents告之内核这个events有多大，这个maxevents的值不能大于创建epoll_create()时的size，参数timeout是超时时间（毫秒，0会立即返回，-1将不确定，也有说法说是永久阻塞）。该函数返回需要处理的事件数目，如返回0表示已超时。</p><h5 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h5><p>　epoll对文件描述符的操作有两种模式：<strong>LT（level trigger）</strong>和<strong>ET（edge trigger）</strong>。LT模式是默认模式，LT模式与ET模式的区别如下：<br>　　<strong>LT模式</strong>：当epoll_wait检测到描述符事件发生并将此事件通知应用程序，<code>应用程序可以不立即处理该事件</code>。下次调用epoll_wait时，会再次响应应用程序并通知此事件。<br>　　<strong>ET模式</strong>：当epoll_wait检测到描述符事件发生并将此事件通知应用程序，<code>应用程序必须立即处理该事件</code>。如果不处理，下次调用epoll_wait时，不会再次响应应用程序并通知此事件。</p><h6 id="LT模式"><a href="#LT模式" class="headerlink" title="LT模式"></a>LT模式</h6><p>LT(level triggered)是缺省的工作方式，并且同时支持block和no-block socket.在这种做法中，内核告诉你一个文件描述符是否就绪了，然后你可以对这个就绪的fd进行IO操作。如果你不作任何操作，内核还是会继续通知你的。</p><h6 id="ET模式"><a href="#ET模式" class="headerlink" title="ET模式"></a>ET模式</h6><p>ET(edge-triggered)是高速工作方式，只支持no-block socket。在这种模式下，当描述符从未就绪变为就绪时，内核通过epoll告诉你。然后它会假设你知道文件描述符已经就绪，并且不会再为那个文件描述符发送更多的就绪通知，直到你做了某些操作导致那个文件描述符不再为就绪状态了(比如，你在发送，接收或者接收请求，或者发送接收的数据少于一定量时导致了一个EWOULDBLOCK 错误）。但是请注意，如果一直不对这个fd作IO操作(从而导致它再次变成未就绪)，内核不会发送更多的通知(only once)</p><p>ET模式在很大程度上减少了epoll事件被重复触发的次数，因此效率要比LT模式高。epoll工作在ET模式的时候，必须使用非阻塞套接口，以避免由于一个文件句柄的阻塞读/阻塞写操作把处理多个文件描述符的任务饿死。</p><h6 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h6><p><strong>假如有这样一个例子：</strong><br>\1. 我们已经把一个用来从管道中读取数据的文件句柄(RFD)添加到epoll描述符<br>\2. 这个时候从管道的另一端被写入了2KB的数据<br>\3. 调用epoll_wait(2)，并且它会返回RFD，说明它已经准备好读取操作<br>\4. 然后我们读取了1KB的数据<br>\5. 调用epoll_wait(2)……</p><p><strong>LT模式：</strong><br>如果是LT模式，那么在第5步调用epoll_wait(2)之后，仍然能受到通知。</p><p><strong>ET模式：</strong><br>如果我们在第1步将RFD添加到epoll描述符的时候使用了EPOLLET标志，那么在第5步调用epoll_wait(2)之后将有可能会挂起，因为剩余的数据还存在于文件的输入缓冲区内，而且数据发出端还在等待一个针对已经发出数据的反馈信息。只有在监视的文件句柄上发生了某个事件的时候 ET 工作模式才会汇报事件。因此在第5步的时候，调用者可能会放弃等待仍在存在于文件输入缓冲区内的剩余数据。</p><p>当使用epoll的ET模型来工作时，当产生了一个EPOLLIN事件后，<br>读数据的时候需要考虑的是当recv()返回的大小如果等于请求的大小，那么很有可能是缓冲区还有数据未读完，也意味着该次事件还没有处理完，所以还需要再次读取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">while(rs)&#123;</span><br><span class="line">  buflen &#x3D; recv(activeevents[i].data.fd, buf, sizeof(buf), 0);</span><br><span class="line">  if(buflen &lt; 0)&#123;</span><br><span class="line">    &#x2F;&#x2F; 由于是非阻塞的模式,所以当errno为EAGAIN时,表示当前缓冲区已无数据可读</span><br><span class="line">    &#x2F;&#x2F; 在这里就当作是该次事件已处理处.</span><br><span class="line">    if(errno &#x3D;&#x3D; EAGAIN)&#123;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else if(buflen &#x3D;&#x3D; 0)&#123;</span><br><span class="line">     &#x2F;&#x2F; 这里表示对端的socket已正常关闭.</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> if(buflen &#x3D;&#x3D; sizeof(buf)&#123;</span><br><span class="line">      rs &#x3D; 1;   &#x2F;&#x2F; 需要再次读取</span><br><span class="line"> &#125;</span><br><span class="line"> else&#123;</span><br><span class="line">      rs &#x3D; 0;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  <strong>Linux中的EAGAIN含义</strong></p></blockquote><p>Linux环境下开发经常会碰到很多错误(设置errno)，其中EAGAIN是其中比较常见的一个错误(比如用在非阻塞操作中)。<br>从字面上来看，是提示再试一次。这个错误经常出现在当应用程序进行一些非阻塞(non-blocking)操作(对文件或socket)的时候。</p><p>例如，以 O_NONBLOCK的标志打开文件/socket/FIFO，如果你连续做read操作而没有数据可读。此时程序不会阻塞起来等待数据准备就绪返回，read函数会返回一个错误EAGAIN，提示你的应用程序现在没有数据可读请稍后再试。<br>又例如，当一个系统调用(比如fork)因为没有足够的资源(比如虚拟内存)而执行失败，返回EAGAIN提示其再调用一次(也许下次就能成功)。</p><h5 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h5><p>下面是一段不完整的代码且格式不对，意在表述上面的过程，去掉了一些模板代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">#define IPADDRESS   &quot;127.0.0.1&quot;</span><br><span class="line">#define PORT        8787</span><br><span class="line">#define MAXSIZE     1024</span><br><span class="line">#define LISTENQ     5</span><br><span class="line">#define FDSIZE      1000</span><br><span class="line">#define EPOLLEVENTS 100</span><br><span class="line"></span><br><span class="line">listenfd &#x3D; socket_bind(IPADDRESS,PORT);</span><br><span class="line"></span><br><span class="line">struct epoll_event events[EPOLLEVENTS];</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;创建一个描述符</span><br><span class="line">epollfd &#x3D; epoll_create(FDSIZE);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;添加监听描述符事件</span><br><span class="line">add_event(epollfd,listenfd,EPOLLIN);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;循环等待</span><br><span class="line">for ( ; ; )&#123;</span><br><span class="line">    &#x2F;&#x2F;该函数返回已经准备好的描述符事件数目</span><br><span class="line">    ret &#x3D; epoll_wait(epollfd,events,EPOLLEVENTS,-1);</span><br><span class="line">    &#x2F;&#x2F;处理接收到的连接</span><br><span class="line">    handle_events(epollfd,events,ret,listenfd,buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;事件处理函数</span><br><span class="line">static void handle_events(int epollfd,struct epoll_event *events,int num,int listenfd,char *buf)</span><br><span class="line">&#123;</span><br><span class="line">     int i;</span><br><span class="line">     int fd;</span><br><span class="line">     &#x2F;&#x2F;进行遍历;这里只要遍历已经准备好的io事件。num并不是当初epoll_create时的FDSIZE。</span><br><span class="line">     for (i &#x3D; 0;i &lt; num;i++)</span><br><span class="line">     &#123;</span><br><span class="line">         fd &#x3D; events[i].data.fd;</span><br><span class="line">        &#x2F;&#x2F;根据描述符的类型和事件类型进行处理</span><br><span class="line">         if ((fd &#x3D;&#x3D; listenfd) &amp;&amp;(events[i].events &amp; EPOLLIN))</span><br><span class="line">            handle_accpet(epollfd,listenfd);</span><br><span class="line">         else if (events[i].events &amp; EPOLLIN)</span><br><span class="line">            do_read(epollfd,fd,buf);</span><br><span class="line">         else if (events[i].events &amp; EPOLLOUT)</span><br><span class="line">            do_write(epollfd,fd,buf);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;添加事件</span><br><span class="line">static void add_event(int epollfd,int fd,int state)&#123;</span><br><span class="line">    struct epoll_event ev;</span><br><span class="line">    ev.events &#x3D; state;</span><br><span class="line">    ev.data.fd &#x3D; fd;</span><br><span class="line">    epoll_ctl(epollfd,EPOLL_CTL_ADD,fd,&amp;ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;处理接收到的连接</span><br><span class="line">static void handle_accpet(int epollfd,int listenfd)&#123;</span><br><span class="line">     int clifd;     </span><br><span class="line">     struct sockaddr_in cliaddr;     </span><br><span class="line">     socklen_t  cliaddrlen;     </span><br><span class="line">     clifd &#x3D; accept(listenfd,(struct sockaddr*)&amp;cliaddr,&amp;cliaddrlen);     </span><br><span class="line">     if (clifd &#x3D;&#x3D; -1)         </span><br><span class="line">     perror(&quot;accpet error:&quot;);     </span><br><span class="line">     else &#123;         </span><br><span class="line">         printf(&quot;accept a new client: %s:%d\n&quot;,inet_ntoa(cliaddr.sin_addr),cliaddr.sin_port);                       &#x2F;&#x2F;添加一个客户描述符和事件         </span><br><span class="line">         add_event(epollfd,clifd,EPOLLIN);     </span><br><span class="line">     &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;读处理</span><br><span class="line">static void do_read(int epollfd,int fd,char *buf)&#123;</span><br><span class="line">    int nread;</span><br><span class="line">    nread &#x3D; read(fd,buf,MAXSIZE);</span><br><span class="line">    if (nread &#x3D;&#x3D; -1)     &#123;         </span><br><span class="line">        perror(&quot;read error:&quot;);         </span><br><span class="line">        close(fd); &#x2F;&#x2F;记住close fd        </span><br><span class="line">        delete_event(epollfd,fd,EPOLLIN); &#x2F;&#x2F;删除监听 </span><br><span class="line">    &#125;</span><br><span class="line">    else if (nread &#x3D;&#x3D; 0)     &#123;         </span><br><span class="line">        fprintf(stderr,&quot;client close.\n&quot;);</span><br><span class="line">        close(fd); &#x2F;&#x2F;记住close fd       </span><br><span class="line">        delete_event(epollfd,fd,EPOLLIN); &#x2F;&#x2F;删除监听 </span><br><span class="line">    &#125;     </span><br><span class="line">    else &#123;         </span><br><span class="line">        printf(&quot;read message is : %s&quot;,buf);        </span><br><span class="line">        &#x2F;&#x2F;修改描述符对应的事件，由读改为写         </span><br><span class="line">        modify_event(epollfd,fd,EPOLLOUT);     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;写处理</span><br><span class="line">static void do_write(int epollfd,int fd,char *buf) &#123;     </span><br><span class="line">    int nwrite;     </span><br><span class="line">    nwrite &#x3D; write(fd,buf,strlen(buf));     </span><br><span class="line">    if (nwrite &#x3D;&#x3D; -1)&#123;         </span><br><span class="line">        perror(&quot;write error:&quot;);        </span><br><span class="line">        close(fd);   &#x2F;&#x2F;记住close fd       </span><br><span class="line">        delete_event(epollfd,fd,EPOLLOUT);  &#x2F;&#x2F;删除监听    </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        modify_event(epollfd,fd,EPOLLIN); </span><br><span class="line">    &#125;    </span><br><span class="line">    memset(buf,0,MAXSIZE); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;删除事件</span><br><span class="line">static void delete_event(int epollfd,int fd,int state) &#123;</span><br><span class="line">    struct epoll_event ev;</span><br><span class="line">    ev.events &#x3D; state;</span><br><span class="line">    ev.data.fd &#x3D; fd;</span><br><span class="line">    epoll_ctl(epollfd,EPOLL_CTL_DEL,fd,&amp;ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;修改事件</span><br><span class="line">static void modify_event(int epollfd,int fd,int state)&#123;     </span><br><span class="line">    struct epoll_event ev;</span><br><span class="line">    ev.events &#x3D; state;</span><br><span class="line">    ev.data.fd &#x3D; fd;</span><br><span class="line">    epoll_ctl(epollfd,EPOLL_CTL_MOD,fd,&amp;ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;注：另外一端我就省了</span><br></pre></td></tr></table></figure><h5 id="epoll总结"><a href="#epoll总结" class="headerlink" title="epoll总结"></a>epoll总结</h5><p>在 select/poll中，进程只有在调用一定的方法后，内核才对所有监视的文件描述符进行扫描，而<strong>epoll事先通过epoll_ctl()来注册一 个文件描述符，一旦基于某个文件描述符就绪时，内核会采用类似callback的回调机制，迅速激活这个文件描述符，当进程调用epoll_wait() 时便得到通知</strong>。(<code>此处去掉了遍历文件描述符，而是通过监听回调的的机制</code>。这正是epoll的魅力所在。)</p><p><strong>epoll的优点主要是一下几个方面：</strong><br>\1. 监视的描述符数量不受限制，它所支持的FD上限是最大可以打开文件的数目，这个数字一般远大于2048,举个例子,在1GB内存的机器上大约是10万左 右，具体数目可以cat /proc/sys/fs/file-max察看,一般来说这个数目和系统内存关系很大。select的最大缺点就是进程打开的fd是有数量限制的。这对 于连接数量比较大的服务器来说根本不能满足。虽然也可以选择多进程的解决方案( Apache就是这样实现的)，不过虽然linux上面创建进程的代价比较小，但仍旧是不可忽视的，加上进程间数据同步远比不上线程间同步的高效，所以也不是一种完美的方案。</p><ol><li> IO的效率不会随着监视fd的数量的增长而下降。epoll不同于select和poll轮询的方式，而是通过每个fd定义的回调函数来实现的。只有就绪的fd才会执行回调函数。</li></ol><blockquote><p>  如果没有大量的idle -connection或者dead-connection，epoll的效率并不会比select/poll高很多，但是当遇到大量的idle- connection，就会发现epoll的效率大大高于select/poll。</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139551R-C.33d57d1aac13ec6a4e7f917e0a47bb69?rik=o/uWsKRpOPc7MA&riu=http://www.thomas-krenn.com/de/wikiDE/images/d/da/Linux-io-stack-diagram_v1.0.png&ehk=1OGRYIpfyG0jiVPRMEKwfpXnNXxZpCQUOMRDg4u7Pz0=&risl=&pid=ImgRaw&r=0" alt="See the source image"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/Anker/p/3269106.html">用户空间与内核空间，进程上下文与中断上下文总结]</a><br><a href="http://guojing.me/linux-kernel-architecture/posts/process-switch/">进程切换</a><br><a href="https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6">维基百科-文件描述符</a><br><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-directio/">Linux 中直接 I/O 机制的介绍</a><br><a href="http://blog.csdn.net/historyasamirror/article/details/5778378">IO - 同步，异步，阻塞，非阻塞 （亡羊补牢篇）</a><br><a href="http://www.cnblogs.com/bigwangdi/p/3182958.html">Linux中select poll和epoll的区别</a><br><a href="http://www.cnblogs.com/Anker/archive/2013/08/14/3258674.html">IO多路复用之select总结</a><br><a href="http://www.cnblogs.com/Anker/archive/2013/08/15/3261006.html">IO多路复用之poll总结</a><br><a href="http://www.cnblogs.com/Anker/archive/2013/08/17/3263780.html">IO多路复用之epoll总结</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码整洁之道</title>
      <link href="metaverse/cleancode/"/>
      <url>metaverse/cleancode/</url>
      
        <content type="html"><![CDATA[<h2 id="必要性"><a href="#必要性" class="headerlink" title="必要性"></a>必要性</h2><ol><li> 要有代码，大胆写，<em>Imperfect</em> code is <em>Better Than</em> Perfect </li><li> 现在就做，later equals never，Now is better than never</li><li> 从开始就不要为了一时便利去破坏代码整洁</li><li> 坚持同一规范</li><li> 隔离与性能的权衡</li></ol><h2 id="什么是代码整洁"><a href="#什么是代码整洁" class="headerlink" title="什么是代码整洁"></a>什么是代码整洁</h2><p>应当有单元测试以及验收测试，使用有意义的命名，只提供一种做某一件事的途径（而非多种），尽量少的依赖关系，清晰并且尽量少的API</p><ol><li> 能通过所有测试</li><li> 没有重复代码</li><li> 体现系统全部设计理念</li><li> 包括尽量少的实体，例如，类、方法、函数等</li><li> 让读的过程轻松，即便会让写的过程更难</li><li> 让营地比你来的时候 更干净</li></ol><h3 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h3><ol><li> 名副其实</li><li> 避免歧义，O I等，避免废话</li><li> 使用可搜索的名称</li><li> 类名不应当是动词</li><li> 方法名应当是动词或动词短语</li><li> 宁可明确，毋为好玩（生活和思想需要务虚，但code要务实）</li><li> 避免双关语，一词一意</li><li> 每个概念一个单词，一意一词</li><li> 使用算法名、计算机术语、模式名、数学术语命名</li><li> 使用所在领域命名</li><li> 函数就该小</li><li> 函数式编程，尽量少用副作用编程</li><li> 做好隔离（抽象、封装、逻辑与业务隔离，实现与使用隔离）</li><li> 函数应该做好一件事，只做一件事</li><li> 函数参数越少越好，最好没有</li><li> 抽离try catch代码块</li><li> 相关联的函数应该放在一起，调用者尽可能放在被调用者上面</li><li>tdd 规则<ol><li> 在能产生不能通过的单元测试之前，不可编写生成代码</li><li> 只允许编写刚好无法通过的代码</li><li> 只可编写刚好足以通过当前失败测试的生成代码</li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程思想 </tag>
            
            <tag> 编程哲学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>trex测试流程</title>
      <link href="metaverse/trex/"/>
      <url>metaverse/trex/</url>
      
        <content type="html"><![CDATA[<h2 id="Trex简单测试"><a href="#Trex简单测试" class="headerlink" title="Trex简单测试"></a>Trex简单测试</h2><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li><p>trex主机与dut主机第一个network为管理网，第二个与第三个network为测试用网，trex主机与dut主机测试用网eth1互联，trex主机与dut主机测试用网eth2互联;</p></li><li><p>只可运行net_set.sh 一次，获得mac地址，若mac地址全为0，重启trex主机;</p></li><li><p>测试项可在run_trex.sh修改（-m 参数为几万pps  -d参数为测试时间）。</p></li></ol><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol><li>打开trex主机 运行trex_set.sh 并得到两个mac地址fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li><li>打开dut主机运行 dut_set.sh fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li><li>打开trex主机运行run_trex.sh ，等待运行结束得到trex结果。</li></ol><h3 id="镜像地址"><a href="#镜像地址" class="headerlink" title="镜像地址"></a>镜像地址</h3><p>dut：<a href="http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2</a></p><p>trex：<a href="http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2</a></p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>dut_set.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ip link set dev eth1 up</span><br><span class="line">ip link set dev eth2 up</span><br><span class="line">ip a add 192.168.155.3/24 dev eth1</span><br><span class="line">ip a add 192.168.166.5/24 dev eth2</span><br><span class="line">ip r add 16.0.0.0/8 via 192.168.155.2</span><br><span class="line">ip r add 48.0.0.0/8 via 192.168.166.4</span><br><span class="line">ip n add 192.168.155.2 dev eth1 lladdr $0</span><br><span class="line">ip n add 192.168.166.4 dev eth2 lladdr $1</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><p>net_set.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">a=(`ip a | grep ^[1-9] | awk -F: &#x27;&#123;print $2&#125;&#x27; | sed &#x27;1,2d&#x27;`)</span><br><span class="line">for ((i=0;i&lt;2;i++))</span><br><span class="line">  do</span><br><span class="line">    b[$i]=`ethtool -i $&#123;a[$i]&#125; |grep bus | awk -F &#x27;:&#x27; &#x27;&#123;print $3 $4 $5&#125;&#x27;|sed -e &#x27;s/../\0:/&#x27;`</span><br><span class="line">  done</span><br><span class="line">for ((i=0;i&lt;2;i++))</span><br><span class="line">  do</span><br><span class="line">    echo $&#123;a[$i]&#125; $&#123;b[$i]&#125;</span><br><span class="line">  done</span><br><span class="line">for ((i=0;i&lt;2;i++))</span><br><span class="line">  do</span><br><span class="line">    e[$i]=`ip link show $&#123;a[$i]&#125; |head -2|tail -1|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">  done</span><br><span class="line">cp /root/trex/v2.81/cfg/simple_cfg.yaml  /etc/trex_cfg.yaml.bak</span><br><span class="line">sed &#x27;4,$d&#x27; /etc/trex_cfg.yaml.bak &gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;  interfaces    : [&quot;&#x27;$&#123;b[0]&#125;&#x27;&quot;,&quot;&#x27;$&#123;b[1]&#125;&#x27;&quot;]&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;  port_info       :  # Port IPs. Change to suit your needs. In case of loopback, you can leave as is.&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;          - ip         : 192.168.155.2&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;            default_gw : 192.168.155.3&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;          - ip         : 192.168.166.4&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;            default_gw : 192.168.166.5&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">echo -e &#x27;\n\n&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class="line">cd ~/trex/v2.81/</span><br><span class="line">./dpdk_setup_ports.py</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat /etc/trex_cfg.yaml</span></span><br><span class="line">cat /root/trex/v2.81/cfg/simple_cfg.yaml</span><br><span class="line">cat /etc/trex_cfg.yaml</span><br><span class="line">echo &#x27;config success ! dont config again!  if not configed please reboot your mechine and check your network  sum is 2 and the last 2 network are connected.&#x27;</span><br><span class="line">echo -e &#x27;\n&#x27;</span><br><span class="line">echo $&#123;e[0]&#125;&#x27; &#x27;$&#123;e[1]&#125;</span><br></pre></td></tr></table></figure><p>run_trex.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /root/trex/v2.81; ./t-rex-64 -f cap2/imix_longtao_1w.yaml -m 5 -d 5</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vdbench的使用</title>
      <link href="metaverse/vdbench/"/>
      <url>metaverse/vdbench/</url>
      
        <content type="html"><![CDATA[<p>ssh免密配置</p><p>参考：<a href="https://blog.csdn.net/SweeNeil/article/details/95338293">https://blog.csdn.net/SweeNeil/article/details/95338293</a></p><ol><li> 使用Vdbench测试工具对所有虚拟机磁盘进行压力测试，vdbench测试工具脚本主机定义设置如下：</li></ol><p>hd=default,vdbench=/home/vdbench,user=root,shell=ssh</p><p>hd=hd1,system=node1</p><p>hd=hd2,system=node2</p><p>hd=hd3,system=node3</p><p>……</p><ol><li> 设置测试工具模型为8k块大小随机读，测试数据量为块存储总SSD缓存大小的1倍。在压力虚拟机上运行Vdbench测试工具。存储定义、工作负载定义、运行定义设置如下：</li></ol><p>sd=sd1,hd=hd1,lun=/dev/sdb,openflags=o_direct,hitarea=1G,threads=1（厂家自行调整）</p><p>……</p><p>wd=wd1,sd=sd*,seekpct=100,rdpct=100,rhpct=60,xfersize=8k </p><p>rd=rd1,wd=wd1,iorate=max,elapsed=604800,maxdata=数据量,interval=5,warmup=30</p><ol><li> 记录平均读写IOPS</li></ol><p>master</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.197</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.196</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.185</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.173</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.171</span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.18.2.165</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">hd&#x3D;default,vdbench&#x3D;&#x2F;home&#x2F;vdbench,user&#x3D;root,shell&#x3D;ssh</span><br><span class="line">hd&#x3D;hd1,system&#x3D;172.18.2.197</span><br><span class="line">hd&#x3D;hd2,system&#x3D;172.18.2.196</span><br><span class="line">hd&#x3D;hd3,system&#x3D;172.18.2.185</span><br><span class="line">hd&#x3D;hd4,system&#x3D;172.18.2.173</span><br><span class="line">hd&#x3D;hd5,system&#x3D;172.18.2.171</span><br><span class="line">hd&#x3D;hd6,system&#x3D;172.18.2.165</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sd&#x3D;sd1,hd&#x3D;hd1,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd2,hd&#x3D;hd1,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd3,hd&#x3D;hd2,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd4,hd&#x3D;hd2,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd5,hd&#x3D;hd3,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd6,hd&#x3D;hd3,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd7,hd&#x3D;hd4,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd8,hd&#x3D;hd4,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd9,hd&#x3D;hd5,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd10,hd&#x3D;h5,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd11,hd&#x3D;hd6,lun&#x3D;&#x2F;dev&#x2F;sdb,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line">sd&#x3D;sd12,hd&#x3D;hd6,lun&#x3D;&#x2F;dev&#x2F;sda,openflags&#x3D;o_direct,hitarea&#x3D;1G,threads&#x3D;1</span><br><span class="line"></span><br><span class="line">wd&#x3D;wd1,sd&#x3D;sd*,seekpct&#x3D;100,rdpct&#x3D;0,rhpct&#x3D;60,xfersize&#x3D;8k</span><br><span class="line"></span><br><span class="line">rd&#x3D;rd1,wd&#x3D;wd1,iorate&#x3D;max,elapsed&#x3D;604800,maxdata&#x3D;150G,interval&#x3D;5,warmup&#x3D;30</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用qemu-imag打包iso</title>
      <link href="metaverse/qemu-img/"/>
      <url>metaverse/qemu-img/</url>
      
        <content type="html"><![CDATA[<h3 id="使用qemu-image-压缩qcow2镜像"><a href="#使用qemu-image-压缩qcow2镜像" class="headerlink" title="使用qemu-image 压缩qcow2镜像"></a>使用qemu-image 压缩qcow2镜像</h3><p>qemu-img convert -c -O qcow2 raw.qcow2 outZipped.qcow2</p><p>raw.qcow2是原始镜像</p><p>outZipped.qcow2是压缩后的目标镜像</p><h3 id="转换并压缩"><a href="#转换并压缩" class="headerlink" title="转换并压缩"></a>转换并压缩</h3><p>qemu-img convert -f raw -O qcow2</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swingbench介绍</title>
      <link href="metaverse/swingbench/"/>
      <url>metaverse/swingbench/</url>
      
        <content type="html"><![CDATA[<p>Swingbench is a free load generator (and benchmarks) designed to stress test an Oracle database (10g,11g,12c).</p><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><ul><li>Swingbench组件：<br>  Swingbench是一个图形界面，用户可以编辑配置参数。可以显示实时的图形。<br>  Minibench是一个图形界面，可以显示简单的实时图形。<br>  Charbench是一个命令行的工具，有很多的命令行选项。</li><li>  四种基准测试</li></ul><table><thead><tr><th align="left">Benchmark</th><th align="left">描述</th><th align="left">读写比例</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">Order Entry</td><td align="left">经典的Order Entry基准测试。像TPC。</td><td align="left">60/40</td><td align="left">TPC-C类似的，基于Oracle自带的两个Sample Schema：OE和SH</td></tr><tr><td align="left">Calling Circle</td><td align="left">电话公司自助系统</td><td align="left">70/30</td><td align="left">基于电话自助服务系统的基准测试，大小相对固定，每次运行都需要重新生成schema</td></tr><tr><td align="left">Stess Test</td><td align="left">简单的INSERT/DELETE/UPDATE/SELECT</td><td align="left">50/50</td><td align="left">Stress Test是最简单的测试，执行insert/update/delete/select的操作，数据是在运行时产生，可以用于测试TimesTen</td></tr><tr><td align="left">Sales History</td><td align="left">DSS基准测试</td><td align="left">100/0</td><td align="left">数据仓库基准测试，使用datagenerator产生数据，由disk和时间来决定最大的大小，基于Oracle自带的两个Sample Schema：OE和SH</td></tr></tbody></table><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul><li>  Linux</li><li>  Oracle Database 11</li></ul><h1 id="架构示意图"><a href="#架构示意图" class="headerlink" title="架构示意图"></a>架构示意图</h1><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/22/89110108255106186165209123221526149212127123_6500656c-5aef-11eb-9fab-fa1e86d74c00.png" alt="img"></p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/22/505624220682411041642202111351681361168348_665819b4-5aef-11eb-9549-fa1e86d74c00.png" alt="img"></p><h1 id="安装和设置"><a href="#安装和设置" class="headerlink" title="安装和设置"></a>安装和设置</h1><ul><li><p>下载<br>  目前作者已经发布了最新的2.5版本，本次使用2.5。从dominicgiles.com下载，地址：<a href="http://dominicgiles.com/downloads.html%E3%80%82">http://dominicgiles.com/downloads.html。</a></p></li><li><p>验证Java版本<br>  2.4和2.5版本需要使用Java 6/7 JVM。</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">yum install -y java-1.7.0-openjdk.x86_64</span><br><span class="line">$</span><br><span class="line">java -version</span><br><span class="line">java version &quot;1.7.0_65&quot;</span><br></pre></td></tr></table></figure></li><li><p>安装</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line">pwd &#x2F;home&#x2F;oracle</span><br><span class="line">unzip swingbench25932.zip</span><br><span class="line">&lt;略&gt;</span><br><span class="line">cd swingbench</span><br><span class="line">pwd</span><br><span class="line">&#x2F;home&#x2F;oracle&#x2F;swingbench</span><br></pre></td></tr></table></figure></li><li><p>用户设置<br>  Unix/Linux平台配置文件为swingbench.env，执行文件路径为bin；Windows下则为swingbenchenv.bat和winbin。在windows平台上注意一定要配置ORACLE_HOME，好像不认注册表。<br>  Linux平台下，swingbench是在Oracle用户下执行，请确保它被设置在环境变量以下。</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line">export ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle</span><br><span class="line">export ORACLE_HOME&#x3D;$ORACLE_BASE&#x2F;product&#x2F;11.2.0&#x2F;dbhome_1</span><br></pre></td></tr></table></figure></li></ul><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><ul><li><p>配置OE仓库</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line">cd bin</span><br><span class="line">.&#x2F;oewizard</span><br></pre></td></tr></table></figure></li></ul><p>1.按在欢迎屏幕[下一页]</p><p>2.选择Benchmark版本，此处选择版本2.0，然后按[下一页]</p><p>3.选择任务，选择“Create the Order Entry Schema（User,Tables,indexes,Data etc）”，然后按[下一页]</p><p>4.在数据库的详细信息界面，输入必要的信息，然后按[下一页]</p><p>5.在Schema Details界面输入所需信息，然后按[下一页]</p><p>6.在Database Options输入所需的信息，然后按[下一页]<br>可默认</p><p>7.大小细节，建议进入用户自定义，可以使用1GB按[下一步]。</p><p>8.最后，指定并行度，然后按[完成]</p><p>9.日志在一个单独的窗口中打开。</p><p>10.打开完成后的模式创建完成界面。并按[确定]退出。</p><ul><li><p>测试</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line">cd &#x2F;home&#x2F;oracle&#x2F;swingbench&#x2F;bin</span><br><span class="line">.&#x2F;swingbench -cs &#x2F;&#x2F;oracledb01&#x2F;orcl112 -dt thin  -rt 0:05</span><br></pre></td></tr></table></figure></li></ul><h1 id="测试中遇到的问题和解决方法"><a href="#测试中遇到的问题和解决方法" class="headerlink" title="测试中遇到的问题和解决方法"></a>测试中遇到的问题和解决方法</h1><ol><li><p>生成AWR<br> 在测试开始时可以生成awr快照，但是结束时没有自动生成awr快照。可以运行下列<br> 语句手工生成：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt;</span><br><span class="line">exec DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT ;</span><br></pre></td></tr></table></figure></li><li><p>遇到等待事件<br> resmgr:cpu quantum<br> 根据metalink的note禁止资源管理</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt;</span><br><span class="line">alter system set resource_manager_plan&#x3D;&#39;&#39; scope&#x3D;both;</span><br></pre></td></tr></table></figure></li><li><p>运行swingbench, 没有显示cpu和disk的实时图形<br> ./swingbench -cpuloc localhost 带选项-cpuloc，如果是2.4版本，可以指定hostname和用户密码</p></li><li><p>遇到ora-03111错误<br> 查了metalink的note可以通过调节sdu来解决，不过有时还是会出现。<br> (SDU = 16384)<br> (TDU = 16384)</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>echarts的使用</title>
      <link href="metaverse/echarts/"/>
      <url>metaverse/echarts/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> echarts = <span class="built_in">require</span>(<span class="string">&#x27;echarts&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chartDom = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;main&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> myChart = echarts.init(chartDom);</span><br><span class="line"><span class="keyword">var</span> option;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colors = [<span class="string">&#x27;#FFAE57&#x27;</span>, <span class="string">&#x27;#FF7853&#x27;</span>, <span class="string">&#x27;#EA5151&#x27;</span>, <span class="string">&#x27;#CC3F57&#x27;</span>, <span class="string">&#x27;#9A2555&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> bgColor = <span class="string">&#x27;#2E2733&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> itemStyle = &#123;</span><br><span class="line">  star5: &#123;</span><br><span class="line">    color: colors[<span class="number">0</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  star4: &#123;</span><br><span class="line">    color: colors[<span class="number">1</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  star3: &#123;</span><br><span class="line">    color: colors[<span class="number">2</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  star2: &#123;</span><br><span class="line">    color: colors[<span class="number">3</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&#x27;虚构&#x27;</span>,</span><br><span class="line">    itemStyle: &#123;</span><br><span class="line">      color: colors[<span class="number">1</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;小说&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;疼&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;慈悲&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;楼下的房客&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;虚无的十字架&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;无声告白&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;童年的终结&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;疯癫老人日记&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;其他&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;纳博科夫短篇小说全集&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;安魂曲&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;人生拼图版&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;比起爱你，我更需要你&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&#x27;非虚构&#x27;</span>,</span><br><span class="line">    itemStyle: &#123;</span><br><span class="line">      color: colors[<span class="number">2</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;设计&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;无界面交互&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;数字绘图的光照与渲染技术&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;日本建筑解剖书&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;奇幻世界艺术\n&amp;RPG地图绘制讲座&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;社科&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;痛点&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;卓有成效的管理者&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;进化&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;后物欲时代的来临&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;疯癫与文明&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;心理&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;我们时代的神经症人格&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;皮格马利翁效应&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;受伤的人&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;2☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;迷恋&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;居家&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;把房子住成家&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;只过必要生活&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;北欧简约风格&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;绘本&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;设计诗&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;假如生活糊弄了你&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;博物学家的神秘动物图鉴&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;3☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;方向&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;哲学&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;人生的智慧&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;技术&#x27;</span>,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;5☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;代码整洁之道&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;4☆&#x27;</span>,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                name: <span class="string">&#x27;Three.js 开发指南&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; data.length; ++j) &#123;</span><br><span class="line">  <span class="keyword">let</span> level1 = data[j].children;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; level1.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> block = level1[i].children;</span><br><span class="line">    <span class="keyword">let</span> bookScore = [];</span><br><span class="line">    <span class="keyword">let</span> bookScoreId;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> star = <span class="number">0</span>; star &lt; block.length; ++star) &#123;</span><br><span class="line">      <span class="keyword">let</span> style = (<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;5☆&#x27;</span>:</span><br><span class="line">            bookScoreId = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> itemStyle.star5;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;4☆&#x27;</span>:</span><br><span class="line">            bookScoreId = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> itemStyle.star4;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;3☆&#x27;</span>:</span><br><span class="line">            bookScoreId = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> itemStyle.star3;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;2☆&#x27;</span>:</span><br><span class="line">            bookScoreId = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">return</span> itemStyle.star2;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)(block[star].name);</span><br><span class="line">      block[star].label = &#123;</span><br><span class="line">        color: style.color,</span><br><span class="line">        downplay: &#123;</span><br><span class="line">          opacity: <span class="number">0.5</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (block[star].children) &#123;</span><br><span class="line">        style = &#123;</span><br><span class="line">          opacity: <span class="number">1</span>,</span><br><span class="line">          color: style.color</span><br><span class="line">        &#125;;</span><br><span class="line">        block[star].children.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">book</span>) </span>&#123;</span><br><span class="line">          book.value = <span class="number">1</span>;</span><br><span class="line">          book.itemStyle = style;</span><br><span class="line">          book.label = &#123;</span><br><span class="line">            color: style.color</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">let</span> value = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">if</span> (bookScoreId === <span class="number">0</span> || bookScoreId === <span class="number">3</span>) &#123;</span><br><span class="line">            value = <span class="number">5</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (bookScore[bookScoreId]) &#123;</span><br><span class="line">            bookScore[bookScoreId].value += value;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bookScore[bookScoreId] = &#123;</span><br><span class="line">              color: colors[bookScoreId],</span><br><span class="line">              value: value</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    level1[i].itemStyle = &#123;</span><br><span class="line">      color: data[j].itemStyle.color</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">option = &#123;</span><br><span class="line">  backgroundColor: bgColor,</span><br><span class="line">  color: colors,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">&#x27;sunburst&#x27;</span>,</span><br><span class="line">      center: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;48%&#x27;</span>],</span><br><span class="line">      data: data,</span><br><span class="line">      sort: <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a.depth === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> b.getValue() - a.getValue();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> a.dataIndex - b.dataIndex;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      label: &#123;</span><br><span class="line">        rotate: <span class="string">&#x27;radial&#x27;</span>,</span><br><span class="line">        color: bgColor</span><br><span class="line">      &#125;,</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        borderColor: bgColor,</span><br><span class="line">        borderWidth: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      levels: [</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          r0: <span class="number">0</span>,</span><br><span class="line">          r: <span class="number">40</span>,</span><br><span class="line">          label: &#123;</span><br><span class="line">            rotate: <span class="number">0</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          r0: <span class="number">40</span>,</span><br><span class="line">          r: <span class="number">105</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          r0: <span class="number">115</span>,</span><br><span class="line">          r: <span class="number">140</span>,</span><br><span class="line">          itemStyle: &#123;</span><br><span class="line">            shadowBlur: <span class="number">2</span>,</span><br><span class="line">            shadowColor: colors[<span class="number">2</span>],</span><br><span class="line">            color: <span class="string">&#x27;transparent&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          label: &#123;</span><br><span class="line">            rotate: <span class="string">&#x27;tangential&#x27;</span>,</span><br><span class="line">            fontSize: <span class="number">10</span>,</span><br><span class="line">            color: colors[<span class="number">0</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          r0: <span class="number">140</span>,</span><br><span class="line">          r: <span class="number">145</span>,</span><br><span class="line">          itemStyle: &#123;</span><br><span class="line">            shadowBlur: <span class="number">80</span>,</span><br><span class="line">            shadowColor: colors[<span class="number">0</span>]</span><br><span class="line">          &#125;,</span><br><span class="line">          label: &#123;</span><br><span class="line">            position: <span class="string">&#x27;outside&#x27;</span>,</span><br><span class="line">            textShadowBlur: <span class="number">5</span>,</span><br><span class="line">            textShadowColor: <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          downplay: &#123;</span><br><span class="line">            label: &#123;</span><br><span class="line">              opacity: <span class="number">0.5</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">option &amp;&amp; myChart.setOption(option);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>perl极简教程</title>
      <link href="metaverse/perlbasics/"/>
      <url>metaverse/perlbasics/</url>
      
        <content type="html"><![CDATA[<p>perl ：practical exteaction report language</p><ol><li><p>perl是动态脚本语言</p></li><li><p>脚本运行是要</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br></pre></td></tr></table></figure></li><li><p>使用#单行注释，使用=pod           =cut多行注释</p></li><li><p>perl不关心留白数量</p></li><li><p>heredoc用法，单引号不转义，双引号转义</p></li><li><p>使用反斜杠\转义</p></li></ol><p>##标量定义</p><p>数字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$num&#x3D;12;</span><br></pre></td></tr></table></figure><p>字符串</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$stri=<span class="string">&quot;string&quot;</span>;</span><br></pre></td></tr></table></figure><p>浮点数</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$float=<span class="number">1.2</span>;</span><br></pre></td></tr></table></figure><p>数组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@arr&#x3D;(0,1,2);</span><br></pre></td></tr></table></figure><p>字典</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%map=(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="number">2</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> perl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>py2与py3在closerange的区别</title>
      <link href="metaverse/differencebwtweenpy2andpy3incloserangefuntion/"/>
      <url>metaverse/differencebwtweenpy2andpy3incloserangefuntion/</url>
      
        <content type="html"><![CDATA[<h2 id="file-descriptors（-proc下）"><a href="#file-descriptors（-proc下）" class="headerlink" title="file descriptors（/proc下）"></a>file descriptors（/proc下）</h2><p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8">内核</a>为每一个<a href="https://zh.wikipedia.org/wiki/%E8%BF%9B%E7%A8%8B">进程</a>所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">程序设计</a>中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于<a href="https://zh.wikipedia.org/wiki/UNIX">UNIX</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a>这样的操作系统。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>文件描述符的优点主要有两个：</p><ul><li>基于文件描述符的<a href="https://zh.wikipedia.org/wiki/I/O">I/O操作</a>兼容<a href="https://zh.wikipedia.org/wiki/POSIX">POSIX</a>标准。</li><li>在UNIX、Linux的系统调用中，大量的系统调用都是依赖于文件描述符</li></ul><p>此外，在Linux系列的操作系统上，由于Linux的设计思想便是把一切设备都视作文件。因此，文件描述符为在该系列平台上进行设备相关的编程实际上提供了一个统一的方法。</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>文件描述符的概念存在两大缺点：</p><ul><li>在非UNIX/Linux <a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>上（如<a href="https://zh.wikipedia.org/wiki/Windows">Windows</a>），无法基于这一概念进行编程——事实上，Windows下的文件描述符和<a href="https://zh.wikipedia.org/wiki/%E4%BF%A1%E5%8F%B7%E9%87%8F">信号量</a>、<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E6%96%A5%E9%94%81">互斥锁</a>等<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1">内核对象</a>一样都记作HANDLE。</li><li>由于文件描述符在形式上不过是个整数，当代码量增大时，会使编程者难以分清哪些整数意味着数据，哪些意味着文件描述符。因此，完成的代码可读性也就会变得很差，这一点一般通过消除<a href="https://zh.wikipedia.org/wiki/%E9%AD%94%E8%A1%93%E6%95%B8%E5%AD%97">魔术数字</a>来解决。</li></ul><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ol><li>在proc目录下，以数字命名的目录表示当前一个运行的进程，目录名即为进程的pid，进程里的fd是文件描述符。</li><li>魔术数字（magic number）是程式设计中所谓的直接写在程式码里的具体数值（如“10”“123”等以数字直接写出的值）。虽然程式作者写的时候自己能了解数值的意义，但对其他程式员而言，甚至制作者本人经过一段时间后，会难以了解这个数值的用途，只能苦笑讽刺“这个数值的意义虽然不懂，不过至少程式会动，真是个魔术般的数字”而得名。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JRE和JDK的区别</title>
      <link href="metaverse/javabasics/"/>
      <url>metaverse/javabasics/</url>
      
        <content type="html"><![CDATA[<p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/16351383024c3f44e8-9100-11eb-9353-fa1e86d74c00.png" alt="0cc3f4a15d3184391a98a7b1c58f6e5f_1440w"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/16351383094800a192-9100-11eb-8da9-fa1e86d74c00.png" alt="20171221220833133"></p><h2 id="先给出JDK，JRE，JVM（带上JVM有助于理解）的名词解释"><a href="#先给出JDK，JRE，JVM（带上JVM有助于理解）的名词解释" class="headerlink" title="先给出JDK，JRE，JVM（带上JVM有助于理解）的名词解释"></a><strong>先给出JDK，JRE，JVM（带上JVM有助于理解）的名词解释</strong></h2><ol><li> Java开发工具包（JDK）是一种用    于开发Java应用程序和applet的软件开发环境。它包括Java运行时环境（JRE）、解释器/加载器（Java）、编译器（javac）、归档器（jar）、文档生成器（Javadoc）和Java开发所需的其他工具。</li><li> JRE代表“Java Runtime Environment”，也可以写成“Java RTE”。Java Runtime Environment提供了执行Java应用程序的最低要求；它由Java虚拟机（JVM）、核心类和支持文件组成。</li><li> 另外也给出了JVM（java virtual machine）的解释。</li></ol><ul><li>  它是一种指定Java虚拟机工作的规范。但是实现提供者对算法的选择是独立的。它的实现由Sun和其他公司提供。</li><li>  满足JVM规范要求的计算机程序的一种实现。</li><li>  运行时实例：每当您在命令提示符下编写java命令来运行java类时，就会创建一个JVM实例。</li></ul><h2 id="一-JDK、JRE和JVM的区别"><a href="#一-JDK、JRE和JVM的区别" class="headerlink" title="一. JDK、JRE和JVM的区别"></a><strong>一. JDK、JRE和JVM的区别</strong></h2><p>为了理解这三者之间的区别，让我们考虑下面的图表。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455466v2-20c4773e7e180335fb7f623c79e92303_hd.jpg?source=1940ef5c" alt="img"></p><ul><li>  <strong>JDK–Java开发工具包</strong>（简称JDK）是一种提供开发和执行（运行）Java程序的环境的工具包。JDK是一个工具包（或包），它包括两个方面</li></ul><ol><li> 开发工具（提供开发java程序的环境）</li><li> JRE（执行java程序）。</li></ol><ul><li>  <strong>JRE–Java Runtime Environment</strong>（也就是说JRE）是一个安装包，它提供的环境只能在您的计算机上运行（而不是开发）Java程序。只有那些只想运行Java程序的用户，也就是系统的最终用户，才会使用JRE。</li><li>  <strong>JVM–Java虚拟机</strong>（JVM）是JDK和JRE的一个非常重要的部分，因为它内置于两者之中。使用JRE或JDK运行的任何Java程序都进入JVM，JVM负责逐行执行Java程序，因此它也被称为解释器。</li></ul><h2 id="二-JRE和JDK是如何工作的？"><a href="#二-JRE和JDK是如何工作的？" class="headerlink" title="二. JRE和JDK是如何工作的？"></a>二. JRE和JDK是如何工作的？</h2><h2 id="JRE由什么组成？"><a href="#JRE由什么组成？" class="headerlink" title="JRE由什么组成？"></a>JRE由什么组成？</h2><p>JRE由以下组件组成：</p><ul><li>  <strong>部署技术</strong>，包括部署、java web start和Java插件。</li><li>  <strong>用户界面工具包</strong>，包括抽象窗口工具包（AWT）、Swing、java2d、辅助功能、图像I/O、打印服务、声音、拖放（DnD）和输入方法。</li><li>  <strong>集成库</strong>，包括接口定义语言（IDL）、Java数据库连接（JDBC）、Java命名和目录接口（JNDI）、远程方法调用（RMI）、Internet Orb间协议远程方法调用（RMI-IIOP）和脚本。</li><li>  <strong>其他基本库</strong>，包括国际支持、输入/输出（I/O）、扩展机制、bean、Java管理扩展（JMX）、Java本机接口（JNI）、数学、网络、覆盖机制、安全性、序列化和Java for XML处理（XML JAXP）。</li><li>  <strong>Lang和util基本库</strong>，包括Lang和util、管理、版本控制、zip、工具、反射、集合、并发实用程序、Java存档（JAR）、日志、首选项API、Ref对象和正则表达式。</li><li>  <strong>Java虚拟机</strong>（JVM），包括Java HotSpot 客户端和<em>Server Virtual Machines</em>。</li></ul><h2 id="JRE是如何工作的？"><a href="#JRE是如何工作的？" class="headerlink" title="JRE是如何工作的？"></a>JRE是如何工作的？</h2><p>为了理解JRE是如何工作的，让我们保存一个java源文件<em>Example.java。</em>该文件被编译成一组字节码，存储在“.class”文件中，这里它就是”<em>Example</em>.class“。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635138321v2-514231f8f6536733d294d76dcefa8d96_hd.jpg?source=1940ef5c" alt="img"><img src= "/img/loading.gif" data-lazy-src="https://pic1.zhimg.com/80/v2-514231f8f6536733d294d76dcefa8d96_1440w.jpg?source=1940ef5c" alt="img"></p><p>下图描述了编译时所做的操作，以下操作在运行时发生：</p><ul><li>  <strong>类加载器</strong></li></ul><p>类加载器加载执行程序所需的所有类。它通过将本地文件系统的名称空间与通过网络导入的名称空间分离来提供安全性。这些文件可以从硬盘、网络或其他来源加载。</p><ul><li>  <strong>字节码校验器</strong></li></ul><p>JVM将代码放入字节码验证器，该验证器检查格式并检查非法代码。例如，非法代码就是违反对象访问权限或违反指针实现的代码。</p><p>字节码验证器确保代码符合JVM规范，并且不违反系统完整性。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/16344554731634455456v2-12142cee79304193c837472e149d3aea_hd.jpg?source=1940ef5c" alt="img"></p><ul><li>  <strong>解释器</strong></li></ul><p>在运行时，字节码由解释器加载、检查和运行。解释器有以下两个功能：</p><ol><li> 执行字节码</li><li> 对底层硬件进行适当的调用</li></ol><p>两种操作可以显示为：</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455479v2-cc90ac57568556eb923f362b10f05178_hd.jpg?source=1940ef5c" alt="img"></p><p>要理解JDK和JRE之间的交互，请考虑下面的图：</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211017/1634455482v2-7fa711bae33644cbc7ea6981a8eda4cf_hd.jpg?source=1940ef5c" alt="img"></p><h2 id="三-JVM是如何工作的？"><a href="#三-JVM是如何工作的？" class="headerlink" title="三. JVM是如何工作的？"></a><strong>三. JVM是如何工作的？</strong></h2><p>JVM在Java程序运行时成为JRE的一个实例。它被广泛地称为运行时解释器。JVM在很大程度上有助于从程序员那里抽象出内部实现，这些程序员为自己的程序使用JDK中的库。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是运行时</title>
      <link href="metaverse/whatsruntime/"/>
      <url>metaverse/whatsruntime/</url>
      
        <content type="html"><![CDATA[<p>runtime 描述了<strong>程序运行时候</strong>执行的软件/指令， 在每种语言有着不同的实现。可大可小，在 C 中，runtime 是库代码， 等同于 C runtime library，一系列 C 程序运行所需的函数，在 Java 中，runtime 还提供了 Java 程序运行所需的虚拟机等。</p><p>总而言之，<strong>runtime 是一个通用抽象的术语，指的是计算机程序运行的时候所需要的一切代码库，框架，平台等</strong>。</p><p>在 Go 中， 有一个 runtime 库，其实现了垃圾回收，并发控制， 栈管理以及其他一些 Go 语言的关键特性。 runtime 库是每个 Go 程序的一部分，也就是说编译 Go 代码为机器代码时也会将其也编译进来。所以 Go 官方将其定位偏向类似于 C 语言中的库。Go 中的 runtime 不像 Java runtime （JRE， java runtime envirement ) 一样，jre 还会提供虚拟机， Java 程序要在 JRE 下 才能运行。</p><p>所以在 Go 语言中， runtime 只是提供支持语言特性的库的名称，也就是 Go 程序执行时候使用的库。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是hyperv</title>
      <link href="metaverse/hyperv/"/>
      <url>metaverse/hyperv/</url>
      
        <content type="html"><![CDATA[<p>Hyper-V是<a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF">微软</a>的一款虚拟化产品，是微软第一个采用类似Vmware ESXi和Citrix Xen的基于hypervisor的技术。这也意味着<a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF/124767">微软</a>会更加直接地与市场先行者VMware展开竞争，但竞争的方式会有所不同。Hyper-V是<a href="https://baike.baidu.com/item/%E5%BE%AE%E8%BD%AF/124767">微软</a>提出的一种<a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/10844875">系统管理</a>程序<a href="https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/276750">虚拟化技术</a>，能够实现桌面虚拟化 </p><h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><p>1.<a href="https://baike.baidu.com/item/Intel/125450">Intel</a>或者<a href="https://baike.baidu.com/item/AMD/5905">AMD</a>64位处理器 [1] （从Windows10预览版更新19559开始ARM64位处理器也受支持 [2] ）</p><p>2.Windows Server 2008 R2及以上(服务器操作<a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F">系统</a>)；Windows 7及以上(桌面操作系统)。</p><p>3.硬件辅助虚拟化。这是在现有的<a href="https://baike.baidu.com/item/%E5%A4%84%E7%90%86%E5%99%A8">处理器</a>，包括一个虚拟化的</p><p>选择工具体来说，[Intel vt](<a href="https://baike.baidu.com/item/Intel">https://baike.baidu.com/item/Intel</a> vt/2091588)或AMD-v（ AMD-v，以前的代号为“ Pacifica ”的 ) 。</p><p>4.<a href="https://baike.baidu.com/item/CPU/120556">CPU</a>必须具备硬件的<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E6%89%A7%E8%A1%8C%E4%BF%9D%E6%8A%A4">数据执行保护</a>（ DEP ）功能，而且该功能必须启动。</p><p>5.内存最低限度为2GB。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172176resize,m_lfit,w_220,h_220,limit_1" alt="微软虚拟化构架">微软虚拟化构架</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows实现延时的几种方式</title>
      <link href="metaverse/batdelay/"/>
      <url>metaverse/batdelay/</url>
      
        <content type="html"><![CDATA[<p>方法一：ping</p><p>缺点:时间精度为1秒,不够精确</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="keyword">off</span></span><br><span class="line">@ping <span class="number">127.0</span>.<span class="number">0.1</span> -n <span class="number">6</span> &gt;nul</span><br><span class="line">start gdh.txt</span><br></pre></td></tr></table></figure><p>方法二：vbs start /wait</p><p>缺点：生成临时文件</p><p>有点：时间精度为0.001秒，精度高</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="keyword">off</span></span><br><span class="line">echo wscript.sleep <span class="number">5000</span>&gt;sleep.vbs</span><br><span class="line">start /wait sleep.vbs</span><br><span class="line">start gdh.txt</span><br><span class="line">del /f /s /q sleep.vbs</span><br></pre></td></tr></table></figure><p>方法三：vbs cscript</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="keyword">off</span></span><br><span class="line">echo wscript.sleep <span class="number">5000</span>&gt;sleep.vbs</span><br><span class="line">@cscript sleep.vbs &gt;nul</span><br><span class="line">start gdh.txt</span><br><span class="line">del /f /s /q sleep.vbs</span><br></pre></td></tr></table></figure><p>方法四：choice</p><p>ssh过去有问题，停不下来</p><p>优点：时间精确，CPU占用低，是最佳选择</p><p>CHOICE：[/C[:]按键表] [/N] [/S] [/T[:]选择值,秒数] [显示文本]<br>其中，/C表示可选则的按键，/N表示不要显示提示信息，/S表示大小写字符敏感方式，/T表示若在批定的时间内没有选择的话，自动执行/C中定义的某个选择值。显示文本是CHOICE命令执行时的提示信息。选择结果将用ERRORLEVEL值来表示</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="keyword">off</span></span><br><span class="line">choice /t <span class="number">5</span> /d y /n &gt;nul</span><br><span class="line">start gdh.txt</span><br></pre></td></tr></table></figure><p>方法五：for+set+if，时间精度为0.01秒</p><p>缺点：CPU占用高，语句过长，不常用</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@echo <span class="keyword">off</span></span><br><span class="line">setlocal enableextensions</span><br><span class="line">echo %time%</span><br><span class="line"><span class="keyword">call</span> :ProcDelay <span class="number">500</span></span><br><span class="line">echo %time%</span><br><span class="line">start gdh.txt</span><br><span class="line">:ProcDelay delayMSec_</span><br><span class="line">setlocal enableextensions</span><br><span class="line"><span class="keyword">for</span> /f <span class="string">&quot;tokens=1-4 delims=:. &quot;</span> %%h <span class="keyword">in</span> (<span class="string">&quot;%time%&quot;</span>) <span class="keyword">do</span> <span class="keyword">set</span> start_=%%h%%i%%j%%k</span><br><span class="line">:_procwaitloop</span><br><span class="line"><span class="keyword">for</span> /f <span class="string">&quot;tokens=1-4 delims=:. &quot;</span> %%h <span class="keyword">in</span> (<span class="string">&quot;%time%&quot;</span>) <span class="keyword">do</span> <span class="keyword">set</span> now_=%%h%%i%%j%%k</span><br><span class="line"><span class="keyword">set</span> /a diff_=%now_%-%start_%</span><br><span class="line"><span class="keyword">if</span> %diff_% LSS %<span class="number">1</span> <span class="keyword">goto</span> _procwaitloop</span><br><span class="line">endlocal &amp; <span class="keyword">goto</span> :EOF</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>幂等</title>
      <link href="metaverse/idempotent/"/>
      <url>metaverse/idempotent/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="幂等去重"><a href="#幂等去重" class="headerlink" title="幂等去重"></a>幂等去重</h2><p>最近计算节点网络异常时经常出现请求未响应问题，之前的做法是在接收到任务之后与原先存在的任务做比较,进而判断是否为同一个请求的重试，</p><p>主流的MQ实现在 <code>autocommit=true</code> 时天然实现了幂等</p><p>但考虑业务处理可能出错的情况我们一般会将autocommit设置成false，在业务处理成功后再提交，这时就需要使用上述幂等方案了</p><p>在接收到消息时写入请求Token以实现去重判断（Token可为Topic+Offset）提交后删除Token，整体上可以做到对业务透明</p><h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><ol><li>没有副作用</li></ol><h3 id="什么是幂等性"><a href="#什么是幂等性" class="headerlink" title="什么是幂等性"></a>什么是幂等性</h3><ol><li>数学表述， 多次调用仍为自身，</li><li>不产生副作用</li><li>带上uuid识别是否是相同的请求，避免重复请求</li><li>ACID 2.0 解释，与分布式中的ACID辨析</li><li>stateless 无状态 何时使用，对内维护状态，对外接口无状态+异步。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis搭建</title>
      <link href="metaverse/redis/"/>
      <url>metaverse/redis/</url>
      
        <content type="html"><![CDATA[<p>单个节点redis搭建</p><ol><li>从官网或github下载源码</li><li>安装gcc</li><li>make（可设置内存分配器为libc，默认为jemalloc，默认更好）（内存分配器未设置为jemalloc，可能影响并发性能，并加重内存碎片，rust用的也是这个内存分配器， info memory查看内存分配器）</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="redis集群搭建"><a href="#redis集群搭建" class="headerlink" title="redis集群搭建"></a>redis集群搭建</h2><ol><li><p>一．安装前准备<br>关闭SELinux</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">echo &quot;&#x2F;usr&#x2F;sbin&#x2F;setenforce 0&quot;</span><br><span class="line">sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;sysconfig&#x2F;selinux </span><br><span class="line">sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br></pre></td></tr></table></figure></li></ol><p>   设置防火墙</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 6379 -j ACCEPT</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure><p>   时钟校对</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ntpdate</span><br><span class="line">echo &quot;#Clock synchronization&quot; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br><span class="line">echo &quot;01 00 * * * &#x2F;sbin&#x2F;ntpdate ntp2.aliyun.com;&#x2F;sbin&#x2F;hwclock -w&quot; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br></pre></td></tr></table></figure><p>   调整文件打开数</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;20-nproc.conf </span><br><span class="line">root soft nofile 102400</span><br><span class="line">root hard nofile 102400</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>   <code>yum -y install gcc gcc-c++</code><br>   二.安装red is<br>   下载redis安装包</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.5.tar.gz</span><br><span class="line">tar zxvf redis-5.0.5.tar.gz </span><br><span class="line">cd redis-5.0.5&#x2F;</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">创建文件目录</span><br></pre></td></tr></table></figure><p>   <code>mkdir -p /opt/redis/&#123;db,etc,bin,logs&#125;</code><br>   将启动文件拷贝至文件目录</p><p>   [root@localhost redis-5.0.5]#cd  src/<br>   [root@localhost src]#cp mkreleasehdr.sh redis-benchmark redis-check-aof redis-server redis-cli  /opt/redis/bin<br>   1<br>   2<br>   修改配置文件/opt/redis/etc/redis.conf</p><p>   bind 0.0.0.0  #绑定的IP地址，0.0.0.0对所有开放<br>   protected-mode no  #关闭保护模式，让其他主机连接<br>   port 6379 #服务端口<br>   tcp-backlog 511 #tcp连接等待队列长度<br>   timeout 0<br>   tcp-keepalive 300<br>   daemonize yes #开启后台模式<br>   supervised no<br>   pidfile /var/run/redis_6379.pid #进程文件<br>   loglevel notice<br>   logfile /opt/redis/logs/redis.log #日志文件<br>   databases 1 #数据库的个数，默认16，由于集群不支持切换库，所有只有一个库<br>   always-show-logo yes<br>   #指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合<br>       save <seconds> <changes><br>       Redis默认配置文件中提供了三个条件：<br>   save 900 1<br>   save 300 10<br>   save 60 10000<br>   stop-writes-on-bgsave-error yes #后台备份出错时，是否停止写入keys到哈希槽<br>   rdbcompression yes #数据文件是否压缩<br>   rdbchecksum yes#数据文件执行校验<br>   dbfilename dump-6379.rdb #指定本地数据库文件名，默认值为dump.rdb<br>   dir /opt/redis/db/ #指定本地数据库存放目录<br>   replica-serve-stale-data yes<br>   replica-read-only yes<br>   repl-diskless-sync no<br>   repl-diskless-sync-delay 5<br>   repl-disable-tcp-nodelay no<br>   replica-priority 100<br>   masterauth 123456 #主机授权密码<br>   requirepass 123456 #数据库密码<br>   maxclients 10000 #最大客户端连接数<br>   lazyfree-lazy-eviction no<br>   lazyfree-lazy-expire no<br>   lazyfree-lazy-server-del no<br>   replica-lazy-flush no<br>   appendonly no<br>   appendfilename “appendonly.aof” #启动Redis上启用了AOF，则会加载AOF，这是具有更好的耐久性保证的文件，相当于MySQL的二进制文件<br>   appendfsync everysec #磁盘上刷新数据，每一秒钟一次<br>   no-appendfsync-on-rewrite no #如果您有延迟问题，请将其转换为”yes”。否则，从持久性的角度来看，设置为”no”是最安全的选择。<br>   auto-aof-rewrite-percentage 100<br>   auto-aof-rewrite-min-size 64mb #自动重写附加文件<br>   aof-load-truncated yes<br>   aof-use-rdb-preamble yes<br>   lua-time-limit 5000<br>   cluster-enabled yes #开启集群<br>   cluster-config-file node1-6379.conf #集群节点配置文件，由Redis节点自动创建和更新的,非人工创建<br>   cluster-node-timeout 15000 #集群节点超时,连接不上的时间<br>   cluster-slave-validity-factor 10  #从节点与主节点失联多久，从节点尝试升级成主节点。如果设置成正数，则cluster-node-timeout乘以cluster-slave-validity-factor得到的时间，是从节点与主节点失联后，此从节点数据有效的最长时间，超过这个时间，从节点不会启动故障迁移<br>   cluster-migration-barrier 1 #主节点需要的最小从节点数，只有达到这个数，主节点失败时，它从节点才会进行迁移<br>   cluster-require-full-coverage yes  #在部分key所在的节点不可用时，如果此参数设置为”yes”(默认值), 则整个集群停止接受操作；如果此参数设置为”no”，则集群依然为可达节点上的key提供读操作。<br>   slowlog-log-slower-than 10000<br>   slowlog-max-len 128<br>   latency-monitor-threshold 0<br>   notify-keyspace-events “”<br>   hash-max-ziplist-entries 512<br>   hash-max-ziplist-value 64<br>   list-max-ziplist-size -2<br>   list-compress-depth 0<br>   set-max-intset-entries 512<br>   zset-max-ziplist-entries 128<br>   zset-max-ziplist-value 64<br>   hll-sparse-max-bytes 3000<br>   stream-node-max-bytes 4096<br>   stream-node-max-entries 100<br>   activerehashing yes<br>   client-output-buffer-limit normal 0 0 0<br>   client-output-buffer-limit replica 256mb 64mb 60<br>   client-output-buffer-limit pubsub 32mb 8mb 60<br>   hz 10 #Redis调用一个内部函数来执行许多后台任务<br>   dynamic-hz yes<br>   aof-rewrite-incremental-fsync yes<br>   rdb-save-incremental-fsync yes<br>   配置启动脚本</p><p>   #!/bin/sh</p><h1 id="chkconfig-35-10-90"><a href="#chkconfig-35-10-90" class="headerlink" title="chkconfig: 35 10 90"></a>chkconfig: 35 10 90</h1><p>   #重要！否则chkconfig不能识别开机启动服务项；<br>   #”35”为运行级别，”10”为启动优先级，”90”为关闭优先级<br>   #</p><h1 id="Simple-Redis-init-d-script-conceived-to-work-on-Linux-systems"><a href="#Simple-Redis-init-d-script-conceived-to-work-on-Linux-systems" class="headerlink" title="Simple Redis init.d script conceived to work on Linux systems"></a>Simple Redis init.d script conceived to work on Linux systems</h1><h1 id="as-it-does-use-of-the-proc-filesystem"><a href="#as-it-does-use-of-the-proc-filesystem" class="headerlink" title="as it does use of the /proc filesystem."></a>as it does use of the /proc filesystem.</h1><p>   REDISPORT=6379<br>   EXEC=/opt/redis/bin/redis-server</p><h1 id="CLIEXEC-usr-local-bin-redis-cli"><a href="#CLIEXEC-usr-local-bin-redis-cli" class="headerlink" title="CLIEXEC=/usr/local/bin/redis-cli"></a>CLIEXEC=/usr/local/bin/redis-cli</h1><p>   CLIEXEC=/opt/redis/bin/redis-cli</p><h1 id="PIDFILE-var-run-redis-REDISPORT-pid"><a href="#PIDFILE-var-run-redis-REDISPORT-pid" class="headerlink" title="PIDFILE=/var/run/redis_${REDISPORT}.pid"></a>PIDFILE=/var/run/redis_${REDISPORT}.pid</h1><p>   PIDFILE=/var/run/redis_${REDISPORT}.pid</p><h1 id="CONF-”-etc-redis-REDISPORT-conf”"><a href="#CONF-”-etc-redis-REDISPORT-conf”" class="headerlink" title="CONF=”/etc/redis/${REDISPORT}.conf”"></a>CONF=”/etc/redis/${REDISPORT}.conf”</h1><p>   CONF=”/opt/redis/etc/redis.conf”</p><p>   USER=root            #添加执行用户变量</p><p>   case “$1” in<br>       start)<br>           if [ -f $PIDFILE ]<br>           then<br>                   echo “$PIDFILE exists, process is already running or crashed”<br>           else<br>                   echo “Starting Redis server…”<br>                   $EXEC $CONF</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    if [ ! -f $PIDFILE ]</span><br><span class="line">    then</span><br><span class="line">            echo &quot;$PIDFILE does not exist, process is not running&quot;</span><br><span class="line">    else</span><br><span class="line">            PID&#x3D;$(cat $PIDFILE)</span><br><span class="line">            echo &quot;Stopping ...&quot;</span><br><span class="line">            $CLIEXEC -p $REDISPORT shutdown</span><br><span class="line">            while [ -x &#x2F;proc&#x2F;$&#123;PID&#125; ]</span><br><span class="line">            do</span><br><span class="line">                echo &quot;Waiting for Redis to shutdown ...&quot;</span><br><span class="line">                sleep 1</span><br><span class="line">            done</span><br><span class="line">            echo &quot;Redis stopped&quot;</span><br><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line">restart|force-reload)</span><br><span class="line">            $&#123;0&#125; stop</span><br><span class="line">            $&#123;0&#125; start</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">            echo &quot;Usage: &#x2F;etc&#x2F;init.d&#x2F;redis-server &#123;start|stop|restart|force-reload&#125;&quot; &gt;&amp;2</span><br><span class="line">            exit 1</span><br><span class="line">将脚本放置&#x2F;etc&#x2F;init.d&#x2F;redis-server</span><br></pre></td></tr></table></figure><p>   设置开机自启</p><p>   [root@localhost ~]#chkconfig –add redis-server<br>   [root@localhost ~]#chkconfig –level 35 redis-server on  #默认runlevel 35已打开<br>   1<br>   2<br>   启动脚本设置执行权限</p><p>   [root@localhost ~]#chmod +x /etc/init.d/redis-server<br>   1<br>   启动redis<br>   #可通过启动脚本启动/关闭服务；或采用”service”指令</p><p>   [root@localhost ~]#/etc/init.d/redis-server start<br>   1<br>   创建集群<br>   在5.0之前该工具是由ruby语言编写的redis-trib.rb，在使用前需要安装ruby语言环境。在5.0之后redis摒弃了该工具，将搭建集群的功能合并到了redis-cli上。<br>   这里就可以直接创建集群，不需要在安装其他工具。</p><p>   创建集群需要注意,最少要6个服务,否则创建集群失败.</p><p>   redis-cli –cluster create 110.110.100.35:6379 110.110.100.36:6379 110.110.100.37:6379 110.110.100.38:6379 110.10.1100.39:6379 110.10.100.40:6379 –cluster-replicas 1 -a 123456</p><p>   参数说明<br>   redis-cli 客户端工具<br>   –cluster create 创建一个新的集群<br>   –cluster-replicas 1 每一个主库对应一个从库<br>   -a 数据库密码</p><p>   出现下面的字样说明创建成功</p><p>   [OK] All nodes agree about slots configuration.</p><blockquote><blockquote><blockquote><p>Check for open slots…<br>Check slots coverage…<br>[OK] All 16384 slots covered.<br>1<br>2<br>3<br>4<br>登陆验证</p></blockquote></blockquote></blockquote><p>   redis-cli -c -p 端口<br>   auth 密码</p><p>   删除主节点<br>   redis-cli –cluster reshard 110.110.100.35:6379</p><p>   到这里就搭建完成了</p><p>   搭建过程中有的问题也有记录在异常处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup redis-server &#x2F;opt&#x2F;redis&#x2F;etc&#x2F;redis.conf &amp;</span><br></pre></td></tr></table></figure><table><thead><tr><th>测试端redis6,被测redis5</th><th>单台</th><th>集群</th></tr></thead><tbody><tr><td>redis-benchmark -h 172.20.59.57 -p 6379 –threads 500 -t get -d 500 -c 500 -n 10000000</td><td>137794.19 requests per second</td><td></td></tr><tr><td>redis-benchmark -h 172.20.59.57 -p 6379 –threads 500 -t set -d 500 -c 500 -n 10000000</td><td>132383.70 requests per second</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>测试端redis5,被测redis5</th><th>单台</th><th>集群</th></tr></thead><tbody><tr><td>redis-benchmark -h 172.20.59.57 -p 6379  -t get -d 500 -c 500 -n 10000000</td><td>84317.03 requests per second</td><td></td></tr><tr><td>redis-benchmark -h 172.20.59.57 -p 6379  -t set -d 500 -c 500 -n 10000000</td><td>98796.66 requests per second</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>测试端redis6,被测redis5 物理机</th><th>单台</th><th>集群</th></tr></thead><tbody><tr><td>redis-benchmark -h 172.20.1.30 -p 6379  -t get -d 500 -c 500 -n 10000000</td><td>106834.19 requests per second</td><td></td></tr><tr><td>redis-benchmark -h 172.20.1.30 -p 6379  -t set -d 500 -c 500 -n 10000000</td><td>113291.34 requests per second</td><td></td></tr><tr><td>redis-benchmark -h 172.20.1.30 -p 6379 –threads 500 -t set -d 500 -c 500 -n 10000000</td><td>163041.70 requests per second</td><td></td></tr><tr><td>redis-benchmark -h 172.20.1.30 -p 6379 –threads 500 -t get -d 500 -c 500 -n 10000000</td><td>169396.78 requests per second</td><td></td></tr></tbody></table><table><thead><tr><th></th><th>set(requests per second)</th><th>get(requests per second)</th></tr></thead><tbody><tr><td>物理机（redis5）+测试机（redis6+threads 500）</td><td>163041.70</td><td>169396.78</td></tr><tr><td>物理机（redis5）+测试机（redis6+threads）</td><td>113291.34</td><td>106834.19</td></tr><tr><td>云主机8c8g（redis5）+测试机（redis6+threads 500）</td><td>132383.70</td><td>137794.19</td></tr><tr><td>云主机8c8g（redis5）+测试机（redis6）</td><td>109325.46</td><td>110688.03</td></tr><tr><td>云主机8c8g（redis5）+测试机（redis5）</td><td>98796.66</td><td>84317.03</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">redis-cli --cluster create 172.20.59.83:6379 172.20.59.119:6379 172.20.59.54:6379 172.20.59.59:6379 172.20.59.99:6379 172.20.59.52:6379 --cluster-replicas 1 -a 123456</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmd执行命令卡住了</title>
      <link href="metaverse/batblock/"/>
      <url>metaverse/batblock/</url>
      
        <content type="html"><![CDATA[<p><strong>windows cmd-&gt;属性-&gt;选项-&gt;编辑选项</strong></p><p><strong>取消 快速编辑模式</strong></p><p>cmd默认开启了“快速编辑模式”，只要当鼠标点击cmd任何区域时，就自动进入了编辑模式，之后的程序向控制台输入内容甚至后台的程序都会被阻塞。</p><p>我们在控制台里面回车或者右键鼠标后，自动退出了编辑模式。因此，控制又恢复输出内容，服务端又正常了。</p><p>选择快速编辑模式的时候,鼠标不小心点到cmd某个位置,都可能让正在运行的进程都卡住，直到按下回车后，会跳出一堆。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络查询、嗅探</title>
      <link href="metaverse/netoperate/"/>
      <url>metaverse/netoperate/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h4 id="查自己的公网ip"><a href="#查自己的公网ip" class="headerlink" title="查自己的公网ip"></a>查自己的公网ip</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ curl http://members.3322.org/dyndns/getip</span><br><span class="line">150.118.52.133</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ curl ip.</span><br><span class="line">150.118.52.133</span><br></pre></td></tr></table></figure><h4 id="查询域名的ip地址"><a href="#查询域名的ip地址" class="headerlink" title="查询域名的ip地址"></a>查询域名的ip地址</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ nslookup www.baidu.com</span><br><span class="line">Server:127.0.0.53 #dns服务器</span><br><span class="line">Address:127.0.0.53#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">www.baidu.comcanonical name = www.a.shifen.com.# 域名实际对应的主机名记录</span><br><span class="line">Name:www.a.shifen.com </span><br><span class="line">Address: 150.101.49.12 #域名负载均衡</span><br><span class="line">Name:www.a.shifen.com</span><br><span class="line">Address: 150.101.49.11</span><br></pre></td></tr></table></figure><h4 id="查询目标ip对应的mac地址"><a href="#查询目标ip对应的mac地址" class="headerlink" title="查询目标ip对应的mac地址"></a>查询目标ip对应的mac地址</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用ping获取arp缓存再查找</span></span><br><span class="line">[root@localhost ~]# ping 127.0.1.21 -c 1 &gt;&gt; /dev/null;arp -a 127.0.1.21|awk -F &quot; &quot; &#x27;&#123;print $4&#125;&#x27;</span><br><span class="line">14:02:ec:32:cc:24</span><br></pre></td></tr></table></figure><h4 id="修改网卡mac地址"><a href="#修改网卡mac地址" class="headerlink" title="修改网卡mac地址"></a>修改网卡mac地址</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 hw ether B3:00:00:00:00:A2#临时修改</span><br></pre></td></tr></table></figure><h4 id="嗅探目标ip的信息"><a href="#嗅探目标ip的信息" class="headerlink" title="嗅探目标ip的信息"></a>嗅探目标ip的信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 嗅探目标ip端口开发情况</span></span><br><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ sudo nmap -PS 180.101.49.12</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-20 15:08 CST</span><br><span class="line">Nmap scan report for 180.101.49.12</span><br><span class="line">Host is up (0.0079s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">80/tcp  open  http</span><br><span class="line">443/tcp open  https</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 嗅探目标ip系统信息</span></span><br><span class="line">sudo nmap -O 180.101.49.12</span><br><span class="line">tarting Nmap 7.80 ( https://nmap.org ) at 2021-08-20 14:59 CST</span><br><span class="line">Nmap scan report for 180.101.49.12</span><br><span class="line">Host is up (0.0084s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">80/tcp  open  http</span><br><span class="line">443/tcp open  https</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 2.6.18 - 2.6.22 (92%), D-Link DWL-624+ or DWL-2000AP, or TRENDnet TEW-432BRP WAP (90%), OneAccess 1641 router (90%), 3Com SuperStack 3 Switch 3870 (88%), HP ProCurve 2524 switch or 9100c Digital Sender printer (86%), Blue Coat PacketShaper appliance (86%), Satel ETHM-2 intruder alarm (86%), Apple TV 5.2.1 or 5.3 (86%), AVtech Room Alert 26W environmental monitor (85%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line"></span><br><span class="line">OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.61 seconds</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 扫描整个网段所有ip</span></span><br><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ nmap  172.20.65.0/24</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-20 15:12 CST</span><br><span class="line">Nmap scan report for 172.20.65.50</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"></span><br><span class="line">Nmap scan report for 172.20.65.62</span><br><span class="line">Host is up (0.00022s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">8080/tcp open  http-proxy</span><br><span class="line">8888/tcp open  sun-answerbook</span><br><span class="line"></span><br><span class="line">Nmap scan report for 172.20.65.77</span><br><span class="line">Host is up (0.00023s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"></span><br><span class="line">Nmap scan report for 172.20.65.84</span><br><span class="line">Host is up (0.00046s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">80/tcp  open  http</span><br><span class="line">999/tcp open  garcon</span><br></pre></td></tr></table></figure><h4 id="模拟发包"><a href="#模拟发包" class="headerlink" title="模拟发包"></a>模拟发包</h4><p>使用hping3模拟发包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">-c --count count 发送数据包的次数</span><br><span class="line">-i --interval 包发送间隔时间（单位是毫秒）缺省时间是1秒</span><br><span class="line">-n -nmeric 数字输出，象征性输出主机地址。</span><br><span class="line">-I --interface 网络接口名如eth0。</span><br><span class="line">-v --verbose 显示很多信息，</span><br><span class="line">-D --debug 进入debug模式</span><br><span class="line">-z --bind 快捷键的使用。</span><br><span class="line">-Z --unbind 消除快捷键。</span><br><span class="line">-O --rawip RAWIP模式，在此模式下HPING会发送带数据的IP头。</span><br><span class="line">-1 --icmp ICMP模式，此模式下HPING会发送IGMP应答报，你可以用--ICMPTYPE --ICMPCODE选项发送其他类型/模式的ICMP报文。</span><br><span class="line">-2 --udp UDP 模式，缺省下，HPING会发送UDP报文到主机的0端口，你可以用--baseport --destport --keep选项指定其模式。</span><br><span class="line">-9 --listen signatuer hping的listen模式，用此模式，HPING会接收指定的数据。</span><br><span class="line">-a --spoof hostname 伪造IP攻击，防火墙就不会记录你的真实IP了，当然回应的包你也接收不到了。</span><br><span class="line">-t --ttl time to live 可以指定发出包的TTL值。</span><br><span class="line">-H --ipproto 在RAW IP模式里选择IP协议。</span><br><span class="line">-w --WINID UNIX ,WINDIWS的id回应不同的，这选项可以让你的ID回应和WINDOWS一样。</span><br><span class="line">-r --rel 更改ID的，可以让ID曾递减输出，详见HPING-HOWTO。</span><br><span class="line">-F --FRAG 更改包的FRAG，这可以测试对方对于包碎片的处理能力，缺省的“virtual mtu”是16字节。</span><br><span class="line">-x --morefrag 此功能可以发送碎片使主机忙于恢复碎片而造成主机的拒绝服务。</span><br><span class="line">-y -dontfrag 发送不可恢复的IP碎片，这可以让你了解更多的MTU PATH DISCOVERY。</span><br><span class="line">-G --fragoff fragment offset value set the fragment offset</span><br><span class="line">-m --mtu mtu value 用此项后ID数值变得很大，50000没指定此项时3000-20000左右。</span><br><span class="line">-G --rroute 记录路由，可以看到详悉的数据等等，最多可以经过9个路由，即使主机屏蔽了ICMP报文</span><br><span class="line">-C --ICMPTYPE type 指定ICMP类型，缺省是ICMP echo REQUEST</span><br><span class="line">-K --ICMPCODE CODE 指定ICMP代号，缺省0</span><br><span class="line">--icmp-ipver 把IP版本也插入IP头</span><br><span class="line">--icmp-iphlen 设置IP头的长度，缺省为5（32字节）</span><br><span class="line">--icmp-iplen 设置IP包长度</span><br><span class="line">-s --baseport source port hping 用源端口猜测回应的包</span><br><span class="line">-p --deskport [+][+]desk port 设置目标端口，缺省为0，一个加号设置为:每发送一个请求包到达后，端口加1，两个加号为：每发一个包，端口数加1</span><br><span class="line">-w --win 发windows包，64BYTE</span><br><span class="line">-O --tcpoff 设置tcp偏移</span><br><span class="line">-m --tcpseq 设置TCP序列数</span><br><span class="line">-l --tcpck 设置TCP ack</span><br><span class="line">-Q --seqnum 搜集序列号</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是不经意传输</title>
      <link href="metaverse/otprotocol/"/>
      <url>metaverse/otprotocol/</url>
      
        <content type="html"><![CDATA[<h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>不经意传输（Oblivious Transfer，OT）指发送方发送了许多信息中的其中一个给接收方，但是发送方不知道接收方接受的是哪一个信息</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>不经意传输是密码学的一类协议。</p><ol><li><p>不经意传输的第一种形式是由Michael Oser Rabin(1976年图灵奖-非确定自动机),这种形式的不经意传输发送方会有 1/2 的概率将消息发送给接收方，而发送方不知道接收方是否接收到该消息,传输方案基于RSA加密算法</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211011/1633944256v2-770e7258668450e33a53bc510a14fc83_1440w.jpg" alt="img"></p></li><li><p>1-2不经意传输(1-n不经意传输)是一种更为常用的不经意传输方案，这种方案被Oded Goldreich、Abraham Lempel和Shimon Even发展成为安全多方计算协议，在这种协议下用户仅能获得数据库中的一个元素，而服务器不知道用户查询了哪一个元素。不经意传输是私有信息检索的加强版本。</p></li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211011/1633944253v2-4f565ca6dc1d08e72721030b8d8698d6_1440w.jpg" alt="img"></p> <iframe   height=850  width=90%  src="https://longtao.fun/ppt/%E5%A7%9A%E6%9C%9F%E6%99%BA.html"   frameborder=0   allowfullscreen> </iframe>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 密码学 </tag>
            
            <tag> 图灵奖 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>获取系统信息</title>
      <link href="metaverse/linuxinfo/"/>
      <url>metaverse/linuxinfo/</url>
      
        <content type="html"><![CDATA[<h3 id="版本信息"><a href="#版本信息" class="headerlink" title="版本信息"></a>版本信息</h3><h4 id="uname工具"><a href="#uname工具" class="headerlink" title="uname工具"></a>uname工具</h4><p>uname工具是对sys/utsname函数的一个封装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-a或--all：显示全部的信息；</span><br><span class="line">-m或--machine：显示电脑类型；</span><br><span class="line">-n或-nodename：显示在网络上的主机名称；</span><br><span class="line">-r或--release：显示操作系统的发行编号；</span><br><span class="line">-s或--sysname：显示操作系统名称；</span><br><span class="line">-v：显示操作系统的版本；</span><br><span class="line">-p或--processor：输出处理器类型或&quot;unknown&quot;；</span><br><span class="line">-i或--hardware-platform：输出硬件平台或&quot;unknown&quot;；</span><br><span class="line">-o或--operating-system：输出操作系统名称；</span><br></pre></td></tr></table></figure><p>简单实例如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sys/utsname.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">utsname</span> <span class="title">uts</span>;</span></span><br><span class="line">    <span class="comment">/* Put information about the system in NAME.  */</span></span><br><span class="line">    uname(&amp;uts);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name=%s\n&quot;</span>,uts.sysname);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;version=%s\n&quot;</span>,uts.version);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;release=%s\n&quot;</span>,uts.release);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;nodename=%s\n&quot;</span>,uts.nodename);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;machine=%s\n&quot;</span>,uts.machine);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**out：</span></span><br><span class="line"><span class="comment">    name=Linux</span></span><br><span class="line"><span class="comment">version=#29~20.04.1-Ubuntu SMP Mon Aug 01 20:58:17 UTC 2021</span></span><br><span class="line"><span class="comment">release=5.11.0-27-generic</span></span><br><span class="line"><span class="comment">nodename=longtaoXiaoXinPro13-2020</span></span><br><span class="line"><span class="comment">machine=x86_64 </span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><p>utsname结构体如下,如果定义了_GNU_SOURCE还可以再打印个domainname</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">utsname</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="comment">/* Name of the implementation of the operating system.  */</span></span><br><span class="line">    <span class="keyword">char</span> sysname[_UTSNAME_SYSNAME_LENGTH];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Name of this node on the network.  */</span></span><br><span class="line">    <span class="keyword">char</span> nodename[_UTSNAME_NODENAME_LENGTH];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Current release level of this implementation.  */</span></span><br><span class="line">    <span class="keyword">char</span> release[_UTSNAME_RELEASE_LENGTH];</span><br><span class="line">    <span class="comment">/* Current version level of this release.  */</span></span><br><span class="line">    <span class="keyword">char</span> version[_UTSNAME_VERSION_LENGTH];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Name of the hardware type the system is running on.  */</span></span><br><span class="line">    <span class="keyword">char</span> machine[_UTSNAME_MACHINE_LENGTH];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> _UTSNAME_DOMAIN_LENGTH - 0</span></span><br><span class="line">    <span class="comment">/* Name of the domain of this node on the network.  */</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">ifdef</span> __USE_GNU</span></span><br><span class="line">    <span class="keyword">char</span> domainname[_UTSNAME_DOMAIN_LENGTH];</span><br><span class="line"><span class="meta"># <span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">char</span> __domainname[_UTSNAME_DOMAIN_LENGTH];</span><br><span class="line"><span class="meta"># <span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h4 id="通过文件查看"><a href="#通过文件查看" class="headerlink" title="通过文件查看"></a>通过文件查看</h4><h5 id="内核信息"><a href="#内核信息" class="headerlink" title="内核信息"></a>内核信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;version</span><br></pre></td></tr></table></figure><h5 id="发行信息"><a href="#发行信息" class="headerlink" title="发行信息"></a>发行信息</h5><p>简要</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;issue</span><br></pre></td></tr></table></figure><p>完整</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;*-release</span><br></pre></td></tr></table></figure><h5 id="CPU信息"><a href="#CPU信息" class="headerlink" title="CPU信息"></a>CPU信息</h5><p>lscpu命令或</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;cpuinfo</span><br></pre></td></tr></table></figure><p>除此之外还可以获取一些其他信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ ls /proc|grep info</span><br><span class="line">buddyinfo </span><br><span class="line">cpuinfo</span><br><span class="line">meminfo</span><br><span class="line">pagetypeinfo</span><br><span class="line">slabinfo</span><br><span class="line">vmallocinfo</span><br><span class="line">zoneinfo</span><br></pre></td></tr></table></figure><h5 id="内存信息"><a href="#内存信息" class="headerlink" title="内存信息"></a>内存信息</h5><p>lsmem命令或者</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;memeinfo</span><br></pre></td></tr></table></figure><h5 id="其他信息"><a href="#其他信息" class="headerlink" title="其他信息"></a>其他信息</h5><p>buddyindo物理内存debug信息，lunux使用buddy算法解决物理内存的碎片问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">longtao@longtaoXiaoXinPro13-2020:~$ cat /proc/buddyinfo </span><br><span class="line">Node 0, zone      DMA      1      0      0      1      2      1      1      0      1      2      2 </span><br><span class="line">Node 0, zone    DMA32   2261   1007    541    301    455    234     60     24     12      4    321 </span><br><span class="line">Node 0, zone   Normal   1120    593    346    660    116     36     32      6      5      4      1</span><br></pre></td></tr></table></figure><p>zoneinfo显示内存空间的统计信息，对分析虚拟内存行为很有用</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>幽灵熔断</title>
      <link href="metaverse/meltdownspectre/"/>
      <url>metaverse/meltdownspectre/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><p>Meltdown/Spectre被发现于2018年, 是很有影响力的cpu漏洞。</p><p>Meltdown（熔断）对应编号恶意数据缓存加载 CVE-2017-5754 。</p><p>Spectre （幽灵）对应编号边界检查绕过 CVE-2017-5753 、分支目标注入 CVE-2017-5715 。</p><p>Meltdown 影响几乎所有的 Intel CPU（从1995年起）以及部分 ARM CPU。 Spectre 拥有更广的影响范围，在 Meltdown 的情况下，恶意程序可读取某些自身无权限访问的数据。利用此漏洞低权限用户可以访问到本身无权限访问的内容，例如用户密码、加密密钥。</p><p>Spectre 恶意利用程序，可导致用户的帐号、密码泄漏。在公共云服务器上，可能打破界限，从一台虚拟机器获取到另一个用户的权限。</p><h3 id="名词"><a href="#名词" class="headerlink" title="名词"></a>名词</h3><p>指令周期：CPU取出一条指令并执行该指令所需的时间称为指令周期，指令周期的长短与指令的复杂程度有关，一般多个CPU周期组成指令周期。</p><p>CPU周期：又称机器周期，通常用从主存读取一条指令的最短时间来规定CPU周期，一般多个时钟周期组成CPU周期</p><p>时钟周期：时钟周期是处理操作的最基本时间单位，由机器的主频决定（超到20GHZ，全人类感谢你）</p><h3 id="CPU的执行"><a href="#CPU的执行" class="headerlink" title="CPU的执行"></a>CPU的执行</h3><h4 id="基本过程"><a href="#基本过程" class="headerlink" title="基本过程"></a>基本过程</h4><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092843-4-257058.jpg" alt="img"></p><p>cpu一般按照 取指令–&gt;指令译码—&gt;指令执行–&gt;存储访问–&gt;写回</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">取指令 --&gt; 指令译码;</span><br><span class="line">指令译码--&gt;指令执行;</span><br><span class="line">指令执行--&gt;存储访问;</span><br><span class="line">存储访问--&gt;写回;</span><br></pre></td></tr></table></figure><p> 取指令:Instruction Fetch,从存储器取指令到CPU</p><p>指令译码:Instruction Decode，对取回的指令进行拆分和解释，识别和区分出不同的指令类别及各种获取操作数的方法</p><p>指令执行:Instruction Execute，使用硬件功能单元执行指令，最常见功能单元为算术逻辑部件运算器（Arithmetic Logical Unit，ALU）</p><p>存储访问:Memory Access，根据指令需要，有可能要访问主存，读取操作数，具体见下表</p><table><thead><tr><th>方式</th><th>算法</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>隐含寻址</td><td>默认操作数地址</td><td>不访存</td><td>数据范围受限</td></tr><tr><td>立即寻址</td><td>D = A</td><td>不访存</td><td>操作数值范围受限</td></tr><tr><td>直接寻址</td><td>EA = A</td><td>简单</td><td>地址范围受限</td></tr><tr><td>间接寻址</td><td>EA = (A)</td><td>地址范围大</td><td>多次访存</td></tr><tr><td>寄存器寻址</td><td>EA = R</td><td>不访存</td><td>地址范围受限</td></tr><tr><td>寄存器间接寻址</td><td>EA = ®</td><td>地址范围大</td><td>访存</td></tr><tr><td>偏移寻址</td><td>EA = A + ®</td><td>灵活</td><td>复杂</td></tr><tr><td>段寻址</td><td>EA = A + ®</td><td>灵活</td><td>复杂</td></tr><tr><td>堆栈寻址</td><td>EA = SP</td><td>不访存</td><td>应用受限</td></tr></tbody></table><p>写回:把执行指令阶段的运行结果数据“写回”到某种存储形式，经常是写到cpu内部寄存器以便下次快速使用</p><h4 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h4><p>若处理器无流水线结构，一条指令执行一般需要五个处理器周期；流水线使用锁存器（latch，用来缓存电信号）让不同指令的各步操作重叠，从而实现多条指令在不同周期并行处理，只执行一条指令的话，流水线不会提高效率。</p><h4 id="分支预测"><a href="#分支预测" class="headerlink" title="分支预测"></a>分支预测</h4><p>流水线架构对顺序执行的命令，性能提升明显，但遇到命令跳转（goto系列等）就会性能降低，那么就出现了分支预测期，提前把预测到的指令存入流水线，分支跳转指令完成后如果预测正确，流水线正常运行，若错误，清空流水线然后执行正确的指令</p><h4 id="乱序执行"><a href="#乱序执行" class="headerlink" title="乱序执行"></a>乱序执行</h4><p>打乱程序原本的执行顺序（类似上层使用异步，编译器也会乱序执行）</p><p>cpu的乱序执行一般都使用Tomasulo算法，包括</p><ul><li>Common Data Bus (CDB).</li><li>Unified Reservation Station (Scheduler).</li><li>Register Renaming (Reorder Buffer).</li></ul><p>该算法虽然是乱序执行, 但是会顺序完成 (retire), 只有在retire后它的输出才会architectually visible (简单地说, 不影响程序逻辑), 但是没有architectually visible不等于没有影响, 当输出更新到reservation station后, 因为cdb的存在, 其他指令已经可以读到. 另外, 非常重要的一点, 异常只有在指令retire的时候才会触发, 对于上面的例子, 即使cpu已经检查到第一条指令没有访问权限, 也只能等到该指令retire时才会触发, 取决于该指令在ROB的位置, 可能马上触发也可能很久之后, ROB容量可以很容易做到比如192这个级别.</p><h3 id="熔断漏洞（利用乱序执行）"><a href="#熔断漏洞（利用乱序执行）" class="headerlink" title="熔断漏洞（利用乱序执行）"></a>熔断漏洞（利用乱序执行）</h3><p>cpu在执行A语句的同时将B语句中的内存位置的信息加载到cache中，这个加载的过程忽略了权限的判断之后再执行B、C语句，在执行B语句时发现并没有权限，所以放弃乱序执行的结果，回滚到最初的状态依次执行。此时cache中的信息没有还原。之后通过边信道攻击来测试数据，发现对于某一个数据的访问要远远快于其他数据的访问，那么就可推断数据在cache中，并且可以反推回它的内存地址。</p><h3 id="幽灵漏洞（利用分支预测）"><a href="#幽灵漏洞（利用分支预测）" class="headerlink" title="幽灵漏洞（利用分支预测）"></a>幽灵漏洞（利用分支预测）</h3><p>和熔断差不多，比如if else 中，提前预测某一条，预测错误，状态回滚，边信道攻击，反推内存地址</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>打补丁，关闭乱序执行、分支预测，不过个人电脑建议别关，关了会影响性能。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内置库re</title>
      <link href="metaverse/re/"/>
      <url>metaverse/re/</url>
      
        <content type="html"><![CDATA[<p>re是python中的正则表达式内置库</p><table><thead><tr><th>修饰符</th><th>描述</th></tr></thead><tbody><tr><td>re.I</td><td>IGNORECASE，忽略大小写</td></tr><tr><td>re.L</td><td>LOCALE，只对8位字节有效，不建议使用，由当前语言区域决定 <code>\w</code>, <code>\W</code>, <code>\b</code>, <code>\B</code> 和大小写敏感匹配</td></tr><tr><td>re.U</td><td>UNICODE，根据Unicode字符集解析字符。由当前语言区域决定 <code>\w</code>, <code>\W</code>, <code>\b</code>, <code>\B</code> 和大小写敏感匹配</td></tr><tr><td>re.M</td><td>MULTILINE，多行匹配，影响 ^ 和 $</td></tr><tr><td>re.S</td><td>DOTALL，.可以匹配除换行符外所有内容</td></tr><tr><td>re.X</td><td>VERBOSE，忽略空格和注释</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DOS与DDOS</title>
      <link href="metaverse/dosandddos/"/>
      <url>metaverse/dosandddos/</url>
      
        <content type="html"><![CDATA[<p>　TCP报头中一共有六个标志位：URG/ACK/PSH/RST/SYN/FIN。<br>SYN<br>　　表示建立一个方向的连接。<br>ACK<br>　　收到数据或请求后发送响应时发送ACK报文。<br>RST<br>　　关闭异常连接<br>FIN<br>　　表示关闭连接 　<br>PSH<br>　　　发送端需要发送一段数据，这个数据需要接收端一收到就进行向上交付。而接收端在收到PSH标志位有效的数据时，迅速将数据交付给应用层。所以PSH又叫急迫比特。<br>　　　但是现在已经不需要将数据交付给应用层了，因为这些效果在TCP栈已经可以自行处理这些问题了。<br>URG<br>　　URG成为紧急指针，意为URG位有效的数据包，是一个紧急需要处理的数据包，需要接收端在接收到之后迅速处理。</p><p>dos全称是denial of service，dos攻击是使目标计算机或网络无法提供正常服务(拒绝服务)</p><p>产生dos攻击效果的方式有很多</p><p>syn攻击</p><p>半连接攻击，向服务器端连续发送大量只有SYN标志的TCP链接请求，服务器会吧这些半连接排到链接缓冲区(Backlog queue)中，缓冲区满，无法接受新的请求，其他合法用户的请求就会被拒绝</p><p>rst攻击</p><p>自己攻击自己</p><p>消耗资源攻击(带宽、磁盘等)</p><p>泛洪攻击(flood)发送大量报文syc、ack、rst、udp、icmp、dns、http/https等</p><p>反射攻击，伪装成被攻击对象向其它机器发送请求，其他机器响应请求，发送大量报文给攻击目标，从而早成攻击目标的性能耗尽一般用udp报文，因为udp的响应报文比请求报文更大，能实现攻击流量放大的作用</p><p>畸形报文攻击</p><p>发送大量有缺陷或者特殊控制作用的报文，造成主机处理报文时系统崩溃</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内存超分原理</title>
      <link href="metaverse/memoryoverscore/"/>
      <url>metaverse/memoryoverscore/</url>
      
        <content type="html"><![CDATA[<p>KVM中内存也是允许过载使用（over-commit）的，KVM能够让分配给客户机的内存总数大于实际可用的物理内存总数。由于客户机操作系统及其上的应用程序并非一直100%地利用其分配到的内存，而且宿主机上的多个客户机一般也不会同时达到100%的内存使用率，所以内存过载分配是可行的。一般来说，有如下三种方式来实现内存的过载使用。</p><ol><li>内存交换（swapping）：用交换空间（swap space）来弥补内存的不足。</li><li>气球（ballooning）：通过virio_balloon驱动来实现宿主机Hypervisor和客户机之间的协作来完成。</li><li>页共享（page sharing）：通过KSM（Kernel Samepage Merging）合并多个客户机进程使用的相同内存页。</li></ol><p>其中，第一种内存交换的方式是最成熟的（Linux中很早就开始应用），也是目前被广泛使用的，不过，它相比于KSM和ballooning的方式效率较为低一些。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SYN攻击</title>
      <link href="metaverse/synattack/"/>
      <url>metaverse/synattack/</url>
      
        <content type="html"><![CDATA[<p>SYN：同步序列编号（***Synchronize Sequence Numbers***）。</p><p>是TCP/IP建立连接时使用的握手信号。在客户机和<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8/100571">服务器</a>之间建立正常的TCP网络连接时，客户机首先发出一个SYN消息，服务器使用SYN+ACK应答表示接收到了这个消息，最后客户机再以<a href="https://baike.baidu.com/item/ACK/3692629">ACK</a>消息响应。这样在<a href="https://baike.baidu.com/item/%E5%AE%A2%E6%88%B7%E6%9C%BA/5168153">客户机</a>和服务器之间才能建立起可靠的TCP连接，数据才可以在客户机和服务器之间传递</p><h3 id="TCP报文首部"><a href="#TCP报文首部" class="headerlink" title="TCP报文首部"></a>TCP报文首部</h3><p>TCP把连接作为最基本的对象，每一条TCP连接都有两个端点，这种端点我们叫作套接字（socket），它的定义为端口号拼接到IP地址即构成了套接字，例如，若IP地址为192.3.4.16 而端口号为80，那么得到的套接字为192.3.4.16:80。</p><ol><li>源端口和目的端口，各占2个字节，分别写入源端口和目的端口；</li><li>序号，占4个字节，TCP连接中传送的字节流中的每个字节都按顺序编号。例如，一段报文的序号字段值是 301 ，而携带的数据共有100字段，显然下一个报文段（如果还有的话）的数据序号应该从401开始；</li><li>确认号，占4个字节，是期望收到对方下一个报文的第一个数据字节的序号。例如，B收到了A发送过来的报文，其序列号字段是501，而数据长度是200字节，这表明B正确的收到了A发送的到序号700为止的数据。因此，B期望收到A的下一个数据序号是701，于是B在发送给A的确认报文段中把确认号置为701；</li><li>数据偏移，占4位，它指出TCP报文的数据距离TCP报文段的起始处有多远；</li><li>保留，占6位，保留今后使用，但目前应都位0；</li><li>紧急URG，当URG=1，表明紧急指针字段有效。告诉系统此报文段中有紧急数据；</li><li>确认ACK，仅当ACK=1时，确认号字段才有效。TCP规定，在连接建立后所有报文的传输都必须把ACK置1；</li><li>推送PSH，当两个应用进程进行交互式通信时，有时在一端的应用进程希望在键入一个命令后立即就能收到对方的响应，这时候就将PSH=1；</li><li>复位RST，当RST=1，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立连接；</li><li>同步SYN，在连接建立时用来同步序号。当SYN=1，ACK=0，表明是连接请求报文，若同意连接，则响应报文中应该使SYN=1，ACK=1；</li><li>终止FIN，用来释放连接。当FIN=1，表明此报文的发送方的数据已经发送完毕，并且要求释放；</li><li>窗口，占2字节，指的是通知接收方，发送本报文你需要有多大的空间来接受；</li><li>检验和，占2字节，校验首部和数据这两部分；</li><li>紧急指针，占2字节，指出本报文段中的紧急数据的字节数；</li><li>选项，长度可变，定义一些其他的可选的参数。</li></ol><h3 id="TCP连接的建立（三次握手）"><a href="#TCP连接的建立（三次握手）" class="headerlink" title="TCP连接的建立（三次握手）"></a>TCP连接的建立（三次握手）</h3><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635171424format,png" alt="三次握手"></p><ol><li>TCP服务器进程先创建传输控制块TCB，时刻准备接受客户进程的连接请求，此时服务器就进入了LISTEN（监听）状态；</li><li>TCP客户进程也是先创建传输控制块TCB，然后向服务器发出连接请求报文，这是报文首部中的同部位SYN=1，同时选择一个初始序列号 seq=x ，此时，TCP客户端进程进入了 SYN-SENT（同步已发送状态）状态。TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。</li><li>TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 ACK=1，SYN=1，确认号是ack=x+1，同时也要为自己初始化一个序列号 seq=y，此时，TCP服务器进程进入了SYN-RCVD（同步收到）状态。这个报文也不能携带数据，但是同样要消耗一个序号。</li><li>TCP客户进程收到确认后，还要向服务器给出确认。确认报文的ACK=1，ack=y+1，自己的序列号seq=x+1，此时，TCP连接建立，客户端进入ESTABLISHED（已建立连接）状态。TCP规定，ACK报文段可以携带数据，但是如果不携带数据则不消耗序号。</li><li>当服务器收到客户端的确认后也进入ESTABLISHED状态，此后双方就可以开始通信了。</li></ol><p><strong>必须三次握手的原因：</strong>双方必须确认对方正确知道对方的seq序号并以ack返回</p><h3 id="TCP连接的释放（四次挥手）"><a href="#TCP连接的释放（四次挥手）" class="headerlink" title="TCP连接的释放（四次挥手）"></a>TCP连接的释放（四次挥手）</h3><p><img src= "/img/loading.gif" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwNjA2MDg0ODUxMjcy?x-oss-process=image/format,png" alt="四次挥手"></p><ol><li>客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。</li><li>服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。</li><li>客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。</li><li>服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。</li><li>客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗ *∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。</li><li>服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</li></ol><p><strong>point：</strong></p><ol><li>服务端和客户端都可以主动断开连接</li><li>在收到FIN包，只是发送方这边不再发送数据了，但是接收方可能还有数据在发送给发送方，所以此时不能直接断开连接，也因此不能立马发送FIN包。</li><li><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635171435tcp-three-way-handshake-and-syn-flood-attack.png" alt="See the source image"></li></ol><p>author:longtao.wu</p><p>blog:<a href="http://www.longtao.fun/">www.longtao.fun</a></p><p><strong>refrence：</strong></p><ol><li><a href="https://github.com/zhengweikeng/blog/blob/master/posts/2016/tcp%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E4%B8%8E%E9%87%8A%E6%94%BE.md">https://github.com/zhengweikeng/blog/blob/master/posts/2016/tcp%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E4%B8%8E%E9%87%8A%E6%94%BE.md</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网卡驱动</title>
      <link href="metaverse/nicdriver/"/>
      <url>metaverse/nicdriver/</url>
      
        <content type="html"><![CDATA[<p>驱动程序（Device Driver）全称为“设备驱动程序”，是一种可以使计算机中央处理器——CPU控制和使用设备的特殊程序，相当于硬件的接口，操作系统通过这个接口，控制硬件设备的工作。</p><p>网卡设备与字符设备和块设备不同， 网络设备并不对应于/dev目录下的文件,不过会存放在/sys/class/net目录下</p><p>Linux系统对网络设备驱动定义了4个层次， 这4个层次到下分为:</p><p>网络协议接口层:</p><p>实现统一的数据包收发的协议,该层主要负责调用dev_queue_xmit()函数发送数据， netif_rx()函数接收数据</p><p>网络设备接口层:</p><p>通过net_device结构体来描述一个具体的网络设备的信息,实现不同的硬件的统一</p><p>设备驱动功能层：</p><p>用来负责驱动网络设备硬件来完成各个功能, 它通过hard_start_xmit() 函数启动发送操作， 并通过网络设备上的中断触发接收操作,</p><p>网络设备与媒介层：</p><p>用来负责完成数据包发送和接收的物理实体, 设备驱动功能层的函数都在这物理上驱动的</p><p><strong>层次结构如下图所示:</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/16351712071182576-20171031190853498-1599050801.png" alt="img"></p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635171258170855_4Tcf_3260790.png" alt="See the source image"></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内置库os</title>
      <link href="metaverse/import/"/>
      <url>metaverse/import/</url>
      
        <content type="html"><![CDATA[<p>一个 <a href="https://docs.python.org/zh-cn/3/glossary.html#term-module">module</a> 内的 Python 代码通过 <a href="https://docs.python.org/zh-cn/3/glossary.html#term-importing">importing</a> 操作就能够访问另一个模块内的代码。 <a href="https://docs.python.org/zh-cn/3/reference/simple_stmts.html#import"><code>import</code></a> 语句是发起调用导入机制的最常用方式，但不是唯一的方式。 <a href="https://docs.python.org/zh-cn/3/library/importlib.html#importlib.import_module"><code>importlib.import_module()</code></a> 以及内置的 <a href="https://docs.python.org/zh-cn/3/library/functions.html#import__"><code>__import__()</code></a> 等函数也可以被用来发起调用导入机制。</p><p><a href="https://docs.python.org/zh-cn/3/reference/simple_stmts.html#import"><code>import</code></a> 语句结合了两个操作；它先搜索指定名称的模块，然后将搜索结果绑定到当前作用域中的名称。 <code>import</code> 语句的搜索操作被定义为对 <a href="https://docs.python.org/zh-cn/3/library/functions.html#import__"><code>__import__()</code></a> 函数的调用并带有适当的参数。 <a href="https://docs.python.org/zh-cn/3/library/functions.html#import__"><code>__import__()</code></a> 的返回值会被用于执行 <code>import</code> 语句的名称绑定操作。 请参阅 <code>import</code> 语句了解名称绑定操作的更多细节。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ol><li>py2和py3在import时即使没有使用，也会初始化import的module文件</li><li>在import文件初始化时，会对类属性进行初始化！</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内置库os</title>
      <link href="metaverse/os/"/>
      <url>metaverse/os/</url>
      
        <content type="html"><![CDATA[<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listdir(path: AnyStr) -&gt; List[AnyStr] #列出目录下所有文件和文件夹</span><br></pre></td></tr></table></figure><p>os.sep与os.path.sep</p><p>根据系统返回分隔符，os.path对于文件路径更健壮</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vlan和vxlan</title>
      <link href="metaverse/vlanandvxlan/"/>
      <url>metaverse/vlanandvxlan/</url>
      
        <content type="html"><![CDATA[<h1 id="vlan"><a href="#vlan" class="headerlink" title="vlan"></a>vlan</h1><p>VLAN(Virtual LAN)，翻译成中文是“虚拟局域网”。LAN可以是由少数几台家用计算机构成的网络，也可以是数以百计的计算机构成的企业网络。VLAN所指的LAN特指使用路由器分割的网络——也就是广播域。</p><p>vlan被创建后，应将交换机端口分配给vlan，以此使得接入该端口的电脑属于该vlan，需要使用该vlan所属的网络IP。</p><p> 广播风暴防范<br>限制网络上bai的广播，将网络划分为多个VLAN可减少参与广播风暴的设备数量。LAN分段可以防止广播风暴波及整个网络。VLAN可以提供建立防火墙的机制，防止交换网络的过量广播。使用VLAN，可以将某个交换端口或用户赋于某一个特定的VLAN组，该VLAN组可以在一个交换网中或跨接多个交换机，在一个VLAN中的广播不会送到VLAN之外。同样，相邻的端口不会收到其他VLAN产生的广 播。这样可以减少广播流量，释放带宽给用户应用，减少广播的产生。<br>2. 安全<br>　　增强局域网的安全性，含有敏感数据的用户组可与网络的其余部分隔离，从而降低泄露机密信息的可能性。不同VLAN内的报文在传输时是相互隔离的，即一个VLAN内的用户不能和其它VLAN内的用户直接通信，如果不同VLAN要进行通信，则需要通过路由器或三层交换机等三层设备。<br>　　　　　　　　3.成本降低<br>　　　　　　　　　　成本高昂的网络升级需求减少，现有带宽和上行链路的利用率更高，因此可节约成本。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>proc目录解析</title>
      <link href="metaverse/proc/"/>
      <url>metaverse/proc/</url>
      
        <content type="html"><![CDATA[<p>在linux中，proc是一个伪文件系统，提供了访问内核数据的一些方法</p><p>proc中PID目录存有进程的一些信息</p><h2 id="pid目录ls"><a href="#pid目录ls" class="headerlink" title="pid目录ls"></a>pid目录ls</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">root@longtaoXiaoXinPro13-2020#</span><span class="bash"> ls /proc/1</span></span><br><span class="line">arch_status         cwd        mem            patch_state   stat</span><br><span class="line">attr                environ    mountinfo      personality   statm</span><br><span class="line">autogroup           exe        mounts         projid_map    status</span><br><span class="line">auxv                fd         mountstats     root          syscall</span><br><span class="line">cgroup              fdinfo     net            sched         task</span><br><span class="line">clear_refs          gid_map    ns             schedstat     timens_offsets</span><br><span class="line">cmdline             io         numa_maps      sessionid     timers</span><br><span class="line">comm                limits     oom_adj        setgroups     timerslack_ns</span><br><span class="line">coredump_filter     loginuid   oom_score      smaps         uid_map</span><br><span class="line">cpu_resctrl_groups  map_files  oom_score_adj  smaps_rollup  wchan</span><br><span class="line">cpuset              maps       pagemap        stack</span><br></pre></td></tr></table></figure><h4 id="attr"><a href="#attr" class="headerlink" title="attr"></a>attr</h4><p>目录， 可读可写，安全相关的一些属性，用来支持安全模块，如SELinux等</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls /proc/1/attr</span></span><br><span class="line"><span class="meta">apparmor#</span></span><br><span class="line"><span class="bash">current<span class="comment">#当前安全属性</span></span></span><br><span class="line"><span class="meta">exec#</span><span class="bash">执行execve时设置的安全属性</span></span><br><span class="line"><span class="meta">keycreate#</span><span class="bash"> add_key时设置属性</span>  </span><br><span class="line"><span class="meta">smack#</span></span><br><span class="line"><span class="bash">context<span class="comment">#</span></span>   </span><br><span class="line"><span class="meta">display#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">fscreate#</span><span class="bash"> </span> </span><br><span class="line"><span class="meta">prev#</span><span class="bash"> </span> </span><br><span class="line"><span class="meta">sockcreate#</span></span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VirtioSCSI和virtioBLK</title>
      <link href="metaverse/virtioscsiandvirtioblk/"/>
      <url>metaverse/virtioscsiandvirtioblk/</url>
      
        <content type="html"><![CDATA[<p><strong>qemu对设备的模拟可以分成两类：全模拟和半模拟。全模拟即完全模拟物理设备的工作过程，使得运行在虚拟机上的软件完全感知不到自身运行环境的差异</strong>。例如qemu中实现了对IDE磁盘、LSI控制器(其上可接SCSI磁盘)等物理存储设备的模拟，原先运行在物理机上的IDE驱动、LSI驱动或应用程序不做任何改动即可运行在虚拟机中。因此，<strong>全模拟的优点比较明显，即不用提供专门针对虚拟化场景的设备驱动，完全可以复用物理环境下的驱动程序。那么全模拟有何缺点呢？全模拟时，虚拟机内部驱动会频繁访问虚拟机IO端口，KVM平台下会导致大量的陷入和陷出操作；另外虚拟机内外数据传输时只能通过以字节为单位的拷贝方式进行，无法直接采用共享内存的方式，因此存在较大的访问性能问题</strong>。</p><p>为解决全虚拟化在性能上的问题，半模拟技术应运而生。它构造了一种虚拟化环境所独有的存储设备，因此<strong>半虚拟化需要在虚拟机内部安装特定的驱动程序才能正常驱使该设备进行工作。通常我们称**虚拟机内部的驱动为前端驱动**，称**负责实现其功能模拟的程序(KVM平台下即为qemu程序)为后端程序*<strong>*，**半模拟技术也常常被叫做前后端技术</strong>。**采用半摸拟技术后，配合前端驱动，虚拟化设备完全可以采用全新的事件通知和数据传递机制进而大幅提升性能， 例如在virtio-blk磁盘中，采用io_event_fd进行前端到后端通知，采用中断注入方式实现后端到前端的通知，并通过IO环(vring)进行数据的共享</strong>。至此，主要说明了virtio-blk产生的背景及其价值。附上qemu所模拟的PC(基于intel i440fx主板架构)的组成结构图，以作为后续深入分析的基础。</p><p>virtio-scsi和virtio-blk都是磁盘的半虚拟化驱动，virtio-scsi解决了virtio-blk的一些限制。</p><p>virtio scsi hba取代virtio blk，这是一种简单的高性能准虚拟化存储设备。然而，<strong>virtio blk的设计固有的局限性如下</strong>：</p><ul><li>•virtio blk的范围有限，这使得新的命令实现变得复杂。每次开发一个新命令时，virtio blk驱动程序都必须在每个客户机中更新。</li><li>•<strong>virtio blk将PCI功能和存储设备映射为1:1，限制了可扩展性</strong>。</li><li>•<strong>virtio blk不是真正的SCSI设备。这会导致一些应用程序在从物理机移动到虚拟机时中断。</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中断</title>
      <link href="metaverse/iterruptrequest/"/>
      <url>metaverse/iterruptrequest/</url>
      
        <content type="html"><![CDATA[<h2 id="中断是什么"><a href="#中断是什么" class="headerlink" title="中断是什么"></a>中断是什么</h2><p>中断是操作系统、CPU、CPU与IO设备中的概念，为中断CPU执行。其中涉及的概念都有无限深的概念栈(其实是无限深)我们就从简单的系统层面讲一讲。</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139455kernel_interface.png" alt="See the source image"></p><h2 id="前置概念"><a href="#前置概念" class="headerlink" title="前置概念"></a>前置概念</h2><p>IRQ：interrupt request,中断请求</p><p>ISR：interrupt service routine， 中断服务程序，中断后运行的服务，ISR运行结束才会结束中断</p><p>PIC：programmable interrupt contolle,可编程中断控制器（中断控制芯片），与I/O设备直连，可以触发CPU的INTR(中断请求)引脚，发起中断请求</p><p>APIC：advanced programmable interrupt contolle,高级编程中断控制器，有两部分，Local APIC 在CPU内部(每个核都有)，I/O APIC在主板芯片组内，I/O APIC和LAPIC通过总线连接</p><h2 id="硬中断"><a href="#硬中断" class="headerlink" title="硬中断"></a>硬中断</h2><p>硬件设备通知CPU就绪中使用，分为：</p><h3 id="可屏蔽中断"><a href="#可屏蔽中断" class="headerlink" title="可屏蔽中断"></a>可屏蔽中断</h3><p>外设或借口的中断、可以在CPU处理其他紧急操作时忽略或屏蔽</p><h3 id="不可屏蔽中断"><a href="#不可屏蔽中断" class="headerlink" title="不可屏蔽中断"></a>不可屏蔽中断</h3><p>电源断电、内存错误等，不可通过软件屏蔽，必须响应中断</p><h2 id="软中断"><a href="#软中断" class="headerlink" title="软中断"></a>软中断</h2><p>软件触发的中断，如定时器、网卡收发包</p><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>一般为程序调用CPU的指令错误时产生，console能看到 segmention fault、core dumped等</p><p>错误：系统可纠正、纠正成功继续运行(如内存页从磁盘加载)</p><p>陷阱：陷阱主要用在调试中。</p><p>终止：终止是由系统表中的硬件错误或值不一致而导致的。终止不会报告造成异常的指令的所在位置。这是最严重的中断，终止将会调用系统的终止异常处理程序来结束造成异常的进程。</p><h2 id="top命令解析"><a href="#top命令解析" class="headerlink" title="top命令解析"></a>top命令解析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">top - 10:40:48 up  1:04,  1 user,  load average: 2.39, 2.22, 2.07</span><br><span class="line">任务: 400 total,   2 running, 397 sleeping,   0 stopped,   1 zombie</span><br><span class="line">%Cpu(s):  5.2 us,  3.4 sy,  0.0 ni, 90.5 id,  0.1 wa,  0.0 hi,  0.8 si,  0.0 st</span><br><span class="line">MiB Mem :  15430.3 total,   3579.7 free,   8020.7 used,   3829.9 buff/cache</span><br><span class="line">MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.   6880.5 avail Mem </span><br><span class="line">ID USER      PR  NI    VIRT    RES    SHR    %CPU  %MEM     TIME+ COMMAND  </span><br><span class="line">4389 longtao   20   0 6273452 451044 148220 S  37.7   2.9  27:28.46 gnome-shell           </span><br></pre></td></tr></table></figure><p>第一行分别为：系统时间、系统已运行时间(1h4min)、用户数、平均CPU负载情况(1分钟、5分钟、15分钟)</p><p>第二行分别为：当前总任务(进程)数量、运行中的2个、休眠397个、stoped0个，zombie0个</p><p>第三为cpu的状态使用情况</p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>5.2 us</td><td>用户空间占用CPU%5.2</td></tr><tr><td>3.4 sy</td><td>内核空间占用CPU%3.4</td></tr><tr><td>0.0 ni</td><td>更改过优先级的进程占用CPU%0</td></tr><tr><td>90.5 id</td><td>90.5%的CPU空闲</td></tr><tr><td>0.1 wa</td><td>IO等待占用CPU百分比</td></tr><tr><td>0.8 si</td><td>软中断占用CPU%0.8</td></tr><tr><td>0.0 hi</td><td>硬中断占用</td></tr><tr><td>0.0 st</td><td>steal time,对云主机来说被Hypervisor偷去的CPU所占比例</td></tr></tbody></table><p>第四行为内存状态分别为：物理总内存total、used使用了的、free空闲的、缓存内存</p><p>第五行为swap交换分区状态：total交换分区总量、空闲、使用了的、缓冲的</p><p>第六行往下都是每个进程使用情况：</p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>ID</td><td>进程号</td></tr><tr><td>USER</td><td>用户</td></tr><tr><td>PR</td><td>进程优先级</td></tr><tr><td>NI</td><td>nice值，正表示低优先值、负表示高</td></tr><tr><td>VIRT</td><td>进程使用虚拟内存总量，VIRT=SWAP+RES</td></tr><tr><td>RES</td><td>进程使用的、未释放的物理内存，RES=CODE+DATA</td></tr><tr><td>SHR</td><td>共享内存</td></tr><tr><td>S</td><td>进程状态，D不可中断的睡眠状态 R运行 S睡眠 T跟踪/停止 Z僵尸进程</td></tr><tr><td>%CPU</td><td>CPU占比(对单个CPU的)</td></tr><tr><td>%MEM</td><td>物理内存占比</td></tr><tr><td>TIME+</td><td>进程使用的CPU时间总计，单位为us</td></tr><tr><td>COMMAND</td><td>进程名称和命令</td></tr></tbody></table><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>数字1：查看每个cpu的情况</p><p>数字2：查看每个numa的情况</p><p>数字3：查看某个numa里每个CPU的情况</p><p>字母P：CPU使用排序</p><p>字母M：内存使用排序</p><p>字母m：改变内存和交换区显示</p><p>字母b：高亮运行太进程</p><p>字母f：编排显示</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机启动到操作系统运行</title>
      <link href="metaverse/bootofcomputer/"/>
      <url>metaverse/bootofcomputer/</url>
      
        <content type="html"><![CDATA[<p>首先学一个东西，一定要有一个<strong>前置</strong>的知识，我们把它当做已知的，我不可能从原子组成分子开始讲原理。那学习计算机启动过程的前置知识是什么呢？我要求你已知以下几点：</p><ol><li>内存是存储数据的地方，给出一个地址信号，内存可以返回该地址所对应的数据。</li><li>CPU 的工作方式就是不断从内存中取出指令，并执行。</li><li>CPU 从内存的哪个地址取出指令，是由一个寄存器中的值决定的，这个值会不断进行 +1 操作，或者由某条跳转指令指定其值是多少。</li></ol><p>好了，只需要知道这三点<strong>前置</strong>知识，你就能专业地解释计算机的启动过程了。</p><h2 id="一、为什么是-BIOS-主导？"><a href="#一、为什么是-BIOS-主导？" class="headerlink" title="一、为什么是 BIOS 主导？"></a>一、为什么是 BIOS 主导？</h2><p>都说开机后，BIOS 就开始运行自己的程序了，又硬件自检，又加载启动区的。我就不服了，为什么开机后是执行 BIOS 里的程序？为啥不是内存里的？为啥不是硬盘里的？</p><p>好的，不要怀疑前置知识，CPU 的工作方式，就是不断从内存中取指令并执行，那为什么会说是执行 BIOS 里的程序呢？这就不得不说说<strong>内存映射</strong>了。</p><h2 id="二、内存映射"><a href="#二、内存映射" class="headerlink" title="二、内存映射"></a>二、内存映射</h2><p><strong>CPU 地址总线的宽度决定了可访问的内存空间的大小</strong>。比如 16 位的 CPU 地址总线宽度为 20 位，地址范围是 1M。32 位的 CPU 地址总线宽度为 32 位，地址范围是 4G。你可以算算我们现在的 64 位机的地址范围。</p><p>可是，可访问的内存空间这么大，并不等于说全都给内存使用，也就是说寻址的对象不只有内存，还有一些外设也要通过地址总线的方式去访问，那怎么去访问这些外设呢？就是在地址范围中划出一片片的区域，这块给显存使用，那块给硬盘控制器使用，等等 。</p><p>这样说，其实就不符合我们的前置知识了，所以可以有一种不太正确的理解方式，那就是内存中的这块位置就是显存，那块位置就是硬盘控制器。我们在相应的位置上读取或者写入，就相当于在显存等外设的相应位置上读取或者写入，就好像这些外设的存储区域，被<strong>映射</strong>到了内存中的某一片区域一样。这样我们就不用管那些外设啦，关注点仍然是一个简简单单的内存。这就是所谓的<strong>内存映射</strong>。</p><p>太好了，现在又用简单的前置知识就能解释得通了，我们继续往下推。</p><h2 id="三、实模式下的内存分布"><a href="#三、实模式下的内存分布" class="headerlink" title="三、实模式下的内存分布"></a>三、实模式下的内存分布</h2><p>刚刚说到内存中划分出了一片一片区域给各种外设，那么问题自然就来了，哪块区域，分给了哪块外设了呢？如果是规定，那应该有一张表比较好吧。嗯没错，还真有，它就是实模式下的内存分布，笔者给它画了一张图：</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139328640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img">在这里插入图片描述</p><p>哎哟我真是个小天使，把比例都表现出来了，网上能再找出比我这个更直观的请给我留言。实模式之后再解释，现在简单理解就是计算机刚开机的时候只有 1M 的内存可用。</p><p>我们看到，内存被各种外设瓜分了，即映射在了内存中。BIOS 更狠，不但其空间被映射到了内存 0xC0000 - 0xFFFFF 位置，其里面的程序还占用了开头的一些区域，比如把中断向量表写在了内存开始的位置，真所谓先到先得啊。</p><h2 id="四、怎么就从-BIOS-里的程序开始执行了"><a href="#四、怎么就从-BIOS-里的程序开始执行了" class="headerlink" title="四、怎么就从 BIOS 里的程序开始执行了"></a>四、怎么就从 BIOS 里的程序开始执行了</h2><p>好了，现在我们知道 BIOS 里的信息被映射到了内存 0xC0000 - 0xFFFFF 位置，其中最为关键的系统 BIOS 被映射到了 0xF0000 - 0xFFFFF 位置。假如我现在说，CPU 开机就是执行了这块区域的代码，然后巴拉巴拉一顿操作就开机了，你肯定要喷我了，为什么就执行到这了呢，那咋不从头开始执行？</p><p>这就自然有了一种猜想，我们要用到另一个前置知识了，就是 CPU 从内存的哪个位置取出执行并执行呢？<strong>是 PC 寄存器中的地址值</strong>。BIOS 程序的入口地址也就是开始地址是 0xFFFF0（人家就那么写的），也就是开机键一按下，一定有一个神奇的力量，将 pc 寄存器中的值变成 0xFFFF0，然后 CPU 就开始马不停蹄地跑了起来。没错，接下来这句话，可能就是你找了很久的答案，请做好准备：</p><p><strong>在你开机的一瞬间，CPU 的 PC 寄存器被强制初始化为 0xFFFF0</strong>。如果再说具体些，CPU 将段基址寄存器 cs 初始化为 0xF000，将偏移地址寄存器 IP 初始化为 0xFFF0，根据实模式下的最终地址计算规则，将段基址左移 4 位，加上偏移地址，得到最终的物理地址也就是抽象出来的 PC 寄存器地址为 0xFFFF0。</p><p>当我在学习这段知识时，看到这句话才让将我心里积压了很久的疑惑解开，多么简单粗暴的道理啊。写到这里我也是长舒了一口气，因为剩下的过程，就几乎只是流水账一样的正推了。</p><p>至于怎么强制初始化的，我觉得就越过了前置知识的边界了，况且各个厂商的硬件实现也不一定相同，有很多办法，也很简单。讨论起来意义就不大了。</p><h2 id="五、BIOS-里到底写了什么程序"><a href="#五、BIOS-里到底写了什么程序" class="headerlink" title="五、BIOS 里到底写了什么程序"></a>五、BIOS 里到底写了什么程序</h2><p>好了，我们现在知道了 BIOS 被映射到了内存的某个位置，并且开机一瞬间 CPU 强制将自己的 pc 寄存器初始化为 BIOS 程序的入口地址，从这里开始 CPU 马不停蹄地向前跑了起来。那接下来的问题似乎也非常自然地就问出来了，那就是 BIOS 程序里到底写了啥？</p><p>把 BIOS 程序里的二进制信息全贴出来也不合适，我们分析一些主要的。我们首先还是来猜测，你看入口地址是 0xFFFF0，说明程序是从这执行的。实模式下内存的下边界就是 0xFFFFF，也就是只剩下 16 个字节的空间可以写代码了，这够干啥的呢？如果你有心的话应该能猜出，入口地址处可能是个跳转指令，跳到一个更大范围的空间去执行自己的任务。没错就是这样，0xFFFF0 处存储的机器指令，翻译成汇编语言是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmp far f000:e05b</span><br></pre></td></tr></table></figure><p>意思是跳转到物理地址 0xfe05b 处开始执行（回忆下前面说的实模式下的地址计算方式）。</p><p>地址 0xfe05b 处开始，便是 BIOS 真正发挥作用的代码了，这块代码会检测一些外设信息，并初始化好硬件，建立中断向量表并填写中断例程。这里的部分不要展开，这只是一段写死的程序而已，而且对理解开机启动过程无帮助，我们看后面精彩的部分，也就是 BIOS 的最后一项工作：<strong>加载启动区</strong>。</p><h2 id="六、0x7c00-是啥"><a href="#六、0x7c00-是啥" class="headerlink" title="六、0x7c00 是啥"></a>六、0x7c00 是啥</h2><p>该较真的地方就是要较真，我绝对不会让<strong>加载</strong>这种魔幻的词出现在这里，我们现在就来把它拆解成人话。</p><p>其实这个词也并不魔幻，加载在计算机领域就是指，<strong>把某设备上（比如硬盘）的程序复制到内存中的过程</strong>。那加载启动区这个过程，翻译过来就是，<strong>BIOS 程序把启动区的内容复制到了内存中的某个区域</strong>。好了，问题又自然出来了，启动区是哪里？被复制到了内存的哪个位置？然后呢？我们一个个来回答。</p><p>什么是启动区呢？即使你不知道，你也应该能够猜到，一定是符合某种特征的一块区域，于是人们把它就叫做启动区了，那要符合什么特征呢？先不急，不知道你有没有过设置 BIOS 启动顺序的经历，通常有 U 盘启动、硬盘启动、软盘启动、光盘启动等等，<strong>BIOS 会按照顺序，读取这些启动盘中位于 0 盘 0 道 1 扇区的内容</strong>。</p><p>至于磁盘格式的划分，本篇就不做讲解了，总之对于内存，我们给出一个数字地址就能获取到该地址的数据，而对于磁盘，我们需要给出磁头、柱面、扇区这三个信息才能定位某个位置的数据，都是描述位置的一种方式而已。</p><p>接着说， 这 0 盘 0 道 1 扇区的内容一共有 512 个字节，<strong>如果末尾的两个字节分别是 0x55 和 0xaa，那么 BIOS 就会认为它是个启动区</strong>。如果不是，那么按顺序继续向下个设备中寻找位于 0 盘 0 道 1 扇区的内容。如果最后发现都没找到符合条件的，那直接报出一个无启动区的错误。</p><p>BIOS 找到了这个启动区之后干嘛呢？哦，前面说过了是加载，<strong>就是把这 512 个字节的内容，一个比特都不少的全部复制到内存的 0x7c00 这个位置</strong>。怎么复制的？当然是指令啦。哪些指令呢？这里我只能简单说指令集中是有 in 和 out 的，用来将外设中的数据复制到内存，或者将内存中的数据复制到外设，用这两个指令，以及外设给我们提供的读取方式，就能做到这一点啦。</p><p>启动区内容此时已经被 BIOS 程序复制到了内存的 0x7c00 这个位置，然后呢？这个其实也不难猜测，启动区的内容就是我们自己写的代码了，复制到这里之后，就开始执行呗，之后我们的程序就接管了接下来的流程，BIOS 的使命也就结束啦。所以复制完之后，接下来应该是一个跳转指令吧！没错，正是这样，PC 寄存器的值变为 0x7c00，指令开始从这里执行。</p><p>咦？不知道你有没有发现，我们似乎不知不觉又把之前的一句魔法语言翻译成人话了，开头我们说：</p><blockquote><p>BIOS 把控制权转交给排在第一位的存储设备。</p></blockquote><p>所以这句话是什么意思呢？<strong>就是 BIOS 把启动区的 512 字节复制到内存的 0x7c00 位置，并且用一条跳转指令将 pc 寄存器的值指向 0x7c00</strong>。你看，这不是也没多几个字嘛，就把这个问题说得明明白白，简简单单。</p><p>哦，对了，现在似乎就剩下一个问题了，为什么非要是 0x7c00 呢？好问题，当然答案也很简单，那就是人家 BIOS 开发团队就是这样定的，之后也不好改了，不然不兼容。为什么不好改？我们看一个简单的启动区 512 字节的代码。（代码摘抄自《30 天自制操作系统》）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">; hello-os</span><br><span class="line">; TAB&#x3D;4</span><br><span class="line"></span><br><span class="line">  ORG  0x7c00   ;程序加载到内存的 0x7c00 这个位置</span><br><span class="line"></span><br><span class="line">;程序主体</span><br><span class="line"></span><br><span class="line">entry:</span><br><span class="line">  MOV  AX,0   ;初始化寄存器</span><br><span class="line">  MOV  SS,AX</span><br><span class="line">  MOV  SP,0x7c00</span><br><span class="line">  MOV  DS,AX   ;段寄存器初始化为 0</span><br><span class="line">  MOV  ES,AX</span><br><span class="line">  MOV  SI,msg</span><br><span class="line">putloop:</span><br><span class="line">  MOV  AL,[SI]</span><br><span class="line">  ADD  SI,1</span><br><span class="line">  CMP  AL,0   ;如果遇到 0 结尾的，就跳出循环不再打印新字符</span><br><span class="line">  JE  fin</span><br><span class="line">  MOV  AH,0x0e   ;指定文字</span><br><span class="line">  MOV  BX,15   ;指定颜色</span><br><span class="line">  INT  0x10   ;调用 BIOS 显示字符函数</span><br><span class="line">  JMP  putloop</span><br><span class="line">fin:</span><br><span class="line">  HLT</span><br><span class="line">  JMP  fin</span><br><span class="line">msg:</span><br><span class="line">  DB  0x0a,0x0a  ;换行、换行</span><br><span class="line">  DB  &quot;hello-os&quot;</span><br><span class="line">  DB  0x0a   ;换行</span><br><span class="line">  DB  0    ;0 结尾</span><br><span class="line"></span><br><span class="line">  RESB 0x7dfe-$   ;填充0到512字节</span><br><span class="line">  DB 0x55, 0xaa   ;可启动设备标识</span><br></pre></td></tr></table></figure><p>我们看第一行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ORG  0x7c00</span><br></pre></td></tr></table></figure><p>这个数字就是刚刚说的启动区加载位置，这行汇编代码简单说就表示把下面的地址统统加上 0x7c00。正因为 BIOS 将启动区的代码加载到了这里，因此有了一个偏移量，所以所有写启动区代码的人就需要在开头写死一个这样的代码，不然全都串位了。</p><p>然后正因为所有写操作系统的，启动区的第一行汇编代码都写死了这个数字，那 BIOS 开发者最初定的这个数字就不好改了，否则它得挨个联系各个操作系统的开发厂商，说唉我这个地址改一下哈，你们跟着改改。在公司推动另一个团队改个代码都得大费周折，想想看这样的推动得耗费多大人力。况且即使改了，之前的代码也都不兼容了，这不得被人们骂死啊。</p><p>再看最后一行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB 0x55, 0xaa</span><br></pre></td></tr></table></figure><p>这也验证了我们之前说的这 512 字节的最后两个字节得是 0x55 0xaa，BIOS 才会认为它是一个启动区，才会去加载它，仅此而已。</p><p>回过头来说 0x7c00 这个值，它其实就是一个规定死的值，但还是会有人问，那必然有它的合理性吧。其实，我的解释也只能说是人家规定了这个值，后人们替他们解释这个合理性，并不是说当初人家就一定是这样想的，就好比我们做语文的阅读理解题一样。</p><p>第一个 BIOS 开发团队是 IBM PC 5150 BIOS，当时被认为的第一个操作系统是 DOS 1.0 操作系统，BIOS 团队就假设是为它服务的。但操作系统还没出，BIOS 团队假设其操作系统需要的最小内存为 32 KB。BIOS 希望自己所加载的启动区代码尽量靠后，这样比较“安全”，不至于过早的被其他程序覆盖掉。可是如果仅仅留 512 字节又感觉太悬了，还有一些栈空间需要预留，那扩大到 1 KB 吧。这样 32 KB 的末尾是 0x8000，减去 1KB(0x400) ，刚好等于 0x7c00。哇塞，太精准了，这可以是一种解释方式。</p><h2 id="七、启动区里的代码写了啥"><a href="#七、启动区里的代码写了啥" class="headerlink" title="七、启动区里的代码写了啥"></a>七、启动区里的代码写了啥</h2><p>其实写到这，我这篇文章就应该戛然而止了，因为最初的那个问题已经解决了，CPU 已经开始马不停蹄地从我们预期的位置跑起来了，万事开头难，剩下的内容，就是操作系统想怎么玩就怎么玩了。</p><p>但我觉得还不够味，似乎还有些问题萦绕在你脑海里。比如说这个问题：</p><blockquote><p>启动区里的代码写了啥？就 512 字节就是全部操作系统内容了？</p></blockquote><p>这是一个好问题，512 个字节确实干不了啥，现在的操作系统怎么也得按 M 为单位算吧，512 个字节远远不够呢，那是怎么回事呢？</p><p>其实我们可以按照之前的思路猜测，BIOS 用很少的代码就把 512 字节的启动区内容加载到了内存，并跳转过去开始执行。那按照这个套路，这 512 字节的启动区代码，是不是也可以把更多磁盘中存储的操作系统程序，加载到内存的某个位置，然后跳转过去呢？</p><p>没错，就是这个套路。<strong>所以 BIOS 负责加载了启动区，而启动区又负责加载真正的操作系统内核</strong>，这配合默契吧？</p><p>由于用于启动盘的磁盘是人家写操作系统的厂商制作的，俗称制作启动盘，所以他也肯定知道操作系统的核心代码存储在磁盘的哪个扇区，因此启动区就把这个扇区，以及之后的好多好多扇区（具体取决于操作系统有多大）都读到内存中，然后跳转到开始的程序开始的位置。跳转到哪里呢？这个就不像 0x7c00 这个数那么经典了，不同的操作系统肯定也不一样，也不用事先规定好，反正写操作系统的人给自己定一个就好了，别覆盖其他关键设备用到的区域就好。</p><h2 id="八、操作系统内核写了啥"><a href="#八、操作系统内核写了啥" class="headerlink" title="八、操作系统内核写了啥"></a>八、操作系统内核写了啥</h2><p>好了现在经过好几轮跳跳跳，终于跳到内核代码啦，我们来一起回顾一下：</p><ol><li>按下开机键，CPU 将 PC 寄存器的值强制初始化为 0xffff0，这个位置是 BIOS 程序的入口地址（一跳）</li><li>该入口地址处是一个跳转指令，跳转到 0xfe05b 位置，开始执行（二跳）</li><li>执行了一些硬件检测工作后，最后一步将启动区内容加载到内存 0x7c00，并跳转到这里（三跳）</li><li>启动区代码主要是加载操作系统内核，并跳转到加载处（四跳）</li></ol><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635139335949069-20190421160331677-268089991.png" alt="img"></p><h1 id="linux系统"><a href="#linux系统" class="headerlink" title="linux系统"></a>linux系统</h1><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/16351393421635139306R-C.81d56db1bef63aa01cbba73b33caedf3?rik=3YtNM7LX/wHS5Q&riu=http://www.linuxidc.com/upload/2016_06/160617100110611.png&ehk=0SHzV/qNHRE7jk8jqfwwge4teKMqurNw7sM4KipqkaA=&risl=&pid=ImgRaw&r=0" alt="See the source image"></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux kernel更换</title>
      <link href="metaverse/changekernel/"/>
      <url>metaverse/changekernel/</url>
      
        <content type="html"><![CDATA[<p>CentOS 是RHEL（Red Hat Enterprise Linux）源代码再编译的产物</p><table><thead><tr><th>发行版本</th><th>发行时间</th><th>内核版本</th><th>发布时间</th></tr></thead><tbody><tr><td>2.1</td><td>2004.05.14</td><td>kernel-2.4.9</td><td>2011.08</td></tr><tr><td>3.1~3.9</td><td>2004.03.19~2007.07.26</td><td>kernel-2.4.21</td><td>2003.01</td></tr><tr><td>4.0~4.9</td><td>2005.03.09~2011.03.02</td><td>kernel-2.6.9</td><td>2004.10</td></tr><tr><td>5.0~5.11</td><td>2007.04.12~2014.09.30</td><td>kernel-2.6.18</td><td>2006.09</td></tr><tr><td>6.0~6.10</td><td>2011.07.04~</td><td>kernel-2.6.32</td><td>2009.12</td></tr><tr><td>7.0.1406</td><td>2014.07.07</td><td>kernel-3.10.0-123</td><td>2013.07</td></tr><tr><td>7.1.1503</td><td>2015.03.31</td><td>kernel-3.10.0-229</td><td></td></tr><tr><td>7.2.1511</td><td>2015.12.15</td><td>kernel-3.10.0-327</td><td></td></tr><tr><td>7.3.1611</td><td>2016.12.12</td><td>kernel-3.10.0-514</td><td></td></tr><tr><td>7.4.1708</td><td>2017.09.13</td><td>kernel-3.10.0-693</td><td></td></tr><tr><td>7.5.1804</td><td>2018.05.10</td><td>kernel-3.10.0-862</td><td></td></tr><tr><td>7.6.1810</td><td>2018.12.04</td><td>kernel-3.10.0-957</td><td></td></tr><tr><td>7.7.1908</td><td>2019.09.18</td><td>kernel-3.10.0-1062</td><td></td></tr><tr><td>8.0.1905</td><td>2019-09-25</td><td>kernel-4.18.0-80</td><td>2018.08</td></tr></tbody></table><p>ubuntu</p><table><thead><tr><th>发行版本</th><th>发行时间</th><th>内核版本</th><th>发布时间</th></tr></thead><tbody><tr><td>4.10</td><td>2004.10.20</td><td>2.6.8</td><td>2004.08</td></tr><tr><td>5.04</td><td>2005.04.08</td><td>2.6.10</td><td>2004.12</td></tr><tr><td>5.10</td><td>2005.10.13</td><td>2.6.12</td><td>2005.01</td></tr><tr><td>6.06</td><td>2006.06.01(LTS)</td><td>2.6.15</td><td>2006.01</td></tr><tr><td>6.10</td><td>2006.10.06</td><td>2.6.17</td><td>2006.06</td></tr><tr><td>7.04</td><td>2007.04.19</td><td>2.6.20</td><td>2007.02</td></tr><tr><td>7.10</td><td>2007.10.18</td><td>2.6.22</td><td>2007.07</td></tr><tr><td>8.04</td><td>2008.04.24(LTS)</td><td>2.6.24</td><td>2008.01</td></tr><tr><td>8.10</td><td>2008.10.30</td><td>2.6.27</td><td>2008.10</td></tr><tr><td>9.04</td><td>2009.04.23</td><td>2.6.28</td><td>2009.01</td></tr><tr><td>9.10</td><td>2009.10.29</td><td>2.6.31</td><td>2009.09</td></tr><tr><td>10.04</td><td>2010.4.29</td><td>2.6.32</td><td>2009.12</td></tr><tr><td>10.10</td><td>2010.10.13</td><td>2.6.35</td><td>2010.08</td></tr><tr><td>11.04</td><td>2011.04.28</td><td>2.6.38</td><td>2011.03</td></tr><tr><td>11.10</td><td>2011.10.13</td><td>3.0</td><td>2011.08</td></tr><tr><td>12.04</td><td>2012.04.26(LTS)</td><td>3.2+</td><td>2012.01</td></tr><tr><td>12.10</td><td>2012.10.20</td><td>3.5</td><td>2012.08</td></tr><tr><td>13.04</td><td>2013.04.25</td><td>3.8</td><td>2013.02</td></tr><tr><td>13.10</td><td>2013.10.17</td><td>3.11</td><td>2013.09</td></tr><tr><td>14.04</td><td>2014.04.18 (LTS)</td><td>3.13</td><td>2014.01</td></tr><tr><td>14.10</td><td>2014.10.23</td><td>3.16</td><td>2014.08</td></tr><tr><td>15.04</td><td>2015.04</td><td>3.19</td><td>2015.03</td></tr><tr><td>15.10</td><td>2015.10</td><td>4.2</td><td>2015.08</td></tr><tr><td>16.04</td><td>2016.04（LTS）</td><td>4.4</td><td>2016.01</td></tr><tr><td>16.10</td><td>2016.10</td><td>4.8</td><td>2016.10</td></tr><tr><td>17.04</td><td>2017.04</td><td>4.10</td><td>2017.02</td></tr><tr><td>17.10</td><td>2017.10</td><td>4.13</td><td>2017.09</td></tr><tr><td>18.04</td><td>2018.04.26</td><td>4.15</td><td>2018.01</td></tr><tr><td>18.10</td><td>2018.10.18</td><td>4.18</td><td>2018.08</td></tr><tr><td>19.04</td><td>2019.04.18</td><td>5.0</td><td>2019.03</td></tr><tr><td>19.10</td><td>2019.10.17</td><td>5.2</td><td>2019.07</td></tr><tr><td>20.04</td><td>2020.04.23</td><td>5.4</td><td>2019.11</td></tr></tbody></table><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>centos</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name grub.cfg #grub是引导操作系统的程序，它会根据自己的配置文件，去引导内核，当内核被加载到内存以后，内核会根据grub配置文件中的配置，找到根分区所使用的文件系统对应的驱动，通过根分区文件系统对应的驱动，挂载根分区，从而达到启动操作系统的目的。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@172-20-1-30 ~]# grub2-</span><br><span class="line">grub2-bios-setup           grub2-macbless             grub2-mkrelpath            grub2-script-check</span><br><span class="line">grub2-editenv              grub2-menulst2cfg          grub2-mkrescue             grub2-set-default</span><br><span class="line">grub2-file                 grub2-mkconfig             grub2-mkstandalone         grub2-setpassword</span><br><span class="line">grub2-fstest               grub2-mkfont               grub2-ofpathname           grub2-sparc64-setup</span><br><span class="line">grub2-get-kernel-settings  grub2-mkimage              grub2-probe                grub2-syslinux2cfg</span><br><span class="line">grub2-glue-efi             grub2-mklayout             grub2-reboot               </span><br><span class="line">grub2-install              grub2-mknetdir             grub2-render-label         </span><br><span class="line">grub2-kbdcomp              grub2-mkpasswd-pbkdf2      grub2-rpm-sort    </span><br><span class="line"><span class="meta">#</span><span class="bash"> centos7 以上使用grub2 系列命令 centos7 以下是grub系列命令，用于grub设置</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a  # 查看kernel版本</span><br></pre></td></tr></table></figure><h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ol><li><a href="https://blog.csdn.net/weixin_40161232/article/details/85251250">https://blog.csdn.net/weixin_40161232/article/details/85251250</a></li><li><a href="https://blog.csdn.net/weixin_34194087/article/details/93497024">https://blog.csdn.net/weixin_34194087/article/details/93497024</a></li><li><a href="https://blog.csdn.net/zhaihaibo168/article/details/102673669">https://blog.csdn.net/zhaihaibo168/article/details/102673669</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yum使用</title>
      <link href="metaverse/yum/"/>
      <url>metaverse/yum/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="更改centos-yum-源"><a href="#更改centos-yum-源" class="headerlink" title="更改centos yum 源"></a>更改centos yum 源</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/yum.repos.d/CentOS-Base.rep</span><br></pre></td></tr></table></figure><p>更改为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name&#x3D;CentOS-$releasever - Base</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7.6.1810&#x2F;os&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line"></span><br><span class="line">[updates]</span><br><span class="line">name&#x3D;CentOS-$releasever - Updates</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7.6.1810&#x2F;updates&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name&#x3D;CentOS-$releasever - Extras</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7.6.1810&#x2F;extras&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[serverid]</span><br><span class="line">#其中serverid是用于区别各个不同的repository（仓库;贮藏室;博物馆;亲信），必须有一个独一无二的名称。 重复了 前面覆盖后面--还是反过来呢？？？用enabled 测试是后面覆盖前面</span><br><span class="line"></span><br><span class="line">name&#x3D;Some name for this server</span><br><span class="line">#name，是对repository的描述，支持像$releasever $basearch这样的变量; name&#x3D;Fedora Core $releasever - $basearch - Released Updates</span><br><span class="line"></span><br><span class="line">baseurl&#x3D;url:&#x2F;&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">#baseurl是服务器设置中最重要的部分，只有设置正确，才能从上面获取软件。它的格式是：</span><br><span class="line">baseurl&#x3D;url:&#x2F;&#x2F;server1&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">url:&#x2F;&#x2F;server2&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">url:&#x2F;&#x2F;server3&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">#其中url支持的协议有 http:&#x2F;&#x2F; ftp:&#x2F;&#x2F; file:&#x2F;&#x2F;三种。baseurl后可以跟多个url，你可以自己改为速度比较快的镜像站，但baseurl只能有一个，也就是说不能像如下格式：</span><br><span class="line">baseurl&#x3D;url:&#x2F;&#x2F;server1&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">baseurl&#x3D;url:&#x2F;&#x2F;server2&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">baseurl&#x3D;url:&#x2F;&#x2F;server3&#x2F;path&#x2F;to&#x2F;repository&#x2F;</span><br><span class="line">其中url指向的目录必须是这个repository header目录的上一级，它也支持$releasever $basearch这样的变量。</span><br><span class="line"></span><br><span class="line">#mirrorlist&#x3D;http:&#x2F;&#x2F;mirrors.fedoraproject.org&#x2F;mirrorlist?repo&#x3D;fedora-$releasever&amp;arch&#x3D;$basearch</span><br><span class="line">#上面的这一行是指定一个镜像服务器的地址列表，通常是开启的，本例中加了注释符号禁用了，我们可以试试，将$releasever和$basearch替换成自己对应的版本和架构，例如10和i386，在浏览器中打开，我们就能看到一长串镜可用的镜像服务器地址列表。</span><br><span class="line"></span><br><span class="line">url之后可以加上多个选项，如gpgcheck、exclude、failovermethod等，比如：</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">exclude&#x3D;gaim</span><br><span class="line">#其中gpgcheck，exclude的含义和[main]部分相同，但只对此服务器起作用，</span><br><span class="line">failovermethod&#x3D;priority</span><br><span class="line">#failovermethode 有两个选项roundrobin和priority，意思分别是有多个url可供选择时，yum选择的次序，roundrobin是随机选择，如果连接失 败则使用下一个，依次循环，priority则根据url的次序从第一个开始。如果不指明，默认是roundrobin。</span><br><span class="line"></span><br><span class="line">enabled&#x3D;[1 or 0]</span><br><span class="line">#当某个软件仓库被配置成 enabled&#x3D;0 时，yum 在安装或升级软件包时不会将该仓库做为软件包提供源。使用这个选项，可以启用或禁用软件仓库。</span><br><span class="line">#通过 yum 的 --enablerepo&#x3D;[repo_name] 和 --disablerepo&#x3D;[repo_name] 选项，或者通过 PackageKit 的&quot;添加&#x2F;删除软件&quot;工具，也能够方便地启用和禁用指定的软件仓库</span><br></pre></td></tr></table></figure><p>由于通过源码安装的qemu没有办法通过系统工具进行卸载，也没有办法通过make uninstall方法卸载，所以只能通过删除文件的方式进行卸载。</p><p>qemu可执行文件默认放在/usr/local/bin，库文件默认放在/usr/local/libexec，配置文件默认放在/usr/local/etc，共享文件默认放在/usr/local/etc/share。要卸载源码编译的qemu，需要到这四个目录中找出相关的文件然后删除掉。</p><p>如果configure时没有通过–target-list=指定编译的目标机体系结构，则/usr/local/bin中的以qemu开头的文件需要删除，总共51个。</p><p>/usr/local/libexec中只有一个文件：qemu-bridge-helper，直接删除即可。</p><p>/usr/local/etc比较简单，只有一个qemu目录，其下有一个文件target-x86_64.conf，直接将qemu目录删除即可。</p><p>同/usr/local/etc一样，qemu相关的共享文件都放在/usr/local/etc/share目录下的qemu子目录中，直接将该子目录删除即可。</p><h2 id="设置本地yum源"><a href="#设置本地yum源" class="headerlink" title="设置本地yum源"></a>设置本地yum源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">创建rpm包文件存放目录及复制相关文件</span><br><span class="line"><span class="meta">  #</span><span class="bash"> mkdir -pv /mnt/CentOS7_ISO</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> <span class="built_in">cd</span> /run/media/robin/CentOS\ 7\ x86_64/</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> cp -R * /mnt/CentOS7_ISO/</span></span><br><span class="line"></span><br><span class="line">修改yum源repo文件配置</span><br><span class="line"><span class="meta">  #</span><span class="bash"> <span class="built_in">cd</span> /etc/yum.repos.d/</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> mkdir old</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> mv *.repo old</span></span><br><span class="line"></span><br><span class="line">编辑repo配置文件</span><br><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/yum.repos.d/longtao.repo</span></span><br><span class="line">[longtao]</span><br><span class="line">name=longtao local repository</span><br><span class="line">baseurl=file/root/qemu-kvm-ev</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">清空yum缓存目录</span><br><span class="line">  [root@centos7-router yum.repos.d]# yum clean all</span><br><span class="line">  Loaded plugins: fastestmirror, langpacks</span><br><span class="line">  Cleaning repos: local-media</span><br><span class="line">  Cleaning up everything</span><br><span class="line">  Cleaning up list of fastest mirrors</span><br><span class="line"></span><br><span class="line">生成yum元数据</span><br><span class="line">  [root@centos7-router yum.repos.d]# yum makecache</span><br><span class="line">  Loaded plugins: fastestmirror, langpacks</span><br><span class="line">  local-media                                                                        | 3.6 kB  00:00:00    </span><br><span class="line">  (1/4): local-media/group_gz                                                      | 155 kB  00:00:00    </span><br><span class="line">  (2/4): local-media/primary_db                                                    | 2.8 MB  00:00:00    </span><br><span class="line">  (3/4): local-media/other_db                                                      | 1.2 MB  00:00:00    </span><br><span class="line">  (4/4): local-media/filelists_db                                                  | 2.9 MB  00:00:00    </span><br><span class="line">  Determining fastest mirrors</span><br><span class="line">  Metadata Cache Created  ###提示元数据缓存创建成功</span><br><span class="line"></span><br><span class="line">查看本机yum repo 仓库</span><br><span class="line">  [root@centos7-router ~]# yum repolist</span><br><span class="line">  Loaded plugins: fastestmirror, langpacks</span><br><span class="line">  Loading mirror speeds from cached hostfile</span><br><span class="line">  repo id                                               repo name                    status</span><br><span class="line">  local-media                                        CentOS-7 - Media                   3,723</span><br><span class="line">  repolist: 3,723</span><br></pre></td></tr></table></figure><h2 id="临时源"><a href="#临时源" class="headerlink" title="临时源"></a>临时源</h2><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><code>yum update</code>别运行，可能把内核和上面的软件都更新了</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react antd</title>
      <link href="metaverse/reactandantd/"/>
      <url>metaverse/reactandantd/</url>
      
        <content type="html"><![CDATA[<ol><li>antd  是<a href="https://www.html.cn/create-react-app/">react </a>UI 组件库 </li><li>使用 <code>npx create-react-app 项目名（项目名不能为大写字母）</code>yarn create  react-app 项目名`</li><li><code>npm start</code>  <code>yarn start</code></li><li><code>yarn test</code> 测试</li><li>package-lock.json文件锁定所有模块的版本号，包括主模块和所有依赖子模块。 当你执行npm install的时候，node从package.json文件读取模块名称，从package-lock.json文件中获取版本号，(类似 go.mod 和 go.sum )</li><li>Webpack 只处理 <code>src</code> 中的文件。 你需要<strong>将任何 JS 和 CSS 文件放在 <code>src</code> 中</strong>，否则 Webpack 将发现不了它们。webpack 是react的前端打包工具</li></ol><h4 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h4><ol><li><p>AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）</p></li><li><p>AJAX 最大的优点是在不重新加载整个页面的情况下，可以与服务器交换数据并更新部分网页内容。</p></li><li><p>AJAX 不需要任何浏览器插件，但需要用户允许JavaScript在浏览器上执行。</p></li><li><p>如需将请求发送到服务器，我们使用 <strong>XMLHttpRequest</strong> 对象的 <strong>open()</strong> 和 <strong>send()</strong> 方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.open(&quot;GET&quot;,&quot;ajax_info.txt&quot;,true);</span><br><span class="line">xmlhttp.send();</span><br></pre></td></tr></table></figure></li><li><p>如需使用 async=false，请将 open() 方法中的第三个参数改为 false：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.open(&quot;GET&quot;,&quot;test1.txt&quot;,false);</span><br></pre></td></tr></table></figure><p>我们不推荐使用 async=false，但是对于一些小型的请求，也是可以的。</p><p>请记住，JavaScript 会等到服务器响应就绪才继续执行。如果服务器繁忙或缓慢，应用程序会挂起或停止。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HAProxy负载均衡器</title>
      <link href="metaverse/loadbanlance/"/>
      <url>metaverse/loadbanlance/</url>
      
        <content type="html"><![CDATA[<h2 id="LB简介"><a href="#LB简介" class="headerlink" title="LB简介"></a>LB简介</h2><h2 id="HAProxy是什么"><a href="#HAProxy是什么" class="headerlink" title="HAProxy是什么"></a>HAProxy是什么</h2><p>HAProxy是一个免费的负载均衡软件，可以运行于大部分主流的Linux操作系统上。</p><p>HAProxy提供了L4(TCP)和L7(HTTP)两种负载均衡能力，具备丰富的功能。HAProxy的社区非常活跃，版本更新快速（最新稳定版1.7.2于2017/01/13推出）。最关键的是，HAProxy具备媲美商用负载均衡器的性能和稳定性。</p><p>因为HAProxy的上述优点，它当前不仅仅是免费负载均衡软件的首选，更几乎成为了唯一选择。（还有gobetween）</p><h3 id="HAProxy的核心功能"><a href="#HAProxy的核心功能" class="headerlink" title="HAProxy的核心功能"></a>HAProxy的核心功能</h3><ul><li>负载均衡：L4和L7两种模式，支持RR/静态RR/LC/IP Hash/URI Hash/URL_PARAM Hash/HTTP_HEADER Hash等丰富的负载均衡算法</li><li>健康检查：支持TCP和HTTP两种健康检查模式</li><li>会话保持：对于未实现会话共享的应用集群，可通过Insert Cookie/Rewrite Cookie/Prefix Cookie，以及上述的多种Hash方式实现会话保持</li><li>SSL：HAProxy可以解析HTTPS协议，并能够将请求解密为HTTP后向后端传输</li><li>HTTP请求重写与重定向</li><li>监控与统计：HAProxy提供了基于Web的统计信息页面，展现健康状态和流量数据。基于此功能，使用者可以开发监控程序来监控HAProxy的状态</li></ul><p><strong>稳定性</strong></p><p>作为建议以单进程模式运行的程序，HAProxy对稳定性的要求是十分严苛的。按照作者的说法，HAProxy在13年间从未出现过一个会导致其崩溃的BUG，HAProxy一旦成功启动，除非操作系统或硬件故障，否则就不会崩溃（我觉得可能多少还是有夸大的成分）。</p><p>在上文中提到过，HAProxy的大部分工作都是在操作系统内核完成的，所以HAProxy的稳定性主要依赖于操作系统，作者建议使用2.6或3.x的Linux内核，对sysctls参数进行精细的优化，并且确保主机有足够的内存。这样HAProxy就能够持续满负载稳定运行数年之久。</p><p>个人的建议：</p><ul><li>使用3.x内核的Linux操作系统运行HAProxy</li><li>运行HAProxy的主机上不要部署其他的应用，确保HAProxy独占资源，同时避免其他应用引发操作系统或主机的故障</li><li>至少为HAProxy配备一台备机，以应对主机硬件故障、断电等突发情况（搭建双活HAProxy的方法在后文中有描述）</li><li>sysctl的建议配置（并不是万用配置，仍然需要针对具体情况进行更精细的调整，但可以作为首次使用HAProxy的初始配置使用）：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65023</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 10240</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 400000</span><br><span class="line">net.ipv4.tcp_max_orphans = 60000</span><br><span class="line">net.ipv4.tcp_synack_retries = 3</span><br><span class="line">net.core.somaxconn = 10000</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机体系架构</title>
      <link href="metaverse/nounsofcomputersystem/"/>
      <url>metaverse/nounsofcomputersystem/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="cpu"><a href="#cpu" class="headerlink" title="cpu"></a>cpu</h1><h3 id="socket-s"><a href="#socket-s" class="headerlink" title="socket(s)"></a>socket(s)</h3><p>主板上物理CPU插槽</p><h3 id="cpu-die"><a href="#cpu-die" class="headerlink" title="cpu die"></a>cpu die</h3><p>Die指从晶圆上切割下来的小方块，一个die内可能存在多个cpu内核，一个或多个Die可封装成一个CPU package(cpu socket)。</p><p>die之间通过片外总线互联，不同die之间的cpu内核不能共享cpu缓存(cache)，die内内核可共享L3 cache</p><h3 id="NUMA-nodes"><a href="#NUMA-nodes" class="headerlink" title="NUMA nodes"></a>NUMA nodes</h3><p>一个socket可以划分多个NUMA node</p><ul><li>NUMA 引入了本地内存和远程内存，CPU 访问本地内存的延迟会小于访问远程内存；</li><li>NUMA 的内存分配与内存回收策略结合时会可能会导致 Linux 的频繁交换分区（Swap）进而影响系统的稳定性</li></ul><h3 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h3><p>CPU的内核，一般一个socket含有多个Core</p><h3 id="Thread-s"><a href="#Thread-s" class="headerlink" title="Thread(s)"></a>Thread(s)</h3><p>超线程技术，一个core包含多个并行处理任务的thread，thread有独立执行上下文，共享内部寄存器，我们常说(看)的</p><h1 id="主板"><a href="#主板" class="headerlink" title="主板"></a>主板</h1><h3 id="PCH-蓝厂南桥，Platform-Controller-Hub"><a href="#PCH-蓝厂南桥，Platform-Controller-Hub" class="headerlink" title="PCH(蓝厂南桥，Platform Controller Hub)"></a>PCH(蓝厂南桥，Platform Controller Hub)</h3><p><img src= "/img/loading.gif" data-lazy-src="https://upload.wikimedia.org/wikipedia/commons/5/53/Intel_5_Series_architecture.png" alt="img"></p><p>淘汰南北桥设计，即将被SOP(不用DMI，用PCIe、USB等)淘汰，功能一直在增删</p><p>PCH具有原来ICH(I/O controller hub,南桥)的全部功能，又具有原来MCH(memory control hub,北桥)的管理引擎功能</p><h3 id="mmu-memory-management-unit，内存管理单元"><a href="#mmu-memory-management-unit，内存管理单元" class="headerlink" title="mmu(memory management unit，内存管理单元)"></a>mmu(memory management unit，内存管理单元)</h3><p>负责处理cpu的内存访问请求的计算机硬件</p><p>功能：虚拟地址到物理地址转换、内存保护、cpu告诉缓存控制</p><h4 id="虚拟内存管理技术"><a href="#虚拟内存管理技术" class="headerlink" title="虚拟内存管理技术"></a>虚拟内存管理技术</h4><p>早期PC 程序直接运行在屋里内存上，有下面几个缺点：</p><ol><li>物理内存不够，如，程序需要100k，物理内存只有64k</li><li>程序每次装载到内存地址不一样</li><li>内存使用率低，需要将整个程序放入内存才能运行</li><li>多任务操作系统，多个进程间地址空间不隔离，一个任务失败可能导致整个系统崩溃</li></ol><h4 id="MMU的分页技术"><a href="#MMU的分页技术" class="headerlink" title="MMU的分页技术"></a>MMU的分页技术</h4><p>虚拟地址空间划分成页(page)，物理地址分成页框(frame)，页和页框大小相同，程序访问虚拟内存，虚拟内存对应物理内存，物理内存并不一定存着虚拟内存所需要的页，可能存在外存中。</p><h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h3 id="网络字节序"><a href="#网络字节序" class="headerlink" title="网络字节序"></a>网络字节序</h3><p>msb：most significant bit,最高有效位，二进制中的msb是最高位</p><p>lsb：least significant bit, 最低有效位，二进制中的lsb事最后一位</p><p>大端模式：big-endian，数据高位字节放内存低地址端</p><p>小端模式：little-eendian，数据低位字节放内存低地址端</p><p>主机可能大端也可能小端</p><p>网络字节序与cpu类型、操作系统无关，网络字节序采用大端模式</p><h1 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h1><h1 id="体系技术"><a href="#体系技术" class="headerlink" title="体系技术"></a>体系技术</h1>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 编程基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>arping的使用</title>
      <link href="metaverse/arping/"/>
      <url>metaverse/arping/</url>
      
        <content type="html"><![CDATA[<h1 id="arping详解"><a href="#arping详解" class="headerlink" title="arping详解"></a>arping详解</h1><p><strong>版本</strong></p><p>  arping主要干的活就是查看ip的MAC地址及IP占用的问题。</p><p>  arping有两个版本，一个版本是Thomas Habets这个人写的，这个版本有个好处是可以arping &lt;MAC地址&gt;，也就是说我们可以通过MAC地址得到IP。还有一个版本是Linux iputils suite的，这个版本就不能通过MAC地址，解析出IP地址了。</p><p>  可以使用arping -V来查看自己系统的arping的版本</p><p>  楼主观察了CentOS使用的是Linux iputils suite版本的，debian使用的是Thomas Habets。</p><p>  注意两个版本的的arping使用的参数有很大的区别，所以要根据自己的arping版本去使用相应的参数。别到网上抄了个，结果在自己的系统上不能执行。</p><p>  楼主使用的系统debian是Thomas Habets版本的，所以下面的很多参数只适合debian操作系统。</p><p><strong>TH版简介</strong></p><p>  过程：给一个主机，发送arp或者ICMP包，并打印回复的消息。主机可以以hostname，ip地址，mac地址等形式出现。一个请求包，每隔一秒发送一次。为什么说发送的包有arp和icmp呢，因为，当主机为ip或hostname的时候，发送的是arp请求包。当主机是mac地址的时候，发送的则是icmp的echo广播包</p><p><strong>参数</strong></p><p>-0：指定源地址为0.0.0.0，这个一般是在我们刚刚安装好系统，电脑还没配置好IP的时候</p><p>-a：Audible ping.这个当有reply回来的时候，你的电脑有喇叭的话，就会滴滴的叫</p><p>-A：Only count addresses matching requested address</p><p>-b：类似-0，指定源broadcast为255.255.255.255</p><p>-B：指定这个就相当于 arping 255.255.255.255</p><p><strong>-c count</strong>：发送指定数量的arp包后，即停止退出</p><p><strong>-d</strong>：这个比较重要，当局域网有IP占用的时候，可以指定这个参数，当有相同的IP的不同MAC地址reply的时候，arping会退出，退出码为1<br>-D：这个检测是否丢包的，当丢包的时候打印感叹号，正常的时候打印逗号</p><p>-e：和-a相反，当没有reply的时候，会滴滴滴</p><p>-p：打开混杂模式，当前用户对mac无权限时，可以加上这个选</p><p><strong>-r</strong>：输出的时候只打印MAC，写脚本的时候用得到，不用自己对结果awk了</p><p><strong>-R</strong>：输出的时候只打印IP，和上面一样</p><p>-s MAC：指定源MAC地址</p><p>-S IP：指定源IP，设置了源IP，如果目标主机没有到源IP的route，则有可能收不到answer</p><p>-t MAC：指定目的MAC</p><p>-T IP：指定目的IP，</p><p>-i interface：指定发送arp包的设备。不指定的话，默认为系统的第一块网卡</p><p><strong>-q</strong>：表示不打印输出，写脚本不想打印输出的时候，应该用的到</p><p>-u：没啥大用，结果显示的时候，加这个参数和不加，index的显示形式不同</p><p>-v：打印详细的输出，默认打印的好像就是verbose</p><p><strong>-w deadline</strong>：指定两个ping直接的时间间隔，单位为毫秒，默认为1秒</p><p><strong>用法</strong></p><p>讲了这么多，感觉大多数的参数都用不到吧。记住常见用法就OK了</p><p>用法1：查看某个IP的MAC地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping 192.168.131.155</span><br></pre></td></tr></table></figure><p>用法2：查看某个IP的MAC地址，并指定count数量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -c 1 192.168.131.155</span><br></pre></td></tr></table></figure><p>用法3：当有多块网卡的时候，指定特定的设备来发送请求包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -i eth1 -c 1 192.168.131.155</span><br></pre></td></tr></table></figure><p>用法4：查看某个IP是否被不同的MAC占用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -d 192.168.131.155</span><br></pre></td></tr></table></figure><p>用法5：查看某个MAC地址的IP，要在同一子网才查得到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -c 1 52:54:00:a1:31:89</span><br></pre></td></tr></table></figure><p>用法6：确定MAC和IP的对应，确定指定的网卡绑定了指定的IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -c 1  -T 192.168.131.156  00:13:72:f9:ca:60</span><br></pre></td></tr></table></figure><p>用法7：确定IP和MAC对应，确定指定IP绑在了指定的网卡上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arping -c 1  -t  00:13:72:f9:ca:60 192.168.131.156</span><br></pre></td></tr></table></figure><p>用法8：有时候，本地查不到某主机，可以通过让网关或别的机器去查。以下几种形式测了下都可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arping   -c 1  -S 10.240.160.1 -s 88:5a:92:12:c1:c1  10.240.162.115</span><br><span class="line">arping   -c 1  -S 10.240.160.1   10.240.162.115</span><br><span class="line">arping   -c 1  -s 88:5a:92:12:c1:c1  10.240.162.11</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的系统性知识总结(gitbook列表)</title>
      <link href="metaverse/structreadme/"/>
      <url>metaverse/structreadme/</url>
      
        <content type="html"><![CDATA[<h1 id="系统性知识的必要性"><a href="#系统性知识的必要性" class="headerlink" title="系统性知识的必要性"></a>系统性知识的必要性</h1><h1 id="gitbook-导航"><a href="#gitbook-导航" class="headerlink" title="gitbook 导航"></a>gitbook 导航</h1>]]></content>
      
      
      <categories>
          
          <category> 说明 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 说明 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装mysql server</title>
      <link href="metaverse/mysql/"/>
      <url>metaverse/mysql/</url>
      
        <content type="html"><![CDATA[<ol><li><p>sudo apt-get install mysql-server -y</p></li><li><p>初始化配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo mysql_secure_installation</span><br><span class="line"></span><br><span class="line">Securing the MySQL server deployment.</span><br><span class="line"></span><br><span class="line">Connecting to MySQL using a blank password.</span><br><span class="line"></span><br><span class="line">VALIDATE PASSWORD PLUGIN can be used to test passwords</span><br><span class="line">and improve security. It checks the strength of password</span><br><span class="line">and allows the users to set only those passwords which are</span><br><span class="line">secure enough. Would you like to setup VALIDATE PASSWORD plugin?</span><br><span class="line"></span><br><span class="line">Press y|Y for Yes, any other key for No: N</span><br><span class="line">Please set the password for root here.</span><br><span class="line"></span><br><span class="line">New password:</span><br><span class="line"></span><br><span class="line">Re-enter new password:</span><br><span class="line">By default, a MySQL installation has an anonymous user,</span><br><span class="line">allowing anyone to log into MySQL without having to have</span><br><span class="line">a user account created for them. This is intended only for</span><br><span class="line">testing, and to make the installation go a bit smoother.</span><br><span class="line">You should remove them before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? (Press y|Y for Yes, any other key for No) : N</span><br><span class="line"></span><br><span class="line"> ... skipping.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from</span><br><span class="line">&#x27;localhost&#x27;. This ensures that someone cannot guess at</span><br><span class="line">the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? (Press y|Y for Yes, any other key for No) : N</span><br><span class="line"></span><br><span class="line"> ... skipping.</span><br><span class="line">By default, MySQL comes with a database named &#x27;test&#x27; that</span><br><span class="line">anyone can access. This is also intended only for testing,</span><br><span class="line">and should be removed before moving into a production</span><br><span class="line">environment.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Remove test database and access to it? (Press y|Y for Yes, any other key for No) : N</span><br><span class="line"></span><br><span class="line"> ... skipping.</span><br><span class="line">Reloading the privilege tables will ensure that all changes</span><br><span class="line">made so far will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y</span><br><span class="line">Success.</span><br><span class="line"></span><br><span class="line">All done!</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机基本组成</title>
      <link href="metaverse/computerprinciples/"/>
      <url>metaverse/computerprinciples/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1 id="计算机基本组成"><a href="#计算机基本组成" class="headerlink" title="计算机基本组成"></a>计算机基本组成</h1><h2 id="基本组成"><a href="#基本组成" class="headerlink" title="基本组成"></a>基本组成</h2><h3 id="存储器"><a href="#存储器" class="headerlink" title="存储器"></a>存储器</h3><p>存放数据和程序的设备，根据功能分为主存、辅存</p><h4 id="主存"><a href="#主存" class="headerlink" title="主存"></a>主存</h4><p>主存储器，通俗称内存，直接与CPU通过MMU交换信息(cpu内部还有几级高速缓存)，速度比较快，容量比较小，ROM掉电非易失，RAM掉电易失(我们电脑的内存)</p><h4 id="辅存"><a href="#辅存" class="headerlink" title="辅存"></a>辅存</h4><p>又称外存，与主存交换信息，速度慢，容量大，掉电非易失，一般就是指我们的固态硬盘、机械硬盘、U盘、光驱+光盘等</p><h3 id="运算器"><a href="#运算器" class="headerlink" title="运算器"></a>运算器</h3><p>位于CPU(中央处理器，central processing unit)中，基本就是指ALU，中文世界一般还把FPU、GPU、寄存器组、累加器、数据总线划入其中</p><h4 id="FPU"><a href="#FPU" class="headerlink" title="FPU"></a>FPU</h4><p>浮点运算器(floating point unit)，电路实现的运行浮点运算的结构(以前用ALU模拟，精度低)，通常集成在CPU中，现代计算机中浮点运算会与SIMD(Single Instruction Multiple Data，一个控制器控制多个处理器)集成在一个指令集内</p><h4 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h4><p>入行处理单元，详见GPU设计与架构文章</p><h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p>控制器 control unit，现代计算机集成在CPU中，指导处理器操作(二进制解码指令转换为控制、定时等信号)</p><h3 id="输入设备"><a href="#输入设备" class="headerlink" title="输入设备"></a>输入设备</h3><p>外设输入，键鼠等</p><h3 id="输出设备"><a href="#输出设备" class="headerlink" title="输出设备"></a>输出设备</h3><p>外设输出，显示器等</p><h2 id="总线信息"><a href="#总线信息" class="headerlink" title="总线信息"></a>总线信息</h2><h3 id="位置分类"><a href="#位置分类" class="headerlink" title="位置分类"></a>位置分类</h3><ul><li>片内总线：芯片内部传送信息的通道</li><li>外部总线：CPU与外设通信,PCI(E)、PXI(E)总线等</li><li>系统总线：<ul><li>数据总线：在CPU与RAM之间传输数据</li><li>地址总线：指定RAM存储地址或者I/O设备地址</li><li>控制总线：将控制器信号传输到其他设备(存储器、I/O设备等)</li></ul></li></ul><h3 id="传送方式分类"><a href="#传送方式分类" class="headerlink" title="传送方式分类"></a>传送方式分类</h3><ul><li>串行总线：Serial communication每次传一位(bit)，rs-232/422/423/485、I2C、PCIE、USB、以太网、SATA等，现在是高速串行总线时代！</li><li>并行总线：同时传送多位数，ATA、PCI、SCSI等，目前用处较少，原因是根据SSN原理限制了并行带宽</li></ul><h2 id="主板接口"><a href="#主板接口" class="headerlink" title="主板接口"></a>主板接口</h2><h4 id="PCIE插槽"><a href="#PCIE插槽" class="headerlink" title="PCIE插槽"></a>PCIE插槽</h4><p>一般插显卡、声卡、无线网卡等，由短到长分别为：PCIEx1、PCIEx4、PCIEx8、PCIEx16，后面数字代表PCIE通道数量</p><h4 id="M-2插槽"><a href="#M-2插槽" class="headerlink" title="M.2插槽"></a>M.2插槽</h4><p>有两个PCIE通道的socket2和四通道的socket3两个版本</p><h4 id="SATA插槽"><a href="#SATA插槽" class="headerlink" title="SATA插槽"></a>SATA插槽</h4><p>硬盘插槽，一般一个PCIE通道</p><h4 id="DIMM插槽"><a href="#DIMM插槽" class="headerlink" title="DIMM插槽"></a>DIMM插槽</h4><p>内存插槽</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> 编程基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hive搭建 centos</title>
      <link href="metaverse/hive/"/>
      <url>metaverse/hive/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h4 id="centos下-Hive搭建（mysql、hadoop-、jdk）"><a href="#centos下-Hive搭建（mysql、hadoop-、jdk）" class="headerlink" title="centos下 Hive搭建（mysql、hadoop 、jdk）"></a>centos下 Hive搭建（mysql、hadoop 、jdk）</h4><h4 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h4><ol><li><p> wget <a href="https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm">https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</a></p></li><li><p>```<br> rpm -ivh mysql80-community-release-el7-3.noarch.rpm</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3.  &#96;&#96;&#96;</span><br><span class="line">    yum install mysql-community-server -y</span><br><span class="line">    systemctl enable mysqld</span><br><span class="line">    systemctl start mysqld</span><br><span class="line">    grep &#39;temporary password&#39; &#x2F;var&#x2F;log&#x2F;mysqld.log #获得密码</span><br><span class="line">    mysql -u root -p</span><br><span class="line">    mysql&gt; set global validate_password.policy&#x3D;0;</span><br><span class="line">    mysql&gt; set global validate_password.length&#x3D;1;</span><br><span class="line">    mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;password&#39;;</span><br><span class="line">    firewall-cmd --zone&#x3D;public --add-port&#x3D;3306&#x2F;tcp --permanent</span><br><span class="line">    firewall-cmd --reload</span><br></pre></td></tr></table></figure></li></ol><p>完整脚本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">yum install mysql-community-server -y</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line">systemctl start mysqld</span><br><span class="line">grep <span class="string">&#x27;temporary password&#x27;</span> /var/<span class="built_in">log</span>/mysqld.log <span class="comment">#获得密码</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.policy=0;</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.length=1;</span><br><span class="line">mysql&gt; alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h4 id="hadoop安装"><a href="#hadoop安装" class="headerlink" title="hadoop安装"></a>hadoop安装</h4><p>Hadoop的核心由3个部分组成：</p><p>  HDFS: Hadoop Distributed File System，分布式文件系统，hdfs还可以再细分为NameNode、SecondaryNameNode、DataNode。</p><p>  YARN: Yet Another Resource Negotiator，资源管理调度系统</p><p>  Mapreduce：分布式运算框架</p><p>1.安装jdk7或8（不支持11）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">下载</span></span><br><span class="line">wget -O jdk-8u131-linux-x64.tar.gz --no-check-certificate --no-cookies --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf ~/jdk-8u131-linux-x64.tar.gz -C /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置环境</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">  后面添加</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_131</span><br><span class="line">export CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载配置</span></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">验证</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">下载hadoop</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget https://downloads.apache.org/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz</span></span><br><span class="line">wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz</span><br><span class="line">tar zxvf hadoop-2.10.1.tar.gz -C /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置jdk</span></span><br><span class="line">vi $&#123;HADOOP_HMOE&#125;/etc/hadoop/hadoop-003env.sh</span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_131/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">设置伪分布模式（Pseudo-Distributed Operation）修改etc/hadoop/core-site.xml文件，增加配置（fs.defaultFS：默认文件系统名称）：</span></span><br><span class="line">vi $&#123;HADOOP_HMOE&#125;/etc/hadoop/core-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 修改etc/hadoop/hdfs-site.xml文件，增加配置（dfs.replication：文件副本数）：</span></span><br><span class="line"> &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">格式化文件系统</span></span><br><span class="line">/usr/local/hadoop-2.10.1/bin/hdfs namenode -format</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">启动NameNode和DataNode进程（启动hdfs）</span></span><br><span class="line">/usr/local/hadoop-2.10.1/sbin/start-dfs.sh // 启动NameNode和DataNode进程</span><br><span class="line">/usr/local/hadoop-2.10.1/sbin/stop-dfs.sh  // 关闭NameNode和DataNode进程</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看HDFS验证成功</span></span><br><span class="line">http://172.20.19.33:50070</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">启动yarn</span></span><br><span class="line">/usr/local/hadoop-2.10.1/sbin/start-yarn.sh</span><br><span class="line">/usr/local/hadoop-2.10.1/sbin/stop-yarn.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看YARN</span></span><br><span class="line">http://172.20.19.33:8088/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置环境</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">  后面添加</span></span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop-2.10.1</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载配置</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h4 id="Hive安装"><a href="#Hive安装" class="headerlink" title="Hive安装"></a>Hive安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/apache/hive/hive-3.1.2/apache-hive-3.1.2-bin.tar.gz -c #比较慢，断点下载</span><br><span class="line">tar zxvf apache-hive-3.1.2-bin.tar.gz -C /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">改名去bin</span></span><br><span class="line">mv apache-hive-3.1.2-bin/ apache-hive-3.1.2/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置</span></span><br><span class="line">cd /usr/local/apache-hive-3.1.2/conf/</span><br><span class="line">cp hive-log4j2.properties.template hive-log4j2.properties</span><br><span class="line">vi /usr/local/apache-hive-3.1.2/conf/hive-site.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;jdbc:mysql://172.20.19.33:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt;</span><br><span class="line">　&lt;/property&gt;</span><br><span class="line">　&lt;property&gt;</span><br><span class="line">    &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">　　&lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;password&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">初始化数据库</span></span><br><span class="line"><span class="meta">#</span><span class="bash">下载并拷贝protobuf-java-3.6.1.jar和mysql-connector-java-8.0.17.jar到<span class="variable">$HIVE_HOME</span>/lib目录下，删除已有的protobuf-java-2.5.0.jar文件。统一hive和mysql服务的时区。</span></span><br><span class="line">wget -c https://repo1.maven.org/maven2/com/google/protobuf/protobuf-java/3.6.1/protobuf-java-3.6.1.jar</span><br><span class="line">wget -c https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.17/mysql-connector-java-8.0.17.jar</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # hive和mysql服务器都要执行，mysql要重启服务</span><br><span class="line">cd /usr/local/apache-hive-3.1.2/bin/</span><br><span class="line">/usr/local/apache-hive-3.1.2/bin/schematool -dbType mysql -initSchema # 报错需要修改mysql访问权限</span><br><span class="line">/usr/local/apache-hive-3.1.2/bin/hive</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  启动hiveserver2：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改<span class="variable">$HADOOP_HOME</span>/etc/hadoop/core-site.xml文件，增加如下配置：</span></span><br><span class="line">vi /usr/local/hadoop-2.10.1/etc/hadoop/core-site.xml</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">         &lt;name&gt;hadoop.proxyuser.hadoop.hosts&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"> &lt;property&gt;</span><br><span class="line">         &lt;name&gt;hadoop.proxyuser.hadoop.groups&lt;/name&gt;</span><br><span class="line">         &lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">vi /usr/local/apache-hive-3.1.2/conf/hive-site.xml</span><br><span class="line"></span><br><span class="line">  &lt;property&gt;</span><br><span class="line">     &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;10000&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">     &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;172.20.19.33&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">/usr/local/apache-hive-3.1.2/bin/hiveserver2 &amp;</span><br></pre></td></tr></table></figure><p>mysql权限修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改表法</span></span><br><span class="line">mysql -u root -pvmware</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">use mysql;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">update user <span class="built_in">set</span> host = <span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user = <span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">flush privileges;</span></span><br></pre></td></tr></table></figure><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p><strong>Hive Shell 、Hive Web UI及JDBC 三种连接Hive Server的方式是互斥的，同一时刻只能用一种方式连接</strong></p><h3 id="端口说明"><a href="#端口说明" class="headerlink" title="端口说明"></a>端口说明</h3><table><thead><tr><th>组件</th><th>Daemon</th><th>端口</th><th>配置</th><th>说明</th></tr></thead><tbody><tr><td>HDFS</td><td>DataNode</td><td>50010</td><td>dfs.datanode.address</td><td>datanode服务端口，用于数据传输</td></tr><tr><td></td><td></td><td>50075</td><td>dfs.datanode.http.address</td><td>http服务的端口</td></tr><tr><td></td><td></td><td>50475</td><td>dfs.datanode.https.address</td><td>https服务的端口</td></tr><tr><td></td><td></td><td>50020</td><td>dfs.datanode.ipc.address</td><td>ipc服务的端口</td></tr><tr><td></td><td>NameNode</td><td>50070</td><td>dfs.namenode.http-address</td><td>http服务的端口</td></tr><tr><td></td><td></td><td>50470</td><td>dfs.namenode.https-address</td><td>https服务的端口</td></tr><tr><td></td><td></td><td>8020</td><td>fs.defaultFS</td><td>接收Client连接的RPC端口，用于获取文件系统metadata信息。</td></tr><tr><td></td><td>journalnode</td><td>8485</td><td>dfs.journalnode.rpc-address</td><td>RPC服务</td></tr><tr><td></td><td></td><td>8480</td><td>dfs.journalnode.http-address</td><td>HTTP服务</td></tr><tr><td></td><td>ZKFC</td><td>8019</td><td>dfs.ha.zkfc.port</td><td>ZooKeeper FailoverController，用于NN HA</td></tr><tr><td>YARN</td><td>ResourceManager</td><td>8032</td><td>yarn.resourcemanager.address</td><td>RM的applications manager(ASM)端口</td></tr><tr><td></td><td></td><td>8030</td><td>yarn.resourcemanager.scheduler.address</td><td>scheduler组件的IPC端口</td></tr><tr><td></td><td></td><td>8031</td><td>yarn.resourcemanager.resource-tracker.address</td><td>IPC</td></tr><tr><td></td><td></td><td>8033</td><td>yarn.resourcemanager.admin.address</td><td>IPC</td></tr><tr><td></td><td></td><td>8088</td><td>yarn.resourcemanager.webapp.address</td><td>http服务端口</td></tr><tr><td></td><td>NodeManager</td><td>8040</td><td>yarn.nodemanager.localizer.address</td><td>localizer IPC</td></tr><tr><td></td><td></td><td>8042</td><td>yarn.nodemanager.webapp.address</td><td>http服务端口</td></tr><tr><td></td><td></td><td>8041</td><td>yarn.nodemanager.address</td><td>NM中container manager的端口</td></tr><tr><td></td><td>JobHistory Server</td><td>10020</td><td>mapreduce.jobhistory.address</td><td>IPC</td></tr><tr><td></td><td></td><td>19888</td><td>mapreduce.jobhistory.webapp.address</td><td>http服务端口</td></tr><tr><td>HBase</td><td>Master</td><td>60000</td><td>hbase.master.port</td><td>IPC</td></tr><tr><td></td><td></td><td>60010</td><td>hbase.master.info.port</td><td>http服务端口</td></tr><tr><td></td><td>RegionServer</td><td>60020</td><td>hbase.regionserver.port</td><td>IPC</td></tr><tr><td></td><td></td><td>60030</td><td>hbase.regionserver.info.port</td><td>http服务端口</td></tr><tr><td></td><td>HQuorumPeer</td><td>2181</td><td>hbase.zookeeper.property.clientPort</td><td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td></tr><tr><td></td><td></td><td>2888</td><td>hbase.zookeeper.peerport</td><td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td></tr><tr><td></td><td></td><td>3888</td><td>hbase.zookeeper.leaderport</td><td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td></tr><tr><td>Hive</td><td>Metastore</td><td>9083</td><td>/etc/default/hive-metastore中export PORT=<port>来更新默认端口</td><td></td></tr><tr><td></td><td>HiveServer</td><td>10000</td><td>/etc/hive/conf/hive-env.sh中export HIVE_SERVER2_THRIFT_PORT=<port>来更新默认端口</td><td></td></tr><tr><td>ZooKeeper</td><td>Server</td><td>2181</td><td>/etc/zookeeper/conf/zoo.cfg中clientPort=<port></td><td>对客户端提供服务的端口</td></tr><tr><td></td><td></td><td>2888</td><td>/etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分</td><td>follower用来连接到leader，只在leader上监听该端口。</td></tr><tr><td></td><td></td><td>3888</td><td>/etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分</td><td>用于leader选举的。只在electionAlg是1,2或3(默认)时需要。</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>50行代码实现md图床</title>
      <link href="metaverse/picpool/"/>
      <url>metaverse/picpool/</url>
      
        <content type="html"><![CDATA[<p><a href="http://longtao.fun/">首页</a> -&gt; <a href="http://longtao.fun/product/product.html">项目列表</a></p><p>原文地址：<a href="https://longtao.fun/picture_pool/">https://longtao.fun/picture_pool/</a></p><h3 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h3><p>服务端代码,使用flask提供api服务，两个接口，一个用来上传，一个用来查看图片，上传图片返回图片url</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line"></span><br><span class="line">file_path = os.path.join(os.path.dirname(__file__), <span class="string">&#x27;pics&#x27;</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/eus/v1/photo&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_frame</span>():</span></span><br><span class="line">    upload_file = request.data</span><br><span class="line">    img = base64.b64decode(upload_file)</span><br><span class="line">    file_name = <span class="built_in">str</span>(uuid.uuid1())</span><br><span class="line">    file_paths = os.path.join(file_path, file_name)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_paths, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;http://&#123;&#125;:5555/eus/v1/show/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ip, file_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/eus/v1/show/&lt;string:filename&gt;&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">filename</span>):</span></span><br><span class="line">    file_paths = os.path.join(file_path, filename)</span><br><span class="line">    f = <span class="built_in">open</span>(file_paths, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">    response = make_response(f)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5555</span>)</span><br></pre></td></tr></table></figure><p>客户端脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) == <span class="number">1</span>:</span><br><span class="line">    sys.argv.append(<span class="string">&#x27;--help&#x27;</span>)</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--source&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;必须传入文件&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--ip&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, nargs=<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&quot;必须指定地址&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">image_list = args.source</span><br><span class="line">url = <span class="string">&#x27;http://&#123;&#125;:5555/eus/v1/photo&#x27;</span>.<span class="built_in">format</span>(args.ip[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">_img</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(_img):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(_img, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            file = f.read()</span><br><span class="line">            encode_f = base64.b64encode(file)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        file = requests.get(_img).content</span><br><span class="line">        encode_f = base64.b64encode(file)</span><br><span class="line">    <span class="keyword">return</span> encode_f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> image_list:</span><br><span class="line">        req = requests.post(url=url, data=get_data(img))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;http://&quot;</span>+<span class="built_in">str</span>(req.text))</span><br></pre></td></tr></table></figure><h4 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h4><ol><li>使用go重写方便部署</li><li>图片去重</li><li>图片压缩</li></ol><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><ol><li> 下载本repo源码</li><li> 安装python3环境，安装</li><li> 修改main 中的ip地址为你的服务端公网ip，是遏制iptables开启5555端口;</li><li> nohup python3 $repoPath/main.py &amp;启动或者通过systemd启动</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;[Unit]</span><br><span class="line">Description=simple picture pool</span><br><span class="line">   </span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/python3 /root/pic_pool/picture_pool/main.py &gt; /dev/null   2&gt;&amp;1</span><br><span class="line">   </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target &quot; &gt; /etc/systemd/system/spp.service</span><br><span class="line">systemctl status spp</span><br><span class="line">systemctl start spp</span><br><span class="line">systemctl enable spp</span><br></pre></td></tr></table></figure><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><ol><li> 在你的修改upload_script.py 中的ip为你搭建的服务端ip（默认的172.20.18.38是我在0.10搭建好的）；</li><li>在你的markdown 编辑器按照以下操作文件-&gt;偏好设置-&gt;图像-&gt;custom上传服务，在命令里填写<code>python3 upload_script.py的绝对路径 -i 你的服务ip地址  -s</code> 例如<code>python3 /home/longtao/workspace/projects/picture_pool/upload_script.py -i 172.20.18.38 -s</code><br> <img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092275f552d50-f59f-11eb-8016-fa1e86d74c00"></li><li>选择插入图片时上传图片，勾选，本地和网络，点击验证上传服务，如下为成功验证<br> <img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/163530923262f6ba28-f59f-11eb-90f6-fa1e86d74c00"></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jenkins安装</title>
      <link href="metaverse/jenkins/"/>
      <url>metaverse/jenkins/</url>
      
        <content type="html"><![CDATA[<h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><p>打开终端，输入docker search命令搜索 Docker Hub 上可用的 Jenkins 镜像：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker search jenkins</span><br><span class="line">NAME                                         DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">jenkins                                      Official Jenkins Docker image                   4328                [OK]</span><br><span class="line">jenkins&#x2F;jenkins                              The leading open source automation server       1563</span><br><span class="line">jenkinsci&#x2F;blueocean                          https:&#x2F;&#x2F;jenkins.io&#x2F;projects&#x2F;blueocean           399</span><br><span class="line">jenkinsci&#x2F;jenkins                            Jenkins Continuous Integration and Delivery …   367</span><br><span class="line">jenkinsci&#x2F;jnlp-slave                         A Jenkins slave using JNLP to establish conn…   110                                     [OK]</span><br><span class="line">jenkins&#x2F;jnlp-slave                           a Jenkins agent (FKA &quot;slave&quot;) using JNLP to …   86                                      [OK]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>根据镜像OFFICIAL标签判断，位列第一、名字为jenkins的是 Jenkins 官方提供的镜像。我们是不是应该使用这个官方镜像呢？</p><p>如果你看过 Jenkins 文档中 Docker 安装 小节，会发现官方推荐使用的镜像是jenkinsci/blueocean，该镜像包含当前的长期支持 (LTS) 的 Jenkins 版本 (可以生产使用) ，并捆绑了所有 Blue Ocean 插件和功能。</p><p>第一次安装的时候使用的是jenkins镜像，其集成的 Jenkins 版本比较高，结果出现好多插件不兼容的情况，对于我等小白来说是一件比较麻烦的事。</p><p>这里我们果断使用jenkinsci/blueocean镜像，使用docker pull命令拉取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull jenkinsci&#x2F;blueocean</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from jenkinsci&#x2F;blueocean</span><br><span class="line">Digest: sha256:523769431f19830cfda7ceae37c59c9f01affb551836933aa30114dcaa5df9eb</span><br><span class="line">Status: Image is up to date for jenkinsci&#x2F;blueocean:latest</span><br></pre></td></tr></table></figure><p>在本地镜像仓库确认是否已存在：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">jenkinsci&#x2F;blueocean   latest              ef2dc74fe285        21 hours ago        552MB</span><br><span class="line">mysql                 latest              990386cbd5c0        2 months ago        443MB</span><br><span class="line">jenkins               latest              cd14cecfdb3a        11 months ago       696MB</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h2><p>现在，就可以基于下载的镜像运行 Jenkins 容器了，有以下两种运行方式供你参考：</p><p>方式一：直接运行，运行期间产生的所有数据都保存在容器内部，容器销毁，数据丢失。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    --name jenkins-blueocean \</span><br><span class="line">    -d \</span><br><span class="line">    -p 8081:8080 \</span><br><span class="line">    -p 50001:50000 \</span><br><span class="line">    jenkinsci&#x2F;blueocean</span><br></pre></td></tr></table></figure><p>方式二：Docker 会在宿主机上创建一个数据卷jenkins-data，容器映射该卷以持久化数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name jenkins-blueocean \</span><br><span class="line">  -d \</span><br><span class="line">  -p 8081:8080 \</span><br><span class="line">  -p 50000:50000 \</span><br><span class="line">  -v jenkins-data:&#x2F;var&#x2F;jenkins_home \</span><br><span class="line">  jenkinsci&#x2F;blueocean</span><br></pre></td></tr></table></figure><p>Tips：8081 端口用来公开访问 Web 界面，50000 端口允许访问远程 Java (JIRA) API。</p><p>这里我使用了第二种方式启动了 一个 Jenkins 容器应用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">  --name jenkins-blueocean \</span><br><span class="line">  -d \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -p 50000:50000 \ </span><br><span class="line">  -v jenkins-data:&#x2F;var&#x2F;jenkins_home \</span><br><span class="line">  jenkinsci&#x2F;blueocean</span><br><span class="line">93f88d6ca2129fae971298e98e20091570f6903463b203a9235660856f63020e</span><br></pre></td></tr></table></figure><p>最后使用docker ps命令确认容器是否已经后台运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class="line">0cad9bbe76a6        jenkinsci&#x2F;blueocean   &quot;&#x2F;sbin&#x2F;tini -- &#x2F;usr&#x2F;…&quot;   About an hour ago   Up About an hour    0.0.0.0:8080-&gt;8080&#x2F;tcp, 0.0.0.0:50000-&gt;50000&#x2F;tcp   jenkins-blueocean</span><br></pre></td></tr></table></figure><h2 id="配置-Jenkins"><a href="#配置-Jenkins" class="headerlink" title="配置 Jenkins"></a>配置 Jenkins</h2><p>以上如果一切正常，现在就可以通过http://<ipaddress>:8080访问 Jenkins 的 Web 界面了。</p><h3 id="Step1：解锁-Jenkins。"><a href="#Step1：解锁-Jenkins。" class="headerlink" title="Step1：解锁 Jenkins。"></a>Step1：解锁 Jenkins。</h3><p>Alt Text</p><p>管理员初始密码被放到了/var/jenkins_home/secrets/initialAdminPassword 文件中。</p><p>因为我们把 Jenkins 部署在了 Docker 容器中，因此需要先进入到容器，再去查看对应的文件initialAdminPassword内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it jenkins-blueocean &#x2F;bin&#x2F;bash</span><br><span class="line">jenkins@93f88d6ca212:&#x2F;$ cat &#x2F;var&#x2F;jenkins_home&#x2F;secrets&#x2F;initialAdminPassword</span><br><span class="line">a6f6d08fcc474178833001d1fc79be62</span><br></pre></td></tr></table></figure><p>如上输出中，a6f6d08fcc474178833001d1fc79be62 便是我们需要的管理员密码，复制并粘贴到 Web 界面，点击继续即可解锁 Jenkins。</p><h3 id="Step2：安装插件。"><a href="#Step2：安装插件。" class="headerlink" title="Step2：安装插件。"></a>Step2：安装插件。</h3><p>Jenkins 可以说完全由插件来驱动的，所以安装一些基础的插件是非要必要的，这里我们选择 安装推荐的插件 ，然后静静地等待插件安装完成即可。</p><h3 id="Step3：创建用户。"><a href="#Step3：创建用户。" class="headerlink" title="Step3：创建用户。"></a>Step3：创建用户。</h3><p>接着继续下一步操作，提示需要创建一个新的用户，自行填写即可。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>访问samba共享文件夹</title>
      <link href="metaverse/samba/"/>
      <url>metaverse/samba/</url>
      
        <content type="html"><![CDATA[<h3 id="whats-samba？"><a href="#whats-samba？" class="headerlink" title="whats samba？"></a>whats samba？</h3><p>Samba is the standard Windows interoperability suite of programs for Linux and Unix.</p><h3 id="Use-in-linux"><a href="#Use-in-linux" class="headerlink" title="Use in linux"></a>Use in linux</h3><h3 id="Use-in-Windows"><a href="#Use-in-Windows" class="headerlink" title="Use in Windows"></a>Use in Windows</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t cifs //ip地址/path/to/share path/to/mount</span><br><span class="line">: &lt;&lt;&#x27;COMMEN</span><br><span class="line">mount：挂载命令</span><br><span class="line">-t cifs： 用cifs文件系统挂载samba共享文件，如果提示错误的文件系统的话，可能是没有cifs，需要自己安装。【centos：</span><br><span class="line">yum install nfs-utils】</span><br><span class="line"></span><br><span class="line">//ip地址/path/to/share：共享目录路径</span><br><span class="line">path/to/mount：要挂载的路径，需要自己创建一个</span><br><span class="line">COMMENT</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sysprep</title>
      <link href="metaverse/sysprep/"/>
      <url>metaverse/sysprep/</url>
      
        <content type="html"><![CDATA[<p>Sysprep程序是微软公司用来配置Microsoft Windows全新安装的一个工具，是为方便企业用户部署系统而设计的。</p><h2 id="Sysprep使用"><a href="#Sysprep使用" class="headerlink" title="Sysprep使用"></a>Sysprep使用</h2><p>1、程序位置为：“C:\Windows\System32\sysprep\sysprep.exe”，也可以通过运行“sysprep”，打开sysprep.exe封装工具。<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177540image_thumb-18.png" alt="image"><br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177545image_thumb-19.png" alt="image"><br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177553image_thumb-20.png" alt="image"></p><p>2、运行sysprep.exe封装工具，打开后点击确定就可以进行封装。<br>如果勾选“通用”的话有什么作用？<br>如果勾选“通用”在初始化系统的时候后会多一个硬件和驱动重新识别和安装的过程。<br>一般是跨硬件进行操作系统迁移的时候才会勾选该按钮，就是让这次封装的系统能在其它不同硬件的计算机上运行。</p><p>关机选项可以根据我们需求进行配置，如果设置为重新启动，封装完成后会自动进行重启。<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177563image_thumb-21.png" alt="image"><br><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177558image_thumb-22.png" alt="image"></p><p>封装完成后就可以看到 欢迎界面了。</p><p>封装完成后你的操作系统配置与数据是不丢失的，包括windows激活与防火墙配置等。</p><h2 id="为什么要使用Sysprep作用"><a href="#为什么要使用Sysprep作用" class="headerlink" title="为什么要使用Sysprep作用"></a>为什么要使用Sysprep作用</h2><p>微软的操作系统很早就开始使用安全标识符（SID）对计算机和用户进行识别。在域控环境中，分配给计算机账号的叫 Machine SID，分配给用户账户的是用户账户 SID。处于工作组计算机的 SID 是由算法生成的，除特殊账户外，其它用户的 SID 也是由算法生成的；而域中各对象的 SID 是由域范围的 SID 和具有唯一性的相对标识符 (RID) 连接组成，RID 是在创建安全主体时由域中的 RID Master 分配的。RID Master 的作用是：分配可用 RID 池给域内的 DC 以及防止对象的 SID 重复。</p><p>所以当你从一台主机克隆出多个 PC，或者使用同一虚拟机母板克隆出多台 VM 之后，其 SID 势必会相同，在加入域时会造成安全主体的识别混乱和加域失败等，通过Sysprep封装就可以解决该问题。</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git的使用</title>
      <link href="metaverse/git/"/>
      <url>metaverse/git/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="git-attributes文件"><a href="#git-attributes文件" class="headerlink" title="git attributes文件"></a>git attributes文件</h2><p>gitattributes是一个文本文件</p><p>格式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">匹配的文件如(*.py) 属性1(如text)  属性2(如eol&#x3D;lf)</span><br></pre></td></tr></table></figure><p>属性有4种状态，以text为例</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*           text=auto #设置值</span><br><span class="line">*.shtext #设置text</span><br><span class="line">*.jpg-text 不设置</span><br><span class="line">*.py未声明</span><br></pre></td></tr></table></figure><p>常见属性说明</p><p>txt：行尾规范化，值为auto时，进入git库行尾自动转为LF，若git库中已经CRLF则不转换</p><p>eol: 值为CRLF时进入工作目录为CRLF，值为LF时进入工作目录为LF</p><h2 id="git-操作"><a href="#git-操作" class="headerlink" title="git 操作"></a>git 操作</h2><h3 id="克隆指定分支"><a href="#克隆指定分支" class="headerlink" title="克隆指定分支"></a>克隆指定分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b feature-vnuma ssh:&#x2F;&#x2F;git@dev.zstack.io:9022&#x2F;mingmin.wen&#x2F;zstack.git</span><br></pre></td></tr></table></figure><h3 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git branch    <span class="comment">#查看本地分支</span></span><br><span class="line">git branch -a <span class="comment">#查看所有分支，包括本地和远程</span></span><br><span class="line">git branch -r <span class="comment">#查看远程分支</span></span><br><span class="line">git branch -vv <span class="comment">#查看上有</span></span><br></pre></td></tr></table></figure><h3 id="同步远程分支"><a href="#同步远程分支" class="headerlink" title="同步远程分支"></a>同步远程分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch <span class="comment">#本地分支与远程分支保持同步</span></span><br><span class="line">git checkout -b 本地分支 origin/远程分支 <span class="comment">#拉去远程分支并创建对应的本地分支</span></span><br></pre></td></tr></table></figure><h3 id="git-reset-区别"><a href="#git-reset-区别" class="headerlink" title="git reset 区别"></a>git reset 区别</h3><h3 id="stage-index-区域"><a href="#stage-index-区域" class="headerlink" title="stage(index) 区域"></a>stage(index) 区域</h3><p>暂存区<code>Stage</code>只是一个简单的索引文件而已， <code>.git/index</code>文件</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211117/1637113648cc3510e8f32578ed0f39756e298749de.png" alt="git 数据流程图示意图"></p><h3 id="合并不同分支"><a href="#合并不同分支" class="headerlink" title="合并不同分支"></a>合并不同分支</h3><ol><li>切换到要最终合并到的目标分支targetB <code>git checkout targetB</code></li><li>将要合进的分支sourceB合并到目标分支 <code>git merge sourceB </code> 即可将sourceB合并到targetB</li><li>如果有冲突请看下一节</li></ol><h3 id="处理合并冲突"><a href="#处理合并冲突" class="headerlink" title="处理合并冲突"></a>处理合并冲突</h3><ol><li>一般ide都会提示你进入冲突处理，逐行处理冲突（使用目标分支的还是你自己分支的）</li><li>使用<code>git mergetool</code> 进入处理冲突,但是需要自己配置git mergertool</li></ol><h3 id="配置mergetool"><a href="#配置mergetool" class="headerlink" title="配置mergetool"></a>配置mergetool</h3><ol><li><p>检查当前系统插件<code>git mergetool --tool-help</code> 看一下支持列表</p></li><li><p>选一个工具下载下载，例如 beyound compare</p></li><li><p>配置<code>git config --global merge.tool bc4</code> <code>git config --global mergetool.bc4.path &quot;bcomp.exe的路径&quot;</code></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常见问题</title>
      <link href="metaverse/gittrouble/"/>
      <url>metaverse/gittrouble/</url>
      
        <content type="html"><![CDATA[<h2 id="git-attributes文件"><a href="#git-attributes文件" class="headerlink" title="git attributes文件"></a>git attributes文件</h2><p>gitattributes是一个文本文件</p><p>格式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">匹配的文件如(*.py) 属性1(如text)  属性2(如eol&#x3D;lf)</span><br></pre></td></tr></table></figure><p>属性有4种状态，以text为例</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*           text=auto #设置值 c</span><br><span class="line">*.shtext #设置text</span><br><span class="line">*.jpg-text 不设置</span><br><span class="line">*.py未声明</span><br></pre></td></tr></table></figure><p>常见属性说明</p><p>txt：行尾规范化，值为auto时，进入git库行尾自动转为LF，若git库中已经CRLF则不转换</p><p>eol: 值为CRLF时进入工作目录为CRLF，值为LF时进入工作目录为LF</p><h2 id="git-操作"><a href="#git-操作" class="headerlink" title="git 操作"></a>git 操作</h2><h3 id="克隆指定分支"><a href="#克隆指定分支" class="headerlink" title="克隆指定分支"></a>克隆指定分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b feature-vnuma ssh:&#x2F;&#x2F;git@dev.zstack.io:9022&#x2F;mingmin.wen&#x2F;zstack.git</span><br></pre></td></tr></table></figure><h3 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git branch    <span class="comment">#查看本地分支</span></span><br><span class="line">git branch -a <span class="comment">#查看所有分支，包括本地和远程</span></span><br><span class="line">git branch -r <span class="comment">#查看远程分支</span></span><br><span class="line">git branch -vv <span class="comment">#查看上有</span></span><br></pre></td></tr></table></figure><h3 id="同步远程分支"><a href="#同步远程分支" class="headerlink" title="同步远程分支"></a>同步远程分支</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch <span class="comment">#本地分支与远程分支保持同步</span></span><br><span class="line">git checkout -b 本地分支 origin/远程分支 <span class="comment">#拉去远程分支并创建对应的本地分支</span></span><br></pre></td></tr></table></figure><h3 id="git-reset-区别"><a href="#git-reset-区别" class="headerlink" title="git reset 区别"></a>git reset 区别</h3><h3 id="stage-index-区域"><a href="#stage-index-区域" class="headerlink" title="stage(index) 区域"></a>stage(index) 区域</h3><p>暂存区<code>Stage</code>只是一个简单的索引文件而已， <code>.git/index</code>文件</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211117/1637113648cc3510e8f32578ed0f39756e298749de.png" alt="git 数据流程图示意图"></p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode代码高亮设置</title>
      <link href="metaverse/vscodeset/"/>
      <url>metaverse/vscodeset/</url>
      
        <content type="html"><![CDATA[<ol><li> 打开File&gt;Preferences-&gt;settings</li><li> 找到workbench.colorCustomizations</li><li> 修改setting.json</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;editor.renderLineHighlight&quot;</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;workbench.colorCustomizations&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;editor.selectionHighlightBackground&quot;</span>: <span class="string">&quot;#9805ec&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;editor.lineHighlightBorder&quot;</span>: <span class="string">&quot;#ff0000&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自旋锁与忙等待</title>
      <link href="metaverse/busyspinandspinwait/"/>
      <url>metaverse/busyspinandspinwait/</url>
      
        <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Busy Spin<br>忙碌的旋转<br>A technique which is used in a way that it loop is running until other thread have to complete his work.<br>一种技术，其使用方式是循环运行，直到其他线程必须完成他的工作。<br>Spin Wait<br>旋转等待<br>A spin wait that you have to wait until condition for thread is true.<br>一种旋转等待，您必须等待，直到线程的条件为真。<br>Spin Loop<br>自旋回路<br>Spin loop is also similar to both of above busy spin and wait spin. It means that threads have to wait for other thread for completing his work.<br>自旋环也类似于上述两种繁忙的自旋和等待自旋。这意味着线程必须等待其他线程完成他的工作。</p><h2 id="暴论"><a href="#暴论" class="headerlink" title="暴论"></a>暴论</h2><p>我们常常听到自旋锁、忙等待、Spin Wait、Spin Loop 、Busy Wait、busy-waiting、busy-looping、 spinning等术语，其实他们都是一个东西。<br>维基百科这么描述<code>busy-waiting, busy-looping or spinning is a technique in which a repeatedly checks to see if a condition is true, such as whether keyboard input or a lock is available</code></p><p>通俗来说就是在循环中判断（等待），不过正确实现自旋锁是很难的，这是因为可能有碰撞产生（例如锁竞争时同时访问锁）。不过我们可以使用一些支持原子操作的语句实现。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h4 id="CAS-compare-and-swap-算法"><a href="#CAS-compare-and-swap-算法" class="headerlink" title="CAS(compare and swap)算法"></a>CAS(compare and swap)算法</h4><p>比较并交换(compare and swap, CAS)，是原子操作的一无锁算法。无锁编程使用，一般用于实现乐观锁，自旋锁</p><p>缺点:ABA问题、循环时间长开销大、只能保证一个共享变量的原子操作</p><p>java中实现自旋锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">spinLock</span> </span>&#123;</span><br><span class="line">    <span class="comment">//java 泛型；调用CAS库AtomicReference泛型类</span></span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Thread&gt; cas = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        <span class="comment">// 利用CAS(Compare And Swap)</span></span><br><span class="line">        <span class="keyword">while</span> (!cas.compareAndSet(<span class="keyword">null</span>, current)) &#123;</span><br><span class="line">            <span class="comment">// DO nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread current = Thread.currentThread();</span><br><span class="line">        cas.compareAndSet(current, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>golang</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> spinLock <span class="keyword">uint32</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sl *spinLock)</span> <span class="title">Lock</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> !atomic.CompareAndSwapUint32((*<span class="keyword">uint32</span>)(sl), <span class="number">0</span>, <span class="number">1</span>) &#123;</span><br><span class="line">        runtime.Gosched()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sl *spinLock)</span> <span class="title">Unlock</span><span class="params">()</span></span> &#123;</span><br><span class="line">    atomic.StoreUint32((*<span class="keyword">uint32</span>)(sl), <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSpinLock</span><span class="params">()</span> <span class="title">sync</span>.<span class="title">Locker</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> lock spinLock</span><br><span class="line">    <span class="keyword">return</span> &amp;lock</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang的bufio包</title>
      <link href="metaverse/bufiopackage/"/>
      <url>metaverse/bufiopackage/</url>
      
        <content type="html"><![CDATA[<p>原理</p><p>bufio通过缓冲提高效率</p><p>把文件读取进缓冲(内存)避免每次读取触发系统io</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">participant 程序 as A</span><br><span class="line">participant 缓冲区buf as B</span><br><span class="line">participant 文件 as C</span><br><span class="line">B--A:写入内容小于buf</span><br><span class="line">B--A:</span><br><span class="line">C--B:buf没空间，写入文件，清空buf</span><br><span class="line">C--A:写入内容大于buf</span><br></pre></td></tr></table></figure><p>把文件写入缓冲，多次写入后，最后一次性写入文件·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">程序--缓冲区buf:写入内容小于buf</span><br><span class="line">程序--缓冲区buf:</span><br><span class="line">缓冲区buf--文件:buf没空间，写入文件，清空buf</span><br><span class="line">程序--文件:写入内容大于buf</span><br><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2009 The Go Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style</span></span><br><span class="line"><span class="comment">// license that can be found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package bufio implements buffered I/O. It wraps an io.Reader or io.Writer</span></span><br><span class="line"><span class="comment">// object, creating another object (Reader or Writer) that also implements</span></span><br><span class="line"><span class="comment">// the interface but provides buffering and some help for textual I/O.</span></span><br><span class="line"><span class="keyword">package</span> bufio</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">defaultBufSize = <span class="number">4096</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">ErrInvalidUnreadByte = errors.New(<span class="string">&quot;bufio: invalid use of UnreadByte&quot;</span>)</span><br><span class="line">ErrInvalidUnreadRune = errors.New(<span class="string">&quot;bufio: invalid use of UnreadRune&quot;</span>)</span><br><span class="line">ErrBufferFull        = errors.New(<span class="string">&quot;bufio: buffer full&quot;</span>)</span><br><span class="line">ErrNegativeCount     = errors.New(<span class="string">&quot;bufio: negative count&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffered input.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reader implements buffering for an io.Reader object.对io.Reader的封装</span></span><br><span class="line"><span class="keyword">type</span> Reader <span class="keyword">struct</span> &#123;</span><br><span class="line">buf          []<span class="keyword">byte</span></span><br><span class="line">rd           io.Reader <span class="comment">// reader provided by the client</span></span><br><span class="line">r, w         <span class="keyword">int</span>       <span class="comment">// buf read and write positions</span></span><br><span class="line">err          error</span><br><span class="line">lastByte     <span class="keyword">int</span> <span class="comment">// last byte read for UnreadByte; -1 means invalid</span></span><br><span class="line">lastRuneSize <span class="keyword">int</span> <span class="comment">// size of last rune read for UnreadRune; -1 means invalid</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> minReadBufferSize = <span class="number">16</span></span><br><span class="line"><span class="keyword">const</span> maxConsecutiveEmptyReads = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NewReaderSize returns a new Reader whose buffer has at least the specified</span></span><br><span class="line"><span class="comment">// size. If the argument io.Reader is already a Reader with large enough</span></span><br><span class="line"><span class="comment">// size, it returns the underlying Reader.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReaderSize</span><span class="params">(rd io.Reader, size <span class="keyword">int</span>)</span> *<span class="title">Reader</span></span> &#123;</span><br><span class="line"><span class="comment">// Is it already a Reader?</span></span><br><span class="line">b, ok := rd.(*Reader)</span><br><span class="line"><span class="keyword">if</span> ok &amp;&amp; <span class="built_in">len</span>(b.buf) &gt;= size &#123;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> size &lt; minReadBufferSize &#123;</span><br><span class="line">size = minReadBufferSize</span><br><span class="line">&#125;</span><br><span class="line">r := <span class="built_in">new</span>(Reader)</span><br><span class="line">r.reset(<span class="built_in">make</span>([]<span class="keyword">byte</span>, size), rd)</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewReader returns a new Reader whose buffer has the default size.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReader</span><span class="params">(rd io.Reader)</span> *<span class="title">Reader</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> NewReaderSize(rd, defaultBufSize)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Size returns the size of the underlying buffer in bytes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(b.buf) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reset discards any buffered data, resets all state, and switches</span></span><br><span class="line"><span class="comment">// the buffered reader to read from r.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Reset</span><span class="params">(r io.Reader)</span></span> &#123;</span><br><span class="line">b.reset(b.buf, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">reset</span><span class="params">(buf []<span class="keyword">byte</span>, r io.Reader)</span></span> &#123;</span><br><span class="line">*b = Reader&#123;</span><br><span class="line">buf:          buf,</span><br><span class="line">rd:           r,</span><br><span class="line">lastByte:     <span class="number">-1</span>,</span><br><span class="line">lastRuneSize: <span class="number">-1</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> errNegativeRead = errors.New(<span class="string">&quot;bufio: reader returned negative count from Read&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// fill reads a new chunk into the buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">fill</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Slide existing data to beginning.</span></span><br><span class="line"><span class="keyword">if</span> b.r &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">copy</span>(b.buf, b.buf[b.r:b.w])</span><br><span class="line">b.w -= b.r</span><br><span class="line">b.r = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b.w &gt;= <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;bufio: tried to fill full buffer&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read new data: try a limited number of times.</span></span><br><span class="line"><span class="keyword">for</span> i := maxConsecutiveEmptyReads; i &gt; <span class="number">0</span>; i-- &#123;</span><br><span class="line">n, err := b.rd.Read(b.buf[b.w:])</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(errNegativeRead)</span><br><span class="line">&#125;</span><br><span class="line">b.w += n</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">b.err = err</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">b.err = io.ErrNoProgress</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">readErr</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">err := b.err</span><br><span class="line">b.err = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Peek returns the next n bytes without advancing the reader. The bytes stop</span></span><br><span class="line"><span class="comment">// being valid at the next read call. If Peek returns fewer than n bytes, it</span></span><br><span class="line"><span class="comment">// also returns an error explaining why the read is short. The error is</span></span><br><span class="line"><span class="comment">// ErrBufferFull if n is larger than b&#x27;s buffer size.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Calling Peek prevents a UnreadByte or UnreadRune call from succeeding</span></span><br><span class="line"><span class="comment">// until the next read operation.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Peek</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, ErrNegativeCount</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b.lastByte = <span class="number">-1</span></span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> b.w-b.r &lt; n &amp;&amp; b.w-b.r &lt; <span class="built_in">len</span>(b.buf) &amp;&amp; b.err == <span class="literal">nil</span> &#123;</span><br><span class="line">b.fill() <span class="comment">// b.w-b.r &lt; len(b.buf) =&gt; buffer is not full</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line"><span class="keyword">return</span> b.buf[b.r:b.w], ErrBufferFull</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0 &lt;= n &lt;= len(b.buf)</span></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="keyword">if</span> avail := b.w - b.r; avail &lt; n &#123;</span><br><span class="line"><span class="comment">// not enough data in buffer</span></span><br><span class="line">n = avail</span><br><span class="line">err = b.readErr()</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">err = ErrBufferFull</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b.buf[b.r : b.r+n], err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Discard skips the next n bytes, returning the number of bytes discarded.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// If Discard skips fewer than n bytes, it also returns an error.</span></span><br><span class="line"><span class="comment">// If 0 &lt;= n &lt;= b.Buffered(), Discard is guaranteed to succeed without</span></span><br><span class="line"><span class="comment">// reading from the underlying io.Reader.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Discard</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(discarded <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, ErrNegativeCount</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">remain := n</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">skip := b.Buffered()</span><br><span class="line"><span class="keyword">if</span> skip == <span class="number">0</span> &#123;</span><br><span class="line">b.fill()</span><br><span class="line">skip = b.Buffered()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> skip &gt; remain &#123;</span><br><span class="line">skip = remain</span><br><span class="line">&#125;</span><br><span class="line">b.r += skip</span><br><span class="line">remain -= skip</span><br><span class="line"><span class="keyword">if</span> remain == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n - remain, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read reads data into p.</span></span><br><span class="line"><span class="comment">// It returns the number of bytes read into p.</span></span><br><span class="line"><span class="comment">// The bytes are taken from at most one Read on the underlying Reader,</span></span><br><span class="line"><span class="comment">// hence n may be less than len(p).</span></span><br><span class="line"><span class="comment">// To read exactly len(p) bytes, use io.ReadFull(b, p).</span></span><br><span class="line"><span class="comment">// At EOF, the count will be zero and err will be io.EOF.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Read</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">n = <span class="built_in">len</span>(p)</span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.Buffered() &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.r == b.w &#123;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(p) &gt;= <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line"><span class="comment">// Large read, empty buffer.</span></span><br><span class="line"><span class="comment">// Read directly into p to avoid copy.</span></span><br><span class="line">n, b.err = b.rd.Read(p)</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(errNegativeRead)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">b.lastByte = <span class="keyword">int</span>(p[n<span class="number">-1</span>])</span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> n, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// One read.</span></span><br><span class="line"><span class="comment">// Do not use b.fill, which will loop.</span></span><br><span class="line">b.r = <span class="number">0</span></span><br><span class="line">b.w = <span class="number">0</span></span><br><span class="line">n, b.err = b.rd.Read(b.buf)</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(errNegativeRead)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line">b.w += n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// copy as much as we can</span></span><br><span class="line">n = <span class="built_in">copy</span>(p, b.buf[b.r:b.w])</span><br><span class="line">b.r += n</span><br><span class="line">b.lastByte = <span class="keyword">int</span>(b.buf[b.r<span class="number">-1</span>])</span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"><span class="keyword">return</span> n, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadByte reads and returns a single byte.</span></span><br><span class="line"><span class="comment">// If no byte is available, returns an error.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadByte</span><span class="params">()</span> <span class="params">(<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> b.r == b.w &#123;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line">b.fill() <span class="comment">// buffer is empty</span></span><br><span class="line">&#125;</span><br><span class="line">c := b.buf[b.r]</span><br><span class="line">b.r++</span><br><span class="line">b.lastByte = <span class="keyword">int</span>(c)</span><br><span class="line"><span class="keyword">return</span> c, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UnreadByte unreads the last byte. Only the most recently read byte can be unread.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// UnreadByte returns an error if the most recent method called on the</span></span><br><span class="line"><span class="comment">// Reader was not a read operation. Notably, Peek is not considered a</span></span><br><span class="line"><span class="comment">// read operation.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">UnreadByte</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.lastByte &lt; <span class="number">0</span> || b.r == <span class="number">0</span> &amp;&amp; b.w &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> ErrInvalidUnreadByte</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// b.r &gt; 0 || b.w == 0</span></span><br><span class="line"><span class="keyword">if</span> b.r &gt; <span class="number">0</span> &#123;</span><br><span class="line">b.r--</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// b.r == 0 &amp;&amp; b.w == 0</span></span><br><span class="line">b.w = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">b.buf[b.r] = <span class="keyword">byte</span>(b.lastByte)</span><br><span class="line">b.lastByte = <span class="number">-1</span></span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadRune reads a single UTF-8 encoded Unicode character and returns the</span></span><br><span class="line"><span class="comment">// rune and its size in bytes. If the encoded rune is invalid, it consumes one byte</span></span><br><span class="line"><span class="comment">// and returns unicode.ReplacementChar (U+FFFD) with a size of 1.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadRune</span><span class="params">()</span> <span class="params">(r <span class="keyword">rune</span>, size <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> b.r+utf8.UTFMax &gt; b.w &amp;&amp; !utf8.FullRune(b.buf[b.r:b.w]) &amp;&amp; b.err == <span class="literal">nil</span> &amp;&amp; b.w-b.r &lt; <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line">b.fill() <span class="comment">// b.w-b.r &lt; len(buf) =&gt; buffer is not full</span></span><br><span class="line">&#125;</span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"><span class="keyword">if</span> b.r == b.w &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span>, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line">r, size = <span class="keyword">rune</span>(b.buf[b.r]), <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> r &gt;= utf8.RuneSelf &#123;</span><br><span class="line">r, size = utf8.DecodeRune(b.buf[b.r:b.w])</span><br><span class="line">&#125;</span><br><span class="line">b.r += size</span><br><span class="line">b.lastByte = <span class="keyword">int</span>(b.buf[b.r<span class="number">-1</span>])</span><br><span class="line">b.lastRuneSize = size</span><br><span class="line"><span class="keyword">return</span> r, size, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UnreadRune unreads the last rune. If the most recent method called on</span></span><br><span class="line"><span class="comment">// the Reader was not a ReadRune, UnreadRune returns an error. (In this</span></span><br><span class="line"><span class="comment">// regard it is stricter than UnreadByte, which will unread the last byte</span></span><br><span class="line"><span class="comment">// from any read operation.)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">UnreadRune</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.lastRuneSize &lt; <span class="number">0</span> || b.r &lt; b.lastRuneSize &#123;</span><br><span class="line"><span class="keyword">return</span> ErrInvalidUnreadRune</span><br><span class="line">&#125;</span><br><span class="line">b.r -= b.lastRuneSize</span><br><span class="line">b.lastByte = <span class="number">-1</span></span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffered returns the number of bytes that can be read from the current buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Buffered</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b.w - b.r &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadSlice reads until the first occurrence of delim in the input,</span></span><br><span class="line"><span class="comment">// returning a slice pointing at the bytes in the buffer.</span></span><br><span class="line"><span class="comment">// The bytes stop being valid at the next read.</span></span><br><span class="line"><span class="comment">// If ReadSlice encounters an error before finding a delimiter,</span></span><br><span class="line"><span class="comment">// it returns all the data in the buffer and the error itself (often io.EOF).</span></span><br><span class="line"><span class="comment">// ReadSlice fails with error ErrBufferFull if the buffer fills without a delim.</span></span><br><span class="line"><span class="comment">// Because the data returned from ReadSlice will be overwritten</span></span><br><span class="line"><span class="comment">// by the next I/O operation, most clients should use</span></span><br><span class="line"><span class="comment">// ReadBytes or ReadString instead.</span></span><br><span class="line"><span class="comment">// ReadSlice returns err != nil if and only if line does not end in delim.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadSlice</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(line []<span class="keyword">byte</span>, err error)</span></span> &#123;</span><br><span class="line">s := <span class="number">0</span> <span class="comment">// search start index</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="comment">// Search buffer.</span></span><br><span class="line"><span class="keyword">if</span> i := bytes.IndexByte(b.buf[b.r+s:b.w], delim); i &gt;= <span class="number">0</span> &#123;</span><br><span class="line">i += s</span><br><span class="line">line = b.buf[b.r : b.r+i+<span class="number">1</span>]</span><br><span class="line">b.r += i + <span class="number">1</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pending error?</span></span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line">line = b.buf[b.r:b.w]</span><br><span class="line">b.r = b.w</span><br><span class="line">err = b.readErr()</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffer full?</span></span><br><span class="line"><span class="keyword">if</span> b.Buffered() &gt;= <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line">b.r = b.w</span><br><span class="line">line = b.buf</span><br><span class="line">err = ErrBufferFull</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s = b.w - b.r <span class="comment">// do not rescan area we scanned before</span></span><br><span class="line"></span><br><span class="line">b.fill() <span class="comment">// buffer is not full</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle last byte, if any.</span></span><br><span class="line"><span class="keyword">if</span> i := <span class="built_in">len</span>(line) - <span class="number">1</span>; i &gt;= <span class="number">0</span> &#123;</span><br><span class="line">b.lastByte = <span class="keyword">int</span>(line[i])</span><br><span class="line">b.lastRuneSize = <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadLine is a low-level line-reading primitive. Most callers should use</span></span><br><span class="line"><span class="comment">// ReadBytes(&#x27;\n&#x27;) or ReadString(&#x27;\n&#x27;) instead or use a Scanner.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ReadLine tries to return a single line, not including the end-of-line bytes.</span></span><br><span class="line"><span class="comment">// If the line was too long for the buffer then isPrefix is set and the</span></span><br><span class="line"><span class="comment">// beginning of the line is returned. The rest of the line will be returned</span></span><br><span class="line"><span class="comment">// from future calls. isPrefix will be false when returning the last fragment</span></span><br><span class="line"><span class="comment">// of the line. The returned buffer is only valid until the next call to</span></span><br><span class="line"><span class="comment">// ReadLine. ReadLine either returns a non-nil line or it returns an error,</span></span><br><span class="line"><span class="comment">// never both.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The text returned from ReadLine does not include the line end (&quot;\r\n&quot; or &quot;\n&quot;).</span></span><br><span class="line"><span class="comment">// No indication or error is given if the input ends without a final line end.</span></span><br><span class="line"><span class="comment">// Calling UnreadByte after ReadLine will always unread the last byte read</span></span><br><span class="line"><span class="comment">// (possibly a character belonging to the line end) even if that byte is not</span></span><br><span class="line"><span class="comment">// part of the line returned by ReadLine.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadLine</span><span class="params">()</span> <span class="params">(line []<span class="keyword">byte</span>, isPrefix <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">line, err = b.ReadSlice(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> err == ErrBufferFull &#123;</span><br><span class="line"><span class="comment">// Handle the case where &quot;\r\n&quot; straddles the buffer.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(line) &gt; <span class="number">0</span> &amp;&amp; line[<span class="built_in">len</span>(line)<span class="number">-1</span>] == <span class="string">&#x27;\r&#x27;</span> &#123;</span><br><span class="line"><span class="comment">// Put the &#x27;\r&#x27; back on buf and drop it from line.</span></span><br><span class="line"><span class="comment">// Let the next call to ReadLine check for &quot;\r\n&quot;.</span></span><br><span class="line"><span class="keyword">if</span> b.r == <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// should be unreachable</span></span><br><span class="line"><span class="built_in">panic</span>(<span class="string">&quot;bufio: tried to rewind past start of buffer&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">b.r--</span><br><span class="line">line = line[:<span class="built_in">len</span>(line)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> line, <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">line = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">err = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> line[<span class="built_in">len</span>(line)<span class="number">-1</span>] == <span class="string">&#x27;\n&#x27;</span> &#123;</span><br><span class="line">drop := <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(line) &gt; <span class="number">1</span> &amp;&amp; line[<span class="built_in">len</span>(line)<span class="number">-2</span>] == <span class="string">&#x27;\r&#x27;</span> &#123;</span><br><span class="line">drop = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">line = line[:<span class="built_in">len</span>(line)-drop]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadBytes reads until the first occurrence of delim in the input,</span></span><br><span class="line"><span class="comment">// returning a slice containing the data up to and including the delimiter.</span></span><br><span class="line"><span class="comment">// If ReadBytes encounters an error before finding a delimiter,</span></span><br><span class="line"><span class="comment">// it returns the data read before the error and the error itself (often io.EOF).</span></span><br><span class="line"><span class="comment">// ReadBytes returns err != nil if and only if the returned data does not end in</span></span><br><span class="line"><span class="comment">// delim.</span></span><br><span class="line"><span class="comment">// For simple uses, a Scanner may be more convenient.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadBytes</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// Use ReadSlice to look for array,</span></span><br><span class="line"><span class="comment">// accumulating full buffers.</span></span><br><span class="line"><span class="keyword">var</span> frag []<span class="keyword">byte</span></span><br><span class="line"><span class="keyword">var</span> full [][]<span class="keyword">byte</span></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">var</span> e error</span><br><span class="line">frag, e = b.ReadSlice(delim)</span><br><span class="line"><span class="keyword">if</span> e == <span class="literal">nil</span> &#123; <span class="comment">// got final fragment</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> e != ErrBufferFull &#123; <span class="comment">// unexpected error</span></span><br><span class="line">err = e</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make a copy of the buffer.</span></span><br><span class="line">buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="built_in">len</span>(frag))</span><br><span class="line"><span class="built_in">copy</span>(buf, frag)</span><br><span class="line">full = <span class="built_in">append</span>(full, buf)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Allocate new buffer to hold the full pieces and the fragment.</span></span><br><span class="line">n := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> full &#123;</span><br><span class="line">n += <span class="built_in">len</span>(full[i])</span><br><span class="line">&#125;</span><br><span class="line">n += <span class="built_in">len</span>(frag)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Copy full pieces and fragment in.</span></span><br><span class="line">buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, n)</span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> full &#123;</span><br><span class="line">n += <span class="built_in">copy</span>(buf[n:], full[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">copy</span>(buf[n:], frag)</span><br><span class="line"><span class="keyword">return</span> buf, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadString reads until the first occurrence of delim in the input,</span></span><br><span class="line"><span class="comment">// returning a string containing the data up to and including the delimiter.</span></span><br><span class="line"><span class="comment">// If ReadString encounters an error before finding a delimiter,</span></span><br><span class="line"><span class="comment">// it returns the data read before the error and the error itself (often io.EOF).</span></span><br><span class="line"><span class="comment">// ReadString returns err != nil if and only if the returned data does not end in</span></span><br><span class="line"><span class="comment">// delim.</span></span><br><span class="line"><span class="comment">// For simple uses, a Scanner may be more convenient.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadString</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">bytes, err := b.ReadBytes(delim)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(bytes), err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteTo implements io.WriterTo.</span></span><br><span class="line"><span class="comment">// This may make multiple calls to the Read method of the underlying Reader.</span></span><br><span class="line"><span class="comment">// If the underlying reader supports the WriteTo method,</span></span><br><span class="line"><span class="comment">// this calls the underlying WriteTo without buffering.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">WriteTo</span><span class="params">(w io.Writer)</span> <span class="params">(n <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">n, err = b.writeBuf(w)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r, ok := b.rd.(io.WriterTo); ok &#123;</span><br><span class="line">m, err := r.WriteTo(w)</span><br><span class="line">n += m</span><br><span class="line"><span class="keyword">return</span> n, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> w, ok := w.(io.ReaderFrom); ok &#123;</span><br><span class="line">m, err := w.ReadFrom(b.rd)</span><br><span class="line">n += m</span><br><span class="line"><span class="keyword">return</span> n, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b.w-b.r &lt; <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line">b.fill() <span class="comment">// buffer not full</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> b.r &lt; b.w &#123;</span><br><span class="line"><span class="comment">// b.r &lt; b.w =&gt; buffer is not empty</span></span><br><span class="line">m, err := b.writeBuf(w)</span><br><span class="line">n += m</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n, err</span><br><span class="line">&#125;</span><br><span class="line">b.fill() <span class="comment">// buffer is empty</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b.err == io.EOF &#123;</span><br><span class="line">b.err = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> n, b.readErr()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> errNegativeWrite = errors.New(<span class="string">&quot;bufio: writer returned negative count from Write&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// writeBuf writes the Reader&#x27;s buffer to the writer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">writeBuf</span><span class="params">(w io.Writer)</span> <span class="params">(<span class="keyword">int64</span>, error)</span></span> &#123;</span><br><span class="line">n, err := w.Write(b.buf[b.r:b.w])</span><br><span class="line"><span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(errNegativeWrite)</span><br><span class="line">&#125;</span><br><span class="line">b.r += n</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">int64</span>(n), err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buffered output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Writer implements buffering for an io.Writer object.</span></span><br><span class="line"><span class="comment">// If an error occurs writing to a Writer, no more data will be</span></span><br><span class="line"><span class="comment">// accepted and all subsequent writes, and Flush, will return the error.</span></span><br><span class="line"><span class="comment">// After all data has been written, the client should call the</span></span><br><span class="line"><span class="comment">// Flush method to guarantee all data has been forwarded to</span></span><br><span class="line"><span class="comment">// the underlying io.Writer.</span></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">struct</span> &#123;</span><br><span class="line">err error</span><br><span class="line">buf []<span class="keyword">byte</span></span><br><span class="line">n   <span class="keyword">int</span></span><br><span class="line">wr  io.Writer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewWriterSize returns a new Writer whose buffer has at least the specified</span></span><br><span class="line"><span class="comment">// size. If the argument io.Writer is already a Writer with large enough</span></span><br><span class="line"><span class="comment">// size, it returns the underlying Writer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWriterSize</span><span class="params">(w io.Writer, size <span class="keyword">int</span>)</span> *<span class="title">Writer</span></span> &#123;</span><br><span class="line"><span class="comment">// Is it already a Writer?</span></span><br><span class="line">b, ok := w.(*Writer)</span><br><span class="line"><span class="keyword">if</span> ok &amp;&amp; <span class="built_in">len</span>(b.buf) &gt;= size &#123;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> size &lt;= <span class="number">0</span> &#123;</span><br><span class="line">size = defaultBufSize</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;Writer&#123;</span><br><span class="line">buf: <span class="built_in">make</span>([]<span class="keyword">byte</span>, size),</span><br><span class="line">wr:  w,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewWriter returns a new Writer whose buffer has the default size.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWriter</span><span class="params">(w io.Writer)</span> *<span class="title">Writer</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> NewWriterSize(w, defaultBufSize)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Size returns the size of the underlying buffer in bytes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(b.buf) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reset discards any unflushed buffered data, clears any error, and</span></span><br><span class="line"><span class="comment">// resets b to write its output to w.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Reset</span><span class="params">(w io.Writer)</span></span> &#123;</span><br><span class="line">b.err = <span class="literal">nil</span></span><br><span class="line">b.n = <span class="number">0</span></span><br><span class="line">b.wr = w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flush writes any buffered data to the underlying io.Writer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Flush</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.n == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">n, err := b.wr.Write(b.buf[<span class="number">0</span>:b.n])</span><br><span class="line"><span class="keyword">if</span> n &lt; b.n &amp;&amp; err == <span class="literal">nil</span> &#123;</span><br><span class="line">err = io.ErrShortWrite</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="number">0</span> &amp;&amp; n &lt; b.n &#123;</span><br><span class="line"><span class="built_in">copy</span>(b.buf[<span class="number">0</span>:b.n-n], b.buf[n:b.n])</span><br><span class="line">&#125;</span><br><span class="line">b.n -= n</span><br><span class="line">b.err = err</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">b.n = <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Available returns how many bytes are unused in the buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Available</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(b.buf) - b.n &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffered returns the number of bytes that have been written into the current buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Buffered</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b.n &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write writes the contents of p into the buffer.</span></span><br><span class="line"><span class="comment">// It returns the number of bytes written.</span></span><br><span class="line"><span class="comment">// If nn &lt; len(p), it also returns an error explaining</span></span><br><span class="line"><span class="comment">// why the write is short.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Write</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(nn <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(p) &gt; b.Available() &amp;&amp; b.err == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">var</span> n <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> b.Buffered() == <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// Large write, empty buffer.</span></span><br><span class="line"><span class="comment">// Write directly from p to avoid copy.</span></span><br><span class="line">n, b.err = b.wr.Write(p)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">n = <span class="built_in">copy</span>(b.buf[b.n:], p)</span><br><span class="line">b.n += n</span><br><span class="line">b.Flush()</span><br><span class="line">&#125;</span><br><span class="line">nn += n</span><br><span class="line">p = p[n:]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nn, b.err</span><br><span class="line">&#125;</span><br><span class="line">n := <span class="built_in">copy</span>(b.buf[b.n:], p)</span><br><span class="line">b.n += n</span><br><span class="line">nn += n</span><br><span class="line"><span class="keyword">return</span> nn, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteByte writes a single byte.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">WriteByte</span><span class="params">(c <span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.Available() &lt;= <span class="number">0</span> &amp;&amp; b.Flush() != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.err</span><br><span class="line">&#125;</span><br><span class="line">b.buf[b.n] = c</span><br><span class="line">b.n++</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteRune writes a single Unicode code point, returning</span></span><br><span class="line"><span class="comment">// the number of bytes written and any error.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">WriteRune</span><span class="params">(r <span class="keyword">rune</span>)</span> <span class="params">(size <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> r &lt; utf8.RuneSelf &#123;</span><br><span class="line">err = b.WriteByte(<span class="keyword">byte</span>(r))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.err</span><br><span class="line">&#125;</span><br><span class="line">n := b.Available()</span><br><span class="line"><span class="keyword">if</span> n &lt; utf8.UTFMax &#123;</span><br><span class="line"><span class="keyword">if</span> b.Flush(); b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, b.err</span><br><span class="line">&#125;</span><br><span class="line">n = b.Available()</span><br><span class="line"><span class="keyword">if</span> n &lt; utf8.UTFMax &#123;</span><br><span class="line"><span class="comment">// Can only happen if buffer is silly small.</span></span><br><span class="line"><span class="keyword">return</span> b.WriteString(<span class="keyword">string</span>(r))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">size = utf8.EncodeRune(b.buf[b.n:], r)</span><br><span class="line">b.n += size</span><br><span class="line"><span class="keyword">return</span> size, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteString writes a string.</span></span><br><span class="line"><span class="comment">// It returns the number of bytes written.</span></span><br><span class="line"><span class="comment">// If the count is less than len(s), it also returns an error explaining</span></span><br><span class="line"><span class="comment">// why the write is short.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">WriteString</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">nn := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(s) &gt; b.Available() &amp;&amp; b.err == <span class="literal">nil</span> &#123;</span><br><span class="line">n := <span class="built_in">copy</span>(b.buf[b.n:], s)</span><br><span class="line">b.n += n</span><br><span class="line">nn += n</span><br><span class="line">s = s[n:]</span><br><span class="line">b.Flush()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nn, b.err</span><br><span class="line">&#125;</span><br><span class="line">n := <span class="built_in">copy</span>(b.buf[b.n:], s)</span><br><span class="line">b.n += n</span><br><span class="line">nn += n</span><br><span class="line"><span class="keyword">return</span> nn, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadFrom implements io.ReaderFrom. If the underlying writer</span></span><br><span class="line"><span class="comment">// supports the ReadFrom method, and b has no buffered data yet,</span></span><br><span class="line"><span class="comment">// this calls the underlying ReadFrom without buffering.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">ReadFrom</span><span class="params">(r io.Reader)</span> <span class="params">(n <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.Buffered() == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> w, ok := b.wr.(io.ReaderFrom); ok &#123;</span><br><span class="line"><span class="keyword">return</span> w.ReadFrom(r)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">if</span> b.Available() == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err1 := b.Flush(); err1 != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n, err1</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">nr := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> nr &lt; maxConsecutiveEmptyReads &#123;</span><br><span class="line">m, err = r.Read(b.buf[b.n:])</span><br><span class="line"><span class="keyword">if</span> m != <span class="number">0</span> || err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">nr++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> nr == maxConsecutiveEmptyReads &#123;</span><br><span class="line"><span class="keyword">return</span> n, io.ErrNoProgress</span><br><span class="line">&#125;</span><br><span class="line">b.n += m</span><br><span class="line">n += <span class="keyword">int64</span>(m)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line"><span class="comment">// If we filled the buffer exactly, flush preemptively.</span></span><br><span class="line"><span class="keyword">if</span> b.Available() == <span class="number">0</span> &#123;</span><br><span class="line">err = b.Flush()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">err = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> n, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// buffered input and output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadWriter stores pointers to a Reader and a Writer.</span></span><br><span class="line"><span class="comment">// It implements io.ReadWriter.</span></span><br><span class="line"><span class="keyword">type</span> ReadWriter <span class="keyword">struct</span> &#123;</span><br><span class="line">*Reader</span><br><span class="line">*Writer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewReadWriter allocates a new ReadWriter that dispatches to r and w.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReadWriter</span><span class="params">(r *Reader, w *Writer)</span> *<span class="title">ReadWriter</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;ReadWriter&#123;r, w&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何给HEXO博客文章进行加密</title>
      <link href="metaverse/encrypthexo/"/>
      <url>metaverse/encrypthexo/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="33fdac49e606782a7dbbfe4fc970fe915c1be79773f1b993df35f17db301ed8e">3ecf1eeb34e97740ad8e82ab56d0b3049f46c88f4d637992895f9bcf6709f41affe7ea6b49f8e7aab122975b82622e06b0c16b052ac253d8c8014364ab54aee2e86b8c6d572c5572849ce25b137f20b9a07b5d8d9980d095b6572edb491095cef4477ec51ff50f31858e60111736bf9e14fefced5f5506a926eef884cbb469ffd903a950d338d399b7cb124fbbbd80c25f1ae415013e20627f39cddd2e37d5541645868f29357442f8139d20281ccf66b469d46687768c3f827688b939c8610f5d3fcb30c36cbaa5a32233651a0b01e5e6e19f879a69687ba60f437c52d6189068b74f263c7aed27f5a787ee58e5eafc9a14ef6b572ab0e54caea4155266ec09acee27aefc4cfb487f17ab94d6c9ab7d273c0217c9b74da80fdfec786f180a7670e586d69c8ffd0886b5bc426b83e844e9d1d481507bb31236a61beec295806ff3669241eff4cdf340686d2105838c631f4252d9e5f43167fdf32744b492d02cfbbabe7c6ecdea197149fb885d516f9f8d08a9379d2cb25901e3af8c1d876a584bbedbbb2d4f2cf2a4977f66ae7e56658110e8a8f0b3b082ac2dd43ca6f3702e69892436fae8f7a42ebdb364a5eb0fe0b22916b1eaade413a9ca8c659e0152fca63d02af63710609b4da40ffef022a385b348a35efbfa332623dc4a17ed00c6c8b85b211ead24796dfce9abeb21a29dd9e6b089baa522afe4cb34dcae7ae7f61c071516e538d78fcc45b5a3bd6ca844cf2c42cbf093ea2b30b25aa0054323a050c57fe8f129ef4655ce31f4df7076d32763ca4a5ad076c1bfce0110ca2c618c7c97ff2c364c7e7430b067fa3768440158d6d8153de85f71723bac0d68dacbf8eb52607013c4edea4f8e170365c516c63fc7bb0a2a9f0bccf61c2ccf0dc8531a9a3b21a4cbbcdb97260ef5b59dbb5e9a6890c419a293435fdcc4e2c4874e6a1cc2c90e945adb59b10881a6bda08002f7d206a55e35eefa0a2080e61bf6ec277ed940f500a80a4147b57b400cbcae2268a70ffae00a9bda985d3cc2073abb97042d0079edaca28003a2bd72fad63ea739b994d74311a81c42371f7a2744d3a94999aa44a538d7e0032109b5955ed104d67f6108a311271f703009c16cec27363ed7e3618b71f1213b4ff3742556cc89d6cc83963fac266856195a2213fee559849b458253a9dc7822369d048cfdcb1fdd9ff462eca6afa08e897f7cf27d2d096ccf9d3dbceabf76f3d3aa65ac197b921b4074dcf36f0992b734b4c0a5454f6c206e8c3327167dbae959c512a374a8a7e2175280ee0efb64c1f73be8409a0d267c98d8bb3413a8d80deb8b99527248e0fa71637a95cd953850c75e246577ba469477ac8378a866193b565802924aaa5bfe25ff18edc2c673d5306d46f75f2cc7fda3367817e53df4c00efa663bbe76c2af94417af18d01f9db355cf13f242c6133530461056e09cf58b34212ce070375b6f3b3c1ea79f419f8d6cecdfdd08b34d45c9d4f7c352ef64820bb332e4639e0b35e156f1a3fe24f3c812880e76084e5400be8093848bc4dda9c24741c2fc9272deb5097594e25c478590b5b7fc3d66e4be4339d219cbbbf415d6b36b9ca4e5731fb46d56e4b8a7014d3246b44d891a5ee7013b62f7323d7fb9e91da4edd1cbd64b0e2bbeccddfe027ed6e1aa4805da8995d8b16e62a403b38306d33f5b91311b28579e6cd103de72086cea1f600095df4f5b962af4cf7cfd313e171069bbeac8aa489bd2eb558bbac086d93accd69547e535e903d2a655671fef81e76ead1317d1881ac00a894d16b0c31200074ca26ae172be5b6e9659ad42534fa179777e34877bd1706aad4bd867aebcf2f419a229fdc52c85acb05472f8cfe1990090fb62c410312aff72127cf4e666d7f7c88d6ee3c56d5ccc2520786e88983f72cb38edf48dd46ed1d7d5d8409f9eece9961e13a3643021994ce3f415c03a19a8a042a5da5a2302d5f7c71baa51a7d00535683a97f996eda6ed4d952e5ac0d2479026f7653402ebc3c1fe55cf74bb02ed324b10ddc59b35b9d7f482649802ed035fdc554ce0afcee02340ce5a2572dcd36a05a8880c68a5840ac46f341d3eacd415c1858f291aa1e3b9309e7ae5ed52826cdb82eec2ec8c16404255eb495be02db7c0e7b5ffe315bf2bc5d84f23023c7e27288c8004ff65f3a5da2f38791263f1d3d1f9c5bbc8ece9bee12e3131ff4ccbee3024288f31986efdb92cee19bba529d2a3c8674cb878fbf776a40fe465a91094d7af11b5e75f3d94c0b85b332a7dcfb748e645a3c64647a26e5b3374be78fc367f6f469d17904c4125e772d0125042d66180647b6620c52395e4279c7578afff2355d3606e8a1a3c0c5b02709f56c99b5ced92beae56c68823770d2b248e3850ae06c5428b4c84e68d1046138cb167424976f9c95fe405c5ffafc93cca35551570597b16414f4cfcd72cd67fd9c2485e25f5e4fc17bec0b398efc659c6c58fc70f1fe04e6ce27e4589549d20d405dd80bdceb34a0cf57aaa5a5c3298827febe1b2c1e9916c5c31202c569509b5d90ce3f8296508a98bf44d7b6c2c5acd2c0a087b80cd8ab5bbaf42febd6c026d32b4a4d3155d6cbfc67f649aa09262455cec28d874033f46b3e1bbb65353fbb2af6e215144a351116f83b03d0f4d3cd3a426a72133234197afcd37cf0cc489aff4288d0339398bfa55675e362954b56bad04003236367ffcabac838d1c432e7ed34d9284f8f9e3a041ae521ee34bcf29d949d9a2150099ee56d468c7a86d8a7f3ff2bf9d62612669f6f27e44fd2cf89303117eb92f87c03ed794f5e4534cb66a8aa478ed1656f7e7fbef292d87690c04933f76452a08cc83d357e031396dcb35166c9a51e255cdad2a6e5237d9f0d8245b1d647abd87bb72113e8fb32ae50c8455ac49ca0ec2935563e08c7b119fc735a89ae3f70c2143ada3d54379b249711540ff0e7a891c3068b91b8dba3f58f04879b04cb0fb6412e491a9db2b1a6f711986dcbd14a209d62f419c16b7210275fa741a90c07336d1626493532e50c36cbebb45b1b1d7183e26480b2d117e2cb812044f97e227e4c1b288ae7cd65181906f4db923f5de9c591fa0950de615d1f8070401b982f874fd35067bb7e2baf1e7cac5ee17a45117988cec24707c020a4a1073605f27741cf884afff3508028b00db5326a696a0cbc21ef429c0b09538cf86d6fef01a2819b3671ba45e6e465d083f844f070aa06645f0208f6df171dac859ac3affedd355ebf8a99d8f99c6c4105bd722210e076b49666ab66fe30516f0550e0bb9dc233aa2946113abe35fecd657e8393d29f1c5b7b1252b94493c95ef1d4c4ba5c25e7735b8f962d10cb0c984c47e5e057f8c6469ef031551850baa4c912b52226803564226a11311db39b9b0277e2a4e988a62d9615b385848fed34711efc14819dac55a6d63f2c2aa891cf9461a6a7df6c52d865a5799e73b2483b332043c493438c01f88721c6ca2cfbed30aec58f6a35f1a55f1bcb70109bb612737b41e12f7e007f22101cbdf982a6856f3d87420a1649a14d82a07e9f8da2ed202abc7f1ecf1ce3ebe5c744a0fe3a03a395e24cf1a01930bc241d620135a1014869224e635d575701e7cb19dc502f896f4793233c89d9850ccfe0e908d9e65d275d33b38de5cb7791c4a476d6222bba7fdc86fd52dbee9426041608e1b74829c0eb1b1404e12ad6fa0dc4b6c78bc2557d3eadb2ecb9e09be76d91c3ee7745b2590af8cef28505923c8a01ebf5e162240a3abbe4232000c6a470c60683390f9f3227f2320b09a0e4c9c2140b47c7b8569fd83f1c9d34a2db6b2880dc446a69ac12065c9a23f1508f80fd91408cd122a4f9e6bc38f12b5d0fa653a3f56a31818a39fcb0093aa32afe0b23e03233fd890c071c5a566b2cff43cac3caaca1b2bea06e6cb34191f69728625c9e525dadaf9a8faaf8da5781f6b24e6ec67e42619699d7acdfd3fdfbb598f0f94f43b36f6b68195713d663ee61512aa4743bd97f00ccc42307e1cf016793e1512d6803330489e1acf5cab4edd68e84fcaf6e956193572a263fbe9dfca81c3880f53f397a01bf08913bd86f536657e20d0e521ccb2f0f8b4af081da79ec0a87df33a7884d4ce4e240652896ac28e65ae665c7417be118989549c1ede07a83458f7cf7369f337859bd5da248644babab1961f10d9232ec9af0241d24e3a42c9aa1862beed13c91e02265722e305b50d11ac2e541e68f63d28684db6cdca9b1b99674b3c58358ab859f6b1f35ae0bacaa52111099985fddc35d9a77d6962d9a96fc28f80ffc904ba8bea9950155a0cbca069c280beaf4fdd47d885cac45976cd53477ea31a4e6939eeb2d5769fe4415fdbf369de5434ed3fd4a7cbe6a9938ce381dfdb0782154daf06254fbab21030f9c72b2ed3fbd87aac575736dc5407af6220207b9083c7e9ec2d7680dfc60cf9dd9ab15782841ec082fcdc2e9a37a299a05bbd35a1f2b74c6faff93a0bfdfceae2bf579fa02dc6fb3e3ac0cf41a36342e085994c58b7c8c0ff752abf40bde5a29d97694645707cf95b6a8153001a344e6ef4272cfe5f16f8da6217a8aeea2d149abbf27b65c1161dfd77cf5edd595f2b64ada7e03387e3dbb0e41af67a4890e5c934a616887933eb42f6c2cb977fbe68b38844a4310116f79706dc8ea50b48b58c06b340312f7dbc7ce0ebc74c232c7666d92f9f1d1c4bf2dce9f522cbf1d57ea67c3d8cd3b4dfc1f06f631d266646b1edefc2c0f9dba7284dda6aa4b8829b72116579f673787ed65ae46a5e61fcb1aee3431c8af141be432c10feb1b4cca89925cf549f0f00c94be8b370f9fb466266f5ed54f33fffb46a5bd4785c4950b5b427fd33a39ed0b696ffb4028b45479a481fb4588c63edd089340a370a79891d779a72c1b0b9bae00d2deff5f7dc2b00b728d322788bab26c9c81cbbe5a61d79c137833441ddd249695b0e667b48735c13fdf686c6c172bef2a244541073e115a09e125a2fb8fbdfd9327f5ef535ad117789a3aef4fc22e2c304783e0f9d80b2c5f3795bc0bb077864f377f165040b8962fbe820528e76f68bf36e5f8c1f5b9c68fd5056c342d62c16d246c5602978f3628eea1d39c551ad8977719843ffa3b7cf2633f072013327c8202656d7b753b033a7c70f0e1681581c3c1a217f7d7cd32954bb0ff194a9b696d6f43899cde3b83d8cb3fd7c97bbdc17fed94efd839168c8dc7413a7d994272d48879d788323ebeaa7c8c38006efc610df1daf5763bef8eab0cc3f5eb45e825b71ba26f47c10f0776fb2e4dec49ce8e45ada0d806a8323af704c55db21d6c4d92e62e3e5ca85d6a6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">密码是  漫步科技人生</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 创作工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 创作工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go的内置包</title>
      <link href="metaverse/built-inpackage/"/>
      <url>metaverse/built-inpackage/</url>
      
        <content type="html"><![CDATA[<h2 id="库与包"><a href="#库与包" class="headerlink" title="库与包"></a>库与包</h2><h4 id="archive"><a href="#archive" class="headerlink" title="archive"></a>archive</h4><h5 id="tar包：负责打包、解包-注意tar不负责压缩和解压"><a href="#tar包：负责打包、解包-注意tar不负责压缩和解压" class="headerlink" title="tar包：负责打包、解包,注意tar不负责压缩和解压"></a>tar包：负责打包、解包,注意tar不负责压缩和解压</h5><p>打包实现原理</p><p>先创建一个文件x.tar，然后向x.tar写入tar头部信息。打开要被tar的文件，向x.tar写入头部信息，然后向x.tar写入文件信息。重复第二步直到所有文件都被写入到x.tar中，关闭x.tar，整个过程就这样完成了</p><p>解包实现原理</p><p>先打开tar文件，然后从这个tar头部中循环读取存储在这个归档文件内的文件头信息，从这个文件头里读取文件名，以这个文件名创建文件，然后向这个文件里写入数据</p><h5 id="zip包：打包、解包，并进行压缩"><a href="#zip包：打包、解包，并进行压缩" class="headerlink" title="zip包：打包、解包，并进行压缩"></a>zip包：打包、解包，并进行压缩</h5><p>压缩实现原理</p><p>工具类：bufio、bytes、string、path、strconv、io/ioutils等，没有领域知识，比较简单</p><p>系统包：os、net、sync、fmt</p><h2 id="linux-说明"><a href="#linux-说明" class="headerlink" title="linux 说明"></a>linux 说明</h2><h4 id="linux文件头信息-标志"><a href="#linux文件头信息-标志" class="headerlink" title="linux文件头信息(标志)"></a>linux文件头信息(标志)</h4><p>使用file命令可以查看文件类型</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# file test ./test/1</span><br><span class="line">test:     directory</span><br><span class="line">./test/1: ASCII text</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程原理 </tag>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习算法</title>
      <link href="metaverse/machine/"/>
      <url>metaverse/machine/</url>
      
        <content type="html"><![CDATA[<p>线性代数</p><p>概率论</p><p>贝叶斯概率公式</p><p>P(A|B)=$\frac{P(A)*P(B|A)}{P(B)}$</p><p>也就是</p><p>P(A$\cap$B) = P(A)*P(B|A)</p>]]></content>
      
      
      <categories>
          
          <category> 编程技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法，机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>

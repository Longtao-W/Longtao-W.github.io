{"title":"trex测试流程","slug":"tools/trex","date":"2021-03-22T15:24:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/trex.json","excerpt":null,"covers":null,"content":"<h2 id=\"Trex简单测试\"><a href=\"#Trex简单测试\" class=\"headerlink\" title=\"Trex简单测试\"></a>Trex简单测试</h2><h3 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h3><ol>\n<li><p>trex主机与dut主机第一个network为管理网，第二个与第三个network为测试用网，trex主机与dut主机测试用网eth1互联，trex主机与dut主机测试用网eth2互联;</p>\n</li>\n<li><p>只可运行net_set.sh 一次，获得mac地址，若mac地址全为0，重启trex主机;</p>\n</li>\n<li><p>测试项可在run_trex.sh修改（-m 参数为几万pps  -d参数为测试时间）。</p>\n</li>\n</ol>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><ol>\n<li>打开trex主机 运行trex_set.sh 并得到两个mac地址fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开dut主机运行 dut_set.sh fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开trex主机运行run_trex.sh ，等待运行结束得到trex结果。</li>\n</ol>\n<h3 id=\"镜像地址\"><a href=\"#镜像地址\" class=\"headerlink\" title=\"镜像地址\"></a>镜像地址</h3><p>dut：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2</a></p>\n<p>trex：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2</a></p>\n<h2 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h2><p>dut_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip link set dev eth1 up</span><br><span class=\"line\">ip link set dev eth2 up</span><br><span class=\"line\">ip a add 192.168.155.3/24 dev eth1</span><br><span class=\"line\">ip a add 192.168.166.5/24 dev eth2</span><br><span class=\"line\">ip r add 16.0.0.0/8 via 192.168.155.2</span><br><span class=\"line\">ip r add 48.0.0.0/8 via 192.168.166.4</span><br><span class=\"line\">ip n add 192.168.155.2 dev eth1 lladdr $0</span><br><span class=\"line\">ip n add 192.168.166.4 dev eth2 lladdr $1</span><br><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>\n\n<p>net_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a=(`ip a | grep ^[1-9] | awk -F: &#x27;&#123;print $2&#125;&#x27; | sed &#x27;1,2d&#x27;`)</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    b[$i]=`ethtool -i $&#123;a[$i]&#125; |grep bus | awk -F &#x27;:&#x27; &#x27;&#123;print $3 $4 $5&#125;&#x27;|sed -e &#x27;s/../\\0:/&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    echo $&#123;a[$i]&#125; $&#123;b[$i]&#125;</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    e[$i]=`ip link show $&#123;a[$i]&#125; |head -2|tail -1|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">cp /root/trex/v2.81/cfg/simple_cfg.yaml  /etc/trex_cfg.yaml.bak</span><br><span class=\"line\">sed &#x27;4,$d&#x27; /etc/trex_cfg.yaml.bak &gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  interfaces    : [&quot;&#x27;$&#123;b[0]&#125;&#x27;&quot;,&quot;&#x27;$&#123;b[1]&#125;&#x27;&quot;]&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  port_info       :  # Port IPs. Change to suit your needs. In case of loopback, you can leave as is.&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.155.2&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.155.3&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.166.4&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.166.5&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;\\n\\n&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">cd ~/trex/v2.81/</span><br><span class=\"line\">./dpdk_setup_ports.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> cat /etc/trex_cfg.yaml</span></span><br><span class=\"line\">cat /root/trex/v2.81/cfg/simple_cfg.yaml</span><br><span class=\"line\">cat /etc/trex_cfg.yaml</span><br><span class=\"line\">echo &#x27;config success ! dont config again!  if not configed please reboot your mechine and check your network  sum is 2 and the last 2 network are connected.&#x27;</span><br><span class=\"line\">echo -e &#x27;\\n&#x27;</span><br><span class=\"line\">echo $&#123;e[0]&#125;&#x27; &#x27;$&#123;e[1]&#125;</span><br></pre></td></tr></table></figure>\n\n<p>run_trex.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root/trex/v2.81; ./t-rex-64 -f cap2/imix_longtao_1w.yaml -m 5 -d 5</span><br></pre></td></tr></table></figure>\n\n","more":"<h2 id=\"Trex简单测试\"><a href=\"#Trex简单测试\" class=\"headerlink\" title=\"Trex简单测试\"></a>Trex简单测试</h2><h3 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h3><ol>\n<li><p>trex主机与dut主机第一个network为管理网，第二个与第三个network为测试用网，trex主机与dut主机测试用网eth1互联，trex主机与dut主机测试用网eth2互联;</p>\n</li>\n<li><p>只可运行net_set.sh 一次，获得mac地址，若mac地址全为0，重启trex主机;</p>\n</li>\n<li><p>测试项可在run_trex.sh修改（-m 参数为几万pps  -d参数为测试时间）。</p>\n</li>\n</ol>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><ol>\n<li>打开trex主机 运行trex_set.sh 并得到两个mac地址fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开dut主机运行 dut_set.sh fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开trex主机运行run_trex.sh ，等待运行结束得到trex结果。</li>\n</ol>\n<h3 id=\"镜像地址\"><a href=\"#镜像地址\" class=\"headerlink\" title=\"镜像地址\"></a>镜像地址</h3><p>dut：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2</a></p>\n<p>trex：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2</a></p>\n<h2 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h2><p>dut_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip link set dev eth1 up</span><br><span class=\"line\">ip link set dev eth2 up</span><br><span class=\"line\">ip a add 192.168.155.3/24 dev eth1</span><br><span class=\"line\">ip a add 192.168.166.5/24 dev eth2</span><br><span class=\"line\">ip r add 16.0.0.0/8 via 192.168.155.2</span><br><span class=\"line\">ip r add 48.0.0.0/8 via 192.168.166.4</span><br><span class=\"line\">ip n add 192.168.155.2 dev eth1 lladdr $0</span><br><span class=\"line\">ip n add 192.168.166.4 dev eth2 lladdr $1</span><br><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>\n\n<p>net_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a=(`ip a | grep ^[1-9] | awk -F: &#x27;&#123;print $2&#125;&#x27; | sed &#x27;1,2d&#x27;`)</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    b[$i]=`ethtool -i $&#123;a[$i]&#125; |grep bus | awk -F &#x27;:&#x27; &#x27;&#123;print $3 $4 $5&#125;&#x27;|sed -e &#x27;s/../\\0:/&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    echo $&#123;a[$i]&#125; $&#123;b[$i]&#125;</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    e[$i]=`ip link show $&#123;a[$i]&#125; |head -2|tail -1|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">cp /root/trex/v2.81/cfg/simple_cfg.yaml  /etc/trex_cfg.yaml.bak</span><br><span class=\"line\">sed &#x27;4,$d&#x27; /etc/trex_cfg.yaml.bak &gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  interfaces    : [&quot;&#x27;$&#123;b[0]&#125;&#x27;&quot;,&quot;&#x27;$&#123;b[1]&#125;&#x27;&quot;]&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  port_info       :  # Port IPs. Change to suit your needs. In case of loopback, you can leave as is.&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.155.2&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.155.3&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.166.4&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.166.5&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;\\n\\n&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">cd ~/trex/v2.81/</span><br><span class=\"line\">./dpdk_setup_ports.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> cat /etc/trex_cfg.yaml</span></span><br><span class=\"line\">cat /root/trex/v2.81/cfg/simple_cfg.yaml</span><br><span class=\"line\">cat /etc/trex_cfg.yaml</span><br><span class=\"line\">echo &#x27;config success ! dont config again!  if not configed please reboot your mechine and check your network  sum is 2 and the last 2 network are connected.&#x27;</span><br><span class=\"line\">echo -e &#x27;\\n&#x27;</span><br><span class=\"line\">echo $&#123;e[0]&#125;&#x27; &#x27;$&#123;e[1]&#125;</span><br></pre></td></tr></table></figure>\n\n<p>run_trex.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root/trex/v2.81; ./t-rex-64 -f cap2/imix_longtao_1w.yaml -m 5 -d 5</span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]}
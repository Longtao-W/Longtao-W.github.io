{"title":"50行代码实现md图床","slug":"tools/picpool","date":"2019-12-08T12:30:41.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/picpool.json","excerpt":null,"covers":["https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092275f552d50-f59f-11eb-8016-fa1e86d74c00","https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/163530923262f6ba28-f59f-11eb-90f6-fa1e86d74c00"],"content":"<p><a href=\"http://longtao.fun/\">首页</a> -&gt; <a href=\"http://longtao.fun/product/product.html\">项目列表</a></p>\n<p>原文地址：<a href=\"https://longtao.fun/picture_pool/\">https://longtao.fun/picture_pool/</a></p>\n<h3 id=\"简单介绍\"><a href=\"#简单介绍\" class=\"headerlink\" title=\"简单介绍\"></a>简单介绍</h3><p>服务端代码,使用flask提供api服务，两个接口，一个用来上传，一个用来查看图片，上传图片返回图片url</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> uuid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request, make_response</span><br><span class=\"line\"></span><br><span class=\"line\">ip = <span class=\"string\">&#x27;127.0.0.1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">file_path = os.path.join(os.path.dirname(__file__), <span class=\"string\">&#x27;pics&#x27;</span>)</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/photo&quot;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_frame</span>():</span></span><br><span class=\"line\">    upload_file = request.data</span><br><span class=\"line\">    img = base64.b64decode(upload_file)</span><br><span class=\"line\">    file_name = <span class=\"built_in\">str</span>(uuid.uuid1())</span><br><span class=\"line\">    file_paths = os.path.join(file_path, file_name)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(img)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/show/&#123;&#125;&#x27;</span>.<span class=\"built_in\">format</span>(ip, file_name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/show/&lt;string:filename&gt;&quot;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span>(<span class=\"params\">filename</span>):</span></span><br><span class=\"line\">    file_paths = os.path.join(file_path, filename)</span><br><span class=\"line\">    f = <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;rb&quot;</span>).read()</span><br><span class=\"line\">    response = make_response(f)</span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;Content-Type&#x27;</span>] = <span class=\"string\">&#x27;image/png&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    app.run(debug=<span class=\"literal\">False</span>, host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5555</span>)</span><br></pre></td></tr></table></figure>\n\n<p>客户端脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) == <span class=\"number\">1</span>:</span><br><span class=\"line\">    sys.argv.append(<span class=\"string\">&#x27;--help&#x27;</span>)</span><br><span class=\"line\">parser = argparse.ArgumentParser()</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-s&#x27;</span>, <span class=\"string\">&#x27;--source&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"string\">&#x27;+&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须传入文件&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-i&#x27;</span>, <span class=\"string\">&#x27;--ip&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"number\">1</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须指定地址&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\">image_list = args.source</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/photo&#x27;</span>.<span class=\"built_in\">format</span>(args.ip[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span>(<span class=\"params\">_img</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> os.path.isfile(_img):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(_img, <span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            file = f.read()</span><br><span class=\"line\">            encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        file = requests.get(_img).content</span><br><span class=\"line\">        encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> encode_f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> img <span class=\"keyword\">in</span> image_list:</span><br><span class=\"line\">        req = requests.post(url=url, data=get_data(img))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;http://&quot;</span>+<span class=\"built_in\">str</span>(req.text))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"todo\"><a href=\"#todo\" class=\"headerlink\" title=\"todo\"></a>todo</h4><ol>\n<li>使用go重写方便部署</li>\n<li>图片去重</li>\n<li>图片压缩</li>\n</ol>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><h4 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h4><ol>\n<li> 下载本repo源码</li>\n<li> 安装python3环境，安装</li>\n<li> 修改main 中的ip地址为你的服务端公网ip，是遏制iptables开启5555端口;</li>\n<li> nohup python3 $repoPath/main.py &amp;启动或者通过systemd启动</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;[Unit]</span><br><span class=\"line\">Description=simple picture pool</span><br><span class=\"line\">   </span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/usr/bin/python3 /root/pic_pool/picture_pool/main.py &gt; /dev/null   2&gt;&amp;1</span><br><span class=\"line\">   </span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target &quot; &gt; /etc/systemd/system/spp.service</span><br><span class=\"line\">systemctl status spp</span><br><span class=\"line\">systemctl start spp</span><br><span class=\"line\">systemctl enable spp</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><ol>\n<li> 在你的修改upload_script.py 中的ip为你搭建的服务端ip（默认的172.20.18.38是我在0.10搭建好的）；</li>\n<li>在你的markdown 编辑器按照以下操作文件-&gt;偏好设置-&gt;图像-&gt;custom上传服务，在命令里填写<code>python3 upload_script.py的绝对路径 -i 你的服务ip地址  -s</code> 例如<code>python3 /home/longtao/workspace/projects/picture_pool/upload_script.py -i 172.20.18.38 -s</code><br> <img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092275f552d50-f59f-11eb-8016-fa1e86d74c00\"></li>\n<li>选择插入图片时上传图片，勾选，本地和网络，点击验证上传服务，如下为成功验证<br> <img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/163530923262f6ba28-f59f-11eb-90f6-fa1e86d74c00\"></li>\n</ol>\n","more":"<p><a href=\"http://longtao.fun/\">首页</a> -&gt; <a href=\"http://longtao.fun/product/product.html\">项目列表</a></p>\n<p>原文地址：<a href=\"https://longtao.fun/picture_pool/\">https://longtao.fun/picture_pool/</a></p>\n<h3 id=\"简单介绍\"><a href=\"#简单介绍\" class=\"headerlink\" title=\"简单介绍\"></a>简单介绍</h3><p>服务端代码,使用flask提供api服务，两个接口，一个用来上传，一个用来查看图片，上传图片返回图片url</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> uuid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request, make_response</span><br><span class=\"line\"></span><br><span class=\"line\">ip = <span class=\"string\">&#x27;127.0.0.1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">file_path = os.path.join(os.path.dirname(__file__), <span class=\"string\">&#x27;pics&#x27;</span>)</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/photo&quot;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_frame</span>():</span></span><br><span class=\"line\">    upload_file = request.data</span><br><span class=\"line\">    img = base64.b64decode(upload_file)</span><br><span class=\"line\">    file_name = <span class=\"built_in\">str</span>(uuid.uuid1())</span><br><span class=\"line\">    file_paths = os.path.join(file_path, file_name)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(img)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/show/&#123;&#125;&#x27;</span>.<span class=\"built_in\">format</span>(ip, file_name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/show/&lt;string:filename&gt;&quot;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span>(<span class=\"params\">filename</span>):</span></span><br><span class=\"line\">    file_paths = os.path.join(file_path, filename)</span><br><span class=\"line\">    f = <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;rb&quot;</span>).read()</span><br><span class=\"line\">    response = make_response(f)</span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;Content-Type&#x27;</span>] = <span class=\"string\">&#x27;image/png&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    app.run(debug=<span class=\"literal\">False</span>, host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5555</span>)</span><br></pre></td></tr></table></figure>\n\n<p>客户端脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) == <span class=\"number\">1</span>:</span><br><span class=\"line\">    sys.argv.append(<span class=\"string\">&#x27;--help&#x27;</span>)</span><br><span class=\"line\">parser = argparse.ArgumentParser()</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-s&#x27;</span>, <span class=\"string\">&#x27;--source&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"string\">&#x27;+&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须传入文件&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-i&#x27;</span>, <span class=\"string\">&#x27;--ip&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"number\">1</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须指定地址&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\">image_list = args.source</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/photo&#x27;</span>.<span class=\"built_in\">format</span>(args.ip[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span>(<span class=\"params\">_img</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> os.path.isfile(_img):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(_img, <span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            file = f.read()</span><br><span class=\"line\">            encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        file = requests.get(_img).content</span><br><span class=\"line\">        encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> encode_f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> img <span class=\"keyword\">in</span> image_list:</span><br><span class=\"line\">        req = requests.post(url=url, data=get_data(img))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;http://&quot;</span>+<span class=\"built_in\">str</span>(req.text))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"todo\"><a href=\"#todo\" class=\"headerlink\" title=\"todo\"></a>todo</h4><ol>\n<li>使用go重写方便部署</li>\n<li>图片去重</li>\n<li>图片压缩</li>\n</ol>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><h4 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h4><ol>\n<li> 下载本repo源码</li>\n<li> 安装python3环境，安装</li>\n<li> 修改main 中的ip地址为你的服务端公网ip，是遏制iptables开启5555端口;</li>\n<li> nohup python3 $repoPath/main.py &amp;启动或者通过systemd启动</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;[Unit]</span><br><span class=\"line\">Description=simple picture pool</span><br><span class=\"line\">   </span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/usr/bin/python3 /root/pic_pool/picture_pool/main.py &gt; /dev/null   2&gt;&amp;1</span><br><span class=\"line\">   </span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target &quot; &gt; /etc/systemd/system/spp.service</span><br><span class=\"line\">systemctl status spp</span><br><span class=\"line\">systemctl start spp</span><br><span class=\"line\">systemctl enable spp</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><ol>\n<li> 在你的修改upload_script.py 中的ip为你搭建的服务端ip（默认的172.20.18.38是我在0.10搭建好的）；</li>\n<li>在你的markdown 编辑器按照以下操作文件-&gt;偏好设置-&gt;图像-&gt;custom上传服务，在命令里填写<code>python3 upload_script.py的绝对路径 -i 你的服务ip地址  -s</code> 例如<code>python3 /home/longtao/workspace/projects/picture_pool/upload_script.py -i 172.20.18.38 -s</code><br> <img src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092275f552d50-f59f-11eb-8016-fa1e86d74c00\"></li>\n<li>选择插入图片时上传图片，勾选，本地和网络，点击验证上传服务，如下为成功验证<br> <img src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/163530923262f6ba28-f59f-11eb-90f6-fa1e86d74c00\"></li>\n</ol>\n","categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]}
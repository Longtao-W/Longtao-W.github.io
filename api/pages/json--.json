{"title":"json工具","date":"2018-06-07T14:17:49.000Z","updated":"2024-06-30T10:35:56.372Z","comments":true,"path":"api/pages/json--.json","covers":null,"excerpt":null,"content":"\n\n<header class=\"header\">\n    <link href=\"htmls/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"htmls/css/font-awesome.min.css\" rel=\"stylesheet\">\n    <link href=\"htmls/css/base.css\" rel=\"stylesheet\">\n    <link href=\"htmls/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"htmls/css/font-awesome.min.css\" rel=\"stylesheet\">\n    <link href=\"htmls/css/base.css\" rel=\"stylesheet\">\n</header>\n\n\n<main class=\"row-fluid\" style=\"height:85%;min-height:550px;\">\n    <div class=\"col-md-5\" style=\"padding:0px;height:100%;\">\n        <textarea id=\"json-src\" placeholder=\"在此输入json字符串或XML字符串...\"   class=\"form-control\"  style=\"height:722px;padding:0 10px 10px 20px;border:0;border-right:solid 1px #ddd;border-bottom:solid 1px #ddd;border-radius:0;resize: none; outline:none;\">{&#13\"Json解析\": \"在左侧输入，右侧按钮依次为压缩、转xml、行号、删除、下载、复制、折叠\"}</textarea>\n    </div>\n    <div class=\"col-md-7\" style=\"padding:0;\">\n        <div style=\"padding:10px;font-size:16px;border-bottom:solid 1px #ddd;\" class=\"navi\">\n            <a href=\"#\" class=\"tip zip\" title=\"压缩\"  data-placement=\"bottom\"><i class=\"fa fa-database\"></i></a>\n            <a href=\"#\" class=\"tip xml\" title=\"转XML\"  data-placement=\"bottom\"><i class=\"fa fa-file-excel-o\"></i></a>\n            <a href=\"#\" class=\"tip shown\"  title=\"显示行号\"  data-placement=\"bottom\"><i class=\"glyphicon glyphicon-sort-by-order\"></i></a>\n            <a href=\"#\" class=\"tip clear\" title=\"清空\"  data-placement=\"bottom\"><i class=\"fa fa-trash\"></i></a>\n            <a href=\"#\" class=\"tip save\" title=\"保存\"  data-placement=\"bottom\"><i class=\"fa fa-download\"></i></a>\n            <a href=\"#\" class=\"tip copy\" title=\"复制\" data-clipboard-target=\"#json-target\"  data-placement=\"bottom\"><i class=\"fa fa-copy\"></i></a>\n            <a href=\"#\" class=\"tip compress\" title=\"折叠\"  data-placement=\"bottom\"><i class=\"fa fa-compress\"></i></a>\n        </div>\n        <div id=\"right-box\"  style=\"height:679px;border-right:solid 1px #ddd;border-bottom:solid 1px #ddd;border-radius:0;resize: none;overflow-y:scroll; outline:none;position:relative;\">\n            <div id=\"line-num\" style=\"background-color:#fafafa;padding:0px 8px;float:left;border-right:dashed 1px #eee;display:none;z-index:-1;color:#999;position:absolute;text-align:center;over-flow:hidden;\">\n                <div>0</div>\n            </div>\n            <div class=\"ro\" id=\"json-target\" style=\"padding:0px 25px;\">\n            </div>\n        </div>\n        <form id=\"form-save\" method=\"POST\"><input type=\"hidden\" value=\"\" id=\"txt-content\" name=\"content\"></form>\n    </div>\n    <br style=\"clear:both;\" />\n</main>\n<link href=\"htmls/css/jquery.numberedtextarea.css\" rel=\"stylesheet\">\n<script src=\"htmls/js/jquery.min.js\"></script>\n<script src=\"htmls/js/jquery.message.js\"></script>\n<script src=\"htmls/js/jquery.json.js\"></script>\n<script src=\"htmls/js/jquery.xml2json.js\"></script>\n<script src=\"htmls/js/jquery.json2xml.js\"></script>\n<script src=\"htmls/js/json2.js\"></script>\n<script src=\"htmls/js/jsonlint.js\"></script>\n<script src=\"htmls/js/bootstrap.min.js\"></script>\n<script src=\"htmls/js/FileSaver.min.js\"></script>\n<script src=\"htmls/js/clipboard.min.js\"></script>\n<script src=\"htmls/js/jquery.numberedtextarea.js\"></script>\n<script type=\"text/javascript\">\n    $('textarea').numberedtextarea();\n    var current_json = '';\n    var current_json_str = '';\n    var xml_flag = false;\n    var zip_flag = false;\n    var shown_flag = false;\n    var compress_flag = false;\n    var xml_text;\n    $('.tip').tooltip();\n    function init(){\n        xml_flag = false;\n        zip_flag = false;\n        shown_flag = false;\n        compress_flag = false;\n        renderLine();\n        $('.xml').attr('style','color:#999;');\n        $('.zip').attr('style','color:#999;');\n    }\n    $('#json-src').keyup(function(){\n        init();\n        var content = $.trim($(this).val());\n        var result = '';\n        if (content!='') {\n            //如果是xml,那么转换为json\n            if (content.substr(0,1) === '<' && content.substr(-1,1) === '>') {\n                try{\n                    var json_obj = $.xml2json(content);\n                    content = JSON.stringify(json_obj);\n                }catch(e){\n                    result = '解析错误：<span style=\"color: #f1592a;font-weight:bold;\">' + e.message + '</span>';\n                    current_json_str = result;\n                    $('#json-target').html(result);\n                    return false;\n                }\n            }\n            try{\n                content = content.replace(/[\\r\\n]/g,\"\");\n                current_json = jsonlint.parse(content);\n                current_json_str = JSON.stringify(current_json);\n                result = new JSONFormat(content,4).toString();\n            }catch(e){\n                result = '<span style=\"color: #f1592a;font-weight:bold;\">' + e + '</span>';\n                current_json_str = result;\n            }\n            $('#json-target').html(result);\n        }else{\n            $('#json-target').html('');\n        }\n    });\n    $('.xml').click(function(){\n        if (xml_flag) {\n            $('#json-src').keyup();\n        }else{\n            var result = $.json2xml(current_json);\n            $('#json-target').html('<textarea style=\"width:100%;position:absolute;height: 80vh;min-height:480px;border:0;resize:none;\">'+result+'</textarea>');\n            xml_text = result;\n            xml_flag = true;\n            $(this).attr('style','color:#15b374;');\n        }\n    });\n    $('.shown').click(function(){\n        if (!shown_flag) {\n            renderLine();\n            $('#json-src').attr(\"style\",\"height:722px;padding:0 10px 10px 40px;border:0;border-right:solid 1px #ddd;border-bottom:solid 1px #ddd;border-radius:0;resize: none; outline:none;\");\n            $('#json-target').attr(\"style\",\"padding:0px 50px;\");\n            $('#line-num').show();\n            $('.numberedtextarea-line-numbers').show();\n            shown_flag = true;\n            $(this).attr('style','color:#15b374;');\n        }else{\n            $('#json-src').attr(\"style\",\"height:722px;padding:0 10px 10px 20px;border:0;border-right:solid 1px #ddd;border-bottom:solid 1px #ddd;border-radius:0;resize: none; outline:none;\");\n            $('#json-target').attr(\"style\",\"padding:0px 20px;\");\n            $('#line-num').hide();\n            $('.numberedtextarea-line-numbers').hide();\n            shown_flag = false;\n            $(this).attr('style','color:#999;');\n        }\n    });\n    function renderLine(){\n        var line_num = $('#json-target').height()/20;\n        $('#line-num').html(\"\");\n        var line_num_html = \"\";\n        for (var i = 1; i < line_num+1; i++) {\n            line_num_html += \"<div>\"+i+\"<div>\";\n        }\n        $('#line-num').html(line_num_html);\n    }\n    $('.zip').click(function(){\n        if (zip_flag) {\n            $('#json-src').keyup();\n        }else{\n            $('#json-target').html(current_json_str);\n            zip_flag = true;\n            xml_flag = false;\n            $(this).attr('style','color:#15b374;');\n        }\n\n    });\n    $('.compress').click(function(){\n        if(!compress_flag){\n            $(this).attr('style','color:#15b374;');\n            //$(this).attr('title','取消折叠').tooltip('fixTitle').tooltip('show');\n            $($(\".fa-minus-square-o\").toArray().reverse()).click();\n            compress_flag = true;\n        }else{\n            while($(\".fa-plus-square-o\").length>0){\n                $(\".fa-plus-square-o\").click();\n            }\n            compress_flag = false;\n            $(this).attr('style','color:#555;');\n            $(this).attr('title','折叠').tooltip('fixTitle').tooltip('show');\n        }\n    });\n    $('.clear').click(function(){\n        $('#json-src').val('');\n        $('#json-target').html('');\n    });\n    (function($){\n        $.fn.innerText = function(msg) {\n            if (msg) {\n                if (document.body.innerText) {\n                    for (var i in this) {\n                        this[i].innerText = msg;\n                    }\n                } else {\n                    for (var i in this) {\n                        this[i].innerHTML.replace(/&amp;lt;br&amp;gt;/gi,\"n\").replace(/(&amp;lt;([^&amp;gt;]+)&amp;gt;)/gi, \"\");\n                    }\n                }\n                return this;\n            } else {\n                if (document.body.innerText) {\n                    return this[0].innerText;\n                } else {\n                    return this[0].innerHTML.replace(/&amp;lt;br&amp;gt;/gi,\"n\").replace(/(&amp;lt;([^&amp;gt;]+)&amp;gt;)/gi, \"\");\n                }\n            }\n        };\n    })(jQuery);\n    $('.save').click(function(){\n        //console.log('xml_flag' +'<br/>'+ xml_flag);\n        var text;\n        if (xml_flag) {\n            var text1 = $.trim($('#json-src').val());\n            // console.log('text1' +'<br/>'+ text1);\n            text = xml_text;\n            //console.log('text' +'<br/>'+ text);\n        }else {\n            var html = $('#json-target').html().replace(/\\n/g,'<br/>').replace(/\\n/g,'<br>');\n            text = $('#json-target').innerText().replace('　　', '    ');\n            // console.log('text' +'<br/>'+ text);\n        }\n        var blob = new Blob([text], {type: \"application/json;charset=utf-8\"});\n        var timestamp=new Date().getTime();\n        saveAs(blob, \"format.\"+timestamp+\".json\");\n    });\n    $('.copy').click(function(){\n    });\n    var clipboard = new Clipboard('.copy');\n    $('#json-src').keyup();\n</script>\n\n"}
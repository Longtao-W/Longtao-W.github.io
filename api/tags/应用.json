{"name":"应用","postlist":[{"title":"arping的使用","slug":"tools/arping","date":"2020-02-11T10:20:21.000Z","updated":"2024-06-30T10:35:56.308Z","comments":true,"path":"api/articles/tools/arping.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172298arping-network-scanning-tool.png","content":"<h1 id=\"arping详解\"><a href=\"#arping详解\" class=\"headerlink\" title=\"arping详解\"></a>arping详解</h1><p><strong>版本</strong></p>\n<p>  arping主要干的活就是查看ip的MAC地址及IP占用的问题。</p>\n<p>  arping有两个版本，一个版本是Thomas Habets这个人写的，这个版本有个好处是可以arping &lt;MAC地址&gt;，也就是说我们可以通过MAC地址得到IP。还有一个版本是Linux iputils suite的，这个版本就不能通过MAC地址，解析出IP地址了。</p>\n<p>  可以使用arping -V来查看自己系统的arping的版本</p>\n<p>  楼主观察了CentOS使用的是Linux iputils suite版本的，debian使用的是Thomas Habets。</p>\n<p>  注意两个版本的的arping使用的参数有很大的区别，所以要根据自己的arping版本去使用相应的参数。别到网上抄了个，结果在自己的系统上不能执行。</p>\n<p>  楼主使用的系统debian是Thomas Habets版本的，所以下面的很多参数只适合debian操作系统。</p>\n<p><strong>TH版简介</strong></p>\n<p>  过程：给一个主机，发送arp或者ICMP包，并打印回复的消息。主机可以以hostname，ip地址，mac地址等形式出现。一个请求包，每隔一秒发送一次。为什么说发送的包有arp和icmp呢，因为，当主机为ip或hostname的时候，发送的是arp请求包。当主机是mac地址的时候，发送的则是icmp的echo广播包</p>\n<p><strong>参数</strong></p>\n<p>-0：指定源地址为0.0.0.0，这个一般是在我们刚刚安装好系统，电脑还没配置好IP的时候</p>\n<p>-a：Audible ping.这个当有reply回来的时候，你的电脑有喇叭的话，就会滴滴的叫</p>\n<p>-A：Only count addresses matching requested address</p>\n<p>-b：类似-0，指定源broadcast为255.255.255.255</p>\n<p>-B：指定这个就相当于 arping 255.255.255.255</p>\n<p><strong>-c count</strong>：发送指定数量的arp包后，即停止退出</p>\n<p><strong>-d</strong>：这个比较重要，当局域网有IP占用的时候，可以指定这个参数，当有相同的IP的不同MAC地址reply的时候，arping会退出，退出码为1<br>-D：这个检测是否丢包的，当丢包的时候打印感叹号，正常的时候打印逗号</p>\n<p>-e：和-a相反，当没有reply的时候，会滴滴滴</p>\n<p>-p：打开混杂模式，当前用户对mac无权限时，可以加上这个选</p>\n<p><strong>-r</strong>：输出的时候只打印MAC，写脚本的时候用得到，不用自己对结果awk了</p>\n<p><strong>-R</strong>：输出的时候只打印IP，和上面一样</p>\n<p>-s MAC：指定源MAC地址</p>\n<p>-S IP：指定源IP，设置了源IP，如果目标主机没有到源IP的route，则有可能收不到answer</p>\n<p>-t MAC：指定目的MAC</p>\n<p>-T IP：指定目的IP，</p>\n<p>-i interface：指定发送arp包的设备。不指定的话，默认为系统的第一块网卡</p>\n<p><strong>-q</strong>：表示不打印输出，写脚本不想打印输出的时候，应该用的到</p>\n<p>-u：没啥大用，结果显示的时候，加这个参数和不加，index的显示形式不同</p>\n<p>-v：打印详细的输出，默认打印的好像就是verbose</p>\n<p><strong>-w deadline</strong>：指定两个ping直接的时间间隔，单位为毫秒，默认为1秒</p>\n<p><strong>用法</strong></p>\n<p>讲了这么多，感觉大多数的参数都用不到吧。记住常见用法就OK了</p>\n<p>用法1：查看某个IP的MAC地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping 192.168.131.155</span><br></pre></td></tr></table></figure>\n\n<p>用法2：查看某个IP的MAC地址，并指定count数量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -c 1 192.168.131.155</span><br></pre></td></tr></table></figure>\n\n<p>用法3：当有多块网卡的时候，指定特定的设备来发送请求包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -i eth1 -c 1 192.168.131.155</span><br></pre></td></tr></table></figure>\n\n<p>用法4：查看某个IP是否被不同的MAC占用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -d 192.168.131.155</span><br></pre></td></tr></table></figure>\n\n<p>用法5：查看某个MAC地址的IP，要在同一子网才查得到</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -c 1 52:54:00:a1:31:89</span><br></pre></td></tr></table></figure>\n\n<p>用法6：确定MAC和IP的对应，确定指定的网卡绑定了指定的IP</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -c 1  -T 192.168.131.156  00:13:72:f9:ca:60</span><br></pre></td></tr></table></figure>\n\n<p>用法7：确定IP和MAC对应，确定指定IP绑在了指定的网卡上</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping -c 1  -t  00:13:72:f9:ca:60 192.168.131.156</span><br></pre></td></tr></table></figure>\n\n<p>用法8：有时候，本地查不到某主机，可以通过让网关或别的机器去查。以下几种形式测了下都可以</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arping   -c 1  -S 10.240.160.1 -s 88:5a:92:12:c1:c1  10.240.162.115</span><br><span class=\"line\">arping   -c 1  -S 10.240.160.1   10.240.162.115</span><br><span class=\"line\">arping   -c 1  -s 88:5a:92:12:c1:c1  10.240.162.11</span><br></pre></td></tr></table></figure>","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"collectd后台监控程序","slug":"tools/collectd","date":"2021-11-21T10:20:21.000Z","updated":"2024-06-30T10:35:56.308Z","comments":true,"path":"api/articles/tools/collectd.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211122/1637548845collectd_logo.png","content":"<p>[toc]</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>collectd 是一个后台监控程序，用来采集其所运行系统上的系统信息，并提供各种存储方式来存储为不同值的格式，例如 RRD 文件形式、文本格式、MongoDB 等等</p>\n<p><strong>连接</strong>：<a href=\"https://collectd.org/index.shtml\">官网文档</a>、<a href=\"https://collectd.org/download.shtml\">下载地址</a>、<a href=\"https://github.com/collectd/collectd\">源码地址</a></p>\n<h2 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h2><ol>\n<li>C语言编写，性能好，跨平台能力强</li>\n<li>插件丰富，方便扩充</li>\n</ol>\n<h2 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h2><ol>\n<li>监控简单</li>\n<li>不能直接生成图形</li>\n</ol>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><p>修改<code>sudo vim /opt/collectd/etc/collectd.conf</code>选择自己需要的插件</p>\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><p><code>systemctl start collectd</code> 启动服务</p>\n<h3 id=\"查看数据\"><a href=\"#查看数据\" class=\"headerlink\" title=\"查看数据\"></a>查看数据</h3><p>若开启了<code>rrdtool</code>插件就可在<code>/var/lib/collectd/rrd/</code>目录下看到相应的统计数据</p>\n<p>日志存储在<code>/var/log/syslog</code></p>\n<h2 id=\"主要插件\"><a href=\"#主要插件\" class=\"headerlink\" title=\"主要插件\"></a>主要插件</h2><h3 id=\"virt\"><a href=\"#virt\" class=\"headerlink\" title=\"virt\"></a>virt</h3><h4 id=\"vcpu\"><a href=\"#vcpu\" class=\"headerlink\" title=\"vcpu\"></a>vcpu</h4><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">get_vcpu_stats</span><span class=\"params\">(virDomainPtr domain, <span class=\"keyword\">unsigned</span> <span class=\"keyword\">short</span> nr_virt_cpu)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> max_cpus = VIR_NODEINFO_MAXCPUS(nodeinfo);</span><br><span class=\"line\"></span><br><span class=\"line\">  virVcpuInfoPtr vinfo = <span class=\"built_in\">calloc</span>(nr_virt_cpu, <span class=\"keyword\">sizeof</span>(*vinfo));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (vinfo == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">    ERROR(PLUGIN_NAME <span class=\"string\">&quot; plugin: calloc failed.&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">int</span> cpu_map_len = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *cpumaps = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (extra_stats &amp; ex_stats_vcpupin) &#123;</span><br><span class=\"line\">    cpu_map_len = VIR_CPU_MAPLEN(max_cpus);</span><br><span class=\"line\">    cpumaps = <span class=\"built_in\">calloc</span>(nr_virt_cpu, cpu_map_len);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cpumaps == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">      ERROR(PLUGIN_NAME <span class=\"string\">&quot; plugin: calloc failed.&quot;</span>);</span><br><span class=\"line\">      sfree(vinfo);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">int</span> status =</span><br><span class=\"line\">      virDomainGetVcpus(domain, vinfo, nr_virt_cpu, cpumaps, cpu_map_len);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    ERROR(PLUGIN_NAME <span class=\"string\">&quot; plugin: virDomainGetVcpus failed with status %i.&quot;</span>,</span><br><span class=\"line\">          status);</span><br><span class=\"line\"></span><br><span class=\"line\">    virErrorPtr err = virGetLastError();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err-&gt;code == VIR_ERR_NO_SUPPORT) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (extra_stats &amp; ex_stats_vcpu)</span><br><span class=\"line\">        ERROR(PLUGIN_NAME</span><br><span class=\"line\">              <span class=\"string\">&quot; plugin: Disabled unsupported ExtraStats selector: vcpu&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (extra_stats &amp; ex_stats_vcpupin)</span><br><span class=\"line\">        ERROR(PLUGIN_NAME</span><br><span class=\"line\">              <span class=\"string\">&quot; plugin: Disabled unsupported ExtraStats selector: vcpupin&quot;</span>);</span><br><span class=\"line\">      extra_stats &amp;= ~(ex_stats_vcpu | ex_stats_vcpupin);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    sfree(cpumaps);</span><br><span class=\"line\">    sfree(vinfo);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nr_virt_cpu; ++i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (extra_stats &amp; ex_stats_vcpu)</span><br><span class=\"line\">      vcpu_submit(vinfo[i].cpuTime, domain, vinfo[i].number, <span class=\"string\">&quot;virt_vcpu&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (extra_stats &amp; ex_stats_vcpupin)</span><br><span class=\"line\">      vcpu_pin_submit(domain, max_cpus, i, cpumaps, cpu_map_len);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  sfree(cpumaps);</span><br><span class=\"line\">  sfree(vinfo);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">vcpu_submit</span><span class=\"params\">(<span class=\"keyword\">derive_t</span> value, virDomainPtr dom, <span class=\"keyword\">int</span> vcpu_nr,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                        <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *type)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">char</span> type_instance[DATA_MAX_NAME_LEN];</span><br><span class=\"line\"></span><br><span class=\"line\">  ssnprintf(type_instance, <span class=\"keyword\">sizeof</span>(type_instance), <span class=\"string\">&quot;%d&quot;</span>, vcpu_nr);</span><br><span class=\"line\">  submit(dom, type, type_instance, &amp;(<span class=\"keyword\">value_t</span>)&#123;.derive = value&#125;, <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">submit</span><span class=\"params\">(virDomainPtr dom, <span class=\"keyword\">char</span> <span class=\"keyword\">const</span> *type,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                   <span class=\"keyword\">char</span> <span class=\"keyword\">const</span> *type_instance, <span class=\"keyword\">value_t</span> *values,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                   <span class=\"keyword\">size_t</span> values_len)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">value_list_t</span> vl = VALUE_LIST_INIT;</span><br><span class=\"line\">  init_value_list(&amp;vl, dom);</span><br><span class=\"line\"></span><br><span class=\"line\">  vl.values = values;</span><br><span class=\"line\">  vl.values_len = values_len;</span><br><span class=\"line\"></span><br><span class=\"line\">  sstrncpy(vl.type, type, <span class=\"keyword\">sizeof</span>(vl.type));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (type_instance != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">    sstrncpy(vl.type_instance, type_instance, <span class=\"keyword\">sizeof</span>(vl.type_instance));</span><br><span class=\"line\"></span><br><span class=\"line\">  plugin_dispatch_values(&amp;vl);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>CPU时间是指中央处理器（CPU）用于执行特定进程或线程的时间量</p>\n<p>虚拟机使用的CPU时间除以宿主机的总CPU时间</p>\n<p>总CPU时间分为用户空间时间、内核空间时间、空闲时间等</p>\n<h3 id=\"cpu\"><a href=\"#cpu\" class=\"headerlink\" title=\"cpu\"></a>cpu</h3><h2 id=\"FAQ\"><a href=\"#FAQ\" class=\"headerlink\" title=\"FAQ\"></a>FAQ</h2><p>idle的时候cpu在做什么？</p>\n<ol>\n<li>节能：一些现代操作系统和处理器支持节能功能，当 CPU 处于空闲状态时，可以降低 CPU 的频率或进入低功耗模式，以节省能源和降低发热。</li>\n<li>调度决策：操作系统可以使用空闲时间来评估当前的任务队列，并决定下一个要执行的任务，以优化系统的性能和响应能力。</li>\n<li>维护任务：操作系统可以利用空闲时间来执行一些后台维护任务，如内存回收、文件系统清理等。</li>\n</ol>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"echarts的使用","slug":"tools/echarts","date":"2021-01-11T10:20:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/echarts.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172298arping-network-scanning-tool.png","content":"<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> echarts = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;echarts&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> chartDom = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;main&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> myChart = echarts.init(chartDom);</span><br><span class=\"line\"><span class=\"keyword\">var</span> option;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> colors = [<span class=\"string\">&#x27;#FFAE57&#x27;</span>, <span class=\"string\">&#x27;#FF7853&#x27;</span>, <span class=\"string\">&#x27;#EA5151&#x27;</span>, <span class=\"string\">&#x27;#CC3F57&#x27;</span>, <span class=\"string\">&#x27;#9A2555&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> bgColor = <span class=\"string\">&#x27;#2E2733&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> itemStyle = &#123;</span><br><span class=\"line\">  star5: &#123;</span><br><span class=\"line\">    color: colors[<span class=\"number\">0</span>]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  star4: &#123;</span><br><span class=\"line\">    color: colors[<span class=\"number\">1</span>]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  star3: &#123;</span><br><span class=\"line\">    color: colors[<span class=\"number\">2</span>]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  star2: &#123;</span><br><span class=\"line\">    color: colors[<span class=\"number\">3</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> data = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;虚构&#x27;</span>,</span><br><span class=\"line\">    itemStyle: &#123;</span><br><span class=\"line\">      color: colors[<span class=\"number\">1</span>]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    children: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;小说&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;疼&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;慈悲&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;楼下的房客&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;虚无的十字架&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;无声告白&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;童年的终结&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;疯癫老人日记&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;其他&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;纳博科夫短篇小说全集&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;安魂曲&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;人生拼图版&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;比起爱你，我更需要你&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;非虚构&#x27;</span>,</span><br><span class=\"line\">    itemStyle: &#123;</span><br><span class=\"line\">      color: colors[<span class=\"number\">2</span>]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    children: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;设计&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;无界面交互&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;数字绘图的光照与渲染技术&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;日本建筑解剖书&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;奇幻世界艺术\\n&amp;RPG地图绘制讲座&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;社科&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;痛点&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;卓有成效的管理者&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;进化&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;后物欲时代的来临&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;疯癫与文明&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;心理&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;我们时代的神经症人格&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;皮格马利翁效应&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;受伤的人&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;2☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;迷恋&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;居家&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;把房子住成家&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;只过必要生活&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;北欧简约风格&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;绘本&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;设计诗&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;假如生活糊弄了你&#x27;</span></span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;博物学家的神秘动物图鉴&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;3☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;方向&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;哲学&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;人生的智慧&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;技术&#x27;</span>,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;5☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;代码整洁之道&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&#x27;4☆&#x27;</span>,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                name: <span class=\"string\">&#x27;Three.js 开发指南&#x27;</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; data.length; ++j) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> level1 = data[j].children;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; level1.length; ++i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> block = level1[i].children;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bookScore = [];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bookScoreId;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> star = <span class=\"number\">0</span>; star &lt; block.length; ++star) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> style = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (name) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"string\">&#x27;5☆&#x27;</span>:</span><br><span class=\"line\">            bookScoreId = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> itemStyle.star5;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"string\">&#x27;4☆&#x27;</span>:</span><br><span class=\"line\">            bookScoreId = <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> itemStyle.star4;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"string\">&#x27;3☆&#x27;</span>:</span><br><span class=\"line\">            bookScoreId = <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> itemStyle.star3;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"string\">&#x27;2☆&#x27;</span>:</span><br><span class=\"line\">            bookScoreId = <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> itemStyle.star2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)(block[star].name);</span><br><span class=\"line\">      block[star].label = &#123;</span><br><span class=\"line\">        color: style.color,</span><br><span class=\"line\">        downplay: &#123;</span><br><span class=\"line\">          opacity: <span class=\"number\">0.5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (block[star].children) &#123;</span><br><span class=\"line\">        style = &#123;</span><br><span class=\"line\">          opacity: <span class=\"number\">1</span>,</span><br><span class=\"line\">          color: style.color</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        block[star].children.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">book</span>) </span>&#123;</span><br><span class=\"line\">          book.value = <span class=\"number\">1</span>;</span><br><span class=\"line\">          book.itemStyle = style;</span><br><span class=\"line\">          book.label = &#123;</span><br><span class=\"line\">            color: style.color</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> value = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (bookScoreId === <span class=\"number\">0</span> || bookScoreId === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            value = <span class=\"number\">5</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (bookScore[bookScoreId]) &#123;</span><br><span class=\"line\">            bookScore[bookScoreId].value += value;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            bookScore[bookScoreId] = &#123;</span><br><span class=\"line\">              color: colors[bookScoreId],</span><br><span class=\"line\">              value: value</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    level1[i].itemStyle = &#123;</span><br><span class=\"line\">      color: data[j].itemStyle.color</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">option = &#123;</span><br><span class=\"line\">  backgroundColor: bgColor,</span><br><span class=\"line\">  color: colors,</span><br><span class=\"line\">  series: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      type: <span class=\"string\">&#x27;sunburst&#x27;</span>,</span><br><span class=\"line\">      center: [<span class=\"string\">&#x27;50%&#x27;</span>, <span class=\"string\">&#x27;48%&#x27;</span>],</span><br><span class=\"line\">      data: data,</span><br><span class=\"line\">      sort: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a.depth === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> b.getValue() - a.getValue();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> a.dataIndex - b.dataIndex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      label: &#123;</span><br><span class=\"line\">        rotate: <span class=\"string\">&#x27;radial&#x27;</span>,</span><br><span class=\"line\">        color: bgColor</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      itemStyle: &#123;</span><br><span class=\"line\">        borderColor: bgColor,</span><br><span class=\"line\">        borderWidth: <span class=\"number\">2</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      levels: [</span><br><span class=\"line\">        &#123;&#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          r0: <span class=\"number\">0</span>,</span><br><span class=\"line\">          r: <span class=\"number\">40</span>,</span><br><span class=\"line\">          label: &#123;</span><br><span class=\"line\">            rotate: <span class=\"number\">0</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          r0: <span class=\"number\">40</span>,</span><br><span class=\"line\">          r: <span class=\"number\">105</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          r0: <span class=\"number\">115</span>,</span><br><span class=\"line\">          r: <span class=\"number\">140</span>,</span><br><span class=\"line\">          itemStyle: &#123;</span><br><span class=\"line\">            shadowBlur: <span class=\"number\">2</span>,</span><br><span class=\"line\">            shadowColor: colors[<span class=\"number\">2</span>],</span><br><span class=\"line\">            color: <span class=\"string\">&#x27;transparent&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          label: &#123;</span><br><span class=\"line\">            rotate: <span class=\"string\">&#x27;tangential&#x27;</span>,</span><br><span class=\"line\">            fontSize: <span class=\"number\">10</span>,</span><br><span class=\"line\">            color: colors[<span class=\"number\">0</span>]</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          r0: <span class=\"number\">140</span>,</span><br><span class=\"line\">          r: <span class=\"number\">145</span>,</span><br><span class=\"line\">          itemStyle: &#123;</span><br><span class=\"line\">            shadowBlur: <span class=\"number\">80</span>,</span><br><span class=\"line\">            shadowColor: colors[<span class=\"number\">0</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          label: &#123;</span><br><span class=\"line\">            position: <span class=\"string\">&#x27;outside&#x27;</span>,</span><br><span class=\"line\">            textShadowBlur: <span class=\"number\">5</span>,</span><br><span class=\"line\">            textShadowColor: <span class=\"string\">&#x27;#333&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          downplay: &#123;</span><br><span class=\"line\">            label: &#123;</span><br><span class=\"line\">              opacity: <span class=\"number\">0.5</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">option &amp;&amp; myChart.setOption(option);</span><br></pre></td></tr></table></figure>\n\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"git的使用","slug":"tools/git","date":"2019-10-21T12:12:11.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/git.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172820git_animado.gif","content":"<p>[toc]</p>\n<h2 id=\"git-attributes文件\"><a href=\"#git-attributes文件\" class=\"headerlink\" title=\"git attributes文件\"></a>git attributes文件</h2><p>gitattributes是一个文本文件</p>\n<p>格式如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">匹配的文件如(*.py) 属性1(如text)  属性2(如eol&#x3D;lf)</span><br></pre></td></tr></table></figure>\n\n<p>属性有4种状态，以text为例</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*           text=auto #设置值</span><br><span class=\"line\">*.sh\t\ttext #设置text</span><br><span class=\"line\">*.jpg\t\t-text 不设置</span><br><span class=\"line\">*.py\t\t未声明</span><br></pre></td></tr></table></figure>\n\n<p>常见属性说明</p>\n<p>txt：行尾规范化，值为auto时，进入git库行尾自动转为LF，若git库中已经CRLF则不转换</p>\n<p>eol: 值为CRLF时进入工作目录为CRLF，值为LF时进入工作目录为LF</p>\n<h2 id=\"git-操作\"><a href=\"#git-操作\" class=\"headerlink\" title=\"git 操作\"></a>git 操作</h2><h3 id=\"克隆指定分支\"><a href=\"#克隆指定分支\" class=\"headerlink\" title=\"克隆指定分支\"></a>克隆指定分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone -b feature-vnuma ssh:&#x2F;&#x2F;git@dev.zstack.io:9022&#x2F;mingmin.wen&#x2F;zstack.git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看分支\"><a href=\"#查看分支\" class=\"headerlink\" title=\"查看分支\"></a>查看分支</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch    <span class=\"comment\">#查看本地分支</span></span><br><span class=\"line\">git branch -a <span class=\"comment\">#查看所有分支，包括本地和远程</span></span><br><span class=\"line\">git branch -r <span class=\"comment\">#查看远程分支</span></span><br><span class=\"line\">git branch -vv <span class=\"comment\">#查看上有</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"同步远程分支\"><a href=\"#同步远程分支\" class=\"headerlink\" title=\"同步远程分支\"></a>同步远程分支</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git fetch <span class=\"comment\">#本地分支与远程分支保持同步</span></span><br><span class=\"line\">git checkout -b 本地分支 origin/远程分支 <span class=\"comment\">#拉去远程分支并创建对应的本地分支</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"git-reset-区别\"><a href=\"#git-reset-区别\" class=\"headerlink\" title=\"git reset 区别\"></a>git reset 区别</h3><h3 id=\"stage-index-区域\"><a href=\"#stage-index-区域\" class=\"headerlink\" title=\"stage(index) 区域\"></a>stage(index) 区域</h3><p>暂存区<code>Stage</code>只是一个简单的索引文件而已， <code>.git/index</code>文件</p>\n<p><img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211117/1637113648cc3510e8f32578ed0f39756e298749de.png\" alt=\"git 数据流程图示意图\"></p>\n<h3 id=\"合并不同分支\"><a href=\"#合并不同分支\" class=\"headerlink\" title=\"合并不同分支\"></a>合并不同分支</h3><ol>\n<li>切换到要最终合并到的目标分支targetB <code>git checkout targetB</code></li>\n<li>将要合进的分支sourceB合并到目标分支 <code>git merge sourceB </code> 即可将sourceB合并到targetB</li>\n<li>如果有冲突请看下一节</li>\n</ol>\n<h3 id=\"处理合并冲突\"><a href=\"#处理合并冲突\" class=\"headerlink\" title=\"处理合并冲突\"></a>处理合并冲突</h3><ol>\n<li>一般ide都会提示你进入冲突处理，逐行处理冲突（使用目标分支的还是你自己分支的）</li>\n<li>使用<code>git mergetool</code> 进入处理冲突,但是需要自己配置git mergertool</li>\n</ol>\n<h3 id=\"配置mergetool\"><a href=\"#配置mergetool\" class=\"headerlink\" title=\"配置mergetool\"></a>配置mergetool</h3><ol>\n<li><p>检查当前系统插件<code>git mergetool --tool-help</code> 看一下支持列表</p>\n</li>\n<li><p>选一个工具下载下载，例如 beyound compare</p>\n</li>\n<li><p>配置<code>git config --global merge.tool bc4</code> <code>git config --global mergetool.bc4.path &quot;bcomp.exe的路径&quot;</code></p>\n</li>\n</ol>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"git常见问题","slug":"tools/gittrouble","date":"2019-10-21T12:12:11.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/gittrouble.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172820git_animado.gif","content":"<h2 id=\"git-attributes文件\"><a href=\"#git-attributes文件\" class=\"headerlink\" title=\"git attributes文件\"></a>git attributes文件</h2><p>gitattributes是一个文本文件</p>\n<p>格式如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">匹配的文件如(*.py) 属性1(如text)  属性2(如eol&#x3D;lf)</span><br></pre></td></tr></table></figure>\n\n<p>属性有4种状态，以text为例</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*           text=auto #设置值 c</span><br><span class=\"line\">*.sh\t\ttext #设置text</span><br><span class=\"line\">*.jpg\t\t-text 不设置</span><br><span class=\"line\">*.py\t\t未声明</span><br></pre></td></tr></table></figure>\n\n<p>常见属性说明</p>\n<p>txt：行尾规范化，值为auto时，进入git库行尾自动转为LF，若git库中已经CRLF则不转换</p>\n<p>eol: 值为CRLF时进入工作目录为CRLF，值为LF时进入工作目录为LF</p>\n<h2 id=\"git-操作\"><a href=\"#git-操作\" class=\"headerlink\" title=\"git 操作\"></a>git 操作</h2><h3 id=\"克隆指定分支\"><a href=\"#克隆指定分支\" class=\"headerlink\" title=\"克隆指定分支\"></a>克隆指定分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone -b feature-vnuma ssh:&#x2F;&#x2F;git@dev.zstack.io:9022&#x2F;mingmin.wen&#x2F;zstack.git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"查看分支\"><a href=\"#查看分支\" class=\"headerlink\" title=\"查看分支\"></a>查看分支</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch    <span class=\"comment\">#查看本地分支</span></span><br><span class=\"line\">git branch -a <span class=\"comment\">#查看所有分支，包括本地和远程</span></span><br><span class=\"line\">git branch -r <span class=\"comment\">#查看远程分支</span></span><br><span class=\"line\">git branch -vv <span class=\"comment\">#查看上有</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"同步远程分支\"><a href=\"#同步远程分支\" class=\"headerlink\" title=\"同步远程分支\"></a>同步远程分支</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git fetch <span class=\"comment\">#本地分支与远程分支保持同步</span></span><br><span class=\"line\">git checkout -b 本地分支 origin/远程分支 <span class=\"comment\">#拉去远程分支并创建对应的本地分支</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"git-reset-区别\"><a href=\"#git-reset-区别\" class=\"headerlink\" title=\"git reset 区别\"></a>git reset 区别</h3><h3 id=\"stage-index-区域\"><a href=\"#stage-index-区域\" class=\"headerlink\" title=\"stage(index) 区域\"></a>stage(index) 区域</h3><p>暂存区<code>Stage</code>只是一个简单的索引文件而已， <code>.git/index</code>文件</p>\n<p><img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211117/1637113648cc3510e8f32578ed0f39756e298749de.png\" alt=\"git 数据流程图示意图\"></p>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"Hive搭建 centos","slug":"tools/hive","date":"2019-12-26T15:40:51.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/hive.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172894hive-sql.jpg","content":"<p>[toc]</p>\n<h4 id=\"centos下-Hive搭建（mysql、hadoop-、jdk）\"><a href=\"#centos下-Hive搭建（mysql、hadoop-、jdk）\" class=\"headerlink\" title=\"centos下 Hive搭建（mysql、hadoop 、jdk）\"></a>centos下 Hive搭建（mysql、hadoop 、jdk）</h4><h4 id=\"Mysql\"><a href=\"#Mysql\" class=\"headerlink\" title=\"Mysql\"></a>Mysql</h4><ol>\n<li><p> wget <a href=\"https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm\">https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</a></p>\n</li>\n<li><p>```<br> rpm -ivh mysql80-community-release-el7-3.noarch.rpm</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">3.  &#96;&#96;&#96;</span><br><span class=\"line\">    yum install mysql-community-server -y</span><br><span class=\"line\">    systemctl enable mysqld</span><br><span class=\"line\">    systemctl start mysqld</span><br><span class=\"line\">    grep &#39;temporary password&#39; &#x2F;var&#x2F;log&#x2F;mysqld.log #获得密码</span><br><span class=\"line\">    mysql -u root -p</span><br><span class=\"line\">    mysql&gt; set global validate_password.policy&#x3D;0;</span><br><span class=\"line\">    mysql&gt; set global validate_password.length&#x3D;1;</span><br><span class=\"line\">    mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;password&#39;;</span><br><span class=\"line\">    firewall-cmd --zone&#x3D;public --add-port&#x3D;3306&#x2F;tcp --permanent</span><br><span class=\"line\">    firewall-cmd --reload</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>完整脚本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class=\"line\">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br><span class=\"line\">yum install mysql-community-server -y</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> mysqld</span><br><span class=\"line\">systemctl start mysqld</span><br><span class=\"line\">grep <span class=\"string\">&#x27;temporary password&#x27;</span> /var/<span class=\"built_in\">log</span>/mysqld.log <span class=\"comment\">#获得密码</span></span><br><span class=\"line\">mysql -u root -p</span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">set</span> global validate_password.policy=0;</span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">set</span> global validate_password.length=1;</span><br><span class=\"line\">mysql&gt; alter user <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> identified by <span class=\"string\">&#x27;password&#x27;</span>;</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"hadoop安装\"><a href=\"#hadoop安装\" class=\"headerlink\" title=\"hadoop安装\"></a>hadoop安装</h4><p>Hadoop的核心由3个部分组成：</p>\n<p>  HDFS: Hadoop Distributed File System，分布式文件系统，hdfs还可以再细分为NameNode、SecondaryNameNode、DataNode。</p>\n<p>  YARN: Yet Another Resource Negotiator，资源管理调度系统</p>\n<p>  Mapreduce：分布式运算框架</p>\n<p>1.安装jdk7或8（不支持11）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">下载</span></span><br><span class=\"line\">wget -O jdk-8u131-linux-x64.tar.gz --no-check-certificate --no-cookies --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf ~/jdk-8u131-linux-x64.tar.gz -C /usr/local/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 配置环境</span></span><br><span class=\"line\">vi /etc/profile</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  后面添加</span></span><br><span class=\"line\">export JAVA_HOME=/usr/local/jdk1.8.0_131</span><br><span class=\"line\">export CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/</span><br><span class=\"line\">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">重新加载配置</span></span><br><span class=\"line\">source /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">验证</span></span><br><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">下载hadoop</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> wget https://downloads.apache.org/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz</span></span><br><span class=\"line\">wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz</span><br><span class=\"line\">tar zxvf hadoop-2.10.1.tar.gz -C /usr/local/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">配置jdk</span></span><br><span class=\"line\">vi $&#123;HADOOP_HMOE&#125;/etc/hadoop/hadoop-003env.sh</span><br><span class=\"line\">export JAVA_HOME=/usr/local/jdk1.8.0_131/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">设置伪分布模式（Pseudo-Distributed Operation）修改etc/hadoop/core-site.xml文件，增加配置（fs.defaultFS：默认文件系统名称）：</span></span><br><span class=\"line\">vi $&#123;HADOOP_HMOE&#125;/etc/hadoop/core-site.xml</span><br><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">    &lt;property&gt;</span><br><span class=\"line\">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class=\"line\">        &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span><br><span class=\"line\">    &lt;/property&gt;</span><br><span class=\"line\">&lt;/configuration&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"> #</span><span class=\"bash\"> 修改etc/hadoop/hdfs-site.xml文件，增加配置（dfs.replication：文件副本数）：</span></span><br><span class=\"line\"> &lt;configuration&gt;</span><br><span class=\"line\">    &lt;property&gt;</span><br><span class=\"line\">        &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class=\"line\">        &lt;value&gt;1&lt;/value&gt;</span><br><span class=\"line\">    &lt;/property&gt;</span><br><span class=\"line\">&lt;/configuration&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">格式化文件系统</span></span><br><span class=\"line\">/usr/local/hadoop-2.10.1/bin/hdfs namenode -format</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">启动NameNode和DataNode进程（启动hdfs）</span></span><br><span class=\"line\">/usr/local/hadoop-2.10.1/sbin/start-dfs.sh // 启动NameNode和DataNode进程</span><br><span class=\"line\">/usr/local/hadoop-2.10.1/sbin/stop-dfs.sh  // 关闭NameNode和DataNode进程</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">查看HDFS验证成功</span></span><br><span class=\"line\">http://172.20.19.33:50070</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">启动yarn</span></span><br><span class=\"line\">/usr/local/hadoop-2.10.1/sbin/start-yarn.sh</span><br><span class=\"line\">/usr/local/hadoop-2.10.1/sbin/stop-yarn.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">查看YARN</span></span><br><span class=\"line\">http://172.20.19.33:8088/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 配置环境</span></span><br><span class=\"line\">vi /etc/profile</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  后面添加</span></span><br><span class=\"line\">export HADOOP_HOME=/usr/local/hadoop-2.10.1</span><br><span class=\"line\">export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">重新加载配置</span></span><br><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Hive安装\"><a href=\"#Hive安装\" class=\"headerlink\" title=\"Hive安装\"></a>Hive安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 下载</span></span><br><span class=\"line\">wget https://mirrors.tuna.tsinghua.edu.cn/apache/hive/hive-3.1.2/apache-hive-3.1.2-bin.tar.gz -c #比较慢，断点下载</span><br><span class=\"line\">tar zxvf apache-hive-3.1.2-bin.tar.gz -C /usr/local/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">改名去bin</span></span><br><span class=\"line\">mv apache-hive-3.1.2-bin/ apache-hive-3.1.2/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">配置</span></span><br><span class=\"line\">cd /usr/local/apache-hive-3.1.2/conf/</span><br><span class=\"line\">cp hive-log4j2.properties.template hive-log4j2.properties</span><br><span class=\"line\">vi /usr/local/apache-hive-3.1.2/conf/hive-site.xml</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class=\"line\">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">  &lt;property&gt;</span><br><span class=\"line\">    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class=\"line\">    &lt;value&gt;jdbc:mysql://172.20.19.33:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt;</span><br><span class=\"line\">　&lt;/property&gt;</span><br><span class=\"line\">　&lt;property&gt;</span><br><span class=\"line\">    &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class=\"line\">　　&lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;</span><br><span class=\"line\">  &lt;/property&gt;</span><br><span class=\"line\">  &lt;property&gt;</span><br><span class=\"line\">    &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class=\"line\">    &lt;value&gt;root&lt;/value&gt;</span><br><span class=\"line\">  &lt;/property&gt;</span><br><span class=\"line\">  &lt;property&gt;</span><br><span class=\"line\">    &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class=\"line\">    &lt;value&gt;password&lt;/value&gt;</span><br><span class=\"line\">  &lt;/property&gt;</span><br><span class=\"line\">&lt;/configuration&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">初始化数据库</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">下载并拷贝protobuf-java-3.6.1.jar和mysql-connector-java-8.0.17.jar到<span class=\"variable\">$HIVE_HOME</span>/lib目录下，删除已有的protobuf-java-2.5.0.jar文件。统一hive和mysql服务的时区。</span></span><br><span class=\"line\">wget -c https://repo1.maven.org/maven2/com/google/protobuf/protobuf-java/3.6.1/protobuf-java-3.6.1.jar</span><br><span class=\"line\">wget -c https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.17/mysql-connector-java-8.0.17.jar</span><br><span class=\"line\">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # hive和mysql服务器都要执行，mysql要重启服务</span><br><span class=\"line\">cd /usr/local/apache-hive-3.1.2/bin/</span><br><span class=\"line\">/usr/local/apache-hive-3.1.2/bin/schematool -dbType mysql -initSchema # 报错需要修改mysql访问权限</span><br><span class=\"line\">/usr/local/apache-hive-3.1.2/bin/hive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  启动hiveserver2：</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 修改<span class=\"variable\">$HADOOP_HOME</span>/etc/hadoop/core-site.xml文件，增加如下配置：</span></span><br><span class=\"line\">vi /usr/local/hadoop-2.10.1/etc/hadoop/core-site.xml</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;</span><br><span class=\"line\">        &lt;value&gt;*&lt;/value&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;</span><br><span class=\"line\">        &lt;value&gt;*&lt;/value&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">         &lt;name&gt;hadoop.proxyuser.hadoop.hosts&lt;/name&gt;</span><br><span class=\"line\">        &lt;value&gt;*&lt;/value&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\"> &lt;property&gt;</span><br><span class=\"line\">         &lt;name&gt;hadoop.proxyuser.hadoop.groups&lt;/name&gt;</span><br><span class=\"line\">         &lt;value&gt;*&lt;/value&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">vi /usr/local/apache-hive-3.1.2/conf/hive-site.xml</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;property&gt;</span><br><span class=\"line\">     &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;</span><br><span class=\"line\">     &lt;value&gt;10000&lt;/value&gt;</span><br><span class=\"line\">  &lt;/property&gt;</span><br><span class=\"line\">  &lt;property&gt;</span><br><span class=\"line\">     &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;</span><br><span class=\"line\">     &lt;value&gt;172.20.19.33&lt;/value&gt;</span><br><span class=\"line\">  &lt;/property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/local/apache-hive-3.1.2/bin/hiveserver2 &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>mysql权限修改</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 改表法</span></span><br><span class=\"line\">mysql -u root -pvmware</span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\">use mysql;</span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\">update user <span class=\"built_in\">set</span> host = <span class=\"string\">&#x27;%&#x27;</span> <span class=\"built_in\">where</span> user = <span class=\"string\">&#x27;root&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\">flush privileges;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h5><p><strong>Hive Shell 、Hive Web UI及JDBC 三种连接Hive Server的方式是互斥的，同一时刻只能用一种方式连接</strong></p>\n<h3 id=\"端口说明\"><a href=\"#端口说明\" class=\"headerlink\" title=\"端口说明\"></a>端口说明</h3><table>\n<thead>\n<tr>\n<th>组件</th>\n<th>Daemon</th>\n<th>端口</th>\n<th>配置</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>HDFS</td>\n<td>DataNode</td>\n<td>50010</td>\n<td>dfs.datanode.address</td>\n<td>datanode服务端口，用于数据传输</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>50075</td>\n<td>dfs.datanode.http.address</td>\n<td>http服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>50475</td>\n<td>dfs.datanode.https.address</td>\n<td>https服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>50020</td>\n<td>dfs.datanode.ipc.address</td>\n<td>ipc服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td>NameNode</td>\n<td>50070</td>\n<td>dfs.namenode.http-address</td>\n<td>http服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>50470</td>\n<td>dfs.namenode.https-address</td>\n<td>https服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8020</td>\n<td>fs.defaultFS</td>\n<td>接收Client连接的RPC端口，用于获取文件系统metadata信息。</td>\n</tr>\n<tr>\n<td></td>\n<td>journalnode</td>\n<td>8485</td>\n<td>dfs.journalnode.rpc-address</td>\n<td>RPC服务</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8480</td>\n<td>dfs.journalnode.http-address</td>\n<td>HTTP服务</td>\n</tr>\n<tr>\n<td></td>\n<td>ZKFC</td>\n<td>8019</td>\n<td>dfs.ha.zkfc.port</td>\n<td>ZooKeeper FailoverController，用于NN HA</td>\n</tr>\n<tr>\n<td>YARN</td>\n<td>ResourceManager</td>\n<td>8032</td>\n<td>yarn.resourcemanager.address</td>\n<td>RM的applications manager(ASM)端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8030</td>\n<td>yarn.resourcemanager.scheduler.address</td>\n<td>scheduler组件的IPC端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8031</td>\n<td>yarn.resourcemanager.resource-tracker.address</td>\n<td>IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8033</td>\n<td>yarn.resourcemanager.admin.address</td>\n<td>IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8088</td>\n<td>yarn.resourcemanager.webapp.address</td>\n<td>http服务端口</td>\n</tr>\n<tr>\n<td></td>\n<td>NodeManager</td>\n<td>8040</td>\n<td>yarn.nodemanager.localizer.address</td>\n<td>localizer IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8042</td>\n<td>yarn.nodemanager.webapp.address</td>\n<td>http服务端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>8041</td>\n<td>yarn.nodemanager.address</td>\n<td>NM中container manager的端口</td>\n</tr>\n<tr>\n<td></td>\n<td>JobHistory Server</td>\n<td>10020</td>\n<td>mapreduce.jobhistory.address</td>\n<td>IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>19888</td>\n<td>mapreduce.jobhistory.webapp.address</td>\n<td>http服务端口</td>\n</tr>\n<tr>\n<td>HBase</td>\n<td>Master</td>\n<td>60000</td>\n<td>hbase.master.port</td>\n<td>IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>60010</td>\n<td>hbase.master.info.port</td>\n<td>http服务端口</td>\n</tr>\n<tr>\n<td></td>\n<td>RegionServer</td>\n<td>60020</td>\n<td>hbase.regionserver.port</td>\n<td>IPC</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>60030</td>\n<td>hbase.regionserver.info.port</td>\n<td>http服务端口</td>\n</tr>\n<tr>\n<td></td>\n<td>HQuorumPeer</td>\n<td>2181</td>\n<td>hbase.zookeeper.property.clientPort</td>\n<td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>2888</td>\n<td>hbase.zookeeper.peerport</td>\n<td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>3888</td>\n<td>hbase.zookeeper.leaderport</td>\n<td>HBase-managed ZK mode，使用独立的ZooKeeper集群则不会启用该端口。</td>\n</tr>\n<tr>\n<td>Hive</td>\n<td>Metastore</td>\n<td>9083</td>\n<td>/etc/default/hive-metastore中export PORT=<port>来更新默认端口</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>HiveServer</td>\n<td>10000</td>\n<td>/etc/hive/conf/hive-env.sh中export HIVE_SERVER2_THRIFT_PORT=<port>来更新默认端口</td>\n<td></td>\n</tr>\n<tr>\n<td>ZooKeeper</td>\n<td>Server</td>\n<td>2181</td>\n<td>/etc/zookeeper/conf/zoo.cfg中clientPort=<port></td>\n<td>对客户端提供服务的端口</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>2888</td>\n<td>/etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分</td>\n<td>follower用来连接到leader，只在leader上监听该端口。</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>3888</td>\n<td>/etc/zookeeper/conf/zoo.cfg中server.x=[hostname]:nnnnn[:nnnnn]，标蓝部分</td>\n<td>用于leader选举的。只在electionAlg是1,2或3(默认)时需要。</td>\n</tr>\n</tbody></table>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"jenkins安装","slug":"tools/jenkins","date":"2019-11-27T13:29:31.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/jenkins.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635174290jenkins-angry.png?resize=331%2C372&ssl=1","content":"<h2 id=\"下载镜像\"><a href=\"#下载镜像\" class=\"headerlink\" title=\"下载镜像\"></a>下载镜像</h2><p>打开终端，输入docker search命令搜索 Docker Hub 上可用的 Jenkins 镜像：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker search jenkins</span><br><span class=\"line\">NAME                                         DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class=\"line\">jenkins                                      Official Jenkins Docker image                   4328                [OK]</span><br><span class=\"line\">jenkins&#x2F;jenkins                              The leading open source automation server       1563</span><br><span class=\"line\">jenkinsci&#x2F;blueocean                          https:&#x2F;&#x2F;jenkins.io&#x2F;projects&#x2F;blueocean           399</span><br><span class=\"line\">jenkinsci&#x2F;jenkins                            Jenkins Continuous Integration and Delivery …   367</span><br><span class=\"line\">jenkinsci&#x2F;jnlp-slave                         A Jenkins slave using JNLP to establish conn…   110                                     [OK]</span><br><span class=\"line\">jenkins&#x2F;jnlp-slave                           a Jenkins agent (FKA &quot;slave&quot;) using JNLP to …   86                                      [OK]</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>根据镜像OFFICIAL标签判断，位列第一、名字为jenkins的是 Jenkins 官方提供的镜像。我们是不是应该使用这个官方镜像呢？</p>\n<p>如果你看过 Jenkins 文档中 Docker 安装 小节，会发现官方推荐使用的镜像是jenkinsci/blueocean，该镜像包含当前的长期支持 (LTS) 的 Jenkins 版本 (可以生产使用) ，并捆绑了所有 Blue Ocean 插件和功能。</p>\n<p>第一次安装的时候使用的是jenkins镜像，其集成的 Jenkins 版本比较高，结果出现好多插件不兼容的情况，对于我等小白来说是一件比较麻烦的事。</p>\n<p>这里我们果断使用jenkinsci/blueocean镜像，使用docker pull命令拉取：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker pull jenkinsci&#x2F;blueocean</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from jenkinsci&#x2F;blueocean</span><br><span class=\"line\">Digest: sha256:523769431f19830cfda7ceae37c59c9f01affb551836933aa30114dcaa5df9eb</span><br><span class=\"line\">Status: Image is up to date for jenkinsci&#x2F;blueocean:latest</span><br></pre></td></tr></table></figure>\n\n<p>在本地镜像仓库确认是否已存在：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker images</span><br><span class=\"line\">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">jenkinsci&#x2F;blueocean   latest              ef2dc74fe285        21 hours ago        552MB</span><br><span class=\"line\">mysql                 latest              990386cbd5c0        2 months ago        443MB</span><br><span class=\"line\">jenkins               latest              cd14cecfdb3a        11 months ago       696MB</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行容器\"><a href=\"#运行容器\" class=\"headerlink\" title=\"运行容器\"></a>运行容器</h2><p>现在，就可以基于下载的镜像运行 Jenkins 容器了，有以下两种运行方式供你参考：</p>\n<p>方式一：直接运行，运行期间产生的所有数据都保存在容器内部，容器销毁，数据丢失。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">    --name jenkins-blueocean \\</span><br><span class=\"line\">    -d \\</span><br><span class=\"line\">    -p 8081:8080 \\</span><br><span class=\"line\">    -p 50001:50000 \\</span><br><span class=\"line\">    jenkinsci&#x2F;blueocean</span><br></pre></td></tr></table></figure>\n\n<p>方式二：Docker 会在宿主机上创建一个数据卷jenkins-data，容器映射该卷以持久化数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">  --name jenkins-blueocean \\</span><br><span class=\"line\">  -d \\</span><br><span class=\"line\">  -p 8081:8080 \\</span><br><span class=\"line\">  -p 50000:50000 \\</span><br><span class=\"line\">  -v jenkins-data:&#x2F;var&#x2F;jenkins_home \\</span><br><span class=\"line\">  jenkinsci&#x2F;blueocean</span><br></pre></td></tr></table></figure>\n\n<p>Tips：8081 端口用来公开访问 Web 界面，50000 端口允许访问远程 Java (JIRA) API。</p>\n<p>这里我使用了第二种方式启动了 一个 Jenkins 容器应用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run \\</span><br><span class=\"line\">  --name jenkins-blueocean \\</span><br><span class=\"line\">  -d \\</span><br><span class=\"line\">  -p 8080:8080 \\</span><br><span class=\"line\">  -p 50000:50000 \\ </span><br><span class=\"line\">  -v jenkins-data:&#x2F;var&#x2F;jenkins_home \\</span><br><span class=\"line\">  jenkinsci&#x2F;blueocean</span><br><span class=\"line\">93f88d6ca2129fae971298e98e20091570f6903463b203a9235660856f63020e</span><br></pre></td></tr></table></figure>\n\n<p>最后使用docker ps命令确认容器是否已经后台运行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class=\"line\">0cad9bbe76a6        jenkinsci&#x2F;blueocean   &quot;&#x2F;sbin&#x2F;tini -- &#x2F;usr&#x2F;…&quot;   About an hour ago   Up About an hour    0.0.0.0:8080-&gt;8080&#x2F;tcp, 0.0.0.0:50000-&gt;50000&#x2F;tcp   jenkins-blueocean</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置-Jenkins\"><a href=\"#配置-Jenkins\" class=\"headerlink\" title=\"配置 Jenkins\"></a>配置 Jenkins</h2><p>以上如果一切正常，现在就可以通过http://<ipaddress>:8080访问 Jenkins 的 Web 界面了。</p>\n<h3 id=\"Step1：解锁-Jenkins。\"><a href=\"#Step1：解锁-Jenkins。\" class=\"headerlink\" title=\"Step1：解锁 Jenkins。\"></a>Step1：解锁 Jenkins。</h3><p>Alt Text</p>\n<p>管理员初始密码被放到了/var/jenkins_home/secrets/initialAdminPassword 文件中。</p>\n<p>因为我们把 Jenkins 部署在了 Docker 容器中，因此需要先进入到容器，再去查看对应的文件initialAdminPassword内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker exec -it jenkins-blueocean &#x2F;bin&#x2F;bash</span><br><span class=\"line\">jenkins@93f88d6ca212:&#x2F;$ cat &#x2F;var&#x2F;jenkins_home&#x2F;secrets&#x2F;initialAdminPassword</span><br><span class=\"line\">a6f6d08fcc474178833001d1fc79be62</span><br></pre></td></tr></table></figure>\n\n<p>如上输出中，a6f6d08fcc474178833001d1fc79be62 便是我们需要的管理员密码，复制并粘贴到 Web 界面，点击继续即可解锁 Jenkins。</p>\n<h3 id=\"Step2：安装插件。\"><a href=\"#Step2：安装插件。\" class=\"headerlink\" title=\"Step2：安装插件。\"></a>Step2：安装插件。</h3><p>Jenkins 可以说完全由插件来驱动的，所以安装一些基础的插件是非要必要的，这里我们选择 安装推荐的插件 ，然后静静地等待插件安装完成即可。</p>\n<h3 id=\"Step3：创建用户。\"><a href=\"#Step3：创建用户。\" class=\"headerlink\" title=\"Step3：创建用户。\"></a>Step3：创建用户。</h3><p>接着继续下一步操作，提示需要创建一个新的用户，自行填写即可。</p>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"longtaoLM的使用","slug":"tools/longtaollm","date":"2023-02-11T10:20:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/longtaollm.json","excerpt":null,"keywords":"云计算","cover":"https://st2.depositphotos.com/1002075/9896/v/600/depositphotos_98965042-stock-illustration-abstract-tunnel-grid-futuristic-technology.jpg","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>longtaoLM是一个精简的中文语言模型</p>\n<h2 id=\"体验\"><a href=\"#体验\" class=\"headerlink\" title=\"体验\"></a>体验</h2><p>在下面的input中输入文字，等待一段时间将会在右侧给出生成的结果；</p>\n<p>注意，如果提问，必须带上问号<code>?</code></p>\n<iframe\n    src=\"https://eustance-eustance-longtao-v1.hf.space\"\n    frameborder=\"0\"\n    width=\"850\"\n    height=\"450\"\n></iframe>","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"50行代码实现md图床","slug":"tools/picpool","date":"2019-12-08T12:30:41.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/picpool.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635176968206911424-carribean-opt-1-tcm126-2202438.jpg","content":"<p><a href=\"http://longtao.fun/\">首页</a> -&gt; <a href=\"http://longtao.fun/product/product.html\">项目列表</a></p>\n<p>原文地址：<a href=\"https://longtao.fun/picture_pool/\">https://longtao.fun/picture_pool/</a></p>\n<h3 id=\"简单介绍\"><a href=\"#简单介绍\" class=\"headerlink\" title=\"简单介绍\"></a>简单介绍</h3><p>服务端代码,使用flask提供api服务，两个接口，一个用来上传，一个用来查看图片，上传图片返回图片url</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> uuid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request, make_response</span><br><span class=\"line\"></span><br><span class=\"line\">ip = <span class=\"string\">&#x27;127.0.0.1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">file_path = os.path.join(os.path.dirname(__file__), <span class=\"string\">&#x27;pics&#x27;</span>)</span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/photo&quot;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_frame</span>():</span></span><br><span class=\"line\">    upload_file = request.data</span><br><span class=\"line\">    img = base64.b64decode(upload_file)</span><br><span class=\"line\">    file_name = <span class=\"built_in\">str</span>(uuid.uuid1())</span><br><span class=\"line\">    file_paths = os.path.join(file_path, file_name)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(img)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/show/&#123;&#125;&#x27;</span>.<span class=\"built_in\">format</span>(ip, file_name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/eus/v1/show/&lt;string:filename&gt;&quot;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span>(<span class=\"params\">filename</span>):</span></span><br><span class=\"line\">    file_paths = os.path.join(file_path, filename)</span><br><span class=\"line\">    f = <span class=\"built_in\">open</span>(file_paths, <span class=\"string\">&quot;rb&quot;</span>).read()</span><br><span class=\"line\">    response = make_response(f)</span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;Content-Type&#x27;</span>] = <span class=\"string\">&#x27;image/png&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    app.run(debug=<span class=\"literal\">False</span>, host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5555</span>)</span><br></pre></td></tr></table></figure>\n\n<p>客户端脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) == <span class=\"number\">1</span>:</span><br><span class=\"line\">    sys.argv.append(<span class=\"string\">&#x27;--help&#x27;</span>)</span><br><span class=\"line\">parser = argparse.ArgumentParser()</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-s&#x27;</span>, <span class=\"string\">&#x27;--source&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"string\">&#x27;+&#x27;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须传入文件&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&#x27;-i&#x27;</span>, <span class=\"string\">&#x27;--ip&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>, nargs=<span class=\"number\">1</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;必须指定地址&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\">image_list = args.source</span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://&#123;&#125;:5555/eus/v1/photo&#x27;</span>.<span class=\"built_in\">format</span>(args.ip[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_data</span>(<span class=\"params\">_img</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> os.path.isfile(_img):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(_img, <span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            file = f.read()</span><br><span class=\"line\">            encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        file = requests.get(_img).content</span><br><span class=\"line\">        encode_f = base64.b64encode(file)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> encode_f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> img <span class=\"keyword\">in</span> image_list:</span><br><span class=\"line\">        req = requests.post(url=url, data=get_data(img))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;http://&quot;</span>+<span class=\"built_in\">str</span>(req.text))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"todo\"><a href=\"#todo\" class=\"headerlink\" title=\"todo\"></a>todo</h4><ol>\n<li>使用go重写方便部署</li>\n<li>图片去重</li>\n<li>图片压缩</li>\n</ol>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><h4 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h4><ol>\n<li> 下载本repo源码</li>\n<li> 安装python3环境，安装</li>\n<li> 修改main 中的ip地址为你的服务端公网ip，是遏制iptables开启5555端口;</li>\n<li> nohup python3 $repoPath/main.py &amp;启动或者通过systemd启动</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;[Unit]</span><br><span class=\"line\">Description=simple picture pool</span><br><span class=\"line\">   </span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/usr/bin/python3 /root/pic_pool/picture_pool/main.py &gt; /dev/null   2&gt;&amp;1</span><br><span class=\"line\">   </span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target &quot; &gt; /etc/systemd/system/spp.service</span><br><span class=\"line\">systemctl status spp</span><br><span class=\"line\">systemctl start spp</span><br><span class=\"line\">systemctl enable spp</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><ol>\n<li> 在你的修改upload_script.py 中的ip为你搭建的服务端ip（默认的172.20.18.38是我在0.10搭建好的）；</li>\n<li>在你的markdown 编辑器按照以下操作文件-&gt;偏好设置-&gt;图像-&gt;custom上传服务，在命令里填写<code>python3 upload_script.py的绝对路径 -i 你的服务ip地址  -s</code> 例如<code>python3 /home/longtao/workspace/projects/picture_pool/upload_script.py -i 172.20.18.38 -s</code><br> <img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/16353092275f552d50-f59f-11eb-8016-fa1e86d74c00\"></li>\n<li>选择插入图片时上传图片，勾选，本地和网络，点击验证上传服务，如下为成功验证<br> <img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211027/163530923262f6ba28-f59f-11eb-90f6-fa1e86d74c00\"></li>\n</ol>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"使用qemu-imag打包iso","slug":"tools/qemu-img","date":"2021-02-22T15:10:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/qemu-img.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177277R-C.017f4d23913d88e0026e0d0ffe1cab9b?rik=FsE6SpMRqvcnqQ&riu=http%3a%2f%2finews.gtimg.com%2fnewsapp_match%2f0%2f4764532864%2f0.jpg&ehk=biDiFq655BeTM1sXCzD%2bZEZuzr41ysdxXrvKKr68LLE%3d&risl=&pid=ImgRaw&r=0","content":"<h3 id=\"使用qemu-image-压缩qcow2镜像\"><a href=\"#使用qemu-image-压缩qcow2镜像\" class=\"headerlink\" title=\"使用qemu-image 压缩qcow2镜像\"></a>使用qemu-image 压缩qcow2镜像</h3><p>qemu-img convert -c -O qcow2 raw.qcow2 outZipped.qcow2</p>\n<p>raw.qcow2是原始镜像</p>\n<p>outZipped.qcow2是压缩后的目标镜像</p>\n<h3 id=\"转换并压缩\"><a href=\"#转换并压缩\" class=\"headerlink\" title=\"转换并压缩\"></a>转换并压缩</h3><p>qemu-img convert -f raw -O qcow2</p>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"redis搭建","slug":"tools/redis","date":"2020-10-23T13:20:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/redis.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211026/1635180052R-C.6e257f1ac9a9ca4b9066f969e0cf5891?rik=sbTjFdKN01gA8w&riu=http%3a%2f%2fi0.hdslb.com%2fbfs%2farchive%2f67dbfe22879d3ed27ff8231184a733d857221134.png&ehk=6P5sf%2f7nkeSmkuFMQwLmte7X19ldc%2b0JtmPptg0Ij2k%3d&risl=&pid=ImgRaw&r=0","content":"<p>单个节点redis搭建</p>\n<ol>\n<li>从官网或github下载源码</li>\n<li>安装gcc</li>\n<li>make（可设置内存分配器为libc，默认为jemalloc，默认更好）（内存分配器未设置为jemalloc，可能影响并发性能，并加重内存碎片，rust用的也是这个内存分配器， info memory查看内存分配器）</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"redis集群搭建\"><a href=\"#redis集群搭建\" class=\"headerlink\" title=\"redis集群搭建\"></a>redis集群搭建</h2><ol>\n<li><p>一．安装前准备<br>关闭SELinux</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setenforce 0</span><br><span class=\"line\">echo &quot;&#x2F;usr&#x2F;sbin&#x2F;setenforce 0&quot;</span><br><span class=\"line\">sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;sysconfig&#x2F;selinux </span><br><span class=\"line\">sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>   设置防火墙</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld</span><br><span class=\"line\">systemctl disable firewalld</span><br><span class=\"line\">vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 6379 -j ACCEPT</span><br><span class=\"line\">service iptables restart</span><br></pre></td></tr></table></figure>\n\n\n<p>   时钟校对</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ntpdate</span><br><span class=\"line\">echo &quot;#Clock synchronization&quot; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br><span class=\"line\">echo &quot;01 00 * * * &#x2F;sbin&#x2F;ntpdate ntp2.aliyun.com;&#x2F;sbin&#x2F;hwclock -w&quot; &gt;&gt; &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br></pre></td></tr></table></figure>\n\n\n<p>   调整文件打开数</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;20-nproc.conf </span><br><span class=\"line\">root soft nofile 102400</span><br><span class=\"line\">root hard nofile 102400</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<p>   <code>yum -y install gcc gcc-c++</code><br>   二.安装red is<br>   下载redis安装包</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.5.tar.gz</span><br><span class=\"line\">tar zxvf redis-5.0.5.tar.gz </span><br><span class=\"line\">cd redis-5.0.5&#x2F;</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\">创建文件目录</span><br></pre></td></tr></table></figure>\n\n<p>   <code>mkdir -p /opt/redis/&#123;db,etc,bin,logs&#125;</code><br>   将启动文件拷贝至文件目录</p>\n<p>   [root@localhost redis-5.0.5]#cd  src/<br>   [root@localhost src]#cp mkreleasehdr.sh redis-benchmark redis-check-aof redis-server redis-cli  /opt/redis/bin<br>   1<br>   2<br>   修改配置文件/opt/redis/etc/redis.conf</p>\n<p>   bind 0.0.0.0  #绑定的IP地址，0.0.0.0对所有开放<br>   protected-mode no  #关闭保护模式，让其他主机连接<br>   port 6379 #服务端口<br>   tcp-backlog 511 #tcp连接等待队列长度<br>   timeout 0<br>   tcp-keepalive 300<br>   daemonize yes #开启后台模式<br>   supervised no<br>   pidfile /var/run/redis_6379.pid #进程文件<br>   loglevel notice<br>   logfile /opt/redis/logs/redis.log #日志文件<br>   databases 1 #数据库的个数，默认16，由于集群不支持切换库，所有只有一个库<br>   always-show-logo yes<br>   #指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合<br>       save <seconds> <changes><br>       Redis默认配置文件中提供了三个条件：<br>   save 900 1<br>   save 300 10<br>   save 60 10000<br>   stop-writes-on-bgsave-error yes #后台备份出错时，是否停止写入keys到哈希槽<br>   rdbcompression yes #数据文件是否压缩<br>   rdbchecksum yes#数据文件执行校验<br>   dbfilename dump-6379.rdb #指定本地数据库文件名，默认值为dump.rdb<br>   dir /opt/redis/db/ #指定本地数据库存放目录<br>   replica-serve-stale-data yes<br>   replica-read-only yes<br>   repl-diskless-sync no<br>   repl-diskless-sync-delay 5<br>   repl-disable-tcp-nodelay no<br>   replica-priority 100<br>   masterauth 123456 #主机授权密码<br>   requirepass 123456 #数据库密码<br>   maxclients 10000 #最大客户端连接数<br>   lazyfree-lazy-eviction no<br>   lazyfree-lazy-expire no<br>   lazyfree-lazy-server-del no<br>   replica-lazy-flush no<br>   appendonly no<br>   appendfilename “appendonly.aof” #启动Redis上启用了AOF，则会加载AOF，这是具有更好的耐久性保证的文件，相当于MySQL的二进制文件<br>   appendfsync everysec #磁盘上刷新数据，每一秒钟一次<br>   no-appendfsync-on-rewrite no #如果您有延迟问题，请将其转换为”yes”。否则，从持久性的角度来看，设置为”no”是最安全的选择。<br>   auto-aof-rewrite-percentage 100<br>   auto-aof-rewrite-min-size 64mb #自动重写附加文件<br>   aof-load-truncated yes<br>   aof-use-rdb-preamble yes<br>   lua-time-limit 5000<br>   cluster-enabled yes #开启集群<br>   cluster-config-file node1-6379.conf #集群节点配置文件，由Redis节点自动创建和更新的,非人工创建<br>   cluster-node-timeout 15000 #集群节点超时,连接不上的时间<br>   cluster-slave-validity-factor 10  #从节点与主节点失联多久，从节点尝试升级成主节点。如果设置成正数，则cluster-node-timeout乘以cluster-slave-validity-factor得到的时间，是从节点与主节点失联后，此从节点数据有效的最长时间，超过这个时间，从节点不会启动故障迁移<br>   cluster-migration-barrier 1 #主节点需要的最小从节点数，只有达到这个数，主节点失败时，它从节点才会进行迁移<br>   cluster-require-full-coverage yes  #在部分key所在的节点不可用时，如果此参数设置为”yes”(默认值), 则整个集群停止接受操作；如果此参数设置为”no”，则集群依然为可达节点上的key提供读操作。<br>   slowlog-log-slower-than 10000<br>   slowlog-max-len 128<br>   latency-monitor-threshold 0<br>   notify-keyspace-events “”<br>   hash-max-ziplist-entries 512<br>   hash-max-ziplist-value 64<br>   list-max-ziplist-size -2<br>   list-compress-depth 0<br>   set-max-intset-entries 512<br>   zset-max-ziplist-entries 128<br>   zset-max-ziplist-value 64<br>   hll-sparse-max-bytes 3000<br>   stream-node-max-bytes 4096<br>   stream-node-max-entries 100<br>   activerehashing yes<br>   client-output-buffer-limit normal 0 0 0<br>   client-output-buffer-limit replica 256mb 64mb 60<br>   client-output-buffer-limit pubsub 32mb 8mb 60<br>   hz 10 #Redis调用一个内部函数来执行许多后台任务<br>   dynamic-hz yes<br>   aof-rewrite-incremental-fsync yes<br>   rdb-save-incremental-fsync yes<br>   配置启动脚本</p>\n<p>   #!/bin/sh</p>\n<h1 id=\"chkconfig-35-10-90\"><a href=\"#chkconfig-35-10-90\" class=\"headerlink\" title=\"chkconfig: 35 10 90\"></a>chkconfig: 35 10 90</h1><p>   #重要！否则chkconfig不能识别开机启动服务项；<br>   #”35”为运行级别，”10”为启动优先级，”90”为关闭优先级<br>   #</p>\n<h1 id=\"Simple-Redis-init-d-script-conceived-to-work-on-Linux-systems\"><a href=\"#Simple-Redis-init-d-script-conceived-to-work-on-Linux-systems\" class=\"headerlink\" title=\"Simple Redis init.d script conceived to work on Linux systems\"></a>Simple Redis init.d script conceived to work on Linux systems</h1><h1 id=\"as-it-does-use-of-the-proc-filesystem\"><a href=\"#as-it-does-use-of-the-proc-filesystem\" class=\"headerlink\" title=\"as it does use of the /proc filesystem.\"></a>as it does use of the /proc filesystem.</h1><p>   REDISPORT=6379<br>   EXEC=/opt/redis/bin/redis-server</p>\n<h1 id=\"CLIEXEC-usr-local-bin-redis-cli\"><a href=\"#CLIEXEC-usr-local-bin-redis-cli\" class=\"headerlink\" title=\"CLIEXEC=/usr/local/bin/redis-cli\"></a>CLIEXEC=/usr/local/bin/redis-cli</h1><p>   CLIEXEC=/opt/redis/bin/redis-cli</p>\n<h1 id=\"PIDFILE-var-run-redis-REDISPORT-pid\"><a href=\"#PIDFILE-var-run-redis-REDISPORT-pid\" class=\"headerlink\" title=\"PIDFILE=/var/run/redis_${REDISPORT}.pid\"></a>PIDFILE=/var/run/redis_${REDISPORT}.pid</h1><p>   PIDFILE=/var/run/redis_${REDISPORT}.pid</p>\n<h1 id=\"CONF-”-etc-redis-REDISPORT-conf”\"><a href=\"#CONF-”-etc-redis-REDISPORT-conf”\" class=\"headerlink\" title=\"CONF=”/etc/redis/${REDISPORT}.conf”\"></a>CONF=”/etc/redis/${REDISPORT}.conf”</h1><p>   CONF=”/opt/redis/etc/redis.conf”</p>\n<p>   USER=root            #添加执行用户变量</p>\n<p>   case “$1” in<br>       start)<br>           if [ -f $PIDFILE ]<br>           then<br>                   echo “$PIDFILE exists, process is already running or crashed”<br>           else<br>                   echo “Starting Redis server…”<br>                   $EXEC $CONF</p>\n   <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    fi</span><br><span class=\"line\">    ;;</span><br><span class=\"line\">stop)</span><br><span class=\"line\">    if [ ! -f $PIDFILE ]</span><br><span class=\"line\">    then</span><br><span class=\"line\">            echo &quot;$PIDFILE does not exist, process is not running&quot;</span><br><span class=\"line\">    else</span><br><span class=\"line\">            PID&#x3D;$(cat $PIDFILE)</span><br><span class=\"line\">            echo &quot;Stopping ...&quot;</span><br><span class=\"line\">            $CLIEXEC -p $REDISPORT shutdown</span><br><span class=\"line\">            while [ -x &#x2F;proc&#x2F;$&#123;PID&#125; ]</span><br><span class=\"line\">            do</span><br><span class=\"line\">                echo &quot;Waiting for Redis to shutdown ...&quot;</span><br><span class=\"line\">                sleep 1</span><br><span class=\"line\">            done</span><br><span class=\"line\">            echo &quot;Redis stopped&quot;</span><br><span class=\"line\">    fi</span><br><span class=\"line\">    ;;</span><br><span class=\"line\">restart|force-reload)</span><br><span class=\"line\">            $&#123;0&#125; stop</span><br><span class=\"line\">            $&#123;0&#125; start</span><br><span class=\"line\">            ;;</span><br><span class=\"line\">    *)</span><br><span class=\"line\">            echo &quot;Usage: &#x2F;etc&#x2F;init.d&#x2F;redis-server &#123;start|stop|restart|force-reload&#125;&quot; &gt;&amp;2</span><br><span class=\"line\">            exit 1</span><br><span class=\"line\">将脚本放置&#x2F;etc&#x2F;init.d&#x2F;redis-server</span><br></pre></td></tr></table></figure>\n<p>   设置开机自启</p>\n<p>   [root@localhost ~]#chkconfig –add redis-server<br>   [root@localhost ~]#chkconfig –level 35 redis-server on  #默认runlevel 35已打开<br>   1<br>   2<br>   启动脚本设置执行权限</p>\n<p>   [root@localhost ~]#chmod +x /etc/init.d/redis-server<br>   1<br>   启动redis<br>   #可通过启动脚本启动/关闭服务；或采用”service”指令</p>\n<p>   [root@localhost ~]#/etc/init.d/redis-server start<br>   1<br>   创建集群<br>   在5.0之前该工具是由ruby语言编写的redis-trib.rb，在使用前需要安装ruby语言环境。在5.0之后redis摒弃了该工具，将搭建集群的功能合并到了redis-cli上。<br>   这里就可以直接创建集群，不需要在安装其他工具。</p>\n<p>   创建集群需要注意,最少要6个服务,否则创建集群失败.</p>\n<p>   redis-cli –cluster create 110.110.100.35:6379 110.110.100.36:6379 110.110.100.37:6379 110.110.100.38:6379 110.10.1100.39:6379 110.10.100.40:6379 –cluster-replicas 1 -a 123456</p>\n<p>   参数说明<br>   redis-cli 客户端工具<br>   –cluster create 创建一个新的集群<br>   –cluster-replicas 1 每一个主库对应一个从库<br>   -a 数据库密码</p>\n<p>   出现下面的字样说明创建成功</p>\n<p>   [OK] All nodes agree about slots configuration.</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Check for open slots…<br>Check slots coverage…<br>[OK] All 16384 slots covered.<br>1<br>2<br>3<br>4<br>登陆验证</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>   redis-cli -c -p 端口<br>   auth 密码</p>\n<p>   删除主节点<br>   redis-cli –cluster reshard 110.110.100.35:6379</p>\n<p>   到这里就搭建完成了</p>\n<p>   搭建过程中有的问题也有记录在异常处理</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup redis-server &#x2F;opt&#x2F;redis&#x2F;etc&#x2F;redis.conf &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<table>\n<thead>\n<tr>\n<th>测试端redis6,被测redis5</th>\n<th>单台</th>\n<th>集群</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>redis-benchmark -h 172.20.59.57 -p 6379 –threads 500 -t get -d 500 -c 500 -n 10000000</td>\n<td>137794.19 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td>redis-benchmark -h 172.20.59.57 -p 6379 –threads 500 -t set -d 500 -c 500 -n 10000000</td>\n<td>132383.70 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>测试端redis5,被测redis5</th>\n<th>单台</th>\n<th>集群</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>redis-benchmark -h 172.20.59.57 -p 6379  -t get -d 500 -c 500 -n 10000000</td>\n<td>84317.03 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td>redis-benchmark -h 172.20.59.57 -p 6379  -t set -d 500 -c 500 -n 10000000</td>\n<td>98796.66 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>测试端redis6,被测redis5 物理机</th>\n<th>单台</th>\n<th>集群</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>redis-benchmark -h 172.20.1.30 -p 6379  -t get -d 500 -c 500 -n 10000000</td>\n<td>106834.19 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td>redis-benchmark -h 172.20.1.30 -p 6379  -t set -d 500 -c 500 -n 10000000</td>\n<td>113291.34 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td>redis-benchmark -h 172.20.1.30 -p 6379 –threads 500 -t set -d 500 -c 500 -n 10000000</td>\n<td>163041.70 requests per second</td>\n<td></td>\n</tr>\n<tr>\n<td>redis-benchmark -h 172.20.1.30 -p 6379 –threads 500 -t get -d 500 -c 500 -n 10000000</td>\n<td>169396.78 requests per second</td>\n<td></td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>set(requests per second)</th>\n<th>get(requests per second)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>物理机（redis5）+测试机（redis6+threads 500）</td>\n<td>163041.70</td>\n<td>169396.78</td>\n</tr>\n<tr>\n<td>物理机（redis5）+测试机（redis6+threads）</td>\n<td>113291.34</td>\n<td>106834.19</td>\n</tr>\n<tr>\n<td>云主机8c8g（redis5）+测试机（redis6+threads 500）</td>\n<td>132383.70</td>\n<td>137794.19</td>\n</tr>\n<tr>\n<td>云主机8c8g（redis5）+测试机（redis6）</td>\n<td>109325.46</td>\n<td>110688.03</td>\n</tr>\n<tr>\n<td>云主机8c8g（redis5）+测试机（redis5）</td>\n<td>98796.66</td>\n<td>84317.03</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">redis-cli --cluster create 172.20.59.83:6379 172.20.59.119:6379 172.20.59.54:6379 172.20.59.59:6379 172.20.59.99:6379 172.20.59.52:6379 --cluster-replicas 1 -a 123456</span><br></pre></td></tr></table></figure>\n\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"访问samba共享文件夹","slug":"tools/samba","date":"2019-11-03T12:13:11.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/samba.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635177413Samba-Ubuntu-16.04.png","content":"<h3 id=\"whats-samba？\"><a href=\"#whats-samba？\" class=\"headerlink\" title=\"whats samba？\"></a>whats samba？</h3><p>Samba is the standard Windows interoperability suite of programs for Linux and Unix.</p>\n<h3 id=\"Use-in-linux\"><a href=\"#Use-in-linux\" class=\"headerlink\" title=\"Use in linux\"></a>Use in linux</h3><h3 id=\"Use-in-Windows\"><a href=\"#Use-in-Windows\" class=\"headerlink\" title=\"Use in Windows\"></a>Use in Windows</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mount -t cifs //ip地址/path/to/share path/to/mount</span><br><span class=\"line\">: &lt;&lt;&#x27;COMMEN</span><br><span class=\"line\">mount：挂载命令</span><br><span class=\"line\">-t cifs： 用cifs文件系统挂载samba共享文件，如果提示错误的文件系统的话，可能是没有cifs，需要自己安装。【centos：</span><br><span class=\"line\">yum install nfs-utils】</span><br><span class=\"line\"></span><br><span class=\"line\">//ip地址/path/to/share：共享目录路径</span><br><span class=\"line\">path/to/mount：要挂载的路径，需要自己创建一个</span><br><span class=\"line\">COMMENT</span><br></pre></td></tr></table></figure>\n\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"trex测试流程","slug":"tools/trex","date":"2021-03-22T15:24:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/trex.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211026/1635177828R-C.d34f9c2395acdb73efab09b9a7eb54c8?rik=ySFewf9hg74oTQ&riu=http%3a%2f%2fwww.jianbihua.net%2fuploads%2fallimg%2f190926%2f1S1064S8_0.jpg&ehk=H2DKfkxH1czTQubUYuvnzsiMtIpOApDO%2fpIcY%2f7AVtI%3d&risl=&pid=ImgRaw&r=0","content":"<h2 id=\"Trex简单测试\"><a href=\"#Trex简单测试\" class=\"headerlink\" title=\"Trex简单测试\"></a>Trex简单测试</h2><h3 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h3><ol>\n<li><p>trex主机与dut主机第一个network为管理网，第二个与第三个network为测试用网，trex主机与dut主机测试用网eth1互联，trex主机与dut主机测试用网eth2互联;</p>\n</li>\n<li><p>只可运行net_set.sh 一次，获得mac地址，若mac地址全为0，重启trex主机;</p>\n</li>\n<li><p>测试项可在run_trex.sh修改（-m 参数为几万pps  -d参数为测试时间）。</p>\n</li>\n</ol>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><ol>\n<li>打开trex主机 运行trex_set.sh 并得到两个mac地址fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开dut主机运行 dut_set.sh fa:ad:96:2e:3c:01 fa:0b:32:14:a9:02；</li>\n<li>打开trex主机运行run_trex.sh ，等待运行结束得到trex结果。</li>\n</ol>\n<h3 id=\"镜像地址\"><a href=\"#镜像地址\" class=\"headerlink\" title=\"镜像地址\"></a>镜像地址</h3><p>dut：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-dut.qcow2</a></p>\n<p>trex：<a href=\"http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2\">http://192.168.200.100/mirror/longtao.wu/image_store/linux_image/wlt-simpletrextest-trex.qcow2</a></p>\n<h2 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h2><p>dut_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip link set dev eth1 up</span><br><span class=\"line\">ip link set dev eth2 up</span><br><span class=\"line\">ip a add 192.168.155.3/24 dev eth1</span><br><span class=\"line\">ip a add 192.168.166.5/24 dev eth2</span><br><span class=\"line\">ip r add 16.0.0.0/8 via 192.168.155.2</span><br><span class=\"line\">ip r add 48.0.0.0/8 via 192.168.166.4</span><br><span class=\"line\">ip n add 192.168.155.2 dev eth1 lladdr $0</span><br><span class=\"line\">ip n add 192.168.166.4 dev eth2 lladdr $1</span><br><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>\n\n<p>net_set.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a=(`ip a | grep ^[1-9] | awk -F: &#x27;&#123;print $2&#125;&#x27; | sed &#x27;1,2d&#x27;`)</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    b[$i]=`ethtool -i $&#123;a[$i]&#125; |grep bus | awk -F &#x27;:&#x27; &#x27;&#123;print $3 $4 $5&#125;&#x27;|sed -e &#x27;s/../\\0:/&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    echo $&#123;a[$i]&#125; $&#123;b[$i]&#125;</span><br><span class=\"line\">  done</span><br><span class=\"line\">for ((i=0;i&lt;2;i++))</span><br><span class=\"line\">  do</span><br><span class=\"line\">    e[$i]=`ip link show $&#123;a[$i]&#125; |head -2|tail -1|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class=\"line\">  done</span><br><span class=\"line\">cp /root/trex/v2.81/cfg/simple_cfg.yaml  /etc/trex_cfg.yaml.bak</span><br><span class=\"line\">sed &#x27;4,$d&#x27; /etc/trex_cfg.yaml.bak &gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  interfaces    : [&quot;&#x27;$&#123;b[0]&#125;&#x27;&quot;,&quot;&#x27;$&#123;b[1]&#125;&#x27;&quot;]&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;  port_info       :  # Port IPs. Change to suit your needs. In case of loopback, you can leave as is.&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.155.2&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.155.3&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;          - ip         : 192.168.166.4&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;            default_gw : 192.168.166.5&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">echo -e &#x27;\\n\\n&#x27;&gt;&gt;/etc/trex_cfg.yaml</span><br><span class=\"line\">cd ~/trex/v2.81/</span><br><span class=\"line\">./dpdk_setup_ports.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> cat /etc/trex_cfg.yaml</span></span><br><span class=\"line\">cat /root/trex/v2.81/cfg/simple_cfg.yaml</span><br><span class=\"line\">cat /etc/trex_cfg.yaml</span><br><span class=\"line\">echo &#x27;config success ! dont config again!  if not configed please reboot your mechine and check your network  sum is 2 and the last 2 network are connected.&#x27;</span><br><span class=\"line\">echo -e &#x27;\\n&#x27;</span><br><span class=\"line\">echo $&#123;e[0]&#125;&#x27; &#x27;$&#123;e[1]&#125;</span><br></pre></td></tr></table></figure>\n\n<p>run_trex.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root/trex/v2.81; ./t-rex-64 -f cap2/imix_longtao_1w.yaml -m 5 -d 5</span><br></pre></td></tr></table></figure>\n\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"ubuntu使用指北","slug":"tools/ubuntu","date":"2021-11-21T12:12:11.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/ubuntu.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211124/1637718777Ubuntu-Pink.png","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>[toc]</p>\n<h2 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h2><p><img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211124/1637718777Ubuntu-Pink.png\"></p>\n<h2 id=\"方便使用\"><a href=\"#方便使用\" class=\"headerlink\" title=\"方便使用\"></a>方便使用</h2><h3 id=\"ubuntu的sudo不用每次都输入密码解决办法\"><a href=\"#ubuntu的sudo不用每次都输入密码解决办法\" class=\"headerlink\" title=\"ubuntu的sudo不用每次都输入密码解决办法\"></a>ubuntu的sudo不用每次都输入密码解决办法</h3><p><strong>方法</strong>:修改<code>/etc/sudoers</code>文件中的<code>%sudo   ALL=(ALL:ALL) ALL   修改为  %sudo   ALL=(ALL:ALL) NOPASSWD:ALL</code><br><strong>原因</strong>：<code>/etc/sudoers</code>为<code>sudo</code>配置文件，当用户执行<code>sudo</code>时，系统会主动寻找<code>/etc/sudoers</code>文件，判断该用户是否有执行<code>sudo</code>的权限，确认用户具有可执行sudo的权限后，让用户输入用户自己的密码确认，若密码输入成功，则开始执行sudo后续的命令</p>\n<h3 id=\"py2-py3-设置-pip\"><a href=\"#py2-py3-设置-pip\" class=\"headerlink\" title=\"py2 py3 设置 pip\"></a>py2 py3 设置 pip</h3><p>下载<a href=\"https://bootstrap.pypa.io/pip/2.7/get-pip.py\">https://bootstrap.pypa.io/pip/2.7/get-pip.py</a></p>\n<p>sudo python2 get-pip.py安装 就可使用pip2了</p>\n<h2 id=\"Linux-通用\"><a href=\"#Linux-通用\" class=\"headerlink\" title=\"Linux 通用\"></a>Linux 通用</h2><h3 id=\"linux如何制作U盘系统镜像\"><a href=\"#linux如何制作U盘系统镜像\" class=\"headerlink\" title=\"linux如何制作U盘系统镜像\"></a>linux如何制作U盘系统镜像</h3><p>方法挺多的，这里用<code>dd</code>命令实现</p>\n<h4 id=\"获取U盘路径\"><a href=\"#获取U盘路径\" class=\"headerlink\" title=\"获取U盘路径\"></a>获取U盘路径</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fdisk -l <span class=\"comment\">#diskmode 是 USB的那个就是</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"卸载U盘\"><a href=\"#卸载U盘\" class=\"headerlink\" title=\"卸载U盘\"></a>卸载U盘</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo umount /dev/sda* <span class=\"comment\">#我这里的U盘路径是/dev/sda</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"格式化U盘\"><a href=\"#格式化U盘\" class=\"headerlink\" title=\"格式化U盘\"></a>格式化U盘</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkfs.vfat /dev/sda -I <span class=\"comment\"># mkfs.vfat 与mkfs.fat以及mkdosfs效果一样的都是创建vfat文件系统</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"制作系统盘\"><a href=\"#制作系统盘\" class=\"headerlink\" title=\"制作系统盘\"></a>制作系统盘</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dd <span class=\"keyword\">if</span>=~/yourImage.iso of=/dev/sda <span class=\"comment\"># ~/yourImage.iso是你的iso文件</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h4><ol>\n<li>dd命令直接将Linux的iso写入U盘就能开机引导的原因是，这些Linux的iso自带了引导文件，所以用dd将Windows的iso写入U盘将不能开机引导，Windows的U盘启动盘制作方法，请参考本文第三小节</li>\n</ol>\n<h3 id=\"配置免密\"><a href=\"#配置免密\" class=\"headerlink\" title=\"配置免密\"></a>配置免密</h3><p>如果没有设置root密码，先设置一下root账户密码：<br>sudo passwd root<br>为了避免每次sudo都要输入密码，这里配置一下visudo：<br>sudo visudo<br>在文件最后加上一句（改为自己的用户名）：<br>longtao ALL=(ALL) NOPASSWD: ALL</p>\n<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><h2 id=\"IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了\"><a href=\"#IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了\" class=\"headerlink\" title=\"IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了\"></a>IBUS输入法崩溃可能会导致gnome卡住，等待超时就好了</h2><p><img src= \"/img/loading.gif\" data-lazy-src=\"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/22/17622374100240188772124472144517832259_image-20220721114611372.png\" alt=\"image-20220721114611372\"></p>\n<h2 id=\"IBUS输入法与jetbrain全家桶有冲突，谨慎使用\"><a href=\"#IBUS输入法与jetbrain全家桶有冲突，谨慎使用\" class=\"headerlink\" title=\"IBUS输入法与jetbrain全家桶有冲突，谨慎使用\"></a>IBUS输入法与jetbrain全家桶有冲突，谨慎使用</h2>","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]},{"title":"zeroconf与mDNS","slug":"tools/zeroconf","date":"2021-04-22T15:20:21.000Z","updated":"2024-06-30T10:35:56.312Z","comments":true,"path":"api/articles/tools/zeroconf.json","excerpt":null,"keywords":"云计算","cover":"https://cdn.jsdelivr.net/gh/Longtao-W/pics@main/20211025/1635172543v2-63f3b744dfd677033510885cd655a34c_r.jpg","content":"<p>[toc]</p>\n<h2 id=\"基础概念\"><a href=\"#基础概念\" class=\"headerlink\" title=\"基础概念\"></a>基础概念</h2><h3 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h3><p>路由中有以下几种形式</p>\n<p>单播：在网络地址和网络节点之间存在一一对应的关系。</p>\n<p>任播：根据路由拓扑自动决定送到“最近”或“最好”的目的地</p>\n<p>多播：是一种群组通信，它把信息同时传递给一组目的计算机。常指IP多播，组播地址224.0.0.0～224.0.0.255</p>\n<p>广播:向指定网络范围内所以设备发送信息，主机标识段host ID 为全1 的IP 地址为广播地址，ARP、DHCP都使用了广播</p>\n<p>地域性广播：一种“特殊”的多播</p>\n<h3 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h3><p>Domain Name System,域名服务，将域名和ip地址互相影射的分布式数据库，使用TCP和UDP的53端口</p>\n<p>TCP：面向连接的协议，提供可靠的数据传输，一般服务质量要求比较高的情况，使用这个协议。</p>\n<p>UDP：用户数据报协议，是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。</p>\n<h2 id=\"zeroConf\"><a href=\"#zeroConf\" class=\"headerlink\" title=\"zeroConf\"></a>zeroConf</h2><p>Zero configuration networking,零配置网络服务规范是一种让用户武穴使用DHCP、DNS等设置就能自动连接设备的一种规范，主要包含以下协议</p>\n<ul>\n<li>Link-Local Address： 无需利用DHCP Server 取得设备地址和IP的相关资料 【RFC3927】</li>\n<li>Multicast Dns： 不需要DNS Server 就可以解决domain 和ip的绑定关系 【RFC6762】</li>\n<li>DNS-SD（dns-based service discovery）： 不需要目录服务器，就可以自动发现设备服务 【RFC6763】</li>\n</ul>\n<h2 id=\"mDNS\"><a href=\"#mDNS\" class=\"headerlink\" title=\"mDNS\"></a>mDNS</h2><h4 id=\"原理和特点\"><a href=\"#原理和特点\" class=\"headerlink\" title=\"原理和特点\"></a>原理和特点</h4><p>Multicast DNS (mDNS)，多播DNS，使用5353端口，组播地址为 <code>224.0.0.251</code> 或 <code>[FF02::FB]</code> 。在一个没有常规DNS服务器的小型网络内可以使用mDNS来实现类似DNS的编程接口、包格式和操作语义,mdns协议使用DNS协议一样的数据包</p>\n<p>若主机开启了mDNS，在进入局域网内时会向224.0.0.251地址发送信息，信息内容包含，ip地址端口号，服务名等；</p>\n<p>同时其mDNS服务会向其它mDNS询问获取局域网内的服务。</p>\n<p>mDNS的顶级域名用 <code>.local</code> 和普通域名区分开的.</p>\n<h2 id=\"DNS-SD\"><a href=\"#DNS-SD\" class=\"headerlink\" title=\"DNS-SD\"></a>DNS-SD</h2><p>DNS Service Discovery是一种基于 DNS 协议的服务发现协议，设备之间可以通过该协议自动发现服务</p>\n<p>使用如下格式</p>\n<p><code>&lt;instance&gt;.&lt;service&gt;.&lt;transport&gt;.&lt;domain&gt;</code></p>\n<h4 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a>流程</h4><p>启动DNS-SD的主机在进入局域网后或启动DNS-SD后会向组播地址发送组播消息，包括主机名、IP信息等，其他拥有相应服务的主机会响应</p>\n<p>关闭DNS-SD的主机在关闭DNS-SD后会向组播地址刷新组播消息，清除信息</p>\n<h2 id=\"技术应用\"><a href=\"#技术应用\" class=\"headerlink\" title=\"技术应用\"></a>技术应用</h2><p>avahi、bonjour、WiSe-Zeroconf是zeroconf协议的常用实现</p>\n<p>在苹果家族中常使用Bonjour、linux中常用avahi、在嵌入式领域常用WiSe-Zeroconf</p>\n<h3 id=\"小玩具\"><a href=\"#小玩具\" class=\"headerlink\" title=\"小玩具\"></a>小玩具</h3><h4 id=\"安装-amp-下载-rocket\"><a href=\"#安装-amp-下载-rocket\" class=\"headerlink\" title=\"安装&amp;下载:rocket:\"></a>安装&amp;下载:rocket:</h4><p>使用golang的<code>zeroconf</code>包进行简单封装的玩具</p>\n<p>server端：<a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-linux-amd64\">amd64-linux</a> <a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-mac-amd64\">amd64-mac</a> <a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-server-win-amd64.exe\">amd64-win</a></p>\n<p>client端：<a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-linux-amd64\">amd64-linux</a> <a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-mac-amd64\">amd64-mac</a> <a href=\"http://192.168.200.150/mirror/longtao.wu/tools/mdnsToy/mdns-client-win-amd64.exe\">amd64-win</a></p>\n<h4 id=\"演示\"><a href=\"#演示\" class=\"headerlink\" title=\"演示\"></a>演示</h4><h3 id=\"AVAHI\"><a href=\"#AVAHI\" class=\"headerlink\" title=\"AVAHI\"></a>AVAHI</h3><h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nss-mDNS avahi avahi-tools -y</span><br></pre></td></tr></table></figure>\n\n<p>avahi-tools是avahi的工具包，包含avahi-browse、avahi-publish-address 、 avahi-resolve-host-nameavahi-browse-domains、avahi-publish-service、avahi-set-host-name、avahi-daemon、avahi-resolve、avahi-publish、avahi-resolve-address</p>\n<p>常用的avahi-browse的功能如下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-D --browse-domains  浏览域而不是服务</span><br><span class=\"line\">-a --all             显示所有服务，忽略类型</span><br><span class=\"line\">-d --domain=DOMAIN   要浏览的域</span><br><span class=\"line\">-v --verbose         启用详述模式</span><br><span class=\"line\">-t --terminate       导出一个完整列表后终止</span><br><span class=\"line\">-c --cache           导出缓存中的所有条目后终止</span><br><span class=\"line\">-l --ignore-local    忽略本地服务</span><br><span class=\"line\">-r --resolve         解析找到的服务</span><br><span class=\"line\">-f --no-fail         如果 daemon 不可用也不中断</span><br><span class=\"line\">-p --parsable        输出可解析格式</span><br><span class=\"line\">-k --no-db-lookup    不查询服务类型</span><br><span class=\"line\">-b --dump-db         导出服务类型数据库</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加服务\"><a href=\"#添加服务\" class=\"headerlink\" title=\"添加服务\"></a>添加服务</h4><p>创建文件 /etc/avahi/services/wltHello.service</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; standalone&#x3D;&#39;no&#39;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE service-group SYSTEM &quot;avahi-service.dtd&quot;&gt;</span><br><span class=\"line\">&lt;service-group&gt;</span><br><span class=\"line\">    &lt;name&gt;wlt@*Hello&lt;&#x2F;name&gt;</span><br><span class=\"line\">    &lt;service&gt;</span><br><span class=\"line\">        &lt;type&gt;_wlt@*Hello._tcp&lt;&#x2F;type&gt;</span><br><span class=\"line\">        &lt;port&gt;5678&lt;&#x2F;port&gt;</span><br><span class=\"line\">    &lt;&#x2F;service&gt;</span><br><span class=\"line\">&lt;&#x2F;service-group&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"重启服务\"><a href=\"#重启服务\" class=\"headerlink\" title=\"重启服务\"></a>重启服务</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart dbus</span><br><span class=\"line\">systemctl restart avahi-daemon</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查询服务\"><a href=\"#查询服务\" class=\"headerlink\" title=\"查询服务\"></a>查询服务</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# avahi-browse -vrtp _wlt@*Hello._tcp</span><br><span class=\"line\">+;eth0;IPv4;wlt\\064\\042Hello;_wlt\\064\\042Hello._tcp;local</span><br><span class=\"line\">=;eth0;IPv4;wlt\\064\\042Hello;_wlt\\064\\042Hello._tcp;local;linux.local;172.20.65.36;5678;</span><br></pre></td></tr></table></figure>\n\n<p>通过avahi-browse即可在局域网内通过avahi-browse发现服务</p>\n<p>在实际生产中，我们可以在开启服务时同时添加mDNS服务，消费者机器通过avahi-browse查询服务得到开启服务的ip地址，再进一步与服务建立链接。除此之外avahi还暴露了一些api：<a href=\"https://www.avahi.org/doxygen/v0.7/html/index.html\">https://www.avahi.org/doxygen/v0.7/html/index.html</a></p>\n","raw":null,"categories":[{"name":"编程技术","path":"api/categories/编程技术.json"}],"tags":[{"name":"应用","path":"api/tags/应用.json"}]}]}